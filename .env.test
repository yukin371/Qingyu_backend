# ============================================
# Qingyu Backend - 测试环境配置
# ============================================
#
# 此配置文件专门用于权限系统测试
# 使用方法: source .env.test (Linux/Mac) 或使用工具加载 (Windows)
#
# ============================================

# ==================== 数据库配置 ====================
# MongoDB配置（使用测试专用端口27018）
QINGYU_DATABASE_URI=mongodb://localhost:27018
QINGYU_DATABASE_NAME=qingyu_permission_test
QINGYU_DATABASE_CONNECT_TIMEOUT=10s
QINGYU_DATABASE_MAX_POOL_SIZE=10
QINGYU_DATABASE_MIN_POOL_SIZE=2
QINGYU_DATABASE_MAX_CONN_IDLE_TIME=60s
QINGYU_DATABASE_RETRY_WRITES=true
QINGYU_DATABASE_RETRY_READS=true

# ==================== Redis配置 ====================
# Redis配置（用于权限缓存，使用测试专用端口6380）
QINGYU_REDIS_ADDR=localhost:6380
QINGYU_REDIS_PASSWORD=
QINGYU_REDIS_DB=1
QINGYU_REDIS_POOL_SIZE=10
QINGYU_REDIS_MIN_IDLE_CONNS=2
QINGYU_REDIS_MAX_RETRIES=3
QINGYU_REDIS_DIAL_TIMEOUT=5s
QINGYU_REDIS_READ_TIMEOUT=3s
QINGYU_REDIS_WRITE_TIMEOUT=3s

# ==================== 服务器配置 ====================
QINGYU_SERVER_PORT=8080
QINGYU_SERVER_MODE=test
QINGYU_LOG_LEVEL=debug

# ==================== JWT配置 ====================
# JWT密钥（测试专用，生产环境必须更换）
QINGYU_JWT_SECRET=test_jwt_secret_key_for_permission_testing_12345
QINGYU_JWT_EXPIRATION_HOURS=24
QINGYU_JWT_REFRESH_EXPIRATION_DAYS=7

# ==================== 权限系统配置 ====================
# 权限中间件配置
PERMISSION_ENABLED=true
PERMISSION_STRATEGY=rbac
PERMISSION_CONFIG_PATH=configs/permissions.yaml

# 权限加载配置
PERMISSION_LOAD_FROM_DB=true
PERMISSION_CACHE_ENABLED=true
PERMISSION_CACHE_TTL=5m
PERMISSION_CACHE_REFRESH_INTERVAL=1m

# 权限格式转换（user.read -> user:read）
PERMISSION_FORMAT_CONVERSION_ENABLED=true

# 权限热更新（测试时可以禁用）
PERMISSION_HOT_RELOAD=false
PERMISSION_HOT_RELOAD_WATCH_CONFIG=false
PERMISSION_HOT_RELOAD_WATCH_DB=false

# 权限会话超时
PERMISSION_SESSION_TIMEOUT=30m

# ==================== 测试配置 ====================
# 测试模式标志
TEST_MODE=true
TEST_DB_NAME=qingyu_permission_test
TEST_MONGO_HOST=localhost
TEST_MONGO_PORT=27018
TEST_REDIS_HOST=localhost
TEST_REDIS_PORT=6380

# ==================== 限流配置 ====================
# 测试时可以禁用限流
RATE_LIMIT_ENABLED=false

# ==================== CORS配置 ====================
# 测试环境允许所有来源
QINGYU_CORS_ALLOWED_ORIGINS=*
QINGYU_CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
QINGYU_CORS_ALLOWED_HEADERS=Origin,Content-Type,Content-Length,Accept-Encoding,Authorization,X-Request-ID
QINGYU_CORS_ALLOW_CREDENTIALS=true

# ==================== AI配置（可选） ====================
# 测试时可以使用mock
QINGYU_AI_API_KEY=test_api_key
QINGYU_AI_BASE_URL=http://localhost:8000
QINGYU_AI_MAX_TOKENS=2000
QINGYU_AI_TEMPERATURE=0.7
QINGYU_AI_MOCK_MODE=true

# ==================== OAuth配置（可选） ====================
# 测试时使用假凭证
GOOGLE_CLIENT_ID=test_google_client_id
GOOGLE_CLIENT_SECRET=test_google_client_secret
GITHUB_CLIENT_ID=test_github_client_id
GITHUB_CLIENT_SECRET=test_github_client_secret

# ==================== 其他配置 ====================
# 时区
TZ=Asia/Shanghai

# 语言
LANG=zh_CN.UTF-8

# ==================== 附加说明 ====================
#
# Windows使用方法:
#   1. 安装 dotenv 工具: go install github.com/joho/godotenv/cmd/godotenv@latest
#   2. 运行: godotenv -f .env.test go run cmd/server/main.go
#
# Linux/Mac使用方法:
#   1. 加载环境变量: export $(cat .env.test | xargs)
#   2. 或使用工具: go run cmd/server/main.go --env .env.test
#
# 或在代码中直接加载:
#   import "github.com/joho/godotenv"
#   godotenv.Load(".env.test")
#
# ============================================
