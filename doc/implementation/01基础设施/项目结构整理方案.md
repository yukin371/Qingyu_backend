# é¡¹ç›®ç»“æ„æ•´ç†æ–¹æ¡ˆ

> **åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
> **æ•´ç†äºº**: yukin371  
> **ç›®çš„**: è§„èŒƒé¡¹ç›®ç»“æ„ï¼Œç¬¦åˆGoé¡¹ç›®æœ€ä½³å®è·µ

---

## ğŸ“‹ é—®é¢˜åˆ†æ

### å½“å‰é—®é¢˜

| é—®é¢˜ | å½“å‰çŠ¶æ€ | æ ‡å‡†å®è·µ | å½±å“ |
|-----|---------|---------|------|
| main.goä½ç½® | æ ¹ç›®å½• | `cmd/server/main.go` | ä¸ç¬¦åˆGoæ ‡å‡† |
| é…ç½®æ–‡ä»¶ä½ç½® | æ ¹ç›®å½• | `config/` ç›®å½• | ç›®å½•æ··ä¹± |
| é‡å¤.dockerignore | 2ä¸ªæ–‡ä»¶ | 1ä¸ªï¼ˆæ ¹ç›®å½•ï¼‰ | å†—ä½™ |
| Makefileè·¯å¾„ | `./cmd/main.go` | å®é™…æ˜¯ `./main.go` | è·¯å¾„é”™è¯¯ |
| æ„å»ºäº§ç‰© | æœªå¿½ç•¥ | åº”åŠ å…¥.gitignore | Gitæ±¡æŸ“ |

### å‘ç°çš„æ–‡ä»¶

```
Qingyu_backend/
â”œâ”€â”€ main.go                    âŒ åº”è¯¥åœ¨ cmd/server/
â”œâ”€â”€ config.yaml                âŒ åº”è¯¥åœ¨ config/
â”œâ”€â”€ config.local.yaml          âŒ åº”è¯¥åœ¨ config/
â”œâ”€â”€ config.docker.yaml         âŒ åº”è¯¥åœ¨ config/
â”œâ”€â”€ .dockerignore              âœ… ä¿ç•™
â”œâ”€â”€ docker/.dockerignore       âŒ åˆ é™¤ï¼ˆé‡å¤ï¼‰
â”œâ”€â”€ Makefile                   âš ï¸ éœ€è¦æ›´æ–°è·¯å¾„
â”œâ”€â”€ Qingyu_backend.exe         âŒ æ„å»ºäº§ç‰©ï¼Œåº”å¿½ç•¥
â””â”€â”€ startup.log                âŒ æ—¥å¿—æ–‡ä»¶ï¼Œåº”å¿½ç•¥
```

---

## ğŸ¯ æ•´ç†æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ ‡å‡†Goé¡¹ç›®ç»“æ„ï¼ˆæ¨èï¼‰â­

æŒ‰ç…§Goå®˜æ–¹æ¨èçš„é¡¹ç›®å¸ƒå±€é‡ç»„ï¼š

#### 1.1 åˆ›å»ºcmdç›®å½•ç»“æ„

```bash
mkdir -p cmd/server
```

#### 1.2 ç§»åŠ¨main.go

```bash
git mv main.go cmd/server/main.go
```

#### 1.3 ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ°configç›®å½•

```bash
git mv config.yaml config/
git mv config.local.yaml config/
git mv config.docker.yaml config/
```

#### 1.4 åˆ é™¤é‡å¤çš„.dockerignore

```bash
# ä¿ç•™æ ¹ç›®å½•çš„ï¼Œåˆ é™¤docker/ç›®å½•çš„
rm docker/.dockerignore
```

#### 1.5 æ›´æ–°Makefile

å°† `MAIN_FILE := ./cmd/main.go` æ”¹ä¸º `MAIN_FILE := ./cmd/server/main.go`

#### 1.6 æ›´æ–°.gitignore

æ·»åŠ æ„å»ºäº§ç‰©å¿½ç•¥ï¼š
```gitignore
# æ„å»ºäº§ç‰©
*.exe
*.exe~
*.dll
*.so
*.dylib
build/
dist/

# æ—¥å¿—æ–‡ä»¶
*.log
startup.log

# æµ‹è¯•è¦†ç›–ç‡
coverage.out
coverage.html

# Airçƒ­é‡è½½å·¥å…·
tmp/
.air.toml
```

---

## ğŸ“ è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1: åˆ›å»ºcmdç›®å½•ï¼ˆ30ç§’ï¼‰

```bash
cd E:\Github\é’ç¾½\Qingyu_backend
mkdir cmd\server
```

### æ­¥éª¤2: ç§»åŠ¨main.goï¼ˆ30ç§’ï¼‰

```bash
# ä½¿ç”¨git mvä¿ç•™å†å²
git mv main.go cmd/server/main.go
```

### æ­¥éª¤3: ç§»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
git mv config.yaml config/
git mv config.local.yaml config/
git mv config.docker.yaml config/
```

### æ­¥éª¤4: åˆ é™¤é‡å¤æ–‡ä»¶ï¼ˆ15ç§’ï¼‰

```bash
# åˆ é™¤dockerç›®å½•ä¸‹çš„.dockerignoreï¼ˆé‡å¤ï¼‰
del docker\.dockerignore
```

### æ­¥éª¤5: æ›´æ–°Makefileï¼ˆ1åˆ†é’Ÿï¼‰

ä¿®æ”¹ `Makefile` æ–‡ä»¶ï¼š
```makefile
# å˜é‡å®šä¹‰
MAIN_FILE := ./cmd/server/main.go  # æ›´æ–°è·¯å¾„
```

### æ­¥éª¤6: æ›´æ–°.gitignoreï¼ˆ2åˆ†é’Ÿï¼‰

åœ¨æ ¹ç›®å½•çš„ `.gitignore` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```gitignore
# æ„å»ºäº§ç‰©
*.exe
*.exe~
build/
dist/

# æ—¥å¿—æ–‡ä»¶
*.log

# æµ‹è¯•è¦†ç›–ç‡
coverage.out
coverage.html

# Airçƒ­é‡è½½
tmp/
```

### æ­¥éª¤7: æ›´æ–°Viperé…ç½®åŠ è½½è·¯å¾„ï¼ˆé‡è¦ï¼ï¼‰âš ï¸

æ£€æŸ¥å¹¶æ›´æ–°åŠ è½½é…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œç¡®ä¿èƒ½æ‰¾åˆ°æ–°ä½ç½®çš„é…ç½®æ–‡ä»¶ã€‚

**éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶**:
- `config/viper_integration.go` - LoadFromFileæ–¹æ³•
- `core/server.go` - æœåŠ¡å™¨åˆå§‹åŒ–
- `main.go` (æ–°ä½ç½®) - å¯åŠ¨ä»£ç 

**å¯èƒ½éœ€è¦çš„ä¿®æ”¹**:
```go
// config/viper_integration.go
func (m *ViperConfigManager) LoadFromFile(configPath string) error {
    m.viper.SetConfigName("config")
    m.viper.SetConfigType("yaml")
    
    // æ·»åŠ å¤šä¸ªé…ç½®è·¯å¾„
    m.viper.AddConfigPath("../../config")  // ä»cmd/server/ç›¸å¯¹è·¯å¾„
    m.viper.AddConfigPath("./config")      // ä»é¡¹ç›®æ ¹ç›®å½•
    m.viper.AddConfigPath(".")             // å½“å‰ç›®å½•
    
    // ... å…¶ä½™ä»£ç 
}
```

### æ­¥éª¤8: éªŒè¯æ•´ç†ç»“æœï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# æµ‹è¯•ç¼–è¯‘
cd cmd/server
go build

# æˆ–ä½¿ç”¨Makefile
cd ../..
make build

# æµ‹è¯•è¿è¡Œ
make run
```

### æ­¥éª¤9: æ¸…ç†æ„å»ºäº§ç‰©ï¼ˆ30ç§’ï¼‰

```bash
# åˆ é™¤æ—§çš„æ„å»ºäº§ç‰©
del Qingyu_backend.exe
del startup.log

# æ¸…ç†buildç›®å½•
make clean
```

### æ­¥éª¤10: æäº¤æ›´æ”¹ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
git add .
git commit -m "refactor: è§„èŒƒé¡¹ç›®ç»“æ„

- ç§»åŠ¨ main.go åˆ° cmd/server/
- ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ° config/ ç›®å½•
- åˆ é™¤é‡å¤çš„ docker/.dockerignore
- æ›´æ–° Makefile è·¯å¾„é…ç½®
- æ›´æ–° .gitignore å¿½ç•¥æ„å»ºäº§ç‰©
- æ›´æ–° Viper é…ç½®åŠ è½½è·¯å¾„

ç¬¦åˆ Go é¡¹ç›®æ ‡å‡†å¸ƒå±€"
```

---

## ğŸ“Š æ•´ç†å‰åå¯¹æ¯”

### æ•´ç†å‰ï¼ˆæ··ä¹±ï¼‰

```
Qingyu_backend/
â”œâ”€â”€ main.go                    # âŒ å…¥å£æ–‡ä»¶åœ¨æ ¹ç›®å½•
â”œâ”€â”€ config.yaml                # âŒ é…ç½®æ–‡ä»¶åœ¨æ ¹ç›®å½•
â”œâ”€â”€ config.local.yaml          # âŒ é…ç½®æ–‡ä»¶åœ¨æ ¹ç›®å½•
â”œâ”€â”€ config.docker.yaml         # âŒ é…ç½®æ–‡ä»¶åœ¨æ ¹ç›®å½•
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ .dockerignore          # âŒ é‡å¤æ–‡ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.go              # âš ï¸ é…ç½®å®šä¹‰åœ¨è¿™é‡Œ
â”‚   â””â”€â”€ ...                    # ä½†é…ç½®æ–‡ä»¶åœ¨æ ¹ç›®å½•
â”œâ”€â”€ Qingyu_backend.exe         # âŒ æ„å»ºäº§ç‰©æœªå¿½ç•¥
â””â”€â”€ startup.log                # âŒ æ—¥å¿—æ–‡ä»¶æœªå¿½ç•¥
```

### æ•´ç†åï¼ˆè§„èŒƒï¼‰âœ…

```
Qingyu_backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go            # âœ… å…¥å£æ–‡ä»¶åœ¨cmd/server/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.go              # âœ… é…ç½®å®šä¹‰
â”‚   â”œâ”€â”€ config.yaml            # âœ… é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.local.yaml      # âœ… æœ¬åœ°é…ç½®
â”‚   â”œâ”€â”€ config.docker.yaml     # âœ… Dockeré…ç½®
â”‚   â”œâ”€â”€ database.go
â”‚   â”œâ”€â”€ jwt.go
â”‚   â””â”€â”€ viper_integration.go
â”œâ”€â”€ .dockerignore              # âœ… å”¯ä¸€çš„dockerignore
â”œâ”€â”€ .gitignore                 # âœ… å·²æ›´æ–°
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ Makefile                   # âœ… è·¯å¾„å·²æ›´æ–°
â””â”€â”€ [å…¶ä»–ç›®å½•ä¿æŒä¸å˜]

# æ„å»ºäº§ç‰©è¢«.gitignoreå¿½ç•¥ï¼š
# - Qingyu_backend.exe
# - startup.log
# - build/
# - coverage.*
```

---

## âœ… éªŒè¯æ¸…å•

æ•´ç†å®Œæˆåï¼Œé€é¡¹æ£€æŸ¥ï¼š

### æ–‡ä»¶ç»“æ„
- [ ] `cmd/server/main.go` å­˜åœ¨
- [ ] `config/config.yaml` å­˜åœ¨
- [ ] `config/config.local.yaml` å­˜åœ¨  
- [ ] `config/config.docker.yaml` å­˜åœ¨
- [ ] æ ¹ç›®å½•æ²¡æœ‰ `main.go`
- [ ] æ ¹ç›®å½•æ²¡æœ‰é…ç½®yamlæ–‡ä»¶
- [ ] `docker/.dockerignore` å·²åˆ é™¤

### Makefile
- [ ] `MAIN_FILE` æŒ‡å‘ `./cmd/server/main.go`
- [ ] `make build` å¯ä»¥æ­£å¸¸æ„å»º
- [ ] `make run` å¯ä»¥æ­£å¸¸è¿è¡Œ

### é…ç½®åŠ è½½
- [ ] Viperèƒ½æ­£ç¡®åŠ è½½é…ç½®æ–‡ä»¶
- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] é…ç½®çƒ­é‡è½½ä»ç„¶å·¥ä½œ

### Git
- [ ] ä½¿ç”¨ `git mv` ç§»åŠ¨æ–‡ä»¶ï¼ˆä¿ç•™å†å²ï¼‰
- [ ] `.gitignore` å·²æ›´æ–°
- [ ] æ„å»ºäº§ç‰©ä¸å†è¢«è¿½è¸ª
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°

### åŠŸèƒ½éªŒè¯
- [ ] æœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] APIæ¥å£æ­£å¸¸å·¥ä½œ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] Redisè¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Viperé…ç½®è·¯å¾„

**é‡è¦**: ç§»åŠ¨é…ç½®æ–‡ä»¶åï¼Œéœ€è¦ç¡®ä¿Viperèƒ½æ‰¾åˆ°é…ç½®æ–‡ä»¶ã€‚

**æ¨èåšæ³•**: åœ¨Viperé…ç½®ä¸­æ·»åŠ å¤šä¸ªæŸ¥æ‰¾è·¯å¾„ï¼š

```go
// config/viper_integration.go
func (m *ViperConfigManager) LoadFromFile(configPath string) error {
    m.viper.SetConfigName("config")
    m.viper.SetConfigType("yaml")
    
    // æ·»åŠ å¤šä¸ªå¯èƒ½çš„é…ç½®æ–‡ä»¶è·¯å¾„
    if configPath != "" {
        m.viper.AddConfigPath(configPath)
    }
    m.viper.AddConfigPath("./config")      // é¡¹ç›®æ ¹ç›®å½•
    m.viper.AddConfigPath("../../config")  // ä»cmd/server/
    m.viper.AddConfigPath(".")
    
    // ... å…¶ä½™ä»£ç 
}
```

### 2. ç›¸å¯¹è·¯å¾„é—®é¢˜

å¦‚æœä»£ç ä¸­æœ‰ç¡¬ç¼–ç çš„ç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦æ³¨æ„ï¼š
- ä»æ ¹ç›®å½•è¿è¡Œï¼š`./config/config.yaml` âœ…
- ä»cmd/serverè¿è¡Œï¼š`../../config/config.yaml` âš ï¸

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–æ™ºèƒ½è·¯å¾„è§£æ

### 3. IDEé…ç½®

æŸäº›IDEå¯èƒ½éœ€è¦æ›´æ–°è¿è¡Œé…ç½®ï¼š
- **VSCode**: æ›´æ–° `.vscode/launch.json` ä¸­çš„ `program` è·¯å¾„
- **GoLand**: æ›´æ–°Run Configurationçš„ä¸»æ–‡ä»¶è·¯å¾„

### 4. CI/CDé…ç½®

å¦‚æœæœ‰CI/CDé…ç½®ï¼Œéœ€è¦æ›´æ–°ï¼š
- GitHub Actions
- GitLab CI
- Jenkinsç­‰

æ„å»ºå‘½ä»¤ä» `go build main.go` æ”¹ä¸º `go build ./cmd/server/`

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶

**ç—‡çŠ¶**: `é…ç½®æ–‡ä»¶ä¸å­˜åœ¨` æˆ– `Config file not found`

**åŸå› **: ViperæŸ¥æ‰¾è·¯å¾„ä¸æ­£ç¡®

**è§£å†³**:
```go
// ç¡®ä¿æ·»åŠ äº†æ­£ç¡®çš„é…ç½®è·¯å¾„
m.viper.AddConfigPath("./config")
m.viper.AddConfigPath("../../config")  // ä»cmd/server/
```

### é—®é¢˜2: ç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶**: `package xxx is not in GOROOT`

**åŸå› **: go.modè·¯å¾„é—®é¢˜

**è§£å†³**:
```bash
go mod tidy
go mod download
```

### é—®é¢˜3: Makefileæ‰§è¡Œå¤±è´¥

**ç—‡çŠ¶**: `No such file or directory: ./cmd/main.go`

**åŸå› **: Makefileè·¯å¾„æœªæ›´æ–°

**è§£å†³**: æ£€æŸ¥å¹¶æ›´æ–° `MAIN_FILE` å˜é‡

---

## ğŸ“š å‚è€ƒèµ„æ–™

### Goé¡¹ç›®å¸ƒå±€æ ‡å‡†

- [golang-standards/project-layout](https://github.com/golang-standards/project-layout)
- [Goé¡¹ç›®ç»“æ„æœ€ä½³å®è·µ](https://go.dev/doc/modules/layout)

### ç›¸å…³æ–‡æ¡£

- [åŸºç¡€è®¾æ–½å®æ–½æ–‡æ¡£](./README_åŸºç¡€è®¾æ–½å®æ–½æ–‡æ¡£.md)
- [åŸºç¡€è®¾æ–½å®æ–½å®Œæˆæ€»ç»“](./åŸºç¡€è®¾æ–½å®æ–½å®Œæˆæ€»ç»“.md)

---

## ğŸ“… æ—¶é—´ä¼°ç®—

| æ­¥éª¤ | é¢„è®¡æ—¶é—´ | éš¾åº¦ |
|-----|---------|------|
| åˆ›å»ºç›®å½• | 30ç§’ | â­ |
| ç§»åŠ¨æ–‡ä»¶ | 2åˆ†é’Ÿ | â­ |
| åˆ é™¤é‡å¤ | 15ç§’ | â­ |
| æ›´æ–°Makefile | 1åˆ†é’Ÿ | â­ |
| æ›´æ–°.gitignore | 2åˆ†é’Ÿ | â­ |
| æ›´æ–°Viperè·¯å¾„ | 5åˆ†é’Ÿ | â­â­â­ |
| æµ‹è¯•éªŒè¯ | 3åˆ†é’Ÿ | â­â­ |
| Gitæäº¤ | 1åˆ†é’Ÿ | â­ |
| **æ€»è®¡** | **15åˆ†é’Ÿ** | **â­â­** |

---

**åˆ›å»ºäºº**: yukin371  
**çŠ¶æ€**: ğŸ“ å¾…æ‰§è¡Œ  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­ç­‰ï¼ˆå»ºè®®å°½å¿«å®Œæˆï¼‰  
**é£é™©**: ğŸŸ¢ ä½ï¼ˆå¯å›æ»šï¼‰

