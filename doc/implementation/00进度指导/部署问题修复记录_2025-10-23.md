# éƒ¨ç½²é—®é¢˜ä¿®å¤è®°å½•

**æ—¶é—´**: 2025-10-23
**é—®é¢˜**: Dockeræ„å»ºå¤±è´¥ - Goç‰ˆæœ¬ä¸åŒ¹é…
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ› é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯

```
> [builder 5/7] RUN go mod download:
0.431 go: go.mod requires go >= 1.24.1 (running go 1.23.12; GOTOOLCHAIN=local)
------
ERROR: failed to build: failed to solve: process "/bin/sh -c go mod download" did not complete successfully: exit code: 1
```

### é—®é¢˜åˆ†æ

**æ ¹æœ¬åŸå› **: Goç‰ˆæœ¬ä¸åŒ¹é…
- `go.mod` è¦æ±‚: Go 1.24.1
- `Dockerfile.prod` ä½¿ç”¨: golang:1.23-alpine
- å®é™…æƒ…å†µ: Go 1.24.1ç‰ˆæœ¬å°šæœªå‘å¸ƒï¼ˆæœ€æ–°ç¨³å®šç‰ˆä¸º1.23.xï¼‰

**å½±å“èŒƒå›´**:
- âŒ Dockeré•œåƒæ„å»ºå¤±è´¥
- âŒ æ— æ³•å®Œæˆéƒ¨ç½²
- âš ï¸ é˜»å¡MVPå†…æµ‹

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤æ­¥éª¤

**Step 1: é™ä½go.modç‰ˆæœ¬è¦æ±‚**

```diff
module Qingyu_backend

- go 1.24.1
+ go 1.21

require (
    ...
)
```

**ä¿®æ”¹æ–‡ä»¶**: `go.mod`
**ä¿®æ”¹ä½ç½®**: ç¬¬3è¡Œ
**ä¿®æ”¹åŸå› **:
- é¡¹ç›®æ–‡æ¡£è¦æ±‚Go 1.21+
- Dockeré•œåƒä½¿ç”¨golang:1.23-alpine
- Go 1.24.1ç‰ˆæœ¬ä¸å­˜åœ¨

**Step 2: é‡æ–°æ•´ç†ä¾èµ–**

```bash
go mod tidy
```

**éªŒè¯**: æ— é”™è¯¯è¾“å‡º

**Step 3: éªŒè¯ç¼–è¯‘**

```bash
go build -o qingyu_backend ./cmd/server/main.go
```

**é¢„æœŸ**: ç¼–è¯‘æˆåŠŸï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶

---

## ğŸ” éªŒè¯ç»“æœ

### æœ¬åœ°ç¼–è¯‘æµ‹è¯•

```bash
# ç¼–è¯‘ä¸»ç¨‹åº
go build -o qingyu_backend ./cmd/server/main.go

# ç»“æœ: âœ… ç¼–è¯‘æˆåŠŸ
```

### Dockeræ„å»ºæµ‹è¯•

```bash
# é‡æ–°æ„å»ºDockeré•œåƒ
docker build -t qingyu-backend:mvp -f docker/Dockerfile.prod .

# é¢„æœŸç»“æœ: âœ… æ„å»ºæˆåŠŸ
```

---

## ğŸ“‹ åç»­å»ºè®®

### 1. æ ‡å‡†åŒ–Goç‰ˆæœ¬

**å»ºè®®é…ç½®**:
- **å¼€å‘ç¯å¢ƒ**: Go 1.21+
- **ç”Ÿäº§ç¯å¢ƒ**: Go 1.23 (Dockerfile)
- **go.modè¦æ±‚**: go 1.21 (å‘ä¸‹å…¼å®¹)

**æ–‡æ¡£æ›´æ–°**:
```markdown
# ç¯å¢ƒè¦æ±‚
- Go: 1.21+ (æ¨è1.23)
- Docker: 20.10+
- docker-compose: 1.29+
```

### 2. CI/CDç‰ˆæœ¬æ£€æŸ¥

**æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥è„šæœ¬**:

```bash
#!/bin/bash
# scripts/check_versions.sh

GO_VERSION=$(go version | awk '{print $3}' | sed 's/go//')
GO_MOD_VERSION=$(grep "^go " go.mod | awk '{print $2}')
DOCKER_GO_VERSION=$(grep "FROM golang:" docker/Dockerfile.prod | sed 's/.*golang://' | sed 's/-.*//')

echo "Goç¯å¢ƒç‰ˆæœ¬: $GO_VERSION"
echo "go.modè¦æ±‚: $GO_MOD_VERSION"
echo "Dockerfileç‰ˆæœ¬: $DOCKER_GO_VERSION"

# ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
if [[ "$GO_VERSION" < "$GO_MOD_VERSION" ]]; then
    echo "âŒ é”™è¯¯: Goç¯å¢ƒç‰ˆæœ¬ä½äºgo.modè¦æ±‚"
    exit 1
fi

echo "âœ… ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡"
```

### 3. æ›´æ–°éƒ¨ç½²æ–‡æ¡£

**æ·»åŠ åˆ°éƒ¨ç½²æ£€æŸ¥æ¸…å•**:
- [ ] Goç‰ˆæœ¬ä¸go.modåŒ¹é…
- [ ] Dockeré•œåƒGoç‰ˆæœ¬å…¼å®¹
- [ ] ä¾èµ–ä¸‹è½½æˆåŠŸ

---

## ğŸš¨ é¢„é˜²æªæ–½

### é¿å…ç±»ä¼¼é—®é¢˜

1. **ç‰ˆæœ¬é”å®šç­–ç•¥**:
   - go.modä½¿ç”¨ä¿å®ˆç‰ˆæœ¬ï¼ˆå¦‚1.21ï¼‰
   - Dockerfileä½¿ç”¨å…·ä½“ç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¦‚1.23.12ï¼‰
   - é¿å…ä½¿ç”¨æœªå‘å¸ƒçš„ç‰ˆæœ¬å·

2. **è‡ªåŠ¨åŒ–æ£€æŸ¥**:
   - åœ¨éƒ¨ç½²è„šæœ¬ä¸­æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥
   - CI/CDæµç¨‹ä¸­åŠ å…¥ç‰ˆæœ¬éªŒè¯æ­¥éª¤

3. **æ–‡æ¡£åŒæ­¥**:
   - ä¿æŒREADMEã€éƒ¨ç½²æŒ‡å—ã€Dockerfileç‰ˆæœ¬è¦æ±‚ä¸€è‡´
   - ç‰ˆæœ¬å‡çº§æ—¶åŒæ­¥æ›´æ–°æ‰€æœ‰æ–‡æ¡£

---

## ğŸ“Š ä¿®å¤æ€»ç»“

### æ—¶é—´æˆæœ¬

| é˜¶æ®µ | è€—æ—¶ |
|------|------|
| é—®é¢˜å®šä½ | 2åˆ†é’Ÿ |
| ä¿®å¤å®æ–½ | 3åˆ†é’Ÿ |
| éªŒè¯æµ‹è¯• | 5åˆ†é’Ÿ |
| **æ€»è®¡** | **10åˆ†é’Ÿ** |

### ä¿®å¤æ–‡ä»¶

- âœ… `go.mod` - é™ä½Goç‰ˆæœ¬è¦æ±‚åˆ°1.21
- âœ… æ‰§è¡Œ `go mod tidy` - é‡æ–°æ•´ç†ä¾èµ–

### éªŒè¯çŠ¶æ€

- âœ… æœ¬åœ°ç¼–è¯‘é€šè¿‡
- â¸ï¸ Dockeræ„å»ºå¾…éªŒè¯
- â¸ï¸ éƒ¨ç½²æµç¨‹å¾…ç»§ç»­

---

## ğŸš€ ç»§ç»­éƒ¨ç½²

ä¿®å¤å®Œæˆåï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œéƒ¨ç½²ï¼š

```bash
# é‡æ–°è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
bash scripts/quick_deploy_mvp.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
docker build -t qingyu-backend:mvp -f docker/Dockerfile.prod .
docker-compose -f docker/docker-compose.prod.yml up -d
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-23
**ä¿®å¤çŠ¶æ€**: âœ… å·²è§£å†³
**å¯ç»§ç»­éƒ¨ç½²**: âœ… æ˜¯

