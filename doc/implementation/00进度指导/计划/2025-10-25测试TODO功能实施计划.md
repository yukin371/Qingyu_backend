# 测试TODO功能实施计划

**制定日期**: 2025-10-25  
**计划周期**: 2-3周  
**状态**: 待执行  
**优先级**: P0-P1（高优先级）

---

## 📊 背景说明

在2025-10-25的集成测试修复过程中，发现多个核心功能尚未实现，导致测试失败或需要跳过。这些功能对用户体验和业务闭环至关重要，需要优先实现。

### 问题来源

- **测试文件**: `test/integration/scenario_interaction_test.go`, `scenario_reading_test.go`
- **测试结果**: 10个测试中4个因功能未实现而跳过，2个因API路由问题失败
- **影响范围**: 阅读端核心互动功能、书城核心API

### 关键发现

1. **评论系统** - 完全未实现，影响用户社区互动
2. **点赞系统** - 完全未实现，影响内容热度算法
3. **书籍详情API** - 路由问题导致404，影响核心阅读流程
4. **章节列表API** - 返回HTML而非JSON，影响章节浏览
5. **收藏系统** - 当前使用书架功能替代，功能受限
6. **阅读历史** - 使用进度历史替代，缺少独立管理

---

## 🎯 实施目标

### 核心目标

1. ✅ 实现完整的**评论系统**，支持用户互动
2. ✅ 实现完整的**点赞系统**，支持内容热度统计
3. ✅ 修复**书籍详情和章节列表API**路由问题
4. ✅ 实现独立的**收藏系统**，与书架分离
5. ✅ 实现独立的**阅读历史系统**
6. ✅ 所有集成测试通过，测试覆盖率达到90%

### 业务价值

- **用户留存**: 评论和点赞提升用户参与度，预计提升15-20%留存率
- **内容质量**: 用户反馈帮助筛选优质内容，改善推荐效果
- **数据分析**: 收藏和历史数据支持个性化推荐
- **产品闭环**: 完整的阅读互动链路，提升用户体验

---

## 📋 详细实施计划

### 阶段一：核心互动功能（高优先级 P0 🔥）

#### 1.1 评论系统实现

**优先级**: P0 🔥  
**预计工作量**: 4天  
**依赖**: MongoDB, UserService  
**测试覆盖**: `TestInteractionScenario/4`, `TestInteractionScenario/5`

##### 数据模型设计

```go
// models/reading/comment.go
type Comment struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    BookID      string             `bson:"book_id" json:"book_id"`
    ChapterID   string             `bson:"chapter_id,omitempty" json:"chapter_id,omitempty"`
    UserID      string             `bson:"user_id" json:"user_id"`
    
    // 评论内容
    Content     string             `bson:"content" json:"content"`
    Rating      int                `bson:"rating" json:"rating"` // 1-5星评分
    
    // 回复相关
    ParentID    string             `bson:"parent_id,omitempty" json:"parent_id,omitempty"`
    RootID      string             `bson:"root_id,omitempty" json:"root_id,omitempty"`
    ReplyToUser string             `bson:"reply_to_user,omitempty" json:"reply_to_user,omitempty"`
    
    // 统计数据
    LikeCount   int                `bson:"like_count" json:"like_count"`
    ReplyCount  int                `bson:"reply_count" json:"reply_count"`
    
    // 审核状态
    Status      string             `bson:"status" json:"status"` // pending, approved, rejected
    RejectReason string            `bson:"reject_reason,omitempty" json:"reject_reason,omitempty"`
    
    // 时间戳
    CreatedAt   time.Time          `bson:"created_at" json:"created_at"`
    UpdatedAt   time.Time          `bson:"updated_at" json:"updated_at"`
}
```

##### Repository层实现

**文件**: `repository/mongodb/reading/comment_repository_mongo.go`

**任务清单**:
- [ ] 创建CommentRepository接口
- [ ] 实现MongoDB适配器
- [ ] 实现基础CRUD操作
  - [ ] CreateComment - 创建评论
  - [ ] GetCommentByID - 获取单条评论
  - [ ] GetCommentsByBookID - 获取书籍评论列表（分页）
  - [ ] GetCommentsByUserID - 获取用户评论历史
  - [ ] GetRepliesByCommentID - 获取评论回复列表
  - [ ] UpdateComment - 更新评论内容
  - [ ] DeleteComment - 删除评论（软删除）
- [ ] 实现审核相关操作
  - [ ] UpdateCommentStatus - 更新审核状态
  - [ ] GetPendingComments - 获取待审核评论
- [ ] 实现统计操作
  - [ ] IncrementLikeCount - 增加点赞数
  - [ ] IncrementReplyCount - 增加回复数
  - [ ] GetBookRatingStats - 获取书籍评分统计
- [ ] 添加索引优化
  - [ ] book_id + created_at（书籍评论查询）
  - [ ] user_id + created_at（用户评论历史）
  - [ ] parent_id（回复查询）
  - [ ] status（审核队列）

##### Service层实现

**文件**: `service/reading/comment_service.go`

**任务清单**:
- [ ] 创建CommentService结构体
- [ ] 实现BaseService接口
- [ ] 实现业务逻辑
  - [ ] PublishComment - 发表评论（内容审核、敏感词过滤）
  - [ ] ReplyComment - 回复评论
  - [ ] GetCommentList - 获取评论列表（支持排序：最新/最热）
  - [ ] GetCommentDetail - 获取评论详情（包含用户信息）
  - [ ] UpdateComment - 编辑评论（限制时间窗口）
  - [ ] DeleteComment - 删除评论（权限校验）
- [ ] 实现审核功能
  - [ ] ReviewComment - 审核评论（管理员）
  - [ ] GetPendingReviews - 获取待审核队列
- [ ] 实现点赞功能
  - [ ] LikeComment - 点赞评论
  - [ ] UnlikeComment - 取消点赞
- [ ] 实现统计功能
  - [ ] GetBookCommentStats - 获取书籍评论统计
  - [ ] GetUserCommentStats - 获取用户评论统计
- [ ] 集成EventBus
  - [ ] 发布CommentCreatedEvent
  - [ ] 发布CommentDeletedEvent
  - [ ] 发布CommentReviewedEvent

##### API层实现

**文件**: `api/v1/reader/comment_api.go`

**任务清单**:
- [ ] 创建CommentAPI结构体
- [ ] 实现API端点
  - [ ] POST /api/v1/reader/comments - 发表评论
  - [ ] GET /api/v1/reader/comments - 获取评论列表
  - [ ] GET /api/v1/reader/comments/:id - 获取评论详情
  - [ ] PUT /api/v1/reader/comments/:id - 编辑评论
  - [ ] DELETE /api/v1/reader/comments/:id - 删除评论
  - [ ] POST /api/v1/reader/comments/:id/reply - 回复评论
  - [ ] POST /api/v1/reader/comments/:id/like - 点赞评论
  - [ ] DELETE /api/v1/reader/comments/:id/like - 取消点赞
- [ ] 实现管理员API
  - [ ] GET /api/v1/admin/comments/pending - 待审核列表
  - [ ] POST /api/v1/admin/comments/:id/review - 审核评论
- [ ] 参数验证
  - [ ] 评论内容长度限制（10-500字）
  - [ ] 评分范围验证（1-5星）
  - [ ] 敏感词过滤
- [ ] 权限控制
  - [ ] 需要登录
  - [ ] 只能编辑/删除自己的评论
  - [ ] 管理员审核权限

##### 测试实现

**任务清单**:
- [ ] 单元测试
  - [ ] CommentRepository测试
  - [ ] CommentService测试
  - [ ] CommentAPI测试
- [ ] 集成测试
  - [ ] 修复TestInteractionScenario/4.评论_发表书籍评论
  - [ ] 修复TestInteractionScenario/5.评论_获取书籍评论列表
  - [ ] 添加评论回复测试
  - [ ] 添加评论审核测试

**预期成果**:
- ✅ 完整的评论系统上线
- ✅ 支持评论、回复、点赞、审核
- ✅ 测试覆盖率 >85%
- ✅ API响应时间 <200ms

---

#### 1.2 点赞系统实现

**优先级**: P0 🔥  
**预计工作量**: 2天  
**依赖**: MongoDB, Redis (推荐)  
**测试覆盖**: `TestInteractionScenario/6`, `TestInteractionScenario/7`

##### 数据模型设计

```go
// models/reading/like.go
type Like struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    UserID      string             `bson:"user_id" json:"user_id"`
    TargetType  string             `bson:"target_type" json:"target_type"` // book, comment, chapter
    TargetID    string             `bson:"target_id" json:"target_id"`
    CreatedAt   time.Time          `bson:"created_at" json:"created_at"`
}

// 统计数据（存储在目标对象中或单独的统计表）
type LikeStats struct {
    TargetID    string    `bson:"_id" json:"target_id"`
    TargetType  string    `bson:"target_type" json:"target_type"`
    LikeCount   int       `bson:"like_count" json:"like_count"`
    UpdatedAt   time.Time `bson:"updated_at" json:"updated_at"`
}
```

##### Repository层实现

**文件**: `repository/mongodb/reading/like_repository_mongo.go`

**任务清单**:
- [ ] 创建LikeRepository接口
- [ ] 实现MongoDB适配器
- [ ] 实现基础操作
  - [ ] AddLike - 添加点赞（去重）
  - [ ] RemoveLike - 取消点赞
  - [ ] IsLiked - 检查是否已点赞
  - [ ] GetUserLikes - 获取用户点赞列表
  - [ ] GetLikeCount - 获取点赞数
- [ ] 实现批量操作
  - [ ] GetLikesCountBatch - 批量获取点赞数
  - [ ] GetUserLikeStatusBatch - 批量检查点赞状态
- [ ] 添加索引
  - [ ] user_id + target_type + target_id（唯一索引，防重）
  - [ ] target_type + target_id + created_at（统计查询）
- [ ] 可选：集成Redis缓存
  - [ ] 缓存点赞数（热点数据）
  - [ ] 使用Redis Set存储用户点赞列表

##### Service层实现

**文件**: `service/reading/like_service.go`

**任务清单**:
- [ ] 创建LikeService结构体
- [ ] 实现BaseService接口
- [ ] 实现业务逻辑
  - [ ] LikeBook - 点赞书籍
  - [ ] UnlikeBook - 取消点赞书籍
  - [ ] LikeComment - 点赞评论
  - [ ] UnlikeComment - 取消点赞评论
  - [ ] GetBookLikeCount - 获取书籍点赞数
  - [ ] GetUserLikeStatus - 检查用户点赞状态
  - [ ] GetUserLikedBooks - 获取用户点赞的书籍列表
- [ ] 实现防刷机制
  - [ ] 点赞频率限制（1秒内不能重复点赞同一对象）
  - [ ] IP限制（可选）
- [ ] 集成EventBus
  - [ ] 发布BookLikedEvent（更新书籍热度）
  - [ ] 发布CommentLikedEvent（更新评论热度）

##### API层实现

**文件**: `api/v1/reader/like_api.go`

**任务清单**:
- [ ] 创建LikeAPI结构体
- [ ] 实现API端点
  - [ ] POST /api/v1/reader/books/:id/like - 点赞书籍
  - [ ] DELETE /api/v1/reader/books/:id/like - 取消点赞书籍
  - [ ] GET /api/v1/reader/books/:id/like/status - 检查点赞状态
  - [ ] POST /api/v1/reader/comments/:id/like - 点赞评论
  - [ ] DELETE /api/v1/reader/comments/:id/like - 取消点赞评论
- [ ] 参数验证和权限控制
  - [ ] 需要登录
  - [ ] 防止重复点赞

##### 测试实现

**任务清单**:
- [ ] 单元测试
  - [ ] LikeRepository测试（包含去重测试）
  - [ ] LikeService测试
  - [ ] LikeAPI测试
- [ ] 集成测试
  - [ ] 修复TestInteractionScenario/6.点赞_点赞书籍
  - [ ] 修复TestInteractionScenario/7.点赞_取消点赞
  - [ ] 添加点赞评论测试
  - [ ] 添加并发点赞测试

**预期成果**:
- ✅ 完整的点赞系统上线
- ✅ 支持书籍、评论点赞
- ✅ 防重和防刷机制完善
- ✅ 测试覆盖率 >85%
- ✅ API响应时间 <100ms

---

### 阶段二：API路由修复（高优先级 P0 🔥）

#### 2.1 书籍详情API修复

**优先级**: P0 🔥  
**预计工作量**: 1天  
**依赖**: BookstoreService  
**测试覆盖**: `TestReadingScenario/1.书籍详情_获取书籍信息`

##### 问题分析

- **现象**: GET /api/v1/bookstore/books/:id 返回404
- **原因**: 可能的路由未注册或ObjectID参数解析问题
- **影响**: 用户无法查看书籍详情，阻断阅读流程

##### 修复任务清单

- [ ] 检查路由注册
  - [ ] 确认 `router/bookstore/book_routes.go` 中是否注册了该路由
  - [ ] 确认路由参数格式：`:id` vs `:bookId`
- [ ] 检查API实现
  - [ ] 确认 `api/v1/bookstore/book_api.go` 中GetBookByID方法存在
  - [ ] 确认参数绑定正确：`c.Param("id")`
- [ ] 修复ObjectID转换
  - [ ] 确保正确使用 `primitive.ObjectIDFromHex()`
  - [ ] 添加错误处理（无效ID返回400）
- [ ] 添加详细日志
  - [ ] 记录请求参数
  - [ ] 记录查询结果
- [ ] 更新测试
  - [ ] 修复TestReadingScenario/1测试
  - [ ] 添加边界测试（无效ID、不存在的ID）

**预期成果**:
- ✅ GET /api/v1/bookstore/books/:id 正常返回200
- ✅ 正确处理ObjectID参数
- ✅ 测试通过

---

#### 2.2 章节列表API修复

**优先级**: P1  
**预计工作量**: 1天  
**依赖**: ReaderService  
**测试覆盖**: `TestReadingScenario/2.书籍详情_获取章节列表`

##### 问题分析

- **现象**: GET /api/v1/reader/chapters 返回HTML而非JSON
- **原因**: 可能路由冲突或404错误页面
- **影响**: 无法获取章节列表，影响阅读体验

##### 修复任务清单

- [ ] 检查路由注册
  - [ ] 确认 `router/reader/chapter_routes.go` 中路由正确
  - [ ] 检查是否与其他路由冲突
- [ ] 检查API实现
  - [ ] 确认 `api/v1/reader/chapter_api.go` 中GetChapterList方法存在
  - [ ] 确认返回JSON格式
- [ ] 修复参数处理
  - [ ] 确认bookId参数正确传递
  - [ ] 添加参数验证
- [ ] 添加错误处理
  - [ ] 确保404返回JSON而非HTML
  - [ ] 统一错误响应格式
- [ ] 更新测试
  - [ ] 修复TestReadingScenario/2测试
  - [ ] 添加分页测试

**预期成果**:
- ✅ GET /api/v1/reader/chapters 正常返回JSON
- ✅ 支持分页和筛选
- ✅ 测试通过

---

### 阶段三：功能完善（中优先级 P1）

#### 3.1 独立收藏系统

**优先级**: P1  
**预计工作量**: 3天  
**依赖**: MongoDB  
**说明**: 当前使用书架功能替代，需要独立的收藏系统

##### 功能设计

**收藏 vs 书架的区别**:
- **书架**: 用户正在阅读或计划阅读的书籍，有阅读进度
- **收藏**: 用户喜欢但不一定阅读的书籍，用于收藏和分享

##### 数据模型

```go
// models/reading/collection.go
type Collection struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    UserID      string             `bson:"user_id" json:"user_id"`
    BookID      string             `bson:"book_id" json:"book_id"`
    
    // 收藏分类
    FolderID    string             `bson:"folder_id,omitempty" json:"folder_id,omitempty"`
    Tags        []string           `bson:"tags" json:"tags"`
    
    // 笔记
    Note        string             `bson:"note" json:"note"`
    
    // 可见性
    IsPublic    bool               `bson:"is_public" json:"is_public"`
    
    CreatedAt   time.Time          `bson:"created_at" json:"created_at"`
    UpdatedAt   time.Time          `bson:"updated_at" json:"updated_at"`
}

// 收藏夹
type CollectionFolder struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    UserID      string             `bson:"user_id" json:"user_id"`
    Name        string             `bson:"name" json:"name"`
    Description string             `bson:"description" json:"description"`
    BookCount   int                `bson:"book_count" json:"book_count"`
    IsPublic    bool               `bson:"is_public" json:"is_public"`
    CreatedAt   time.Time          `bson:"created_at" json:"created_at"`
}
```

##### 实施任务

- [ ] Repository层
  - [ ] 创建CollectionRepository接口
  - [ ] 实现CRUD操作
  - [ ] 实现收藏夹管理
- [ ] Service层
  - [ ] 实现CollectionService
  - [ ] 实现收藏夹管理
  - [ ] 实现收藏分享
- [ ] API层
  - [ ] POST /api/v1/reader/collections - 添加收藏
  - [ ] GET /api/v1/reader/collections - 获取收藏列表
  - [ ] DELETE /api/v1/reader/collections/:id - 取消收藏
  - [ ] POST /api/v1/reader/collections/folders - 创建收藏夹
  - [ ] GET /api/v1/reader/collections/folders - 获取收藏夹列表
- [ ] 测试
  - [ ] 单元测试
  - [ ] 集成测试

**预期成果**:
- ✅ 独立的收藏系统上线
- ✅ 支持收藏夹和标签
- ✅ 支持收藏分享

---

#### 3.2 独立阅读历史系统

**优先级**: P1  
**预计工作量**: 2天  
**依赖**: MongoDB  
**说明**: 当前使用进度历史替代，需要独立的阅读历史

##### 功能设计

**阅读历史 vs 阅读进度的区别**:
- **阅读进度**: 当前阅读到的位置（实时更新）
- **阅读历史**: 历史阅读记录（按时间排序，可搜索）

##### 数据模型

```go
// models/reading/history.go
type ReadingHistory struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    UserID      string             `bson:"user_id" json:"user_id"`
    BookID      string             `bson:"book_id" json:"book_id"`
    ChapterID   string             `bson:"chapter_id" json:"chapter_id"`
    
    // 阅读信息
    ReadDuration int               `bson:"read_duration" json:"read_duration"` // 阅读时长（秒）
    Progress     float64           `bson:"progress" json:"progress"`           // 阅读进度（百分比）
    
    // 设备信息
    DeviceType   string            `bson:"device_type" json:"device_type"`
    DeviceID     string            `bson:"device_id" json:"device_id"`
    
    // 时间戳
    StartTime    time.Time         `bson:"start_time" json:"start_time"`
    EndTime      time.Time         `bson:"end_time" json:"end_time"`
    CreatedAt    time.Time         `bson:"created_at" json:"created_at"`
}
```

##### 实施任务

- [ ] Repository层
  - [ ] 创建HistoryRepository接口
  - [ ] 实现CRUD操作
  - [ ] 实现搜索和筛选
- [ ] Service层
  - [ ] 实现HistoryService
  - [ ] 实现阅读统计
  - [ ] 实现历史清理（自动删除90天前的记录）
- [ ] API层
  - [ ] GET /api/v1/reader/history - 获取阅读历史
  - [ ] GET /api/v1/reader/history/stats - 获取阅读统计
  - [ ] DELETE /api/v1/reader/history - 清空历史
  - [ ] DELETE /api/v1/reader/history/:id - 删除单条历史
- [ ] 测试
  - [ ] 单元测试
  - [ ] 集成测试（修复TestInteractionScenario/8）

**预期成果**:
- ✅ 独立的阅读历史系统上线
- ✅ 支持搜索和统计
- ✅ 测试通过

---

## 📅 实施时间表

### 第1周（2025-10-28 ~ 11-01）

| 日期 | 任务 | 负责人 | 状态 |
|------|------|--------|------|
| 周一 | 评论系统 - Repository层实现 | - | 待开始 |
| 周二 | 评论系统 - Service层实现 | - | 待开始 |
| 周三 | 评论系统 - API层实现 + 测试 | - | 待开始 |
| 周四 | 点赞系统 - 完整实现 | - | 待开始 |
| 周五 | 点赞系统 - 测试 + 集成 | - | 待开始 |

**里程碑**: ✅ 评论和点赞系统上线

---

### 第2周（2025-11-04 ~ 11-08）

| 日期 | 任务 | 负责人 | 状态 |
|------|------|--------|------|
| 周一 | 书籍详情API修复 | - | 待开始 |
| 周二 | 章节列表API修复 | - | 待开始 |
| 周三-周四 | 独立收藏系统实现 | - | 待开始 |
| 周五 | 收藏系统测试 | - | 待开始 |

**里程碑**: ✅ API修复完成，收藏系统上线

---

### 第3周（2025-11-11 ~ 11-15）

| 日期 | 任务 | 负责人 | 状态 |
|------|------|--------|------|
| 周一-周二 | 独立阅读历史系统实现 | - | 待开始 |
| 周三 | 阅读历史测试 | - | 待开始 |
| 周四-周五 | 完整集成测试 + Bug修复 | - | 待开始 |

**里程碑**: ✅ 所有功能上线，测试通过

---

## 🎯 成功标准

### 功能完整性

- [ ] 评论系统完全实现，支持评论、回复、点赞、审核
- [ ] 点赞系统完全实现，支持书籍和评论点赞
- [ ] 书籍详情API正常返回200
- [ ] 章节列表API正常返回JSON
- [ ] 独立收藏系统上线
- [ ] 独立阅读历史系统上线

### 测试覆盖

- [ ] 所有集成测试通过（0个失败，0个panic）
- [ ] TestInteractionScenario: 10/10通过（当前6/10通过，4/10跳过）
- [ ] TestReadingScenario: 所有测试通过
- [ ] 单元测试覆盖率 >85%

### 性能指标

- [ ] 评论API响应时间 <200ms
- [ ] 点赞API响应时间 <100ms
- [ ] 收藏API响应时间 <150ms
- [ ] 历史API响应时间 <150ms

### 代码质量

- [ ] 遵循项目架构规范
- [ ] 代码审查通过
- [ ] 无严重linter错误
- [ ] 文档完整

---

## 🚨 风险识别与缓解

### 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 评论系统复杂度高 | 高 | 中 | 分阶段实现，先实现基础功能，后续迭代高级功能 |
| 点赞并发问题 | 中 | 中 | 使用MongoDB原子操作或Redis分布式锁 |
| API路由问题难以定位 | 中 | 低 | 添加详细日志，使用调试工具 |
| 数据迁移问题 | 低 | 低 | 收藏和历史是新功能，无需迁移 |

### 资源风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 开发时间不足 | 高 | 中 | 优先完成P0任务，P1任务可延后 |
| 测试不充分 | 中 | 低 | 自动化测试，持续集成 |

---

## 📊 优先级矩阵

### 紧急且重要（立即执行）

- 🔥 **评论系统** - 用户互动核心功能
- 🔥 **点赞系统** - 内容热度算法基础
- 🔥 **书籍详情API修复** - 阻断核心流程

### 重要但不紧急（计划执行）

- **章节列表API修复** - 影响用户体验
- **独立收藏系统** - 提升产品体验
- **独立阅读历史** - 数据分析基础

### 紧急但不重要（快速处理）

- 暂无

### 不紧急不重要（延后处理）

- Redis配置问题（TestRedisServiceContainerIntegration）

---

## 📚 参考资源

### 项目文档

- `doc/implementation/修复/测试修复最终报告_2025-1025_v2.md` - 测试修复报告
- `test/integration/scenario_interaction_test.go` - 互动功能测试
- `test/integration/scenario_reading_test.go` - 阅读功能测试
- `doc/architecture/架构设计规范.md` - 架构规范

### 技术参考

- [MongoDB 索引最佳实践](https://docs.mongodb.com/manual/indexes/)
- [Go Gin Web Framework](https://gin-gonic.com/docs/)
- [Redis 缓存策略](https://redis.io/topics/lru-cache)

---

## 📝 变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2025-10-25 | v1.0 | 初始版本创建，基于测试修复发现的TODO功能 | AI Assistant |

---

**计划审核**: 待审核  
**计划批准**: 待批准  
**执行状态**: 待开始

**下一步行动**: 
1. 审核并批准计划
2. 分配开发资源
3. 开始阶段一开发（评论和点赞系统）

---

## 📌 附录：测试TODO清单

### 来自 scenario_interaction_test.go

```go
// TODO: 实现评论功能
// - 需要实现 POST /api/v1/reader/comments API
// - 支持评论内容、评分
// - 需要评论审核机制

// TODO: 实现评论列表查询
// - 需要实现 GET /api/v1/reader/comments API
// - 支持分页、排序（最新/最热）
// - 支持评论回复嵌套显示

// TODO: 实现点赞功能
// - 需要实现 POST /api/v1/reader/books/:id/like API
// - 支持点赞去重（一个用户只能点赞一次）
// - 更新书籍点赞数统计

// TODO: 实现取消点赞功能
// - 需要实现 DELETE /api/v1/reader/books/:id/like API
// - 同步更新书籍点赞数统计
```

### 来自 scenario_reading_test.go

```go
// TODO: 修复书籍详情API路由问题
// - 检查路由是否正确注册：GET /api/v1/bookstore/books/:id
// - 确认BookstoreAPI中GetBookByID方法是否实现
// - 验证MongoDB ObjectID转换是否正确

// TODO: 修复章节列表API
// - 确认API路径正确: GET /api/v1/reader/chapters?bookId=xxx
// - 验证返回JSON格式而非HTML
```

---

**计划制定完成！** 🎉

