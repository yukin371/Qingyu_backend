# MVPå†…æµ‹ç¯å¢ƒéƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v1.0-MVP  
**æ—¥æœŸ**: 2025-10-23  
**ç›®æ ‡**: éƒ¨ç½²MVPç‰ˆæœ¬åˆ°å†…æµ‹ç¯å¢ƒ

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### ç¯å¢ƒè¦æ±‚

**æœåŠ¡å™¨é…ç½®**:
- CPU: 2æ ¸+
- å†…å­˜: 4GB+
- ç£ç›˜: 20GB+
- æ“ä½œç³»ç»Ÿ: Linux/Windows/macOS

**è½¯ä»¶ä¾èµ–**:
- Docker: 20.10+
- docker-compose: 1.29+
- Go: 1.21+ (å¼€å‘ç¯å¢ƒ)

### å‡†å¤‡æ£€æŸ¥æ¸…å•

è¿è¡Œéƒ¨ç½²æ£€æŸ¥è„šæœ¬ï¼š
```bash
bash scripts/deployment_check.sh
```

**æ£€æŸ¥ç»“æœåº”ä¸º**:
- âœ… 21/21é¡¹æ£€æŸ¥é€šè¿‡
- âš ï¸ 0ä¸ªè­¦å‘Š
- âŒ 0ä¸ªå¤±è´¥

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# 1. å…‹éš†ä»£ç ï¼ˆå¦‚æœå°šæœªå…‹éš†ï¼‰
git clone <repository-url>
cd Qingyu_backend

# 2. åˆ‡æ¢åˆ°æœ€æ–°MVPåˆ†æ”¯
git checkout mvp-release

# 3. è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
bash scripts/quick_deploy_mvp.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- æ„å»ºDockeré•œåƒ
- å¯åŠ¨æœåŠ¡å®¹å™¨
- åˆå§‹åŒ–æ•°æ®åº“
- åˆ›å»ºæµ‹è¯•è´¦å·
- å¥åº·æ£€æŸ¥

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### Step 1: æ„å»ºDockeré•œåƒ

```bash
docker build -t qingyu-backend:mvp -f docker/Dockerfile.prod .
```

#### Step 2: å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆMongoDB + Redis + Backendï¼‰
docker-compose -f docker/docker-compose.prod.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker/docker-compose.prod.yml ps
```

**é¢„æœŸè¾“å‡º**:
```
Name                  State   Ports
qingyu-backend        Up      0.0.0.0:8080->8080/tcp
qingyu-mongodb        Up      0.0.0.0:27017->27017/tcp
qingyu-redis          Up      0.0.0.0:6379->6379/tcp
```

#### Step 3: æ•°æ®åº“åˆå§‹åŒ–

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
docker exec -it qingyu-backend go run cmd/migrate/main.go

# åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
docker exec -it qingyu-backend go run migration/seeds/main.go
```

#### Step 4: å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥APIå¥åº·çŠ¶æ€
curl http://localhost:8080/health

# é¢„æœŸå“åº”
{
  "status": "healthy",
  "timestamp": "2025-10-23T10:00:00Z",
  "services": {
    "mongodb": "connected",
    "redis": "connected"
  }
}
```

---

## ğŸ§ª éƒ¨ç½²éªŒè¯

### 1. æœåŠ¡å¯ç”¨æ€§éªŒè¯

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl -i http://localhost:8080/health

# æ£€æŸ¥APIå“åº”
curl http://localhost:8080/api/v1/system/version
```

### 2. MVPæ–°åŠŸèƒ½éªŒè¯

#### å¯†ç å¼ºåº¦éªŒè¯

```bash
# æµ‹è¯•æ³¨å†Œï¼ˆå¼±å¯†ç åº”è¢«æ‹’ç»ï¼‰
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "email": "test@example.com",
    "password": "123456"
  }'

# é¢„æœŸï¼š400 Bad Requestï¼Œå¯†ç ä¸ç¬¦åˆè¦æ±‚

# æµ‹è¯•æ³¨å†Œï¼ˆå¼ºå¯†ç åº”æˆåŠŸï¼‰
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "email": "test@example.com",
    "password": "Test123456"
  }'

# é¢„æœŸï¼š201 Created
```

#### å¤šç«¯ç™»å½•é™åˆ¶éªŒè¯

```bash
# è„šæœ¬ï¼šæ¨¡æ‹Ÿ6æ¬¡ç™»å½•
for i in {1..6}; do
  echo "ç™»å½•å°è¯• $i"
  curl -X POST http://localhost:8080/api/v1/auth/login \
    -H "Content-Type: application/json" \
    -d '{
      "username": "test_user",
      "password": "Test123456"
    }'
  echo ""
done

# é¢„æœŸï¼šå‰5æ¬¡æˆåŠŸï¼Œç¬¬6æ¬¡å¤±è´¥ï¼ˆè®¾å¤‡æ•°é‡é™åˆ¶ï¼‰
```

#### è‡ªåŠ¨ä¿å­˜åŠŸèƒ½éªŒè¯

```bash
# 1. ç™»å½•è·å–Token
TOKEN=$(curl -s -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "test_user", "password": "Test123456"}' \
  | jq -r '.data.token')

# 2. åˆ›å»ºé¡¹ç›®
PROJECT_ID=$(curl -s -X POST http://localhost:8080/api/v1/projects \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "æµ‹è¯•é¡¹ç›®", "description": "è‡ªåŠ¨ä¿å­˜æµ‹è¯•"}' \
  | jq -r '.data.id')

# 3. åˆ›å»ºæ–‡æ¡£
DOCUMENT_ID=$(curl -s -X POST http://localhost:8080/api/v1/projects/$PROJECT_ID/documents \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"title": "æµ‹è¯•ç« èŠ‚", "content": "åˆå§‹å†…å®¹"}' \
  | jq -r '.data.id')

# 4. ç­‰å¾…35ç§’ï¼ˆç¡®ä¿è§¦å‘è‡ªåŠ¨ä¿å­˜ï¼‰
sleep 35

# 5. æŸ¥è¯¢ç‰ˆæœ¬å†å²
curl -s http://localhost:8080/api/v1/documents/$DOCUMENT_ID/versions \
  -H "Authorization: Bearer $TOKEN"

# é¢„æœŸï¼šç‰ˆæœ¬åˆ—è¡¨ä¸­åº”åŒ…å«"è‡ªåŠ¨ä¿å­˜"ç‰ˆæœ¬
```

### 3. æ ¸å¿ƒæµç¨‹å®Œæ•´éªŒè¯

å‚è€ƒ `scripts/mvp_smoke_test.sh` è„šæœ¬ï¼ŒéªŒè¯å®Œæ•´ç”¨æˆ·æµç¨‹ï¼š
```bash
bash scripts/mvp_smoke_test.sh
```

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
docker logs -f qingyu-backend

# æŸ¥çœ‹MongoDBæ—¥å¿—
docker logs -f qingyu-mongodb

# æŸ¥çœ‹Redisæ—¥å¿—
docker logs -f qingyu-redis

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker logs --tail 100 qingyu-backend
```

### æ—¥å¿—çº§åˆ«

**ç”Ÿäº§ç¯å¢ƒé…ç½®** (`config/config.docker.yaml`):
```yaml
log:
  level: info  # debug/info/warn/error
  format: json
  output: stdout
```

### å…³é”®æ—¥å¿—æ ‡è¯†

- `[AutoSave]` - è‡ªåŠ¨ä¿å­˜ç›¸å…³
- `[Session]` - ä¼šè¯ç®¡ç†ç›¸å…³
- `[Auth]` - è®¤è¯æˆæƒç›¸å…³
- `[ERROR]` - é”™è¯¯æ—¥å¿—
- `[WARN]` - è­¦å‘Šæ—¥å¿—

---

## ğŸ”§ å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜1: æœåŠ¡å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: `docker-compose up` å¤±è´¥

**æ’æŸ¥**:
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose -f docker/docker-compose.prod.yml logs

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 8080

# æ£€æŸ¥Dockerç£ç›˜ç©ºé—´
docker system df
```

**è§£å†³**:
```bash
# æ¸…ç†æ—§å®¹å™¨
docker-compose -f docker/docker-compose.prod.yml down

# é‡æ–°å¯åŠ¨
docker-compose -f docker/docker-compose.prod.yml up -d
```

### é—®é¢˜2: MongoDBè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—ä¸­æ˜¾ç¤º "connect to mongodb failed"

**æ’æŸ¥**:
```bash
# æ£€æŸ¥MongoDBæ˜¯å¦è¿è¡Œ
docker ps | grep mongodb

# æ£€æŸ¥MongoDBæ—¥å¿—
docker logs qingyu-mongodb

# æµ‹è¯•è¿æ¥
docker exec -it qingyu-mongodb mongosh --eval "db.runCommand({ ping: 1 })"
```

**è§£å†³**:
```bash
# é‡å¯MongoDB
docker restart qingyu-mongodb

# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
docker exec -it qingyu-backend go run cmd/migrate/main.go
```

### é—®é¢˜3: Redisè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: ä¼šè¯åŠŸèƒ½å¼‚å¸¸

**æ’æŸ¥**:
```bash
# æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
docker ps | grep redis

# æµ‹è¯•Redisè¿æ¥
docker exec -it qingyu-redis redis-cli ping
```

**è§£å†³**:
```bash
# é‡å¯Redis
docker restart qingyu-redis
```

### é—®é¢˜4: è‡ªåŠ¨ä¿å­˜æœªè§¦å‘

**ç—‡çŠ¶**: 30ç§’åæœªåˆ›å»ºç‰ˆæœ¬

**æ’æŸ¥**:
```bash
# æ£€æŸ¥åç«¯æ—¥å¿—
docker logs qingyu-backend | grep AutoSave

# æ£€æŸ¥ç‰ˆæœ¬æœåŠ¡æ—¥å¿—
docker logs qingyu-backend | grep Version
```

**è§£å†³**:
```bash
# é‡å¯åç«¯æœåŠ¡
docker restart qingyu-backend

# æ‰‹åŠ¨è§¦å‘ä¿å­˜
# é€šè¿‡APIè°ƒç”¨ PUT /api/v1/documents/{id}
```

---

## ğŸ”„ æ›´æ–°ä¸å›æ»š

### æ›´æ–°éƒ¨ç½²

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin mvp-release

# 2. é‡æ–°æ„å»ºé•œåƒ
docker build -t qingyu-backend:mvp-new -f docker/Dockerfile.prod .

# 3. åœæ­¢æ—§æœåŠ¡
docker-compose -f docker/docker-compose.prod.yml down

# 4. æ›´æ–°é•œåƒæ ‡ç­¾å¹¶å¯åŠ¨
docker tag qingyu-backend:mvp-new qingyu-backend:mvp
docker-compose -f docker/docker-compose.prod.yml up -d

# 5. éªŒè¯
curl http://localhost:8080/health
```

### å›æ»šéƒ¨ç½²

```bash
# 1. åœæ­¢å½“å‰æœåŠ¡
docker-compose -f docker/docker-compose.prod.yml down

# 2. ä½¿ç”¨æ—§é•œåƒ
docker tag qingyu-backend:mvp-old qingyu-backend:mvp

# 3. å¯åŠ¨æœåŠ¡
docker-compose -f docker/docker-compose.prod.yml up -d

# 4. éªŒè¯
curl http://localhost:8080/health
```

---

## ğŸ“± å†…æµ‹è´¦å·å‡†å¤‡

### åˆ›å»ºæµ‹è¯•è´¦å·

```bash
# ä½¿ç”¨ç§å­æ•°æ®è„šæœ¬åˆ›å»º
docker exec -it qingyu-backend go run migration/seeds/create_test_users.go
```

**å†…æµ‹è´¦å·åˆ—è¡¨**:
| ç”¨æˆ·å | é‚®ç®± | å¯†ç  | è§’è‰² |
|--------|------|------|------|
| test001 | test001@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ· |
| test002 | test002@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ· |
| test003 | test003@qingyu.com | Test@123456 | VIPç”¨æˆ· |
| test004 | test004@qingyu.com | Test@123456 | VIPç”¨æˆ· |
| test005 | test005@qingyu.com | Test@123456 | ä½œè€… |
| admin001 | admin@qingyu.com | Admin@123456 | ç®¡ç†å‘˜ |

---

## ğŸ¯ å†…æµ‹å‡†å¤‡æ¸…å•

### éƒ¨ç½²å‰

- [ ] ä»£ç å·²åˆå¹¶åˆ°mvp-releaseåˆ†æ”¯
- [ ] æ‰€æœ‰ç¼–è¯‘æ£€æŸ¥é€šè¿‡
- [ ] éƒ¨ç½²å‡†å¤‡æ£€æŸ¥é€šè¿‡ï¼ˆ21/21ï¼‰
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### éƒ¨ç½²ä¸­

- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡

### éƒ¨ç½²å

- [ ] APIå¯è®¿é—®æ€§éªŒè¯
- [ ] MVPæ–°åŠŸèƒ½éªŒè¯ï¼ˆå¯†ç /å¤šç«¯ç™»å½•/è‡ªåŠ¨ä¿å­˜ï¼‰
- [ ] æ ¸å¿ƒæµç¨‹å†’çƒŸæµ‹è¯•é€šè¿‡
- [ ] å†…æµ‹è´¦å·åˆ›å»ºå®Œæˆ
- [ ] ç›‘æ§æ—¥å¿—æ­£å¸¸

### æ–‡æ¡£å‡†å¤‡

- [ ] å†…æµ‹æŒ‡å—å‘é€ç»™æµ‹è¯•ç”¨æˆ·
- [ ] é—®é¢˜åé¦ˆæ¸ é“å·²å»ºç«‹
- [ ] å·²çŸ¥é™åˆ¶è¯´æ˜æ–‡æ¡£

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

**æŠ€æœ¯æ”¯æŒ**: tech-support@qingyu.com  
**Bugåé¦ˆ**: https://github.com/qingyu/issues  
**ç´§æ€¥è”ç³»**: æŠ€æœ¯è´Ÿè´£äºº

---

**éƒ¨ç½²æˆåŠŸæ ‡å‡†**:
1. âœ… æ‰€æœ‰æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡
2. âœ… MVPæ ¸å¿ƒåŠŸèƒ½å¯ç”¨
3. âœ… æ— ä¸¥é‡é”™è¯¯æ—¥å¿—
4. âœ… å†…æµ‹è´¦å·å¯ç™»å½•
5. âœ… ç›‘æ§æ—¥å¿—æ­£å¸¸è¿è¡Œ

**ä¸‹ä¸€æ­¥**: å¯åŠ¨å†…æµ‹ï¼Œæ”¶é›†ç”¨æˆ·åé¦ˆ ğŸš€

