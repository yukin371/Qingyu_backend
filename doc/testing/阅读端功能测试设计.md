# 阅读端功能测试设计方案

## 📋 测试概述

**测试目标**: 使用 CNNovel125K 导入的 100 本小说数据，全面测试阅读端功能

**测试数据**:
- 📚 书籍数量: 100 本
- 📖 章节数量: 10,273 章
- 🏷️ 分类: 多个分类（玄幻、仙侠、都市等）
- ⭐ 评分范围: 0.0 - 5.0

---

## 🎯 测试功能清单

### 一、书城浏览功能

#### 1.1 书籍列表展示
| 测试点 | API 端点 | 测试用例 |
|--------|---------|---------|
| 基础列表 | `GET /api/v1/bookstore/books` | 获取前10本书 |
| 分页功能 | `GET /api/v1/bookstore/books?page=2&pageSize=20` | 翻页查看 |
| 排序功能 | `GET /api/v1/bookstore/books?sortBy=word_count&sortOrder=desc` | 按字数降序 |
| 分类筛选 | `GET /api/v1/bookstore/books?category=玄幻` | 只看玄幻类 |

#### 1.2 书籍搜索
| 测试点 | API 端点 | 测试参数 |
|--------|---------|---------|
| 标题搜索 | `GET /api/v1/bookstore/books/search?keyword=书名关键词` | 搜索包含关键词的书 |
| 作者搜索 | `GET /api/v1/bookstore/books/search?author=作者名` | 搜索作者的书 |
| 组合搜索 | `GET /api/v1/bookstore/books/search?keyword=XXX&category=玄幻` | 分类+关键词 |

#### 1.3 书籍详情
| 测试点 | API 端点 | 验证内容 |
|--------|---------|---------|
| 详情页 | `GET /api/v1/bookstore/books/{id}` | 标题、作者、简介、字数、章节数 |
| 字段完整性 | 同上 | 所有必要字段都有值 |
| 不存在的书 | `GET /api/v1/bookstore/books/invalid_id` | 返回404错误 |

---

### 二、榜单功能测试

#### 2.1 热门榜
| 测试点 | 预期结果 | 实现方式 |
|--------|---------|---------|
| 热门书籍 | 获取 is_hot=true 的书 | `GET /api/v1/bookstore/books?is_hot=true` |
| 按字数排名 | 字数最多的前20本 | `GET /api/v1/bookstore/books?sortBy=word_count&sortOrder=desc&limit=20` |
| 按章节数排名 | 章节最多的前20本 | `GET /api/v1/bookstore/books?sortBy=chapter_count&sortOrder=desc&limit=20` |

#### 2.2 推荐榜
| 测试点 | 预期结果 | 实现方式 |
|--------|---------|---------|
| 编辑推荐 | 获取 is_recommended=true 的书 | `GET /api/v1/bookstore/books?is_recommended=true` |
| 精选书籍 | 获取 is_featured=true 的书 | `GET /api/v1/bookstore/books?is_featured=true` |

#### 2.3 分类榜
| 测试点 | 预期结果 | 实现方式 |
|--------|---------|---------|
| 玄幻热门榜 | 玄幻类按字数排序 | `GET /api/v1/bookstore/books?category=玄幻&sortBy=word_count&sortOrder=desc&limit=20` |
| 仙侠热门榜 | 仙侠类按字数排序 | `GET /api/v1/bookstore/books?category=仙侠&sortBy=word_count&sortOrder=desc&limit=20` |
| 都市热门榜 | 都市类按字数排序 | `GET /api/v1/bookstore/books?category=都市&sortBy=word_count&sortOrder=desc&limit=20` |

#### 2.4 新书榜
| 测试点 | 预期结果 | 实现方式 |
|--------|---------|---------|
| 最新发布 | 按创建时间降序 | `GET /api/v1/bookstore/books?sortBy=created_at&sortOrder=desc&limit=20` |
| 最近更新 | 按更新时间降序 | `GET /api/v1/bookstore/books?sortBy=updated_at&sortOrder=desc&limit=20` |

---

### 三、章节阅读功能

#### 3.1 章节列表
| 测试点 | API 端点 | 验证内容 |
|--------|---------|---------|
| 获取目录 | `GET /api/v1/bookstore/books/{id}/chapters` | 所有章节列表 |
| 章节顺序 | 同上 | 按 chapter_num 正序排列 |
| 分页目录 | `GET /api/v1/bookstore/books/{id}/chapters?page=1&pageSize=50` | 分页加载章节 |

#### 3.2 章节内容
| 测试点 | API 端点 | 验证内容 |
|--------|---------|---------|
| 读章节 | `GET /api/v1/bookstore/chapters/{id}` | 完整章节内容 |
| 字数统计 | 同上 | word_count 字段准确 |
| 免费章节 | 同上 | is_free=true, price=0 |

#### 3.3 阅读进度
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 保存进度 | `POST /api/v1/reader/progress` | 记录阅读位置 |
| 获取进度 | `GET /api/v1/reader/books/{id}/progress` | 获取上次阅读位置 |
| 继续阅读 | 同上 | 从上次位置继续 |

---

### 四、书签功能

#### 4.1 书签管理
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 添加书签 | `POST /api/v1/reader/annotations` | 在章节中添加书签 |
| 获取书签列表 | `GET /api/v1/reader/books/{id}/annotations` | 获取某书的所有书签 |
| 删除书签 | `DELETE /api/v1/reader/annotations/{id}` | 删除指定书签 |

---

### 五、评分系统

#### 5.1 评分功能
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 创建评分 | `POST /api/v1/reading/ratings` | 用户给书打分和评论 |
| 获取评分列表 | `GET /api/v1/reading/books/{id}/ratings` | 查看某书的所有评分 |
| 平均评分 | `GET /api/v1/reading/books/{id}/average-rating` | 获取书籍平均分 |
| 评分分布 | `GET /api/v1/reading/books/{id}/rating-distribution` | 1-5星分布统计 |

#### 5.2 评分互动
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 点赞评分 | `POST /api/v1/reading/ratings/{id}/like` | 给有用的评分点赞 |
| 取消点赞 | `POST /api/v1/reading/ratings/{id}/unlike` | 取消点赞 |

---

### 六、推荐系统

#### 6.1 个性化推荐
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 为你推荐 | `GET /api/v1/recommendation/personal` | 基于阅读历史推荐 |
| 相似书籍 | `GET /api/v1/recommendation/similar/{book_id}` | 找相似的书 |

#### 6.2 通用推荐
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 热门推荐 | `GET /api/v1/recommendation/books?type=hot` | 热门书籍推荐 |
| 新书推荐 | `GET /api/v1/recommendation/books?type=new` | 新书推荐 |

---

### 七、统计数据

#### 7.1 书籍统计
| 测试点 | API 端点 | 说明 |
|--------|---------|------|
| 阅读统计 | `GET /api/v1/reading/books/{id}/statistics` | 阅读量、收藏量等 |
| 分类统计 | `GET /api/v1/reading/statistics/categories` | 各分类书籍数量 |

---

## 🧪 测试脚本设计

### 自动化测试脚本结构

```bash
scripts/test_reading_features.sh
├── 1. 基础数据验证
├── 2. 书城浏览测试
├── 3. 榜单功能测试
├── 4. 章节阅读测试
├── 5. 书签功能测试
├── 6. 评分系统测试
├── 7. 推荐系统测试
└── 8. 生成测试报告
```

---

## 📊 测试数据准备

### 准备测试用户
```bash
# 创建测试用户
POST /api/v1/auth/register
{
  "username": "test_reader",
  "email": "test@example.com",
  "password": "test123456"
}
```

### 准备测试数据
1. **已有数据**: 100本小说（已导入）
2. **需要生成**:
   - 用户阅读记录
   - 书签数据
   - 评分数据

---

## 🎯 关键测试场景

### 场景 1: 新用户浏览书城
```
1. 打开书城首页 → 查看热门榜
2. 点击分类 → 查看玄幻榜单
3. 搜索书籍 → 关键词搜索
4. 查看详情 → 点击某本书
5. 开始阅读 → 打开第一章
```

### 场景 2: 用户阅读和互动
```
1. 继续阅读 → 从上次位置继续
2. 添加书签 → 标记重要段落
3. 给书评分 → 打5星+评论
4. 查看推荐 → 看相似书籍
```

### 场景 3: 榜单浏览
```
1. 热门榜 → 查看字数最多的书
2. 新书榜 → 查看最新发布的书
3. 分类榜 → 查看玄幻热门
4. 推荐榜 → 查看编辑精选
```

---

## 🔍 性能测试指标

### 响应时间目标
| API类型 | 目标时间 | 说明 |
|---------|---------|------|
| 书籍列表 | < 100ms | 不含章节内容 |
| 书籍搜索 | < 200ms | 使用文本索引 |
| 章节内容 | < 150ms | 单章内容 |
| 榜单查询 | < 150ms | 已排序数据 |
| 评分查询 | < 100ms | 分页查询 |

### 并发测试
- **并发用户**: 50-100 人
- **测试场景**: 同时浏览书城、阅读章节
- **成功率**: > 99%

---

## 📝 测试数据模板

### 评分测试数据
```json
{
  "book_id": "{{book_id}}",
  "user_id": "{{user_id}}",
  "score": 5,
  "comment": "很好看的小说，强烈推荐！",
  "is_spoiler": false
}
```

### 书签测试数据
```json
{
  "book_id": "{{book_id}}",
  "chapter_id": "{{chapter_id}}",
  "position": 1234,
  "note": "这段很精彩"
}
```

### 阅读进度数据
```json
{
  "book_id": "{{book_id}}",
  "chapter_id": "{{chapter_id}}",
  "chapter_num": 10,
  "progress_percent": 25
}
```

---

## ✅ 测试检查清单

### 功能完整性
- [ ] 书籍列表正常显示
- [ ] 分页功能正常
- [ ] 搜索功能正常
- [ ] 榜单排序正确
- [ ] 章节内容完整
- [ ] 书签功能正常
- [ ] 评分功能正常
- [ ] 推荐系统工作

### 数据准确性
- [ ] 字数统计正确
- [ ] 章节数量正确
- [ ] 分类标签正确
- [ ] 评分计算准确
- [ ] 榜单排名准确

### 性能表现
- [ ] 响应时间达标
- [ ] 并发测试通过
- [ ] 无明显性能瓶颈
- [ ] 索引使用正常

### 用户体验
- [ ] 界面响应快速
- [ ] 错误提示友好
- [ ] 数据加载流畅
- [ ] 功能操作简单

---

## 🐛 常见问题预案

### 问题 1: 榜单数据为空
**原因**: 没有符合条件的书籍  
**解决**: 检查筛选条件，调整参数

### 问题 2: 搜索无结果
**原因**: 文本索引未创建  
**解决**: 确认索引创建成功

### 问题 3: 章节加载慢
**原因**: 章节内容太大  
**解决**: 考虑分段加载或压缩

### 问题 4: 评分功能需要登录
**原因**: 需要用户认证  
**解决**: 先登录获取 token

---

## 📈 测试报告模板

### 测试摘要
- **测试时间**: [填写]
- **测试人员**: [填写]
- **测试环境**: test 分支
- **测试数据**: 100 本小说

### 测试结果
- **总测试项**: [填写]
- **通过项**: [填写]
- **失败项**: [填写]
- **跳过项**: [填写]
- **通过率**: [填写]%

### 性能数据
- **平均响应时间**: [填写] ms
- **最慢接口**: [填写]
- **并发测试**: [填写] 用户，成功率 [填写]%

### 发现的问题
1. [问题描述]
2. [问题描述]

### 优化建议
1. [建议内容]
2. [建议内容]

---

## 📚 相关文档

- [快速开始指南](./CNNovel125K快速开始.md)
- [数据导入指南](../../migration/seeds/README_小说导入指南.md)
- [API 文档](../api/)
- [测试报告模板](./CNNovel125K测试报告.md)

---

**创建时间**: 2025-10-20  
**最后更新**: 2025-10-20  
**维护者**: 青羽测试团队

