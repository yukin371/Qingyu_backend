# 青羽写作系统 - 本地测试数据初始化指南

## 概述

本文档介绍如何在本地开发环境中快速初始化测试数据，包括导入小说数据和创建内测用户。

## 前置要求

### 1. 环境准备

- ✅ Go 1.21+
- ✅ MongoDB 服务已启动（默认端口 27017）
- ✅ Python 3.7+（仅在需要生成新数据时）

### 2. 配置检查

确保 `config/config.local.yaml` 中的数据库配置正确：

```yaml
database:
  type: "mongodb"
  primary:
    mongodb:
      uri: "mongodb://localhost:27017"
      database: "Qingyu_backend"
```

## 快速开始

### Windows 系统

直接运行一键初始化脚本：

```bash
scripts\setup_local_test_data.bat
```

脚本会自动完成以下操作：
1. ✅ 检查 MongoDB 连接
2. ✅ 导入 100 本小说数据（含约 3000 章节）
3. ✅ 创建 20 个内测用户

### Linux/Mac 系统

如果需要在 Linux/Mac 系统使用，请手动执行以下命令：

```bash
# 1. 检查数据库连接
go run cmd/migrate/main.go -command=status -config=.

# 2. 导入小说数据
go run cmd/migrate/main.go -command=import-novels -file=data/novels_100.json -config=.

# 3. 创建内测用户
go run migration/seeds/create_beta_users.go
```

## 内测账号列表

### 管理员账号（3个）

| 用户名 | 密码 | 角色 | 说明 |
|-------|------|------|------|
| admin | Admin@123456 | admin | 超级管理员，拥有所有权限 |
| admin_test | Admin@123456 | admin | 测试管理员 |
| admin_audit | Admin@123456 | admin | 审核管理员 |

### VIP 用户（5个）

| 用户名 | 密码 | 昵称 | 用途 |
|-------|------|------|------|
| vip_writer01 | Vip@123456 | VIP作家1号 | 测试高级写作功能 |
| vip_writer02 | Vip@123456 | VIP作家2号 | 测试AI辅助功能 |
| vip_reader01 | Vip@123456 | VIP读者1号 | 测试付费阅读功能 |
| vip_reader02 | Vip@123456 | VIP读者2号 | 测试书架和推荐功能 |
| vip_tester | Vip@123456 | VIP全能测试员 | VIP综合测试 |

### 写作用户（5个）

| 用户名 | 密码 | 昵称 | 用途 |
|-------|------|------|------|
| writer_xuanhuan | Writer@123456 | 玄幻小说家 | 测试玄幻小说创作 |
| writer_yanqing | Writer@123456 | 言情作家 | 测试言情小说创作 |
| writer_dushi | Writer@123456 | 都市创作者 | 测试都市小说创作 |
| writer_newbie | Writer@123456 | 新手作者 | 测试新手写作流程 |
| writer_pro | Writer@123456 | 专业作家 | 测试高级写作功能 |

### 阅读用户（5个）

| 用户名 | 密码 | 昵称 | 用途 |
|-------|------|------|------|
| reader01 | Reader@123456 | 书虫小白 | 测试基础阅读功能 |
| reader02 | Reader@123456 | 阅读达人 | 测试书架管理功能 |
| reader03 | Reader@123456 | 小说爱好者 | 测试搜索和推荐功能 |
| reader04 | Reader@123456 | 评论家 | 测试评论和互动功能 |
| reader05 | Reader@123456 | 随性读者 | 测试用户行为追踪 |

### 综合测试用户（2个）

| 用户名 | 密码 | 昵称 | 用途 |
|-------|------|------|------|
| tester_all | Test@123456 | 全功能测试员 | 测试所有用户功能 |
| tester_api | Test@123456 | API测试专员 | API接口测试专用 |

## 测试数据说明

### 小说数据

- **数据来源**: CNNovel125K 数据集
- **小说数量**: 100 本
- **章节数量**: 约 3000 章
- **分类**: 玄幻、言情、都市、武侠、仙侠、科幻等
- **状态**: 全部标记为已完结
- **权限**: 全部免费

### 数据特点

- ✅ 真实的网络小说数据
- ✅ 包含多种分类，便于测试推荐系统
- ✅ 评分数据完整，可测试排行榜
- ✅ 字数统计准确，可测试阅读进度

## 进阶操作

### 1. 仅导入小说数据

```bash
go run cmd/migrate/main.go -command=import-novels -file=data/novels_100.json -config=.
```

### 2. 仅创建内测用户

```bash
go run cmd/create_beta_users/main.go
```

### 3. 试运行（验证数据但不导入）

```bash
go run cmd/migrate/main.go -command=import-novels -file=data/novels_100.json -dry-run=true -config=.
```

### 4. 清理测试数据

**警告**：此操作会删除所有书籍和章节数据！

```bash
go run cmd/migrate/main.go -command=clean-novels -config=.
```

### 5. 导入更多小说

如果需要更多测试数据，可以使用 Python 脚本生成：

```bash
# 生成 500 本小说
python scripts/import_novels.py --max-novels 500 --output data/novels_500.json

# 导入到数据库
go run cmd/migrate/main.go -command=import-novels -file=data/novels_500.json -config=.
```

## 测试场景

### 1. 写作端测试

使用写作类账号测试：

- ✅ 创建项目
- ✅ 章节编辑
- ✅ AI 辅助创作（需配置 AI API）
- ✅ 大纲管理
- ✅ 人物设定

**推荐账号**：
- VIP 功能：`vip_writer01` / `Vip@123456`
- 普通功能：`writer_xuanhuan` / `Writer@123456`

### 2. 阅读端测试

使用阅读类账号测试：

- ✅ 书城浏览
- ✅ 书籍搜索
- ✅ 章节阅读
- ✅ 书架管理
- ✅ 阅读进度
- ✅ 评论互动

**推荐账号**：
- VIP 功能：`vip_reader01` / `Vip@123456`
- 普通功能：`reader01` / `Reader@123456`

### 3. 管理端测试

使用管理员账号测试：

- ✅ 用户管理
- ✅ 内容审核
- ✅ 数据统计
- ✅ 系统配置

**推荐账号**：`admin` / `Admin@123456`

### 4. API 测试

使用 API 测试账号：

```bash
# 1. 登录获取 Token
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"tester_api","password":"Test@123456"}'

# 2. 使用 Token 调用 API
curl -X GET http://localhost:8080/api/v1/bookstore/books \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 常见问题

### Q1: MongoDB 连接失败？

**解决方案**：
1. 检查 MongoDB 服务是否启动
2. 检查配置文件中的连接 URI
3. 确认数据库端口未被占用

```bash
# Windows 启动 MongoDB
net start MongoDB

# Linux/Mac 启动 MongoDB
sudo systemctl start mongod
```

### Q2: 导入失败，提示文件不存在？

**解决方案**：
1. 确认 `data/novels_100.json` 文件存在
2. 如果不存在，项目已自带此文件
3. 也可以使用 Python 脚本重新生成

### Q3: 用户创建失败？

**解决方案**：
1. 检查数据库连接
2. 查看是否有用户名或邮箱冲突
3. 如果用户已存在，脚本会自动跳过

### Q4: 如何重置所有测试数据？

**解决方案**：

```bash
# 1. 清理小说数据
go run cmd/migrate/main.go -command=clean-novels -config=.

# 2. 手动清理用户（可选）
# 连接 MongoDB 并删除用户集合

# 3. 重新运行初始化脚本
scripts\setup_local_test_data.bat
```

### Q5: 密码忘记了怎么办？

**解决方案**：
所有测试账号密码遵循统一格式：
- 管理员：`Admin@123456`
- VIP用户：`Vip@123456`
- 写作用户：`Writer@123456`
- 阅读用户：`Reader@123456`
- 测试用户：`Test@123456`

## 安全建议

### 开发环境

- ✅ 使用本文档中的测试账号
- ✅ 定期清理测试数据
- ⚠️ 不要在公网暴露开发环境

### 生产环境

- ❌ **绝对不要**使用这些测试账号
- ✅ 使用强密码策略（至少 12 位，包含大小写字母、数字、特殊字符）
- ✅ 启用双因素认证
- ✅ 定期更换密码
- ✅ 限制管理员账号数量

## 相关文档

- [小说导入详细指南](../../migration/seeds/README_小说导入指南.md)
- [API 测试文档](../../doc/api/)
- [数据库设计文档](../../doc/architecture/)
- [测试规范](./测试规范.md)

## 技术支持

如有问题，请：
1. 查看本文档常见问题部分
2. 检查项目日志文件 `startup.log`
3. 提交 Issue 到项目仓库

---

**最后更新**: 2025-10-24  
**维护者**: 青羽后端开发团队

