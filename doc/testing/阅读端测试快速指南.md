# 阅读端功能测试快速指南

## 🚀 快速开始

### 前提条件
✅ 已导入 100 本小说数据  
✅ MongoDB 正在运行  
✅ 服务器已启动（`go run cmd/server/main.go`）

---

## 📋 一键测试

### Windows 用户
```bash
# 运行自动化测试脚本
scripts\test_reading_features.bat
```

### Linux/Mac 用户
```bash
# 添加执行权限
chmod +x scripts/test_reading_features.sh

# 运行测试
./scripts/test_reading_features.sh
```

**测试内容**:
- ✅ 书城浏览（列表、分页、排序）
- ✅ 书籍搜索
- ✅ 榜单功能（热门榜、新书榜、分类榜）
- ✅ 书籍详情和章节
- ✅ 评分系统
- ✅ 推荐系统

**测试结果**:
- 自动保存在 `test_results/` 目录
- 生成测试报告
- 显示通过率

---

## 🎯 重点测试功能

### 1. 榜单功能测试

#### 热门榜（按字数）
```bash
curl "http://localhost:8080/api/v1/bookstore/books?sortBy=word_count&sortOrder=desc&limit=20"
```

#### 热门榜（按章节数）
```bash
curl "http://localhost:8080/api/v1/bookstore/books?sortBy=chapter_count&sortOrder=desc&limit=20"
```

#### 新书榜
```bash
curl "http://localhost:8080/api/v1/bookstore/books?sortBy=created_at&sortOrder=desc&limit=20"
```

#### 推荐榜
```bash
curl "http://localhost:8080/api/v1/bookstore/books?is_recommended=true&limit=20"
```

#### 玄幻热门榜
```bash
curl "http://localhost:8080/api/v1/bookstore/books?category=玄幻&sortBy=word_count&sortOrder=desc&limit=20"
```

### 2. 书城浏览测试

#### 获取书籍列表
```bash
curl "http://localhost:8080/api/v1/bookstore/books?page=1&pageSize=10"
```

#### 搜索书籍
```bash
curl "http://localhost:8080/api/v1/bookstore/books/search?keyword=书名"
```

#### 按分类筛选
```bash
curl "http://localhost:8080/api/v1/bookstore/books?category=玄幻&page=1&pageSize=10"
```

### 3. 书籍和章节测试

#### 获取书籍详情
```bash
# 先从列表中获取一个书籍 ID
curl "http://localhost:8080/api/v1/bookstore/books/{book_id}"
```

#### 获取章节列表
```bash
curl "http://localhost:8080/api/v1/bookstore/books/{book_id}/chapters?page=1&pageSize=50"
```

#### 获取章节内容
```bash
curl "http://localhost:8080/api/v1/bookstore/chapters/{chapter_id}"
```

---

## 📊 查看测试数据

### 方法 1: 使用浏览器
直接在浏览器访问 API 端点，查看 JSON 响应

### 方法 2: 使用 Postman
导入 API 端点到 Postman 进行测试

### 方法 3: 使用 MongoDB Compass
直接查看数据库中的数据

---

## 🧪 测试场景示例

### 场景 1: 用户浏览榜单
```bash
# 1. 查看热门榜（前20本字数最多的书）
curl "http://localhost:8080/api/v1/bookstore/books?sortBy=word_count&sortOrder=desc&limit=20" | json_pp

# 2. 查看玄幻热门榜
curl "http://localhost:8080/api/v1/bookstore/books?category=玄幻&sortBy=word_count&sortOrder=desc&limit=20" | json_pp

# 3. 查看新书榜
curl "http://localhost:8080/api/v1/bookstore/books?sortBy=created_at&sortOrder=desc&limit=20" | json_pp
```

### 场景 2: 用户搜索和阅读
```bash
# 1. 搜索书籍
curl "http://localhost:8080/api/v1/bookstore/books/search?keyword=仙" | json_pp

# 2. 从结果中选择一本书，查看详情
# 假设得到 book_id = "67159ac8e08b43d4a0a5e401"
curl "http://localhost:8080/api/v1/bookstore/books/67159ac8e08b43d4a0a5e401" | json_pp

# 3. 获取章节列表
curl "http://localhost:8080/api/v1/bookstore/books/67159ac8e08b43d4a0a5e401/chapters?page=1&pageSize=10" | json_pp

# 4. 阅读第一章
# 假设得到 chapter_id = "67159ac8e08b43d4a0a5e402"
curl "http://localhost:8080/api/v1/bookstore/chapters/67159ac8e08b43d4a0a5e402" | json_pp
```

### 场景 3: 查看统计数据
```bash
# 1. 查看书籍评分
curl "http://localhost:8080/api/v1/reading/books/{book_id}/average-rating" | json_pp

# 2. 查看评分分布
curl "http://localhost:8080/api/v1/reading/books/{book_id}/rating-distribution" | json_pp

# 3. 查看推荐书籍
curl "http://localhost:8080/api/v1/recommendation/books?limit=10" | json_pp
```

---

## 🎨 使用 jq 美化输出

安装 jq:
```bash
# Windows (使用 Chocolatey)
choco install jq

# Linux
sudo apt-get install jq

# Mac
brew install jq
```

使用示例:
```bash
# 美化 JSON 输出
curl "http://localhost:8080/api/v1/bookstore/books?limit=5" | jq '.'

# 只显示书名和作者
curl "http://localhost:8080/api/v1/bookstore/books?limit=5" | jq '.data[].title, .data[].author'

# 统计返回的书籍数量
curl "http://localhost:8080/api/v1/bookstore/books" | jq '.data | length'
```

---

## 📈 性能测试

### 使用 Apache Bench

#### 测试书籍列表性能
```bash
ab -n 1000 -c 10 "http://localhost:8080/api/v1/bookstore/books?limit=10"
```

#### 测试榜单性能
```bash
ab -n 500 -c 5 "http://localhost:8080/api/v1/bookstore/books?sortBy=word_count&sortOrder=desc&limit=20"
```

**参数说明**:
- `-n 1000`: 总请求数 1000
- `-c 10`: 并发数 10

**关注指标**:
- Requests per second（每秒请求数）
- Time per request（单个请求时间）
- Failed requests（失败请求数，应为 0）

---

## 📝 测试检查清单

### 榜单功能
- [ ] 热门榜（按字数）返回正确
- [ ] 热门榜（按章节数）返回正确
- [ ] 新书榜按时间排序正确
- [ ] 推荐榜只返回 is_recommended=true 的书
- [ ] 精选榜只返回 is_featured=true 的书
- [ ] 分类榜正确筛选分类
- [ ] 榜单数据按要求排序
- [ ] 榜单限制数量（limit）生效

### 书城功能
- [ ] 书籍列表正常显示
- [ ] 分页功能正常
- [ ] 搜索返回正确结果
- [ ] 分类筛选正确
- [ ] 排序功能正常
- [ ] 书籍详情完整

### 章节功能
- [ ] 章节列表正确
- [ ] 章节顺序正确
- [ ] 章节内容完整
- [ ] 字数统计准确

### 性能指标
- [ ] 书籍列表 < 100ms
- [ ] 搜索响应 < 200ms
- [ ] 榜单查询 < 150ms
- [ ] 章节内容 < 150ms
- [ ] 并发测试通过（50-100 用户）

---

## 🐛 常见问题

### Q1: 测试脚本提示连接失败
**A**: 确保服务器正在运行：
```bash
go run cmd/server/main.go
```

### Q2: 榜单返回空数据
**A**: 检查筛选条件：
- 确认数据库中有符合条件的书籍
- 检查分类名称是否正确（区分大小写）
- 尝试去掉部分筛选条件

### Q3: 搜索功能无结果
**A**: 确认文本索引已创建：
```javascript
// 在 MongoDB 中检查
db.books.getIndexes()
```

### Q4: 章节加载慢
**A**: 
- 检查章节内容大小
- 确认索引已创建
- 考虑添加缓存

---

## 📊 预期结果

### 热门榜（按字数）前5名
应该看到字数从高到低排列的书籍，例如：
1. 书A - 500,000 字
2. 书B - 450,000 字
3. 书C - 400,000 字
...

### 分类统计
- 玄幻类: XX 本
- 仙侠类: XX 本
- 都市类: XX 本
- 其他类: XX 本
- 总计: 100 本

---

## 📚 相关文档

- [详细测试设计](./阅读端功能测试设计.md)
- [数据导入指南](../../migration/seeds/README_小说导入指南.md)
- [快速开始](./CNNovel125K快速开始.md)
- [API 文档](../api/)

---

## 💡 提示

1. **自动化测试**: 优先使用提供的测试脚本
2. **手动测试**: 使用 Postman 或浏览器进行深入测试
3. **性能测试**: 使用 Apache Bench 进行压力测试
4. **数据验证**: 使用 MongoDB Compass 直接查看数据库

---

**创建时间**: 2025-10-20  
**维护者**: 青羽测试团队

祝测试顺利！ 🎉

