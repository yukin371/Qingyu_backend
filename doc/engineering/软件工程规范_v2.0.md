# é’ç¾½å¹³å°è½¯ä»¶å·¥ç¨‹è§„èŒƒ v2.0

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025-10-06
> **é¡¹ç›®åç§°**: é’ç¾½ä¸€ç«™å¼é˜…è¯»å†™ä½œå¹³å°
> **é€‚ç”¨èŒƒå›´**: å…¨ä½“å¼€å‘äººå‘˜

---

## 1. æ¦‚è¿°

### 1.1 ç›®çš„

æœ¬è§„èŒƒæ—¨åœ¨ä¸ºé’ç¾½å¹³å°å»ºç«‹å…¨é¢ã€ç³»ç»Ÿçš„è½¯ä»¶å·¥ç¨‹æ ‡å‡†ï¼Œç¡®ä¿å¼€å‘å›¢é˜Ÿåœ¨éœ€æ±‚ã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰å„ä¸ªç¯èŠ‚éµå¾ªç»Ÿä¸€çš„è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œä»è€Œä¿è¯è½¯ä»¶è´¨é‡ã€æå‡å¼€å‘æ•ˆç‡ã€é™ä½ç»´æŠ¤æˆæœ¬ã€‚

### 1.2 é€‚ç”¨èŒƒå›´

- âœ… éœ€æ±‚åˆ†æä¸ç®¡ç†
- âœ… è½¯ä»¶æ¶æ„ä¸è®¾è®¡
- âœ… ç¼–ç å¼€å‘è§„èŒƒï¼ˆGoã€JavaScript/TypeScriptï¼‰
- âœ… æµ‹è¯•ä¸è´¨é‡ä¿è¯
- âœ… é¡¹ç›®ç®¡ç†ä¸åä½œ
- âœ… é…ç½®ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶
- âœ… éƒ¨ç½²ä¸è¿ç»´
- âœ… æ–‡æ¡£ç¼–å†™è§„èŒƒ

### 1.3 æŒ‡å¯¼åŸåˆ™

**æ ¸å¿ƒåŸåˆ™**ï¼š

1. **æ¶æ„ä¼˜å…ˆ**ï¼šåŸºäºåˆ†å±‚æ¶æ„å’ŒRepositoryæ¨¡å¼
2. **è´¨é‡ä¸ºæœ¬**ï¼šä»£ç è´¨é‡ã€æµ‹è¯•è¦†ç›–ç‡ã€æ€§èƒ½æŒ‡æ ‡
3. **å®‰å…¨ç¬¬ä¸€**ï¼šå®‰å…¨è®¾è®¡è´¯ç©¿å§‹ç»ˆ
4. **æŒç»­æ”¹è¿›**ï¼šæ•æ·å¼€å‘ã€å¿«é€Ÿè¿­ä»£
5. **å›¢é˜Ÿåä½œ**ï¼šä»£ç å®¡æŸ¥ã€çŸ¥è¯†å…±äº«
6. **æ–‡æ¡£å®Œå–„**ï¼šæ–‡æ¡£ä¸ä»£ç åŒæ­¥æ›´æ–°

**å·¥ç¨‹ä»·å€¼è§‚**ï¼š

- ğŸ¯ **æ¸…æ™°èƒœäºèªæ˜**ï¼šä»£ç å¯è¯»æ€§ä¼˜å…ˆ
- ğŸ”§ **ç®€å•èƒœäºå¤æ‚**ï¼šé¿å…è¿‡åº¦è®¾è®¡
- âœ… **æµ‹è¯•èƒœäºè°ƒè¯•**ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘
- ğŸ“š **æ–‡æ¡£èƒœäºå£å¤´**ï¼šçŸ¥è¯†æ˜¾æ€§åŒ–
- ğŸš€ **è¿­ä»£èƒœäºå®Œç¾**ï¼šæŒç»­äº¤ä»˜ä»·å€¼

---

## 2. éœ€æ±‚å·¥ç¨‹è§„èŒƒ

### 2.1 éœ€æ±‚åˆ†ææµç¨‹

#### 2.1.1 éœ€æ±‚æ”¶é›†é˜¶æ®µ

**è¾“å…¥**ï¼š

- ç”¨æˆ·åé¦ˆå’Œéœ€æ±‚
- å¸‚åœºè°ƒç ”æ•°æ®
- ç«å“åˆ†ææŠ¥å‘Š
- ä¸šåŠ¡å‘å±•ç­–ç•¥

**æ´»åŠ¨**ï¼š

1. **ç”¨æˆ·è®¿è°ˆ**ï¼šä¸ç›®æ ‡ç”¨æˆ·æ·±åº¦äº¤æµ
2. **é—®å·è°ƒæŸ¥**ï¼šå¤§è§„æ¨¡ç”¨æˆ·éœ€æ±‚æ”¶é›†
3. **æ•°æ®åˆ†æ**ï¼šç”¨æˆ·è¡Œä¸ºæ•°æ®æŒ–æ˜
4. **ç«å“ç ”ç©¶**ï¼šåˆ†æç«äº‰å¯¹æ‰‹åŠŸèƒ½
5. **å¤´è„‘é£æš´**ï¼šå›¢é˜Ÿåˆ›æ–°è®¨è®º

**è¾“å‡º**ï¼š

- éœ€æ±‚æ¸…å•ï¼ˆåˆç¨¿ï¼‰
- ç”¨æˆ·ç”»åƒ
- ä½¿ç”¨åœºæ™¯æè¿°

#### 2.1.2 éœ€æ±‚åˆ†æé˜¶æ®µ

**åˆ†æç»´åº¦**ï¼š

- **åŠŸèƒ½éœ€æ±‚**ï¼šç”¨æˆ·éœ€è¦ä»€ä¹ˆåŠŸèƒ½
- **éåŠŸèƒ½éœ€æ±‚**ï¼šæ€§èƒ½ã€å®‰å…¨ã€å¯ç”¨æ€§ç­‰
- **ä¸šåŠ¡ä»·å€¼**ï¼šéœ€æ±‚å¯¹ä¸šåŠ¡çš„å½±å“
- **æŠ€æœ¯å¯è¡Œæ€§**ï¼šå®ç°éš¾åº¦å’Œæˆæœ¬
- **ä¼˜å…ˆçº§**ï¼šP0/P1/P2/P3åˆ†çº§

**åˆ†ææ–¹æ³•**ï¼š

- KANOæ¨¡å‹ï¼ˆåŸºæœ¬ã€æœŸæœ›ã€å…´å¥‹éœ€æ±‚ï¼‰
- ç”¨æˆ·æ•…äº‹åœ°å›¾
- ä¸šåŠ¡æµç¨‹åˆ†æ
- æŠ€æœ¯é£é™©è¯„ä¼°

**è¾“å‡º**ï¼š

- éœ€æ±‚åˆ†ææŠ¥å‘Š
- éœ€æ±‚ä¼˜å…ˆçº§åˆ—è¡¨
- é£é™©è¯„ä¼°æŠ¥å‘Š

#### 2.1.3 éœ€æ±‚æ–‡æ¡£åŒ–é˜¶æ®µ

**æ–‡æ¡£ç±»å‹**ï¼š

1. **éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦(SRS)**ï¼šè¯¦ç»†çš„åŠŸèƒ½å’ŒéåŠŸèƒ½éœ€æ±‚
2. **ç”¨æˆ·æ•…äº‹(User Story)**ï¼šä»¥ç”¨æˆ·è§†è§’æè¿°éœ€æ±‚
3. **éªŒæ”¶æ ‡å‡†(Acceptance Criteria)**ï¼šéœ€æ±‚éªŒæ”¶æ¡ä»¶
4. **éœ€æ±‚è¿½æº¯çŸ©é˜µ**ï¼šéœ€æ±‚åˆ°è®¾è®¡ã€ä»£ç ã€æµ‹è¯•çš„æ˜ å°„

**æ–‡æ¡£æ¨¡æ¿**ï¼š

```markdown
## éœ€æ±‚æ ‡é¢˜

**éœ€æ±‚ID**: REQ-[æ¨¡å—]-[åºå·]  
**ä¼˜å…ˆçº§**: P0/P1/P2/P3  
**æå‡ºäºº**: XXX  
**åˆ›å»ºæ—¶é—´**: YYYY-MM-DD

### éœ€æ±‚æè¿°
ï¼ˆæ¸…æ™°æè¿°éœ€æ±‚å†…å®¹ï¼‰

### ç”¨æˆ·æ•…äº‹
ä½œä¸º [ç”¨æˆ·è§’è‰²]ï¼Œæˆ‘æƒ³è¦ [åŠŸèƒ½]ï¼Œä»¥ä¾¿ [ç›®æ ‡]ã€‚

### éªŒæ”¶æ ‡å‡†
- [ ] æ ‡å‡†1
- [ ] æ ‡å‡†2
- [ ] æ ‡å‡†3

### æŠ€æœ¯è€ƒè™‘
ï¼ˆæŠ€æœ¯å®ç°è¦ç‚¹ã€ä¾èµ–ã€é£é™©ï¼‰

### ç›¸å…³éœ€æ±‚
- REQ-XXX-001
- REQ-XXX-002
```

### 2.2 éœ€æ±‚ç®¡ç†è§„èŒƒ

#### 2.2.1 éœ€æ±‚å˜æ›´ç®¡ç†

**å˜æ›´æµç¨‹**ï¼š

```
éœ€æ±‚å˜æ›´ç”³è¯· â†’ å½±å“åˆ†æ â†’ è¯„å®¡å†³ç­– â†’ å˜æ›´å®æ–½ â†’ å˜æ›´éªŒè¯
```

**å˜æ›´æ§åˆ¶**ï¼š

- âœ… æ‰€æœ‰å˜æ›´å¿…é¡»èµ°æ­£å¼æµç¨‹
- âœ… è¯„ä¼°å˜æ›´å¯¹è¿›åº¦ã€æˆæœ¬ã€è´¨é‡çš„å½±å“
- âœ… å˜æ›´å¿…é¡»ç»è¿‡ç›¸å…³æ–¹å®¡æ‰¹
- âœ… å˜æ›´è®°å½•éœ€å½’æ¡£

#### 2.2.2 éœ€æ±‚è¿½è¸ªç®¡ç†

**è¿½æº¯çŸ©é˜µ**ï¼š

| éœ€æ±‚ID           | è®¾è®¡æ–‡æ¡£        | ä»£ç æ¨¡å—          | æµ‹è¯•ç”¨ä¾‹      | çŠ¶æ€   |
| ---------------- | --------------- | ----------------- | ------------- | ------ |
| REQ-AI-AGENT-001 | agent_design.md | service/ai/agent/ | test_agent.go | å·²å®Œæˆ |
| REQ-RAG-001      | rag_design.md   | service/ai/rag/   | test_rag.go   | è¿›è¡Œä¸­ |

**è¿½è¸ªå·¥å…·**ï¼š

- Gitæäº¤å…³è”éœ€æ±‚IDï¼ˆå¦‚ï¼š`[REQ-AI-001] Implement Agent tool calling`ï¼‰
- ä»£ç æ³¨é‡Šæ ‡æ³¨éœ€æ±‚æ¥æº
- æµ‹è¯•ç”¨ä¾‹å…³è”éœ€æ±‚ID

#### 2.2.3 éœ€æ±‚éªŒè¯

**éªŒè¯æ–¹æ³•**ï¼š

- âœ… éœ€æ±‚è¯„å®¡ä¼šè®®ï¼ˆäº§å“ã€å¼€å‘ã€æµ‹è¯•ï¼‰
- âœ… åŸå‹éªŒè¯ï¼ˆå¿«é€ŸéªŒè¯æ ¸å¿ƒäº¤äº’ï¼‰
- âœ… ç”¨æˆ·æµ‹è¯•ï¼ˆé‚€è¯·ç›®æ ‡ç”¨æˆ·è¯•ç”¨ï¼‰
- âœ… æ•°æ®åˆ†æï¼ˆA/Bæµ‹è¯•ã€ç°åº¦å‘å¸ƒï¼‰

### 2.3 éœ€æ±‚æ–‡æ¡£æ ‡å‡†

**æ–‡æ¡£è§„èŒƒ**ï¼š

- ä½¿ç”¨Markdownæ ¼å¼ç¼–å†™
- å­˜æ”¾åœ¨ `doc/engineering/`ç›®å½•
- éœ€æ±‚IDå‘½åè§„åˆ™ï¼š`REQ-[æ¨¡å—]-[åŠŸèƒ½]-[åºå·]`
  - ä¾‹ï¼š`REQ-AI-AGENT-001`ã€`REQ-READING-BOOKSTORE-001`
- ä¼˜å…ˆçº§æ ‡è®°ï¼šP0â­â­â­â­â­ã€P1â­â­â­â­ã€P2â­â­â­ã€P3â­â­

---

## 3. è½¯ä»¶æ¶æ„è§„èŒƒ

### 3.1 æ¶æ„åŸåˆ™

#### 3.1.1 åˆ†å±‚æ¶æ„åŸåˆ™

**æ¶æ„å±‚æ¬¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Router Layer (è·¯ç”±å±‚)                â”‚  HTTPè·¯ç”±ã€ä¸­é—´ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       API Layer (æ¥å£å±‚)                 â”‚  è¯·æ±‚å¤„ç†ã€å“åº”æ„å»º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Service Layer (ä¸šåŠ¡é€»è¾‘å±‚)           â”‚  ä¸šåŠ¡è§„åˆ™ã€æµç¨‹æ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Repository Layer (æ•°æ®è®¿é—®å±‚)          â”‚  æ•°æ®æŒä¹…åŒ–ã€æŸ¥è¯¢å°è£…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Model Layer (æ•°æ®æ¨¡å‹å±‚)            â”‚  æ•°æ®ç»“æ„ã€éªŒè¯è§„åˆ™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾èµ–è§„åˆ™**ï¼š

- âœ… ä¸Šå±‚å¯ä»¥ä¾èµ–ä¸‹å±‚
- âŒ ä¸‹å±‚ä¸èƒ½ä¾èµ–ä¸Šå±‚
- âœ… åŒå±‚ä¹‹é—´é€šè¿‡æ¥å£äº¤äº’
- âœ… ä¾èµ–æ¥å£è€Œéå…·ä½“å®ç°ï¼ˆDIP - ä¾èµ–å€’ç½®åŸåˆ™ï¼‰

**å±‚æ¬¡èŒè´£**ï¼š

- **Routerå±‚**ï¼šå®šä¹‰è·¯ç”±ã€æ³¨å†Œä¸­é—´ä»¶
- **APIå±‚**ï¼šå‚æ•°ç»‘å®šã€éªŒè¯ã€è°ƒç”¨Serviceã€æ„å»ºå“åº”
- **Serviceå±‚**ï¼šä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡åè°ƒã€äº‹ä»¶å‘å¸ƒ
- **Repositoryå±‚**ï¼šæ•°æ®æ“ä½œã€æŸ¥è¯¢å°è£…ã€ç¼“å­˜ç®¡ç†
- **Modelå±‚**ï¼šæ•°æ®ç»“æ„ã€å­—æ®µæ ‡ç­¾ã€éªŒè¯è§„åˆ™

#### 3.1.2 Repositoryæ¨¡å¼

**æ¥å£å®šä¹‰**ï¼š

```go
// Repositoryæ¥å£ï¼ˆinterfaces/user/UserRepository_interface.goï¼‰
type UserRepository interface {
    // åŸºç¡€CRUD
    Create(ctx context.Context, user *models.User) error
    GetByID(ctx context.Context, id string) (*models.User, error)
    Update(ctx context.Context, id string, updates map[string]interface{}) error
    Delete(ctx context.Context, id string) error
  
    // ä¸šåŠ¡æŸ¥è¯¢
    GetByEmail(ctx context.Context, email string) (*models.User, error)
    List(ctx context.Context, filter infrastructure.Filter) ([]*models.User, error)
  
    // å¥åº·æ£€æŸ¥
    Health(ctx context.Context) error
}
```

**å…·ä½“å®ç°**ï¼š

```go
// MongoDBå®ç°ï¼ˆmongodb/user/user_repository_mongo.goï¼‰
type MongoUserRepository struct {
    collection   *mongo.Collection
    queryBuilder infrastructure.QueryBuilder
}

func NewMongoUserRepository(db *mongo.Database) UserRepository {
    return &MongoUserRepository{
        collection:   db.Collection("users"),
        queryBuilder: mongodb.NewMongoQueryBuilder(),
    }
}

func (r *MongoUserRepository) Create(ctx context.Context, user *models.User) error {
    // å®ç°ç»†èŠ‚
}
```

**å·¥å‚æ¨¡å¼**ï¼š

```go
// Repositoryå·¥å‚
type RepositoryFactory interface {
    CreateUserRepository() user.UserRepository
    CreateProjectRepository() writing.ProjectRepository
    CreateAIRepository() ai.AIRepository
    Health(ctx context.Context) error
    Close() error
}
```

**è§„èŒƒè¦æ±‚**ï¼š

- âœ… æ‰€æœ‰æ•°æ®è®¿é—®å¿…é¡»é€šè¿‡Repository
- âœ… Repositoryæ¥å£åœ¨ `repository/interfaces/`å®šä¹‰
- âœ… å…·ä½“å®ç°æŒ‰æ•°æ®åº“ç±»å‹ç»„ç»‡ï¼ˆmongodb/ã€postgres/ï¼‰
- âœ… ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºRepositoryå®ä¾‹
- âŒ Serviceå±‚ä¸å¾—ç›´æ¥æ“ä½œæ•°æ®åº“

#### 3.1.3 ä¾èµ–æ³¨å…¥åŸåˆ™

**æœåŠ¡å®¹å™¨**ï¼š

```go
// æœåŠ¡å®¹å™¨ï¼ˆservice/container/service_container.goï¼‰
type ServiceContainer struct {
    repositoryFactory interfaces.RepositoryFactory
    services          map[string]base.BaseService
    eventBus          base.EventBus
}

func NewServiceContainer(factory interfaces.RepositoryFactory) *ServiceContainer {
    container := &ServiceContainer{
        repositoryFactory: factory,
        services:          make(map[string]base.BaseService),
        eventBus:          base.NewSimpleEventBus(),
    }
  
    // æ³¨å†ŒæœåŠ¡
    container.registerServices()
    return container
}

func (c *ServiceContainer) registerServices() {
    // åˆ›å»ºå¹¶æ³¨å†ŒUserService
    userService := user.NewUserService(
        c.repositoryFactory.CreateUserRepository(),
        c.repositoryFactory.CreateRoleRepository(),
        c.eventBus,
    )
    c.RegisterService("UserService", userService)
  
    // åˆ›å»ºå¹¶æ³¨å†ŒAIService
    aiService := ai.NewAIService(
        c.repositoryFactory.CreateAIRepository(),
        c.eventBus,
    )
    c.RegisterService("AIService", aiService)
}
```

**ä¾èµ–æ³¨å…¥ç¤ºä¾‹**ï¼š

```go
// Serviceæ„é€ å‡½æ•°
func NewUserService(
    userRepo repository.UserRepository,      // æ³¨å…¥Repositoryæ¥å£
    roleRepo repository.RoleRepository,
    eventBus base.EventBus,                  // æ³¨å…¥EventBusæ¥å£
) *UserService {
    return &UserService{
        userRepo:  userRepo,
        roleRepo:  roleRepo,
        eventBus:  eventBus,
        validator: base.NewBaseValidator(),
    }
}
```

**è§„èŒƒè¦æ±‚**ï¼š

- âœ… ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
- âœ… ä¾èµ–æ¥å£è€Œéå…·ä½“å®ç°
- âœ… é€šè¿‡ServiceContainerç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸ
- âŒ ç¦æ­¢åœ¨ä»£ç ä¸­ç›´æ¥newå…·ä½“å®ç°ç±»

#### 3.1.4 äº‹ä»¶é©±åŠ¨æ¶æ„

**äº‹ä»¶æ€»çº¿**ï¼š

```go
// äº‹ä»¶æ¥å£
type Event interface {
    GetEventType() string
    GetEventData() interface{}
    GetTimestamp() time.Time
    GetSource() string
}

// äº‹ä»¶å¤„ç†å™¨
type EventHandler interface {
    Handle(ctx context.Context, event Event) error
    GetHandlerName() string
    GetSupportedEventTypes() []string
}

// äº‹ä»¶æ€»çº¿
type EventBus interface {
    Subscribe(eventType string, handler EventHandler) error
    Unsubscribe(eventType string, handlerName string) error
    Publish(ctx context.Context, event Event) error
    PublishAsync(ctx context.Context, event Event) error
}
```

**äº‹ä»¶å‘å¸ƒ**ï¼š

```go
// Serviceå±‚å‘å¸ƒäº‹ä»¶
func (s *UserService) CreateUser(ctx context.Context, req *CreateUserRequest) error {
    // ... åˆ›å»ºç”¨æˆ·é€»è¾‘
  
    // å‘å¸ƒç”¨æˆ·åˆ›å»ºäº‹ä»¶
    event := &base.BaseEvent{
        EventType: "user.created",
        EventData: map[string]interface{}{
            "user_id": user.ID,
            "email":   user.Email,
        },
        Timestamp: time.Now(),
        Source:    "UserService",
    }
    s.eventBus.PublishAsync(ctx, event)
  
    return nil
}
```

**äº‹ä»¶è®¢é˜…**ï¼š

```go
// åˆå§‹åŒ–æ—¶è®¢é˜…äº‹ä»¶
func initEventHandlers(eventBus base.EventBus) {
    // è®¢é˜…ç”¨æˆ·åˆ›å»ºäº‹ä»¶ï¼Œå‘é€æ¬¢è¿é‚®ä»¶
    welcomeHandler := &WelcomeEmailHandler{
        emailService: email.NewEmailService(),
    }
    eventBus.Subscribe("user.created", welcomeHandler)
  
    // è®¢é˜…ç”¨æˆ·åˆ›å»ºäº‹ä»¶ï¼Œåˆå§‹åŒ–é’±åŒ…
    walletHandler := &InitWalletHandler{
        walletService: wallet.NewWalletService(),
    }
    eventBus.Subscribe("user.created", walletHandler)
}
```

**è§„èŒƒè¦æ±‚**ï¼š

- âœ… è·¨Serviceçš„æ“ä½œä¼˜å…ˆä½¿ç”¨äº‹ä»¶
- âœ… å¼‚æ­¥æ“ä½œä½¿ç”¨PublishAsync
- âœ… äº‹ä»¶å‘½åè§„èŒƒï¼š`[å®ä½“].[åŠ¨ä½œ]`ï¼ˆå¦‚ `user.created`ï¼‰
- âœ… äº‹ä»¶å¤„ç†å¤±è´¥ä¸åº”å½±å“ä¸»æµç¨‹

### 3.2 æ¨¡å—åŒ–è®¾è®¡è§„èŒƒ

#### 3.2.1 æ¨¡å—åˆ’åˆ†åŸåˆ™

**æ¨¡å—è¾¹ç•Œ**ï¼š

- æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†ï¼ˆDDD - é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰
- é«˜å†…èšã€ä½è€¦åˆ
- æ¨¡å—é—´é€šè¿‡æ¥å£æˆ–äº‹ä»¶é€šä¿¡

**æ ¸å¿ƒæ¨¡å—**ï¼š

1. **é˜…è¯»ç«¯æ¨¡å—**ï¼šä¹¦åŸã€é˜…è¯»å™¨ã€æ¨èã€ç¤¾äº¤
2. **å†™ä½œç«¯æ¨¡å—**ï¼šç¼–è¾‘å™¨ã€é¡¹ç›®ç®¡ç†ã€è®¾å®šç™¾ç§‘
3. **AIæœåŠ¡æ¨¡å—**ï¼šAIé€‚é…å™¨ã€Agentç³»ç»Ÿã€RAGç³»ç»Ÿ
4. **ç”¨æˆ·ä¸­å¿ƒæ¨¡å—**ï¼šç”¨æˆ·ç®¡ç†ã€è§’è‰²æƒé™ã€ç”¨æˆ·ç­‰çº§
5. **å…±äº«æœåŠ¡æ¨¡å—**ï¼šé€šçŸ¥ã€å­˜å‚¨ã€æœç´¢ã€é’±åŒ…
6. **åŸºç¡€è®¾æ–½æ¨¡å—**ï¼šè®¤è¯ã€ä¸­é—´ä»¶ã€é…ç½®ã€ç›‘æ§

#### 3.2.2 ç›®å½•ç»“æ„è§„èŒƒ

```
Qingyu_backend/
â”œâ”€â”€ api/v1/                      # APIå±‚
â”‚   â”œâ”€â”€ system/                  # ç³»ç»ŸAPI
â”‚   â”œâ”€â”€ document/                # æ–‡æ¡£API
â”‚   â”œâ”€â”€ ai/                      # AI API
â”‚   â”œâ”€â”€ reading/                 # é˜…è¯»API
â”‚   â””â”€â”€ shared/                  # å…±äº«API
â”œâ”€â”€ service/                     # Serviceå±‚
â”‚   â”œâ”€â”€ base/                    # åŸºç¡€æœåŠ¡
â”‚   â”œâ”€â”€ container/               # æœåŠ¡å®¹å™¨
â”‚   â”œâ”€â”€ interfaces/              # Serviceæ¥å£
â”‚   â”œâ”€â”€ user/                    # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ ai/                      # AIæœåŠ¡
â”‚   â”œâ”€â”€ project/                 # é¡¹ç›®æœåŠ¡
â”‚   â””â”€â”€ shared/                  # å…±äº«æœåŠ¡
â”œâ”€â”€ repository/                  # Repositoryå±‚
â”‚   â”œâ”€â”€ interfaces/              # Repositoryæ¥å£
â”‚   â”‚   â”œâ”€â”€ infrastructure/      # åŸºç¡€æ¥å£
â”‚   â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·Repositoryæ¥å£
â”‚   â”‚   â”œâ”€â”€ writing/             # å†™ä½œRepositoryæ¥å£
â”‚   â”‚   â””â”€â”€ repository_factory.go
â”‚   â”œâ”€â”€ mongodb/                 # MongoDBå®ç°
â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ writing/
â”‚   â”‚   â””â”€â”€ factory.go
â”‚   â””â”€â”€ Mock/                    # Mockå®ç°ï¼ˆæµ‹è¯•ç”¨ï¼‰
â”œâ”€â”€ models/                      # Modelå±‚
â”‚   â”œâ”€â”€ users/                   # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ document/                # æ–‡æ¡£æ¨¡å‹
â”‚   â”œâ”€â”€ ai/                      # AIæ¨¡å‹
â”‚   â””â”€â”€ shared/                  # å…±äº«æ¨¡å‹
â”œâ”€â”€ router/                      # Routerå±‚
â”‚   â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ project/
â”‚   â”œâ”€â”€ ai/
â”‚   â””â”€â”€ enter.go
â”œâ”€â”€ middleware/                  # ä¸­é—´ä»¶
â”œâ”€â”€ config/                      # é…ç½®
â”œâ”€â”€ pkg/                         # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ errors/                  # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ validator/               # éªŒè¯å™¨
â”‚   â””â”€â”€ response/                # å“åº”æ ¼å¼åŒ–
â”œâ”€â”€ test/                        # æµ‹è¯•
â”‚   â”œâ”€â”€ api/                     # APIæµ‹è¯•
â”‚   â”œâ”€â”€ service/                 # Serviceæµ‹è¯•
â”‚   â”œâ”€â”€ repository/              # Repositoryæµ‹è¯•
â”‚   â””â”€â”€ integration/             # é›†æˆæµ‹è¯•
â”œâ”€â”€ doc/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ engineering/             # å·¥ç¨‹æ–‡æ¡£
â”‚   â”œâ”€â”€ design/                  # è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ api/                     # APIæ–‡æ¡£
â”‚   â””â”€â”€ implementation/          # å®ç°æŒ‡å—
â”œâ”€â”€ docker/                      # Dockeré…ç½®
â”œâ”€â”€ main.go                      # å…¥å£æ–‡ä»¶
â””â”€â”€ go.mod                       # Goæ¨¡å—
```

### 3.3 è®¾è®¡æ–‡æ¡£è§„èŒƒ

**å¿…éœ€æ–‡æ¡£**ï¼š

1. **æ¶æ„è®¾è®¡æ–‡æ¡£**ï¼šæ•´ä½“æ¶æ„ã€æŠ€æœ¯é€‰å‹ã€æ ¸å¿ƒæµç¨‹
2. **æ¨¡å—è®¾è®¡æ–‡æ¡£**ï¼šæ¨¡å—èŒè´£ã€æ¥å£å®šä¹‰ã€æ•°æ®æ¨¡å‹
3. **APIè®¾è®¡æ–‡æ¡£**ï¼šæ¥å£å®šä¹‰ã€è¯·æ±‚å“åº”æ ¼å¼ã€é”™è¯¯ç 
4. **æ•°æ®åº“è®¾è®¡æ–‡æ¡£**ï¼šè¡¨ç»“æ„ã€ç´¢å¼•è®¾è®¡ã€æ•°æ®å­—å…¸

**æ–‡æ¡£æ¨¡æ¿**ï¼šå‚è€ƒ `doc/design/è®¾è®¡æ–‡æ¡£æ¨¡æ¿.md`

**è®¾è®¡è¯„å®¡**ï¼š

- é‡å¤§åŠŸèƒ½è®¾è®¡éœ€ç»è¿‡è¯„å®¡
- è¯„å®¡å‚ä¸æ–¹ï¼šæ¶æ„å¸ˆã€å¼€å‘ã€æµ‹è¯•ã€äº§å“
- è¯„å®¡è¦ç‚¹ï¼šå¯è¡Œæ€§ã€æ€§èƒ½ã€å®‰å…¨ã€å¯ç»´æŠ¤æ€§

---

## 4. ç¼–ç è§„èŒƒ

### 4.1 Goè¯­è¨€ç¼–ç è§„èŒƒ

#### 4.1.1 å‘½åè§„èŒƒ

**åŒ…å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå°å†™ã€ç®€æ´ã€æœ‰æ„ä¹‰
package userservice
package aiagent

// âŒ é”™è¯¯ï¼šé©¼å³°ã€ä¸‹åˆ’çº¿
package UserService
package ai_agent
```

**å¸¸é‡å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå¤§é©¼å³°æˆ–å…¨å¤§å†™+ä¸‹åˆ’çº¿
const MaxRetryCount = 3
const DEFAULT_TIMEOUT = 30 * time.Second

// âŒ é”™è¯¯ï¼šå°å†™
const maxretrycount = 3
```

**å˜é‡å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå°é©¼å³°
var userID string
var eventBus base.EventBus

// âŒ é”™è¯¯ï¼šä¸‹åˆ’çº¿
var user_id string
var event_bus base.EventBus
```

**å‡½æ•°/æ–¹æ³•å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå¤§é©¼å³°ï¼ˆå¯¼å‡ºï¼‰æˆ–å°é©¼å³°ï¼ˆç§æœ‰ï¼‰ï¼ŒåŠ¨è¯å¼€å¤´
func CreateUser(ctx context.Context, req *CreateUserRequest) error
func validateUserInput(user *User) error

// âŒ é”™è¯¯ï¼šåè¯å¼€å¤´
func User(ctx context.Context) error
```

**ç»“æ„ä½“å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå¤§é©¼å³°
type UserService struct {
    userRepo repository.UserRepository
    eventBus base.EventBus
}

// âŒ é”™è¯¯ï¼šå°å†™ã€ä¸‹åˆ’çº¿
type userService struct {}
type User_Service struct {}
```

**æ¥å£å‘½å**ï¼š

```go
// âœ… æ­£ç¡®ï¼šå¤§é©¼å³°ï¼Œåè¯æˆ–åè¯+er
type UserRepository interface {}
type EventHandler interface {}

// âŒ é”™è¯¯ï¼šåŠ Interfaceåç¼€ï¼ˆåœ¨æ–‡ä»¶åä¸­ä½“ç°ï¼‰
type UserRepositoryInterface interface {}
```

#### 4.1.2 ä»£ç ç»„ç»‡è§„èŒƒ

**æ–‡ä»¶å‘½å**ï¼š

```
// âœ… æ­£ç¡®ï¼šå°å†™+ä¸‹åˆ’çº¿
user_service.go
user_repository_mongo.go
UserRepository_interface.go  // æ¥å£æ–‡ä»¶å¯ä»¥å¤§é©¼å³°

// âŒ é”™è¯¯ï¼šé©¼å³°
UserService.go
```

**å¯¼å…¥é¡ºåº**ï¼š

```go
import (
    // 1. æ ‡å‡†åº“
    "context"
    "fmt"
    "time"
  
    // 2. ç¬¬ä¸‰æ–¹åº“
    "github.com/gin-gonic/gin"
    "go.mongodb.org/mongo-driver/mongo"
  
    // 3. é¡¹ç›®å†…éƒ¨åŒ…
    "Qingyu_backend/models/users"
    "Qingyu_backend/repository/interfaces/user"
)
```

**ç»“æ„ä½“å­—æ®µé¡ºåº**ï¼š

```go
type UserService struct {
    // 1. å¯¼å‡ºå­—æ®µ
    Name    string
    Version string
  
    // 2. æœªå¯¼å‡ºå­—æ®µï¼ˆä¾èµ–ï¼‰
    userRepo  repository.UserRepository
    eventBus  base.EventBus
    validator base.Validator
}
```

#### 4.1.3 æ³¨é‡Šè§„èŒƒ

**åŒ…æ³¨é‡Š**ï¼š

```go
// Package user æä¾›ç”¨æˆ·ç®¡ç†ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œ
// åŒ…æ‹¬ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚
package user
```

**å‡½æ•°æ³¨é‡Š**ï¼š

```go
// CreateUser åˆ›å»ºæ–°ç”¨æˆ·
//
// å‚æ•°:
//   ctx: ä¸Šä¸‹æ–‡ï¼Œç”¨äºä¼ é€’è¯·æ±‚ä¿¡æ¯å’Œæ§åˆ¶è¶…æ—¶
//   req: åˆ›å»ºç”¨æˆ·è¯·æ±‚ï¼ŒåŒ…å«ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç ç­‰ä¿¡æ¯
//
// è¿”å›:
//   resp: åˆ›å»ºç”¨æˆ·å“åº”ï¼ŒåŒ…å«ç”¨æˆ·IDå’ŒåŸºæœ¬ä¿¡æ¯
//   error: é”™è¯¯ä¿¡æ¯ï¼ŒæˆåŠŸæ—¶ä¸ºnil
//
// é”™è¯¯ç :
//   VALIDATION_ERROR: å‚æ•°éªŒè¯å¤±è´¥
//   BUSINESS_ERROR: é‚®ç®±å·²è¢«æ³¨å†Œ
//   INTERNAL_ERROR: åˆ›å»ºç”¨æˆ·å¤±è´¥
func (s *UserService) CreateUser(ctx context.Context, req *CreateUserRequest) (*CreateUserResponse, error) {
    // å®ç°
}
```

**ç»“æ„ä½“æ³¨é‡Š**ï¼š

```go
// UserService ç”¨æˆ·æœåŠ¡
//
// è´Ÿè´£å¤„ç†ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š
// - ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
// - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
// - æƒé™éªŒè¯
//
// ä¾èµ–:
// - UserRepository: ç”¨æˆ·æ•°æ®è®¿é—®
// - RoleRepository: è§’è‰²æ•°æ®è®¿é—®
// - EventBus: äº‹ä»¶å‘å¸ƒ
type UserService struct {
    userRepo  repository.UserRepository
    roleRepo  repository.RoleRepository
    eventBus  base.EventBus
    validator base.Validator
}
```

**è¡Œå†…æ³¨é‡Š**ï¼š

```go
func (s *UserService) CreateUser(ctx context.Context, req *CreateUserRequest) error {
    // 1. å‚æ•°éªŒè¯
    if err := s.validateCreateUserRequest(req); err != nil {
        return errors.NewValidationError("å‚æ•°éªŒè¯å¤±è´¥").WithDetails(err.Error())
    }
  
    // 2. ä¸šåŠ¡è§„åˆ™æ£€æŸ¥ï¼šé‚®ç®±å”¯ä¸€æ€§
    exists, err := s.userRepo.ExistsByEmail(ctx, req.Email)
    if err != nil {
        return errors.NewInternalError("æ£€æŸ¥é‚®ç®±å¤±è´¥").WithCause(err)
    }
    if exists {
        return errors.NewBusinessError("é‚®ç®±å·²è¢«æ³¨å†Œ")
    }
  
    // 3. å¯†ç åŠ å¯†
    hashedPassword, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost)
    if err != nil {
        return errors.NewInternalError("å¯†ç åŠ å¯†å¤±è´¥").WithCause(err)
    }
  
    // ... åç»­é€»è¾‘
}
```

#### 4.1.4 é”™è¯¯å¤„ç†è§„èŒƒ

**ç»Ÿä¸€é”™è¯¯ç±»å‹**ï¼š

```go
// ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„UnifiedError
func (s *UserService) GetUser(ctx context.Context, id string) (*User, error) {
    user, err := s.userRepo.GetByID(ctx, id)
    if err != nil {
        return nil, errors.NewInternalError("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥").
            WithCause(err).
            WithService("UserService", "GetUser").
            WithMetadata("user_id", id)
    }
  
    if user == nil {
        return nil, errors.NewNotFoundError("ç”¨æˆ·ä¸å­˜åœ¨").
            WithMetadata("user_id", id)
    }
  
    return user, nil
}
```

**é”™è¯¯ä¼ æ’­**ï¼š

```go
// âœ… æ­£ç¡®ï¼šåŒ…è£…é”™è¯¯ï¼Œæ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯
if err != nil {
    return fmt.Errorf("åˆ›å»ºç”¨æˆ·å¤±è´¥: %w", err)
}

// âŒ é”™è¯¯ï¼šç›´æ¥è¿”å›åº•å±‚é”™è¯¯
if err != nil {
    return err
}

// âŒ é”™è¯¯ï¼šåæ‰é”™è¯¯
if err != nil {
    log.Println(err)
    return nil
}
```

**é”™è¯¯æ£€æŸ¥**ï¼š

```go
// âœ… æ­£ç¡®ï¼šç«‹å³æ£€æŸ¥é”™è¯¯
result, err := doSomething()
if err != nil {
    return err
}

// âŒ é”™è¯¯ï¼šå»¶è¿Ÿæ£€æŸ¥
result, err := doSomething()
// ... å…¶ä»–ä»£ç 
if err != nil {
    return err
}
```

#### 4.1.5 ä»£ç è´¨é‡æ ‡å‡†

**å‡½æ•°å¤æ‚åº¦**ï¼š

- å•ä¸ªå‡½æ•°ä¸è¶…è¿‡50è¡Œï¼ˆç‰¹æ®Šæƒ…å†µé™¤å¤–ï¼‰
- åœˆå¤æ‚åº¦ < 10
- åµŒå¥—å±‚çº§ < 4å±‚

**ä»£ç é‡å¤**ï¼š

- é‡å¤ä»£ç æå–ä¸ºå‡½æ•°
- ç›¸ä¼¼é€»è¾‘ä½¿ç”¨æ³›å‹æˆ–æ¥å£

**æ€§èƒ½è€ƒè™‘**ï¼š

```go
// âœ… æ­£ç¡®ï¼šé¢„åˆ†é…åˆ‡ç‰‡å®¹é‡
users := make([]*User, 0, expectedSize)

// âŒ é”™è¯¯ï¼šé¢‘ç¹æ‰©å®¹
users := []*User{}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨strings.Builderæ‹¼æ¥å­—ç¬¦ä¸²
var builder strings.Builder
for _, s := range strs {
    builder.WriteString(s)
}
result := builder.String()

// âŒ é”™è¯¯ï¼šä½¿ç”¨+æ‹¼æ¥
result := ""
for _, s := range strs {
    result += s  // æ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ†é…å†…å­˜
}
```

### 4.2 å‰ç«¯ç¼–ç è§„èŒƒï¼ˆJavaScript/TypeScriptï¼‰

#### 4.2.1 å‘½åè§„èŒƒ

```javascript
// å˜é‡ï¼šå°é©¼å³°
const userName = 'John';
const userAge = 25;

// å¸¸é‡ï¼šå…¨å¤§å†™+ä¸‹åˆ’çº¿
const MAX_RETRY_COUNT = 3;
const API_BASE_URL = 'https://api.example.com';

// å‡½æ•°ï¼šå°é©¼å³°ï¼ŒåŠ¨è¯å¼€å¤´
function getUserById(id) {}
function fetchUserData() {}

// ç±»ï¼šå¤§é©¼å³°
class UserService {}
class BookstoreManager {}

// ç»„ä»¶ï¼šå¤§é©¼å³°
function UserProfile() {}
function BookList() {}

// ç§æœ‰æˆå‘˜ï¼š_å¼€å¤´
class User {
    _privateMethod() {}
}
```

#### 4.2.2 TypeScriptç±»å‹å®šä¹‰

```typescript
// âœ… æ­£ç¡®ï¼šæ˜ç¡®çš„ç±»å‹å®šä¹‰
interface User {
    id: string;
    username: string;
    email: string;
    createdAt: Date;
}

function getUser(id: string): Promise<User> {
    // ...
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨any
function getUser(id: any): Promise<any> {
    // ...
}
```

### 4.3 ä»£ç å®¡æŸ¥è§„èŒƒ

**å®¡æŸ¥æ¸…å•**ï¼š

- [ ] æ˜¯å¦ç¬¦åˆæ¶æ„è®¾è®¡ï¼ˆåˆ†å±‚ã€ä¾èµ–æ³¨å…¥ï¼‰
- [ ] æ˜¯å¦éµå¾ªç¼–ç è§„èŒƒï¼ˆå‘½åã€æ³¨é‡Šã€æ ¼å¼ï¼‰
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„
- [ ] æ˜¯å¦æœ‰å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡æ˜¯å¦è¾¾æ ‡
- [ ] æ˜¯å¦æœ‰æ½œåœ¨çš„æ€§èƒ½é—®é¢˜
- [ ] æ˜¯å¦æœ‰å®‰å…¨éšæ‚£
- [ ] æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ—¥å¿—è®°å½•
- [ ] æ–‡æ¡£æ˜¯å¦æ›´æ–°

**å®¡æŸ¥æµç¨‹**ï¼š

1. æäº¤Pull Request
2. è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼ˆlintã€testã€buildï¼‰
3. è‡³å°‘1äººä»£ç å®¡æŸ¥
4. ä¿®æ”¹å¹¶å›å¤å®¡æŸ¥æ„è§
5. å®¡æŸ¥é€šè¿‡ååˆå¹¶

---

## 5. æµ‹è¯•è§„èŒƒ

### 5.1 æµ‹è¯•ç­–ç•¥

**æµ‹è¯•é‡‘å­—å¡”**ï¼š

```
       /\
      /  \  End-to-End Tests (10%)
     /    \
    /------\  Integration Tests (20%)
   /        \
  /----------\  Unit Tests (70%)
 /            \
```

**æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**ï¼š

- å•å…ƒæµ‹è¯•ï¼šâ‰¥ 80%
- é›†æˆæµ‹è¯•ï¼šâ‰¥ 60%
- å…³é”®è·¯å¾„ï¼š100%

### 5.2 å•å…ƒæµ‹è¯•è§„èŒƒ

**æµ‹è¯•æ–‡ä»¶å‘½å**ï¼š

```
user_service.go â†’ user_service_test.go
user_repository_mongo.go â†’ user_repository_mongo_test.go
```

**æµ‹è¯•å‡½æ•°å‘½å**ï¼š

```go
// æ ¼å¼ï¼šTest[FunctionName]_[Scenario]_[ExpectedResult]
func TestUserService_CreateUser_Success(t *testing.T) {}
func TestUserService_CreateUser_EmailExists_ReturnsError(t *testing.T) {}
func TestUserService_CreateUser_InvalidInput_ReturnsValidationError(t *testing.T) {}
```

**æµ‹è¯•ç»“æ„ï¼ˆAAAæ¨¡å¼ï¼‰**ï¼š

```go
func TestUserService_CreateUser_Success(t *testing.T) {
    // Arrangeï¼ˆå‡†å¤‡ï¼‰
    mockUserRepo := &MockUserRepository{}
    mockEventBus := &MockEventBus{}
    service := NewUserService(mockUserRepo, nil, mockEventBus)
  
    req := &CreateUserRequest{
        Username: "testuser",
        Email:    "test@example.com",
        Password: "password123",
    }
  
    mockUserRepo.On("ExistsByEmail", mock.Anything, "test@example.com").Return(false, nil)
    mockUserRepo.On("Create", mock.Anything, mock.AnythingOfType("*models.User")).Return(nil)
  
    // Actï¼ˆæ‰§è¡Œï¼‰
    resp, err := service.CreateUser(context.Background(), req)
  
    // Assertï¼ˆæ–­è¨€ï¼‰
    assert.NoError(t, err)
    assert.NotNil(t, resp)
    assert.Equal(t, "testuser", resp.Username)
  
    mockUserRepo.AssertExpectations(t)
}
```

**Mockä½¿ç”¨**ï¼š

```go
// ä½¿ç”¨testify/mockåˆ›å»ºMock
type MockUserRepository struct {
    mock.Mock
}

func (m *MockUserRepository) Create(ctx context.Context, user *models.User) error {
    args := m.Called(ctx, user)
    return args.Error(0)
}

func (m *MockUserRepository) GetByEmail(ctx context.Context, email string) (*models.User, error) {
    args := m.Called(ctx, email)
    if args.Get(0) == nil {
        return nil, args.Error(1)
    }
    return args.Get(0).(*models.User), args.Error(1)
}
```

### 5.3 é›†æˆæµ‹è¯•è§„èŒƒ

**æµ‹è¯•ç»„ç»‡**ï¼š

```
test/integration/
â”œâ”€â”€ user_integration_test.go
â”œâ”€â”€ ai_integration_test.go
â””â”€â”€ setup_test.go  // æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–
```

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š

```go
func TestUserServiceIntegration(t *testing.T) {
    // 1. åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“
    config := &interfaces.MongoConfig{
        URI:      "mongodb://localhost:27017",
        Database: "test_db",
        Timeout:  30 * time.Second,
    }
  
    factory, err := mongodb.NewMongoRepositoryFactory(config)
    require.NoError(t, err)
    defer factory.Close()
  
    // 2. åˆ›å»ºService
    userRepo := factory.CreateUserRepository()
    eventBus := base.NewSimpleEventBus()
    service := user.NewUserService(userRepo, nil, eventBus)
  
    // 3. æ‰§è¡Œæµ‹è¯•
    req := &user.CreateUserRequest{
        Username: "testuser",
        Email:    "test@example.com",
        Password: "password123",
    }
  
    resp, err := service.CreateUser(context.Background(), req)
    require.NoError(t, err)
    require.NotNil(t, resp)
  
    // 4. éªŒè¯æ•°æ®åº“çŠ¶æ€
    user, err := userRepo.GetByEmail(context.Background(), "test@example.com")
    require.NoError(t, err)
    assert.Equal(t, "testuser", user.Username)
  
    // 5. æ¸…ç†æµ‹è¯•æ•°æ®
    defer userRepo.Delete(context.Background(), resp.UserID)
}
```

### 5.4 æ€§èƒ½æµ‹è¯•è§„èŒƒ

**å·¥å…·é€‰æ‹©**ï¼š

- å‹åŠ›æµ‹è¯•ï¼šwrkã€Apache Bench
- è´Ÿè½½æµ‹è¯•ï¼šJMeterã€Locust
- æ€§èƒ½åˆ†æï¼špprof

**æ€§èƒ½æŒ‡æ ‡**ï¼š

- APIå“åº”æ—¶é—´ï¼šP95 < 200ms
- QPSï¼šâ‰¥ 5000
- å¹¶å‘ç”¨æˆ·æ•°ï¼šâ‰¥ 10000

**æ€§èƒ½æµ‹è¯•ç¤ºä¾‹**ï¼š

```bash
# ä½¿ç”¨wrkè¿›è¡Œå‹åŠ›æµ‹è¯•
wrk -t12 -c400 -d30s --latency http://localhost:8080/api/v1/users

# è¾“å‡ºç¤ºä¾‹
Running 30s test @ http://localhost:8080/api/v1/users
  12 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    45.23ms   12.34ms  200.00ms   89.23%
    Req/Sec     0.89k    123.45    1.23k    76.54%
  Latency Distribution
     50%   43.21ms
     75%   52.34ms
     90%   61.23ms
     99%   91.45ms
  320000 requests in 30.00s, 45.67MB read
Requests/sec:  10666.67
Transfer/sec:   1.52MB
```

---

## 6. é¡¹ç›®ç®¡ç†è§„èŒƒ

### 6.1 ç‰ˆæœ¬æ§åˆ¶è§„èŒƒ

#### 6.1.1 Gitå·¥ä½œæµï¼ˆGitFlowï¼‰

**åˆ†æ”¯ç­–ç•¥**ï¼š

```
main (production)     â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â†’
                            /      \
develop (integration) â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â†’
                       |         /   \
feature/xxx           â—â”€â—â”€â—â”€â—â”€â”€/     \
                                       \
hotfix/xxx                              â—â”€â—â”€â—
```

**åˆ†æ”¯å‘½å**ï¼š

- `main`ï¼šç”Ÿäº§ç¯å¢ƒåˆ†æ”¯
- `develop`ï¼šå¼€å‘é›†æˆåˆ†æ”¯
- `feature/[åŠŸèƒ½å]`ï¼šåŠŸèƒ½å¼€å‘åˆ†æ”¯
- `hotfix/[bugå]`ï¼šç´§æ€¥ä¿®å¤åˆ†æ”¯
- `release/v[ç‰ˆæœ¬å·]`ï¼šå‘å¸ƒå‡†å¤‡åˆ†æ”¯

**åˆ†æ”¯ç®¡ç†è§„åˆ™**ï¼š

- `main`åˆ†æ”¯ï¼šåªæ¥å—releaseå’Œhotfixçš„åˆå¹¶
- `develop`åˆ†æ”¯ï¼šæ¥å—featureçš„åˆå¹¶
- `feature`åˆ†æ”¯ï¼šä»developåˆ›å»ºï¼Œå®Œæˆååˆå¹¶å›develop
- `hotfix`åˆ†æ”¯ï¼šä»mainåˆ›å»ºï¼Œå®Œæˆååˆå¹¶å›mainå’Œdevelop

#### 6.1.2 æäº¤è§„èŒƒï¼ˆConventional Commitsï¼‰

**æäº¤æ ¼å¼**ï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç±»å‹ï¼ˆtypeï¼‰**ï¼š

- `feat`ï¼šæ–°åŠŸèƒ½
- `fix`ï¼šBugä¿®å¤
- `docs`ï¼šæ–‡æ¡£æ›´æ–°
- `style`ï¼šä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰
- `refactor`ï¼šé‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯Bugä¿®å¤ï¼‰
- `perf`ï¼šæ€§èƒ½ä¼˜åŒ–
- `test`ï¼šæµ‹è¯•ç›¸å…³
- `chore`ï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

**ç¤ºä¾‹**ï¼š

```
feat(ai): implement Agent tool calling framework

- Add tool registration interface
- Implement tool execution engine
- Add permission control for tool calling

Closes #123
```

```
fix(auth): fix JWT token expiration check

Previously, expired tokens were still accepted.
Now properly validate token expiration.

Fixes #456
```

**å…³è”Issue**ï¼š

```
feat(rag): add vector database integration

Refs #789
```

### 6.2 æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰

#### 6.2.1 CI Pipeline

**GitHub Actionså·¥ä½œæµ**ï¼š

```yaml
name: CI

on:
  push:
    branches: [ develop, main ]
  pull_request:
    branches: [ develop, main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
    
      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
    
      - name: Install dependencies
        run: go mod download
    
      - name: Lint
        run: golangci-lint run
    
      - name: Test
        run: go test -v -race -coverprofile=coverage.out ./...
    
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.out
  
  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
    
      - name: Build Docker image
        run: docker build -t qingyu-backend:${{ github.sha }} .
    
      - name: Push to registry
        run: |
          docker tag qingyu-backend:${{ github.sha }} registry.example.com/qingyu-backend:latest
          docker push registry.example.com/qingyu-backend:latest
```

#### 6.2.2 ä»£ç è´¨é‡æ£€æŸ¥

**å·¥å…·é…ç½®**ï¼š

```yaml
# .golangci.yml
linters:
  enable:
    - gofmt
    - goimports
    - golint
    - govet
    - errcheck
    - staticcheck
    - unused
    - gosimple
    - structcheck
    - varcheck
    - ineffassign
    - deadcode

linters-settings:
  gofmt:
    simplify: true
  goimports:
    local-prefixes: Qingyu_backend
  golint:
    min-confidence: 0.8

issues:
  exclude-rules:
    - path: _test\.go
      linters:
        - errcheck
```

**SonarQubeé›†æˆ**ï¼š

```yaml
sonar:
  projectKey: qingyu-backend
  projectName: Qingyu Backend
  projectVersion: 1.0
  sources: .
  exclusions: |
    **/*_test.go,
    **/vendor/**,
    **/mock/**
  test.inclusions: |
    **/*_test.go
  go.coverage.reportPaths: coverage.out
```

### 6.3 æ•æ·å¼€å‘è§„èŒƒ

#### 6.3.1 è¿­ä»£ç®¡ç†

**Sprintå‘¨æœŸ**ï¼š2å‘¨

**Sprintæµç¨‹**ï¼š

1. **Sprint Planning**ï¼ˆå‘¨ä¸€ä¸Šåˆï¼‰

   - è¯„å®¡éœ€æ±‚ä¼˜å…ˆçº§
   - ä¼°ç®—Story Point
   - åˆ¶å®šSprintç›®æ ‡
   - åˆ†é…ä»»åŠ¡
2. **Daily Standup**ï¼ˆæ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œ15åˆ†é’Ÿï¼‰

   - æ˜¨å¤©å®Œæˆäº†ä»€ä¹ˆ
   - ä»Šå¤©è®¡åˆ’åšä»€ä¹ˆ
   - é‡åˆ°ä»€ä¹ˆé˜»ç¢
3. **Sprint Review**ï¼ˆå‘¨äº”ä¸‹åˆï¼‰

   - æ¼”ç¤ºå®Œæˆçš„åŠŸèƒ½
   - æ”¶é›†åé¦ˆ
4. **Sprint Retrospective**ï¼ˆå‘¨äº”ä¸‹åˆï¼‰

   - æ€»ç»“ç»éªŒæ•™è®­
   - æ”¹è¿›è¡ŒåŠ¨è®¡åˆ’

#### 6.3.2 ä»»åŠ¡ç®¡ç†

**ä»»åŠ¡çŠ¶æ€**ï¼š

- `Todo`ï¼šå¾…å¼€å§‹
- `In Progress`ï¼šè¿›è¡Œä¸­
- `In Review`ï¼šä»£ç å®¡æŸ¥ä¸­
- `Testing`ï¼šæµ‹è¯•ä¸­
- `Done`ï¼šå·²å®Œæˆ

**Story Pointä¼°ç®—**ï¼ˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰ï¼š

- 1 pointï¼š1-2å°æ—¶
- 2 pointsï¼šåŠå¤©
- 3 pointsï¼š1å¤©
- 5 pointsï¼š2-3å¤©
- 8 pointsï¼š3-5å¤©
- 13 pointsï¼š1å‘¨ï¼ˆéœ€æ‹†åˆ†ï¼‰

---

## 7. éƒ¨ç½²è¿ç»´è§„èŒƒ

### 7.1 ç¯å¢ƒç®¡ç†

**ç¯å¢ƒåˆ†ç±»**ï¼š

- **å¼€å‘ç¯å¢ƒï¼ˆDevï¼‰**ï¼šæœ¬åœ°å¼€å‘
- **æµ‹è¯•ç¯å¢ƒï¼ˆTestï¼‰**ï¼šåŠŸèƒ½æµ‹è¯•
- **é¢„å‘å¸ƒç¯å¢ƒï¼ˆStagingï¼‰**ï¼šç”Ÿäº§éªŒè¯
- **ç”Ÿäº§ç¯å¢ƒï¼ˆProductionï¼‰**ï¼šæ­£å¼è¿è¡Œ

**ç¯å¢ƒé…ç½®**ï¼š

```yaml
# config/config.yaml
environments:
  dev:
    database:
      uri: mongodb://localhost:27017
      database: qingyu_dev
    redis:
      addr: localhost:6379
    ai:
      provider: openai
      api_key: ${DEV_OPENAI_KEY}
  
  test:
    database:
      uri: mongodb://test-db:27017
      database: qingyu_test
    redis:
      addr: test-redis:6379
  
  production:
    database:
      uri: ${PROD_MONGO_URI}
      database: qingyu_prod
    redis:
      addr: ${PROD_REDIS_ADDR}
    ai:
      provider: ${PROD_AI_PROVIDER}
      api_key: ${PROD_AI_KEY}
```

### 7.2 DockeråŒ–éƒ¨ç½²

**Dockerfile**ï¼š

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o qingyu-backend .

# è¿è¡Œé˜¶æ®µ
FROM alpine:latest

RUN apk --no-cache add ca-certificates tzdata
WORKDIR /root/

COPY --from=builder /app/qingyu-backend .
COPY --from=builder /app/config ./config

EXPOSE 8080

CMD ["./qingyu-backend"]
```

**Docker Compose**ï¼š

```yaml
version: '3.8'

services:
  backend:
    build: .
    ports:
      - "8080:8080"
    environment:
      - ENV=production
      - MONGO_URI=${MONGO_URI}
      - REDIS_ADDR=${REDIS_ADDR}
    depends_on:
      - mongodb
      - redis
    restart: unless-stopped
  
  mongodb:
    image: mongo:5.0
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped
  
  redis:
    image: redis:6.0-alpine
    ports:
      - "6379:6379"
    restart: unless-stopped
  
  milvus:
    image: milvusdb/milvus:v2.3.0
    ports:
      - "19530:19530"
    volumes:
      - milvus-data:/var/lib/milvus
    restart: unless-stopped

volumes:
  mongo-data:
  milvus-data:
```

### 7.3 ç›‘æ§å‘Šè­¦

**ç›‘æ§æŒ‡æ ‡**ï¼š

```yaml
# Prometheusé…ç½®
scrape_configs:
  - job_name: 'qingyu-backend'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/metrics'
    scrape_interval: 15s
```

**å…³é”®æŒ‡æ ‡**ï¼š

- **ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
- **åº”ç”¨æŒ‡æ ‡**ï¼šQPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šç”¨æˆ·æ•°ã€è®¢å•æ•°ã€æ”¶å…¥
- **AIæŒ‡æ ‡**ï¼šAPIè°ƒç”¨é‡ã€Tokenæ¶ˆè€—ã€æˆæœ¬

**å‘Šè­¦è§„åˆ™**ï¼š

```yaml
groups:
  - name: qingyu-alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }}%"
    
      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High response time"
          description: "P95 response time is {{ $value }}s"
```

### 7.4 æ—¥å¿—ç®¡ç†

**æ—¥å¿—çº§åˆ«**ï¼š

- `DEBUG`ï¼šè°ƒè¯•ä¿¡æ¯
- `INFO`ï¼šä¸€èˆ¬ä¿¡æ¯
- `WARN`ï¼šè­¦å‘Šä¿¡æ¯
- `ERROR`ï¼šé”™è¯¯ä¿¡æ¯
- `FATAL`ï¼šè‡´å‘½é”™è¯¯

**ç»“æ„åŒ–æ—¥å¿—**ï¼š

```go
import "go.uber.org/zap"

logger.Info("User created successfully",
    zap.String("user_id", userID),
    zap.String("email", email),
    zap.String("service", "UserService"),
    zap.String("operation", "CreateUser"),
)

logger.Error("Failed to create user",
    zap.Error(err),
    zap.String("email", email),
    zap.String("service", "UserService"),
    zap.String("operation", "CreateUser"),
)
```

**æ—¥å¿—æ”¶é›†**ï¼š

- å·¥å…·ï¼šFilebeat + Logstash + Elasticsearch + Kibana (ELK Stack)
- æ—¥å¿—ä¿ç•™æœŸï¼š30å¤©ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

---

## 8. æ–‡æ¡£è§„èŒƒ

### 8.1 æ–‡æ¡£åˆ†ç±»

**å·¥ç¨‹æ–‡æ¡£**ï¼ˆ`doc/engineering/`ï¼‰ï¼š

- éœ€æ±‚åˆ†ææ–‡æ¡£
- è½¯ä»¶éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦(SRS)
- è½¯ä»¶å·¥ç¨‹è§„èŒƒ
- æ¶æ„è®¾è®¡æ–‡æ¡£

**è®¾è®¡æ–‡æ¡£**ï¼ˆ`doc/design/`ï¼‰ï¼š

- æ¨¡å—è®¾è®¡æ–‡æ¡£
- æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- æ¥å£è®¾è®¡æ–‡æ¡£

**å®ç°æ–‡æ¡£**ï¼ˆ`doc/implementation/`ï¼‰ï¼š

- å®ç°æŒ‡å—
- ä¿®å¤æ¸…å•
- æŠ€æœ¯é€‰å‹æ–‡æ¡£

**APIæ–‡æ¡£**ï¼ˆ`doc/api/`ï¼‰ï¼š

- APIæ¥å£æ–‡æ¡£
- APIä½¿ç”¨ç¤ºä¾‹

### 8.2 æ–‡æ¡£ç¼–å†™è§„èŒƒ

**Markdownè§„èŒƒ**ï¼š

- ä½¿ç”¨æ ‡å‡†Markdownè¯­æ³•
- ä»£ç å—æŒ‡å®šè¯­è¨€ï¼š\`\`\`goã€\`\`\`javascript
- ä½¿ç”¨è¡¨æ ¼ç»„ç»‡æ•°æ®
- ä½¿ç”¨Emojiå¢å¼ºå¯è¯»æ€§ï¼ˆé€‚åº¦ï¼‰

**æ–‡æ¡£ç»“æ„**ï¼š

```markdown
# æ–‡æ¡£æ ‡é¢˜

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-06  
> **ä½œè€…**: XXX

## 1. æ¦‚è¿°
ï¼ˆç®€è¦è¯´æ˜æ–‡æ¡£ç›®çš„å’ŒèŒƒå›´ï¼‰

## 2. ä¸»è¦å†…å®¹
ï¼ˆè¯¦ç»†å†…å®¹ï¼‰

## 3. å‚è€ƒèµ„æ–™
ï¼ˆç›¸å…³æ–‡æ¡£ã€é“¾æ¥ï¼‰
```

**ç‰ˆæœ¬ç®¡ç†**ï¼š

- é‡å¤§æ›´æ–°æ—¶åˆ›å»ºæ–°ç‰ˆæœ¬æ–‡æ¡£ï¼ˆå¦‚ `xxx_v2.0.md`ï¼‰
- åœ¨æ–‡æ¡£å¤´éƒ¨æ ‡æ³¨ç‰ˆæœ¬å’Œæ›´æ–°æ—¥æœŸ
- ç»´æŠ¤ç‰ˆæœ¬å†å²è¡¨æ ¼

### 8.3 æ–‡æ¡£ç»´æŠ¤

**æ›´æ–°åŸåˆ™**ï¼š

- ä»£ç å˜æ›´å¿…é¡»åŒæ­¥æ›´æ–°æ–‡æ¡£
- æ¯ä¸ªSprintç»“æŸæ—¶æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§
- å®šæœŸå®¡æŸ¥æ–‡æ¡£ï¼Œæ¸…ç†è¿‡æ—¶å†…å®¹

**æ–‡æ¡£å®¡æŸ¥**ï¼š

- é‡è¦æ–‡æ¡£éœ€ç»è¿‡è¯„å®¡
- æ£€æŸ¥å†…å®¹å‡†ç¡®æ€§ã€å®Œæ•´æ€§ã€å¯è¯»æ€§
- ç¡®ä¿æ–‡æ¡£ä¸å®é™…ä»£ç ä¸€è‡´

---

## 9. å®‰å…¨å·¥ç¨‹è§„èŒƒ

### 9.1 å®‰å…¨ç¼–ç å®è·µ

**è¾“å…¥éªŒè¯**ï¼š

```go
// âœ… æ­£ç¡®ï¼šä¸¥æ ¼éªŒè¯è¾“å…¥
func (api *UserApi) Register(c *gin.Context) {
    var req CreateUserRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        response.Error(c, http.StatusBadRequest, "å‚æ•°æ ¼å¼é”™è¯¯", err.Error())
        return
    }
  
    // å‚æ•°éªŒè¯
    if err := api.validator.Struct(&req); err != nil {
        response.ValidationError(c, err)
        return
    }
  
    // ...
}

// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨æœªéªŒè¯çš„è¾“å…¥
func (api *UserApi) Register(c *gin.Context) {
    email := c.PostForm("email")  // æœªéªŒè¯
    // ç›´æ¥ä½¿ç”¨emailè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
}
```

**SQLæ³¨å…¥é˜²æŠ¤**ï¼š

```go
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
filter := bson.M{"email": email}
result := collection.FindOne(ctx, filter)

// âŒ é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
query := fmt.Sprintf("SELECT * FROM users WHERE email = '%s'", email)
```

**XSSé˜²æŠ¤**ï¼š

```go
// å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒHTMLè½¬ä¹‰
import "html"

safeContent := html.EscapeString(userInput)
```

**å¯†ç å®‰å…¨**ï¼š

```go
// âœ… æ­£ç¡®ï¼šä½¿ç”¨bcryptåŠ å¯†
hashedPassword, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)

// âŒ é”™è¯¯ï¼šæ˜æ–‡å­˜å‚¨æˆ–MD5åŠ å¯†
password := req.Password  // æ˜æ–‡
hashedPassword := md5.Sum([]byte(password))  // MD5ä¸å®‰å…¨
```

### 9.2 è®¤è¯æˆæƒå®‰å…¨

**JWTé…ç½®**ï¼š

```go
// è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
claims := jwt.MapClaims{
    "user_id": userID,
    "exp":     time.Now().Add(7 * 24 * time.Hour).Unix(),  // 7å¤©
}

// ä½¿ç”¨å¼ºå¯†é’¥
jwtSecret := []byte(config.JWT.Secret)  // è‡³å°‘32å­—èŠ‚éšæœºå­—ç¬¦ä¸²
```

**RBACæƒé™æ£€æŸ¥**ï¼š

```go
// æ¯ä¸ªæ¥å£éƒ½è¿›è¡Œæƒé™æ£€æŸ¥
func (api *AdminApi) DeleteUser(c *gin.Context) {
    // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
    if !middleware.HasPermission(c, "admin") {
        response.Error(c, http.StatusForbidden, "æƒé™ä¸è¶³", "")
        return
    }
  
    // ...
}
```

### 9.3 æ•°æ®å®‰å…¨

**æ•æ„Ÿæ•°æ®åŠ å¯†**ï¼š

```go
// æ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨
type User struct {
    ID       string `bson:"_id" json:"id"`
    Email    string `bson:"email" json:"email"`
    Password string `bson:"password" json:"-"`  // ä¸è¿”å›ç»™å®¢æˆ·ç«¯
    // ...
}
```

**HTTPSå¼ºåˆ¶**ï¼š

```go
// é…ç½®HTTPS
r := gin.Default()
r.Use(middleware.HTTPSRedirect())  // å¼ºåˆ¶HTTPS
r.RunTLS(":443", "cert.pem", "key.pem")
```

**æ•°æ®è„±æ•**ï¼š

```go
// æ—¥å¿—ä¸­è„±æ•æ•æ„Ÿä¿¡æ¯
logger.Info("User login",
    zap.String("email", maskEmail(email)),  // è„±æ•é‚®ç®±
    zap.String("ip", clientIP),
)

func maskEmail(email string) string {
    parts := strings.Split(email, "@")
    if len(parts) != 2 {
        return "***"
    }
    return parts[0][:2] + "***@" + parts[1]
}
```

---

## 10. é™„å½•

### 10.1 å·¥å…·æ¨è

**å¼€å‘å·¥å…·**ï¼š

- IDEï¼šGoLandã€VSCode
- APIæµ‹è¯•ï¼šPostmanã€Insomnia
- æ•°æ®åº“å·¥å…·ï¼šMongoDB Compassã€Redis Desktop Manager

**ä»£ç è´¨é‡å·¥å…·**ï¼š

- Linterï¼šgolangci-lint
- æµ‹è¯•ï¼šgo testã€testify
- è¦†ç›–ç‡ï¼šgo cover
- é™æ€åˆ†æï¼šSonarQube

**DevOpså·¥å…·**ï¼š

- ç‰ˆæœ¬æ§åˆ¶ï¼šGitã€GitHub
- CI/CDï¼šGitHub Actionsã€Jenkins
- å®¹å™¨åŒ–ï¼šDockerã€Docker Compose
- ç¼–æ’ï¼šKubernetes
- ç›‘æ§ï¼šPrometheusã€Grafana
- æ—¥å¿—ï¼šELK Stack

### 10.2 å‚è€ƒèµ„æ–™

**å®˜æ–¹æ–‡æ¡£**ï¼š

- [Goè¯­è¨€è§„èŒƒ](https://go.dev/ref/spec)
- [Ginæ¡†æ¶æ–‡æ¡£](https://gin-gonic.com/docs/)
- [MongoDB Go Driver](https://pkg.go.dev/go.mongodb.org/mongo-driver)

**æœ€ä½³å®è·µ**ï¼š

- [Effective Go](https://go.dev/doc/effective_go)
- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [Uber Go Style Guide](https://github.com/uber-go/guide/blob/master/style.md)

**æ¶æ„è®¾è®¡**ï¼š

- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Domain-Driven Design](https://martinfowler.com/tags/domain%20driven%20design.html)
- [Microservices Patterns](https://microservices.io/patterns/index.html)

**é¡¹ç›®æ–‡æ¡£**ï¼š

- [é’ç¾½å¹³å°æ¶æ„è®¾è®¡è§„èŒƒ](../architecture/æ¶æ„è®¾è®¡è§„èŒƒ.md)
- [Repositoryå±‚è®¾è®¡è§„èŒƒ](../architecture/repositoryå±‚è®¾è®¡è§„èŒƒ.md)
- [æ¨¡å—åŒ–æ¶æ„è®¾è®¡v2.0](../design/é’ç¾½å¹³å°æ¨¡å—åŒ–æ¶æ„è®¾è®¡v2.0.md)

### 10.3 æœ¯è¯­è¡¨

| æœ¯è¯­         | è‹±æ–‡                        | è¯´æ˜                       |
| ------------ | --------------------------- | -------------------------- |
| ä»“å‚¨         | Repository                  | æ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ•°æ®åº“æ“ä½œ |
| ä¾èµ–æ³¨å…¥     | Dependency Injection        | é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–       |
| äº‹ä»¶æ€»çº¿     | Event Bus                   | äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶           |
| é¢†åŸŸé©±åŠ¨è®¾è®¡ | Domain-Driven Design (DDD)  | ä»¥ä¸šåŠ¡é¢†åŸŸä¸ºæ ¸å¿ƒçš„è®¾è®¡æ–¹æ³• |
| æŒç»­é›†æˆ     | Continuous Integration (CI) | é¢‘ç¹é›†æˆä»£ç åˆ°ä¸»åˆ†æ”¯       |
| æŒç»­éƒ¨ç½²     | Continuous Deployment (CD)  | è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ       |

---

## 11. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ       | å˜æ›´å†…å®¹                                                                | ä½œè€…       |
| ---- | ---------- | ----------------------------------------------------------------------- | ---------- |
| v1.0 | 2024-01-XX | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€å·¥ç¨‹è§„èŒƒ                                                  | é¡¹ç›®ç»„     |
| v2.0 | 2025-10-06 | é‡æ„ç‰ˆæœ¬ï¼Œæ•´åˆRepositoryæ¨¡å¼ã€Serviceå±‚ã€äº‹ä»¶é©±åŠ¨ã€Agentç³»ç»Ÿã€RAGç³»ç»Ÿç­‰ | é’ç¾½æ¶æ„ç»„ |

---

**æœ€åæ›´æ–°**: 2025-10-06
