# é’ç¾½åç«¯ä¾èµ–ç®¡ç†è§„èŒƒ

## æ¥å£ä¸å®ç°ä¾èµ–åŸåˆ™

### 1. åŸºæœ¬åŸåˆ™

éµå¾ª**ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰**ï¼š
- é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡
- æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡

### 2. å½“å‰æ¶æ„

```
service/interfaces/base/     â† æ¥å£å®šä¹‰ï¼ˆæŠ½è±¡ï¼‰
    â”œâ”€ BaseService
    â”œâ”€ Event
    â”œâ”€ EventBus
    â””â”€ EventHandler

service/base/                â† å…·ä½“å®ç°
    â”œâ”€ BaseEvent
    â”œâ”€ SimpleEventBus
    â”œâ”€ ServiceContainer
    â””â”€ ç±»å‹åˆ«åï¼ˆæŒ‡å‘æ¥å£ï¼‰
```

### 3. ä¾èµ–è§„èŒƒ

#### ğŸ¯ æ¨èåšæ³•ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰

```go
// âœ… æœåŠ¡å±‚å®ç°
import (
    baseInterface "Qingyu_backend/service/interfaces/base"
    "Qingyu_backend/service/base"  // ä»…ç”¨äºå…·ä½“å®ç°
)

type MyService struct {
    eventBus baseInterface.EventBus  // å­—æ®µç±»å‹ä½¿ç”¨æ¥å£
}

func NewMyService(eventBus baseInterface.EventBus) *MyService {
    return &MyService{
        eventBus: eventBus,  // æ„é€ å‡½æ•°æ¥å—æ¥å£
    }
}

func (s *MyService) doSomething(ctx context.Context) {
    // ä½¿ç”¨å…·ä½“å®ç°åˆ›å»ºäº‹ä»¶
    event := &base.BaseEvent{
        EventType: "my.event",
        EventData: data,
    }
    s.eventBus.PublishAsync(ctx, event)
}
```

#### âš¡ å½“å‰åšæ³•ï¼ˆåŠ¡å®æ¨¡å¼ï¼‰

```go
// âš ï¸ å½“å‰å®ç°ï¼ˆé€šè¿‡ç±»å‹åˆ«åä½¿ç”¨æ¥å£ï¼‰
import "Qingyu_backend/service/base"

type MyService struct {
    eventBus base.EventBus  // å®é™…ä¸Šæ˜¯ baseInterface.EventBus
}

func NewMyService(eventBus base.EventBus) *MyService {
    return &MyService{eventBus: eventBus}
}

func (s *MyService) doSomething(ctx context.Context) {
    event := &base.BaseEvent{...}
    s.eventBus.PublishAsync(ctx, event)
}
```

**è¯´æ˜**ï¼š
- é€šè¿‡ `service/base` ä¸­çš„ç±»å‹åˆ«å `type EventBus = baseInterface.EventBus`
- å®é™…ä¸Šä»åœ¨ä½¿ç”¨æ¥å£ç±»å‹
- ç®€åŒ–äº†å¯¼å…¥ï¼Œä½†æ¶æ„è¾¹ç•Œä¸å¤Ÿæ¸…æ™°

### 4. ä¸åŒåœºæ™¯çš„é€‰æ‹©

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|---------|------|
| æ–°æœåŠ¡å¼€å‘ | ä¸¥æ ¼æ¨¡å¼ | ä¿æŒæ¶æ„æ¸…æ™° |
| ç°æœ‰æœåŠ¡ | åŠ¡å®æ¨¡å¼ | é¿å…å¤§è§„æ¨¡é‡æ„ |
| æµ‹è¯•ä»£ç  | ä¸¥æ ¼æ¨¡å¼ | ä¾¿äº Mock |
| åˆå§‹åŒ–ä»£ç ï¼ˆmain.goï¼‰ | åŠ¡å®æ¨¡å¼ | éœ€è¦åˆ›å»ºå…·ä½“å®ç° |

### 5. è¿ç§»å»ºè®®

å¦‚æœè¦ä»åŠ¡å®æ¨¡å¼è¿ç§»åˆ°ä¸¥æ ¼æ¨¡å¼ï¼Œå»ºè®®ï¼š

1. **ä¼˜å…ˆçº§**ï¼š
   - P0: æ–°å¼€å‘çš„æœåŠ¡å¿…é¡»ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
   - P1: æ ¸å¿ƒæœåŠ¡é€æ­¥é‡æ„
   - P2: æµ‹è¯•ä»£ç ä¼˜å…ˆæ”¹é€ 
   - P3: å…¶ä»–æœåŠ¡æŒ‰éœ€æ”¹é€ 

2. **è¿ç§»æ­¥éª¤**ï¼š
   ```go
   // Step 1: æ·»åŠ æ¥å£å¯¼å…¥
   import (
       baseInterface "Qingyu_backend/service/interfaces/base"
       "Qingyu_backend/service/base"
   )
   
   // Step 2: ä¿®æ”¹å­—æ®µç±»å‹
   type MyService struct {
       eventBus baseInterface.EventBus  // base.EventBus â†’ baseInterface.EventBus
   }
   
   // Step 3: ä¿®æ”¹æ„é€ å‡½æ•°ç­¾å
   func NewMyService(eventBus baseInterface.EventBus) *MyService {...}
   
   // Step 4: ä¿æŒå®ç°ä»£ç ä¸å˜ï¼ˆå› ä¸ºç±»å‹å…¼å®¹ï¼‰
   ```

3. **å½±å“èŒƒå›´**ï¼š
   - å­—æ®µå£°æ˜
   - å‡½æ•°ç­¾å
   - å¯¼å…¥è¯­å¥
   - âš ï¸ å®ç°ä»£ç æ— éœ€ä¿®æ”¹ï¼ˆç±»å‹å…¼å®¹ï¼‰

### 6. æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼š
- âœ… é€šè¿‡ç±»å‹åˆ«åå®é™…ä½¿ç”¨äº†æ¥å£
- âš ï¸ ä½†ä¾èµ–äº†å®ç°åŒ…ï¼Œæ¶æ„ä¸å¤Ÿæ¸…æ™°
- âœ… åŠ¡å®å¯ç”¨ï¼Œé€‚åˆå½“å‰é˜¶æ®µ

**æœªæ¥æ–¹å‘**ï¼š
- ğŸ¯ é€æ­¥è¿ç§»åˆ°ä¸¥æ ¼æ¨¡å¼
- ğŸ¯ æ–°ä»£ç å¿…é¡»éµå¾ªæ¥å£ä¼˜å…ˆåŸåˆ™
- ğŸ¯ ä¿æŒå‘åå…¼å®¹ï¼Œé¿å…ç ´åæ€§å˜æ›´

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-24
**ç»´æŠ¤è€…**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ

