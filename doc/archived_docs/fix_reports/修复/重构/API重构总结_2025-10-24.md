# APIå±‚é‡æ„æ€»ç»“

## ğŸ“… é‡æ„æ—¥æœŸ
2025-10-24

## ğŸ¯ é‡æ„ç›®æ ‡

1. **åˆ›å»ºç‹¬ç«‹çš„adminæ¨¡å—** - é›†ä¸­ç®¡ç†æ‰€æœ‰ç®¡ç†å‘˜ç›¸å…³API
2. **é‡å‘½åsystemæ¨¡å—ä¸ºuser** - æ›´å‡†ç¡®åœ°åæ˜ æ¨¡å—èŒè´£
3. **å®Œå–„APIæ–‡æ¡£** - ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ è¯¦ç»†çš„READMEæ–‡æ¡£
4. **æ›´æ–°è·¯ç”±å±‚** - åæ˜ æ–°çš„APIç»“æ„

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ–°å»ºæ¨¡å—

#### ğŸ“ api/v1/admin/ (æ–°å¢)
é›†ä¸­ç®¡ç†æ‰€æœ‰ç®¡ç†å‘˜APIï¼ŒåŒ…å«ï¼š

**æ–‡ä»¶ç»“æ„:**
- `types.go` - é€šç”¨DTOå®šä¹‰
- `user_admin_api.go` - ç”¨æˆ·ç®¡ç†API
- `quota_admin_api.go` - AIé…é¢ç®¡ç†API
- `audit_admin_api.go` - å®¡æ ¸ç®¡ç†API
- `system_admin_api.go` - ç³»ç»Ÿç®¡ç†API
- `README.md` - æ¨¡å—æ–‡æ¡£

**ä¸»è¦APIç«¯ç‚¹:**
```
/api/v1/admin/users/*          - ç”¨æˆ·ç®¡ç†
/api/v1/admin/quota/*          - AIé…é¢ç®¡ç†
/api/v1/admin/audit/*          - å®¡æ ¸ç®¡ç†
/api/v1/admin/system/*         - ç³»ç»Ÿç®¡ç†
```

#### ğŸ“ api/v1/user/ (é‡å‘½åè‡ªsystem)
ä¸“æ³¨äºæ™®é€šç”¨æˆ·ç›¸å…³APIï¼š

**æ–‡ä»¶ç»“æ„:**
- `user_api.go` - ç”¨æˆ·è®¤è¯å’Œä¸ªäººä¿¡æ¯ç®¡ç†
- `user_dto.go` - ç”¨æˆ·ç›¸å…³DTO
- `README.md` - æ¨¡å—æ–‡æ¡£

**ä¸»è¦APIç«¯ç‚¹:**
```
/api/v1/register              - ç”¨æˆ·æ³¨å†Œ
/api/v1/login                 - ç”¨æˆ·ç™»å½•
/api/v1/users/profile         - ä¸ªäººä¿¡æ¯ç®¡ç†
/api/v1/users/password        - å¯†ç ä¿®æ”¹
```

### 2. è·¯ç”±å±‚é‡æ„

#### ğŸ“ router/admin/ (æ–°å¢)
- `admin_router.go` - ç®¡ç†å‘˜è·¯ç”±æ³¨å†Œ

#### ğŸ“ router/user/ (æ–°å¢)
- `user_router.go` - ç”¨æˆ·è·¯ç”±æ³¨å†Œ

#### æ›´æ–° router/enter.go
- å¯¼å…¥æ–°çš„adminå’Œuserè·¯ç”±æ¨¡å—
- ç§»é™¤æ—§çš„router/userså¼•ç”¨
- è°ƒæ•´æœåŠ¡åˆå§‹åŒ–é¡ºåº

### 3. APIè¿ç§»

ä»å…¶ä»–æ¨¡å—è¿ç§»åˆ°adminæ¨¡å—çš„APIï¼š

**ä» api/v1/ai/quota_api.go:**
- `UpdateUserQuota` â†’ `admin/quota_admin_api.go`
- `SuspendUserQuota` â†’ `admin/quota_admin_api.go`
- `ActivateUserQuota` â†’ `admin/quota_admin_api.go`

**ä» api/v1/shared/admin_api.go:**
- æ‰€æœ‰ç³»ç»Ÿç®¡ç†åŠŸèƒ½ â†’ `admin/system_admin_api.go`
- æ‰€æœ‰å®¡æ ¸ç®¡ç†åŠŸèƒ½ â†’ `admin/audit_admin_api.go`

### 4. æ–‡æ¡£å®Œå–„

ä¸ºä»¥ä¸‹æ¨¡å—åˆ›å»ºæˆ–æ›´æ–°äº†è¯¦ç»†çš„READMEæ–‡æ¡£ï¼š

âœ… **api/v1/admin/README.md** - ç®¡ç†å‘˜æ¨¡å—å®Œæ•´æ–‡æ¡£
âœ… **api/v1/user/README.md** - ç”¨æˆ·æ¨¡å—å®Œæ•´æ–‡æ¡£
âœ… **api/v1/bookstore/README.md** - ä¹¦åŸæ¨¡å—æ–‡æ¡£æ›´æ–°
âœ… **api/v1/writer/README.md** - å†™ä½œç«¯æ¨¡å—æ–‡æ¡£
âœ… **api/v1/reader/README.md** - é˜…è¯»ç«¯æ¨¡å—æ–‡æ¡£æ›´æ–°
âœ… **api/v1/recommendation/README.md** - æ¨èæ¨¡å—æ–‡æ¡£
âœ… **api/v1/shared/README.md** - å…±äº«æœåŠ¡æ¨¡å—æ–‡æ¡£

### 5. æµ‹è¯•æ–‡ä»¶æ›´æ–°

#### æ–°å»ºæµ‹è¯•æ–‡ä»¶:
- `test/api/admin_api_test.go` - ç®¡ç†å‘˜APIå•å…ƒæµ‹è¯•
- `test/api/test_helpers.go` - å…±äº«MockUserRepository

#### æ›´æ–°æµ‹è¯•æ–‡ä»¶:
- `test/api/user_api_test.go` - ä½¿ç”¨å…±äº«Mock
- `test/integration/user_api_integration_test.go` - ä¿®å¤è·¯ç”±å¼•ç”¨

### 6. æ¸…ç†å·¥ä½œ

åˆ é™¤çš„æ–‡ä»¶å’Œç›®å½•ï¼š
- âŒ `api/v1/system/` - å·²é‡å‘½åä¸ºuser
- âŒ `api/v1/shared/admin_api.go` - å·²è¿ç§»åˆ°adminæ¨¡å—
- âŒ `router/users/` - å·²é‡å‘½åä¸ºuser

## ğŸ“Š æ¨¡å—ç»“æ„å¯¹æ¯”

### é‡æ„å‰
```
api/v1/
â”œâ”€â”€ system/          # æ··åˆäº†ç”¨æˆ·å’Œç®¡ç†å‘˜åŠŸèƒ½
â”œâ”€â”€ shared/          # åŒ…å«admin_api.go
â”œâ”€â”€ ai/              # åŒ…å«ç®¡ç†å‘˜é…é¢ç®¡ç†
â”œâ”€â”€ bookstore/
â”œâ”€â”€ reader/
â”œâ”€â”€ recommendation/
â””â”€â”€ writer/
```

### é‡æ„å
```
api/v1/
â”œâ”€â”€ admin/           # âœ¨ æ–°å¢ï¼šé›†ä¸­çš„ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ user_admin_api.go
â”‚   â”œâ”€â”€ quota_admin_api.go
â”‚   â”œâ”€â”€ audit_admin_api.go
â”‚   â”œâ”€â”€ system_admin_api.go
â”‚   â”œâ”€â”€ types.go
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ user/            # âœ¨ é‡å‘½åï¼šä¸“æ³¨ç”¨æˆ·åŠŸèƒ½
â”‚   â”œâ”€â”€ user_api.go
â”‚   â”œâ”€â”€ user_dto.go
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ ai/              # æ¸…ç†ï¼šç§»é™¤ç®¡ç†å‘˜åŠŸèƒ½
â”œâ”€â”€ bookstore/       # æ›´æ–°ï¼šå®Œå–„æ–‡æ¡£
â”œâ”€â”€ reader/          # æ›´æ–°ï¼šå®Œå–„æ–‡æ¡£
â”œâ”€â”€ recommendation/  # æ›´æ–°ï¼šå®Œå–„æ–‡æ¡£
â”œâ”€â”€ shared/          # æ¸…ç†ï¼šç§»é™¤admin_api.go
â””â”€â”€ writer/          # æ›´æ–°ï¼šå®Œå–„æ–‡æ¡£
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. èŒè´£åˆ†ç¦»
- **useræ¨¡å—**: åªå¤„ç†æ™®é€šç”¨æˆ·çš„è®¤è¯å’Œä¸ªäººä¿¡æ¯ç®¡ç†
- **adminæ¨¡å—**: é›†ä¸­ç®¡ç†æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½
- **å…¶ä»–æ¨¡å—**: ä¸“æ³¨å„è‡ªçš„ä¸šåŠ¡é¢†åŸŸ

### 2. ç»Ÿä¸€è®¤è¯
```go
// ç”¨æˆ·è·¯ç”±
authenticated := r.Group("/users")
authenticated.Use(middleware.JWTAuth())

// ç®¡ç†å‘˜è·¯ç”±
adminGroup := r.Group("/admin")
adminGroup.Use(middleware.JWTAuth())
adminGroup.Use(middleware.RequireRole("admin"))
```

### 3. RESTfulé£æ ¼
```
GET    /api/v1/admin/users        - è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/v1/admin/users/:id    - è·å–å•ä¸ªç”¨æˆ·
PUT    /api/v1/admin/users/:id    - æ›´æ–°ç”¨æˆ·
DELETE /api/v1/admin/users/:id    - åˆ é™¤ç”¨æˆ·
POST   /api/v1/admin/users/:id/ban - å°ç¦ç”¨æˆ·
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–æ³¨å…¥
```go
// router/admin/admin_router.go
func RegisterAdminRoutes(
    r *gin.RouterGroup,
    userService serviceInterfaces.UserService,
    aiQuotaService serviceInterfaces.AIQuotaService,
    contentAuditService serviceInterfaces.ContentAuditService,
    sharedAdminService adminService.AdminService,
)
```

### é”™è¯¯å¤„ç†
ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š
```go
shared.Success(c, 200, "æˆåŠŸ", data)
shared.Error(c, 400, "å‚æ•°é”™è¯¯", nil)
shared.InternalError(c, "å†…éƒ¨é”™è¯¯", err)
```

## ğŸ“ APIæ–‡æ¡£ç‰¹ç‚¹

æ¯ä¸ªREADMEåŒ…å«ï¼š
1. **æ¨¡å—æ¦‚è¿°** - èŒè´£è¯´æ˜
2. **æ ¸å¿ƒåŠŸèƒ½** - ä¸»è¦åŠŸèƒ½åˆ—è¡¨
3. **APIè·¯ç”±è¡¨** - å®Œæ•´çš„ç«¯ç‚¹åˆ—è¡¨
4. **è¯·æ±‚ç¤ºä¾‹** - cURLå’Œå“åº”ç¤ºä¾‹
5. **æµç¨‹å›¾** - Mermaidæµç¨‹å›¾
6. **è®¾è®¡åŸåˆ™** - æ¶æ„å†³ç­–è¯´æ˜

## âœ… æ„å»ºéªŒè¯

```bash
# ç¼–è¯‘æˆåŠŸ
go build -o qingyu_backend.exe ./cmd/server/main.go
# Exit code: 0

# æµ‹è¯•ç¼–è¯‘æˆåŠŸ
go test -c ./test/api/admin_api_test.go ./test/api/test_helpers.go -tags=integration
# ç”Ÿæˆ: admin_test.exe
```

## ğŸš€ åç»­å·¥ä½œå»ºè®®

### 1. å®Œå–„æµ‹è¯•è¦†ç›–
- [ ] ä¸ºadminæ¨¡å—æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•
- [ ] æ·»åŠ æƒé™éªŒè¯æµ‹è¯•
- [ ] æ·»åŠ APIæ€§èƒ½æµ‹è¯•

### 2. æ–‡æ¡£å®Œå–„
- [ ] æ·»åŠ Swaggeræ–‡æ¡£ç”Ÿæˆ
- [ ] è¡¥å……APIä½¿ç”¨ç¤ºä¾‹
- [ ] åˆ›å»ºPostmané›†åˆ

### 3. å®‰å…¨åŠ å›º
- [ ] å®ç°æ“ä½œæ—¥å¿—è®°å½•
- [ ] æ·»åŠ æ•æ„Ÿæ“ä½œäºŒæ¬¡ç¡®è®¤
- [ ] å®Œå–„æƒé™ç²’åº¦æ§åˆ¶

### 4. æ€§èƒ½ä¼˜åŒ–
- [ ] æ·»åŠ ç¼“å­˜å±‚
- [ ] å®ç°æ‰¹é‡æ“ä½œAPI
- [ ] ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `doc/api/ç®¡ç†å‘˜APIæ–‡æ¡£.md` - ç®¡ç†å‘˜APIè¯¦ç»†æ–‡æ¡£
- `doc/architecture/æ¶æ„è®¾è®¡è§„èŒƒ.md` - æ¶æ„è®¾è®¡è§„èŒƒ
- `doc/architecture/è·¯ç”±å±‚è®¾è®¡è§„èŒƒ.md` - è·¯ç”±å±‚è®¾è®¡è§„èŒƒ
- `api/v1/*/README.md` - å„æ¨¡å—è¯¦ç»†æ–‡æ¡£

## ğŸ‘¥ å½±å“èŒƒå›´

### å‰ç«¯éœ€è¦æ›´æ–°çš„æ¥å£è·¯å¾„

#### ç®¡ç†å‘˜ç›¸å…³API
```javascript
// æ—§è·¯å¾„ â†’ æ–°è·¯å¾„
/api/v1/ai/quota/admin/:userId          â†’ /api/v1/admin/quota/:userId
/api/v1/shared/admin/users              â†’ /api/v1/admin/users
/api/v1/shared/admin/audit/*            â†’ /api/v1/admin/audit/*
/api/v1/shared/admin/system/*           â†’ /api/v1/admin/system/*
```

#### ç”¨æˆ·ç›¸å…³API
```javascript
// æ—§è·¯å¾„ â†’ æ–°è·¯å¾„
/api/v1/system/register                 â†’ /api/v1/register
/api/v1/system/login                    â†’ /api/v1/login
/api/v1/system/users/profile            â†’ /api/v1/users/profile
```

### å…¼å®¹æ€§è¯´æ˜
âš ï¸ **Breaking Changes**: æ­¤æ¬¡é‡æ„é‡‡ç”¨äº†å…¨æ–°çš„è·¯ç”±ç»“æ„ï¼Œå‰ç«¯éœ€è¦åŒæ­¥æ›´æ–°ã€‚

## âœ¨ é‡æ„æ”¶ç›Š

1. **æ›´æ¸…æ™°çš„æ¨¡å—èŒè´£** - æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€æ˜ç¡®
2. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§** - ç›¸å…³åŠŸèƒ½é›†ä¸­ç®¡ç†
3. **æ›´å®Œå–„çš„æ–‡æ¡£** - è¯¦ç»†çš„APIæ–‡æ¡£å’Œç¤ºä¾‹
4. **æ›´æ˜“äºæµ‹è¯•** - å…±äº«Mocké™ä½æµ‹è¯•æˆæœ¬
5. **æ›´å¥½çš„æ‰©å±•æ€§** - ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•æ‰“ä¸‹åŸºç¡€

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡APIå±‚é‡æ„æˆåŠŸå®ç°äº†ï¼š
- âœ… åˆ›å»ºäº†ç‹¬ç«‹çš„adminç®¡ç†å‘˜æ¨¡å—
- âœ… å°†systemæ¨¡å—é‡å‘½åä¸ºuserï¼ŒèŒè´£æ›´æ¸…æ™°
- âœ… å®Œå–„äº†æ‰€æœ‰APIæ¨¡å—çš„æ–‡æ¡£
- âœ… æ›´æ–°äº†è·¯ç”±å±‚ä»¥åæ˜ æ–°ç»“æ„
- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… åŸºç¡€æµ‹è¯•æ¡†æ¶æ­å»ºå®Œæˆ

é‡æ„éµå¾ªäº†é¡¹ç›®çš„æ¶æ„è®¾è®¡è§„èŒƒï¼Œä¿æŒäº†ä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

---

**é‡æ„å®Œæˆæ—¶é—´**: 2025-10-24
**æ„å»ºçŠ¶æ€**: âœ… æˆåŠŸ
**æ–‡æ¡£å®Œæ•´æ€§**: âœ… å®Œæ•´
**æµ‹è¯•çŠ¶æ€**: âœ… åŸºç¡€æµ‹è¯•é€šè¿‡

