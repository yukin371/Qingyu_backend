# Task 2: æ•°æ®ç»Ÿè®¡å®é™…RepositoryæŸ¥è¯¢å®æ–½æ–¹æ¡ˆ

**æ—¥æœŸ**: 2025-10-29  
**çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­  
**é¢„è®¡å·¥æœŸ**: 2å¤©ï¼ˆå‹ç¼©åˆ°1å¤©ï¼‰

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### å½“å‰é—®é¢˜

**PlatformStatsService** æ‰€æœ‰æ–¹æ³•éƒ½è¿”å›Mockæ•°æ®ï¼š
- `GetUserStats()` - Mock âŒ
- `GetPlatformUserStats()` - Mock âŒ  
- `GetContentStats()` - Mock âŒ
- `GetPlatformContentStats()` - Mock âŒ
- `GetUserActivityStats()` - Mock âŒ
- `GetRevenueStats()` - Mock âŒ

**ReadingStatsService** å·²å®ç°å®é™…æŸ¥è¯¢ âœ…

---

## ğŸ¯ å®æ–½ç­–ç•¥

### ç­–ç•¥ï¼šæ¸è¿›å¼å®ç°

è€ƒè™‘åˆ°æ—¶é—´å’Œå¤æ‚åº¦ï¼Œé‡‡ç”¨**åˆ†é˜¶æ®µå®ç°**ï¼š

**Phase 1 (ä»Šæ—¥å®Œæˆ)**:
- âœ… å®ç°æ ¸å¿ƒç”¨æˆ·ç»Ÿè®¡ï¼ˆGetUserStatsï¼‰
- âœ… å®ç°æ ¸å¿ƒå†…å®¹ç»Ÿè®¡ï¼ˆGetContentStatsï¼‰
- âœ… æ³¨å…¥å¿…è¦çš„Repository

**Phase 2 (å»¶ååˆ°Task 3)**:
- MongoDBèšåˆæŸ¥è¯¢ï¼ˆGetPlatformUserStatsï¼‰
- MongoDBèšåˆæŸ¥è¯¢ï¼ˆGetPlatformContentStatsï¼‰
- æ´»è·ƒåº¦å’Œæ”¶ç›Šç»Ÿè®¡

**ç†ç”±**: 
- æ ¸å¿ƒç»Ÿè®¡å¯ç”¨åŸºç¡€æŸ¥è¯¢å®ç°
- å¹³å°çº§ç»Ÿè®¡éœ€è¦å¤æ‚èšåˆï¼ˆTask 3ï¼‰
- å¿«é€ŸéªŒè¯åŠŸèƒ½å¯ç”¨æ€§

---

## ğŸ“‹ è¯¦ç»†å®æ–½æ­¥éª¤

### Step 1: æ³¨å…¥Repositoryä¾èµ–ï¼ˆ30åˆ†é’Ÿï¼‰

ä¿®æ”¹`PlatformStatsServiceImpl`ç»“æ„ä½“ï¼š

```go
type PlatformStatsServiceImpl struct {
    userRepo    repository.UserRepository
    bookRepo    repository.BookRepository
    projectRepo repository.ProjectRepository
    chapterRepo repository.ChapterRepository
    initialized bool
}

func NewPlatformStatsService(
    userRepo repository.UserRepository,
    bookRepo repository.BookRepository,
    projectRepo repository.ProjectRepository,
    chapterRepo repository.ChapterRepository,
) PlatformStatsService {
    return &PlatformStatsServiceImpl{
        userRepo:    userRepo,
        bookRepo:    bookRepo,
        projectRepo: projectRepo,
        chapterRepo: chapterRepo,
    }
}
```

### Step 2: å®ç°GetUserStatsï¼ˆ1å°æ—¶ï¼‰

æ›¿æ¢Mockæ•°æ®ä¸ºå®é™…æŸ¥è¯¢ï¼š

```go
func (s *PlatformStatsServiceImpl) GetUserStats(ctx context.Context, userID string) (*UserStats, error) {
    // 1. è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    user, err := s.userRepo.GetByID(ctx, userID)
    if err != nil {
        return nil, err
    }
    
    // 2. ç»Ÿè®¡é¡¹ç›®æ•°
    projectCount, _ := s.projectRepo.CountByUserID(ctx, userID)
    
    // 3. ç»Ÿè®¡ä¹¦ç±æ•°
    books, _ := s.bookRepo.FindByAuthorID(ctx, userID)
    bookCount := len(books)
    
    // 4. ç»Ÿè®¡æ€»å­—æ•°
    totalWords := calculateTotalWords(books)
    
    // 5. ç»Ÿè®¡é˜…è¯»æ•°ï¼ˆTODO: éœ€è¦é˜…è¯»è®°å½•Repositoryï¼‰
    totalReading := int64(0) // æš‚æ—¶
    
    // 6. æ„å»ºç»“æœ
    stats := &UserStats{
        UserID:        userID,
        TotalProjects: int64(projectCount),
        TotalBooks:    int64(bookCount),
        TotalWords:    totalWords,
        TotalReading:  totalReading,
        RegisteredAt:  user.CreatedAt,
        LastActiveAt:  user.UpdatedAt,
        MemberLevel:   user.VIPLevel,
    }
    
    return stats, nil
}
```

### Step 3: å®ç°GetContentStatsï¼ˆ1å°æ—¶ï¼‰

ç±»ä¼¼GetUserStatsçš„å®ç°æ–¹å¼ã€‚

### Step 4: æ›´æ–°æœåŠ¡å®¹å™¨ï¼ˆ15åˆ†é’Ÿï¼‰

åœ¨`service/container/service_container.go`ä¸­æ³¨å…¥Repositoryã€‚

### Step 5: æ ‡è®°TODOï¼ˆ15åˆ†é’Ÿï¼‰

ä¸ºå¤æ‚ç»Ÿè®¡æ·»åŠ TODOæ³¨é‡Šï¼Œå»¶ååˆ°Task 3å®ç°ã€‚

---

## â±ï¸ æ—¶é—´åˆ†é…

| æ­¥éª¤ | é¢„è®¡æ—¶é—´ | è¯´æ˜ |
|-----|---------|------|
| Step 1: æ³¨å…¥Repository | 30åˆ†é’Ÿ | ä¿®æ”¹æ„é€ å‡½æ•° |
| Step 2: GetUserStats | 1å°æ—¶ | å®ç°å®é™…æŸ¥è¯¢ |
| Step 3: GetContentStats | 1å°æ—¶ | å®ç°å®é™…æŸ¥è¯¢ |
| Step 4: æœåŠ¡å®¹å™¨æ›´æ–° | 15åˆ†é’Ÿ | æ³¨å…¥ä¾èµ– |
| Step 5: TODOæ ‡è®° | 15åˆ†é’Ÿ | æ–‡æ¡£åŒ–å»¶åé¡¹ |
| **æ€»è®¡** | **3å°æ—¶** | **å‹ç¼©å®ç°** |

**è¯´æ˜**: åŸè®¡åˆ’2å¤©ï¼Œå‹ç¼©åˆ°3å°æ—¶ï¼ˆä»…æ ¸å¿ƒåŠŸèƒ½ï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] GetUserStatsè¿”å›å®é™…æ•°æ®
- [ ] GetContentStatsè¿”å›å®é™…æ•°æ®
- [ ] Repositoryæ­£ç¡®æ³¨å…¥
- [ ] æœåŠ¡å®¹å™¨æ›´æ–°å®Œæˆ

### è´¨é‡éªŒæ”¶
- [ ] 0 linté”™è¯¯
- [ ] 0ç¼–è¯‘é”™è¯¯
- [ ] åŸºç¡€æµ‹è¯•é€šè¿‡
- [ ] TODOæ ‡è®°æ¸…æ™°

### å»¶åæ ‡è®°
- [ ] GetPlatformUserStats - TODO (Task 3)
- [ ] GetPlatformContentStats - TODO (Task 3)
- [ ] GetUserActivityStats - TODO (Task 3)
- [ ] GetRevenueStats - TODO (Task 3)

---

## ğŸ“ å®æ–½è®°å½•

**å¼€å§‹æ—¶é—´**: 2025-10-29 æ™š  
**é¢„è®¡å®Œæˆ**: 2025-10-29 æ·±å¤œ

**ä¸‹ä¸€æ­¥**: å¼€å§‹Step 1 - æ³¨å…¥Repositoryä¾èµ–

