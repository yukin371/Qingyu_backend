# é…ç½®ç®¡ç†å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

é…ç½®ç®¡ç†å·¥å…·æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„Webç•Œé¢å·¥å…·ï¼Œå…è®¸ç³»ç»Ÿç®¡ç†å‘˜é€šè¿‡å‰ç«¯ç•Œé¢å®æ—¶ç®¡ç†ç³»ç»Ÿé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘YAMLæ–‡ä»¶æˆ–é‡å¯æœåŠ¡ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ¨ **å‹å¥½ç•Œé¢**ï¼šé€šè¿‡Webç•Œé¢ç®¡ç†é…ç½®ï¼Œæ— éœ€SSHç™»å½•æœåŠ¡å™¨
- ğŸ”„ **å®æ—¶ç”Ÿæ•ˆ**ï¼šé…ç½®æ›´æ–°åè‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œéƒ¨åˆ†é…ç½®å³æ—¶ç”Ÿæ•ˆ
- ğŸ”’ **å®‰å…¨ä¿æŠ¤**ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤ºï¼Œç®¡ç†å‘˜æƒé™æ§åˆ¶
- ğŸ“¦ **è‡ªåŠ¨å¤‡ä»½**ï¼šæ¯æ¬¡æ›´æ–°å‰è‡ªåŠ¨å¤‡ä»½ï¼Œæ”¯æŒä¸€é”®æ¢å¤
- âœ… **é…ç½®éªŒè¯**ï¼šæ›´æ–°å‰éªŒè¯é…ç½®æ ¼å¼ï¼Œé˜²æ­¢é”™è¯¯é…ç½®
- ğŸ” **åˆ†ç»„ç®¡ç†**ï¼šé…ç½®æŒ‰åŠŸèƒ½åˆ†ç»„ï¼Œä¾¿äºæŸ¥æ‰¾å’Œç®¡ç†

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–ç®¡ç†å‘˜Token

é¦–å…ˆéœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•è·å–Tokenï¼š

```bash
# ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:8080/api/v1/login \
  -H 'Content-Type: application/json' \
  -d '{
    "username": "admin",
    "password": "your_password"
  }'

# å“åº”
{
  "code": 200,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": "admin_user_id"
  }
}
```

ä¿å­˜è¿”å›çš„ `token`ï¼Œåç»­æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨ã€‚

### 2. æŸ¥çœ‹å½“å‰é…ç½®

```bash
curl -X GET http://localhost:8080/api/v1/admin/config \
  -H 'Authorization: Bearer <your_token>'
```

### 3. æ›´æ–°é…ç½®

```bash
curl -X PUT http://localhost:8080/api/v1/admin/config \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "key": "server.port",
    "value": "9090"
  }'
```

---

## ğŸ’» åŠŸèƒ½è¯¦è§£

### é…ç½®åˆ†ç»„

é…ç½®æŒ‰ç…§åŠŸèƒ½æ¨¡å—åˆ†ä¸ºä»¥ä¸‹å‡ ç»„ï¼š

#### 1. æœåŠ¡å™¨é…ç½® (server)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-------|------|--------|------|
| `server.port` | æœåŠ¡å™¨ç«¯å£ | 8080 | 8080, 9090 |
| `server.mode` | è¿è¡Œæ¨¡å¼ | debug | debug, release |

**ä½•æ—¶ä¿®æ”¹**ï¼š
- ç«¯å£å†²çªæ—¶ä¿®æ”¹ `server.port`
- ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢åˆ° `release` æ¨¡å¼

#### 2. æ•°æ®åº“é…ç½® (database)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-------|------|--------|------|
| `database.uri` | MongoDBè¿æ¥URI | mongodb://localhost:27017 | mongodb://user:pass@host:port |
| `database.name` | æ•°æ®åº“åç§° | Qingyu_backend | Qingyu_backend, qingyu_prod |
| `database.max_pool_size` | æœ€å¤§è¿æ¥æ± å¤§å° | 100 | 50, 100, 200 |

**ä½•æ—¶ä¿®æ”¹**ï¼š
- åˆ‡æ¢æ•°æ®åº“æœåŠ¡å™¨æ—¶ä¿®æ”¹ `database.uri`
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“å
- æ€§èƒ½è°ƒä¼˜æ—¶è°ƒæ•´è¿æ¥æ± å¤§å°

#### 3. JWTé…ç½® (jwt)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-------|------|--------|------|
| `jwt.secret` | JWTå¯†é’¥ | qingyu_secret_key | å¼ºå¯†ç å­—ç¬¦ä¸² |
| `jwt.expiration_hours` | Tokenè¿‡æœŸæ—¶é—´ | 24 | 1, 24, 168 |

**ä½•æ—¶ä¿®æ”¹**ï¼š
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ä¸ºå¼ºå¯†é’¥
- æ ¹æ®å®‰å…¨éœ€æ±‚è°ƒæ•´è¿‡æœŸæ—¶é—´

#### 4. Redisé…ç½® (redis)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-------|------|--------|------|
| `redis.host` | Redisä¸»æœºåœ°å€ | localhost | localhost, redis.example.com |
| `redis.port` | Redisç«¯å£ | 6379 | 6379, 6380 |
| `redis.password` | Rediså¯†ç  | ç©º | å¯†ç å­—ç¬¦ä¸² |
| `redis.db` | æ•°æ®åº“ç¼–å· | 0 | 0, 1, 2 |

**ä½•æ—¶ä¿®æ”¹**ï¼š
- åˆ‡æ¢RedisæœåŠ¡å™¨
- ç”Ÿäº§ç¯å¢ƒè®¾ç½®å¯†ç 
- ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒDB

#### 5. AIæœåŠ¡é…ç½® (ai)

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-------|------|--------|------|
| `ai.api_key` | AI APIå¯†é’¥ | - | AIzaSy... |
| `ai.base_url` | APIåŸºç¡€URL | - | https://api.openai.com/v1 |
| `ai.max_tokens` | æœ€å¤§Tokenæ•° | 2000 | 1000, 2000, 4000 |

**ä½•æ—¶ä¿®æ”¹**ï¼š
- åˆ‡æ¢AIæœåŠ¡æä¾›å•†
- è°ƒæ•´Tokené™åˆ¶

---

## ğŸ”§ å¸¸è§æ“ä½œåœºæ™¯

### åœºæ™¯1: ä¿®æ”¹æœåŠ¡å™¨ç«¯å£

**éœ€æ±‚**ï¼šå°†æœåŠ¡å™¨ç«¯å£ä»8080æ”¹ä¸º9090

**æ­¥éª¤**ï¼š

1. è·å–å½“å‰é…ç½®ç¡®è®¤ç«¯å£
```bash
curl -X GET http://localhost:8080/api/v1/admin/config/server.port \
  -H 'Authorization: Bearer <token>'
```

2. æ›´æ–°ç«¯å£é…ç½®
```bash
curl -X PUT http://localhost:8080/api/v1/admin/config \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "key": "server.port",
    "value": "9090"
  }'
```

3. é‡å¯æœåŠ¡ç”Ÿæ•ˆ
```bash
# æ³¨æ„ï¼šç«¯å£ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡
./scripts/deployment/restart.sh
```

### åœºæ™¯2: åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

**éœ€æ±‚**ï¼šå°†å¼€å‘é…ç½®åˆ‡æ¢åˆ°ç”Ÿäº§é…ç½®

**æ­¥éª¤**ï¼š

ä½¿ç”¨æ‰¹é‡æ›´æ–°APIä¸€æ¬¡æ€§ä¿®æ”¹å¤šä¸ªé…ç½®ï¼š

```bash
curl -X PUT http://localhost:8080/api/v1/admin/config/batch \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "updates": [
      {
        "key": "server.mode",
        "value": "release"
      },
      {
        "key": "jwt.secret",
        "value": "super-secure-production-secret-key-123456"
      },
      {
        "key": "database.name",
        "value": "qingyu_production"
      },
      {
        "key": "jwt.expiration_hours",
        "value": 1
      }
    ]
  }'
```

### åœºæ™¯3: é…ç½®é”™è¯¯æ¢å¤

**é—®é¢˜**ï¼šä¸å°å¿ƒä¿®æ”¹äº†é…ç½®å¯¼è‡´æœåŠ¡å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ¢å¤æœ€è¿‘çš„å¤‡ä»½
```bash
curl -X POST http://localhost:8080/api/v1/admin/config/restore \
  -H 'Authorization: Bearer <token>'
```

2. éªŒè¯é…ç½®æ˜¯å¦æ­£å¸¸
```bash
curl -X GET http://localhost:8080/api/v1/admin/config \
  -H 'Authorization: Bearer <token>'
```

### åœºæ™¯4: å¢åŠ æ•°æ®åº“è¿æ¥æ± 

**éœ€æ±‚**ï¼šç³»ç»Ÿè´Ÿè½½å¢åŠ ï¼Œéœ€è¦è°ƒæ•´æ•°æ®åº“è¿æ¥æ± å¤§å°

**æ­¥éª¤**ï¼š

```bash
curl -X PUT http://localhost:8080/api/v1/admin/config \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "key": "database.max_pool_size",
    "value": 200
  }'
```

**ç”Ÿæ•ˆæ—¶é—´**ï¼šç«‹å³ç”Ÿæ•ˆï¼ˆä¸‹æ¬¡æ•°æ®åº“è¿æ¥æ—¶ä½¿ç”¨æ–°é…ç½®ï¼‰

### åœºæ™¯5: æ›´æ¢AIæœåŠ¡æä¾›å•†

**éœ€æ±‚**ï¼šä»Geminiåˆ‡æ¢åˆ°OpenAI

**æ­¥éª¤**ï¼š

```bash
curl -X PUT http://localhost:8080/api/v1/admin/config/batch \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "updates": [
      {
        "key": "ai.api_key",
        "value": "sk-xxxxxxxxxxxxxxxxxxxxx"
      },
      {
        "key": "ai.base_url",
        "value": "https://api.openai.com/v1"
      },
      {
        "key": "ai.max_tokens",
        "value": 4000
      }
    ]
  }'
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### éœ€è¦é‡å¯æœåŠ¡çš„é…ç½®

ä»¥ä¸‹é…ç½®ä¿®æ”¹åéœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼š

- âœ… `server.port` - æœåŠ¡å™¨ç«¯å£
- âœ… `server.mode` - è¿è¡Œæ¨¡å¼
- âœ… `database.uri` - æ•°æ®åº“è¿æ¥

### ç«‹å³ç”Ÿæ•ˆçš„é…ç½®

ä»¥ä¸‹é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ï¼š

- âœ… `jwt.expiration_hours` - Tokenè¿‡æœŸæ—¶é—´ï¼ˆå½±å“æ–°ç”Ÿæˆçš„Tokenï¼‰
- âœ… `ai.max_tokens` - AI Tokené™åˆ¶
- âœ… `database.max_pool_size` - è¿æ¥æ± å¤§å°ï¼ˆæ–°è¿æ¥ä½¿ç”¨æ–°å€¼ï¼‰

### æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

ç³»ç»Ÿä¼šè‡ªåŠ¨è„±æ•ä»¥ä¸‹æ•æ„Ÿä¿¡æ¯ï¼š

- ğŸ”’ `jwt.secret` - JWTå¯†é’¥
- ğŸ”’ `database.uri` - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼ˆåŒ…å«å¯†ç ï¼‰
- ğŸ”’ `redis.password` - Rediså¯†ç 
- ğŸ”’ `ai.api_key` - AI APIå¯†é’¥

**æ˜¾ç¤ºæ ¼å¼**ï¼š`qing****_key`ï¼ˆä»…æ˜¾ç¤ºé¦–å°¾4ä¸ªå­—ç¬¦ï¼‰

### å¤‡ä»½ç­–ç•¥

- ğŸ“¦ æ¯æ¬¡æ›´æ–°é…ç½®å‰è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶
- ğŸ“¦ å¤‡ä»½æ–‡ä»¶å‘½åï¼š`config.yaml.backup`
- ğŸ“¦ ä½äºé…ç½®æ–‡ä»¶åŒç›®å½•ä¸‹
- ğŸ“¦ å»ºè®®å®šæœŸæ‰‹åŠ¨å¤‡ä»½åˆ°å®‰å…¨ä½ç½®

---

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

### 1. æƒé™ç®¡ç†

- âœ… åªæˆäºˆå¯ä¿¡ä»»çš„ç®¡ç†å‘˜è®¿é—®æƒé™
- âœ… å®šæœŸè½®æ¢ç®¡ç†å‘˜å¯†ç 
- âœ… ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥

### 2. æ•æ„Ÿä¿¡æ¯

- âœ… ç”Ÿäº§ç¯å¢ƒJWTå¯†é’¥è‡³å°‘32ä½
- âœ… æ•°æ®åº“å¯†ç ä½¿ç”¨å¼ºå¯†ç 
- âœ… APIå¯†é’¥å®šæœŸè½®æ¢

### 3. æ“ä½œè®°å½•

å»ºè®®åœ¨é‡è¦é…ç½®ä¿®æ”¹å‰ï¼š

1. è®°å½•ä¿®æ”¹åŸå› 
2. é€šçŸ¥ç›¸å…³äººå‘˜
3. å‡†å¤‡å›æ»šæ–¹æ¡ˆ

### 4. æµ‹è¯•æµç¨‹

ç”Ÿäº§ç¯å¢ƒé…ç½®ä¿®æ”¹å‰ï¼š

1. åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯
2. å‡†å¤‡å›æ»šæ–¹æ¡ˆ
3. é€‰æ‹©ä½å³°æœŸæ“ä½œ
4. ç›‘æ§æœåŠ¡è¿è¡ŒçŠ¶æ€

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ›´æ–°é…ç½®åæœåŠ¡æ— å“åº”

**å¯èƒ½åŸå› **ï¼š
- é…ç½®æ ¼å¼é”™è¯¯
- æ•°æ®åº“è¿æ¥å¤±è´¥
- Redisè¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
tail -f logs/server.log

# 2. æ¢å¤é…ç½®å¤‡ä»½
curl -X POST http://localhost:8080/api/v1/admin/config/restore \
  -H 'Authorization: Bearer <token>'

# 3. é‡å¯æœåŠ¡
./scripts/deployment/restart.sh
```

### é—®é¢˜2: æ— æ³•è®¿é—®é…ç½®ç®¡ç†ç•Œé¢

**å¯èƒ½åŸå› **ï¼š
- Tokenè¿‡æœŸ
- æƒé™ä¸è¶³
- æœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. é‡æ–°ç™»å½•è·å–Token
curl -X POST http://localhost:8080/api/v1/login \
  -H 'Content-Type: application/json' \
  -d '{"username":"admin","password":"your_password"}'

# 2. ç¡®è®¤è§’è‰²æƒé™
curl -X GET http://localhost:8080/api/v1/users/profile \
  -H 'Authorization: Bearer <token>'
# ç¡®è®¤roleå­—æ®µä¸º"admin"

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status qingyu-backend
```

### é—®é¢˜3: é…ç½®æ›´æ–°å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- é…ç½®å€¼ç±»å‹é”™è¯¯
- é…ç½®é¡¹ä¸å­˜åœ¨
- é…ç½®é¡¹ä¸å¯ç¼–è¾‘

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
# å“åº”ä¼šåŒ…å«è¯¦ç»†é”™è¯¯è¯´æ˜

# 2. éªŒè¯é…ç½®æ ¼å¼
curl -X POST http://localhost:8080/api/v1/admin/config/validate \
  -H 'Authorization: Bearer <token>' \
  -H 'Content-Type: application/json' \
  -d '{"yaml_content":"your yaml content"}'

# 3. ç¡®è®¤é…ç½®é¡¹ä¿¡æ¯
curl -X GET http://localhost:8080/api/v1/admin/config/<key> \
  -H 'Authorization: Bearer <token>'
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©

1. **æ–‡æ¡£**ï¼šæŸ¥çœ‹ `/doc/api/admin/é…ç½®ç®¡ç†APIæ–‡æ¡£.md`
2. **æ—¥å¿—**ï¼šæŸ¥çœ‹ `/logs/server.log` è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. **æµ‹è¯•**ï¼šä½¿ç”¨Postmanæˆ–cURLæµ‹è¯•APIæ¥å£

### åé¦ˆé—®é¢˜

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š

- æ“ä½œæ­¥éª¤
- é”™è¯¯ä¿¡æ¯
- é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆæ•æ„Ÿä¿¡æ¯è„±æ•ï¼‰
- æœåŠ¡å™¨æ—¥å¿—

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†æµç¨‹

```
[è®¡åˆ’] â†’ [æµ‹è¯•] â†’ [å¤‡ä»½] â†’ [æ‰§è¡Œ] â†’ [éªŒè¯] â†’ [ç›‘æ§]
```

### 2. ç¯å¢ƒéš”ç¦»

- å¼€å‘ç¯å¢ƒï¼š`config.yaml`
- æµ‹è¯•ç¯å¢ƒï¼š`config.test.yaml`
- ç”Ÿäº§ç¯å¢ƒï¼š`config.prod.yaml`

### 3. å˜æ›´ç®¡ç†

å»ºè®®å»ºç«‹é…ç½®å˜æ›´æµç¨‹ï¼š

1. æäº¤å˜æ›´ç”³è¯·
2. æŠ€æœ¯è¯„å®¡
3. æµ‹è¯•ç¯å¢ƒéªŒè¯
4. ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
5. å˜æ›´è®°å½•å½’æ¡£

### 4. å®šæœŸæ£€æŸ¥

å»ºè®®æ¯æœˆæ£€æŸ¥ï¼š

- JWTå¯†é’¥æ˜¯å¦éœ€è¦è½®æ¢
- è¿æ¥æ± å¤§å°æ˜¯å¦åˆé€‚
- Tokenè¿‡æœŸæ—¶é—´æ˜¯å¦åˆç†
- APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ

---

**ç»´æŠ¤è€…**ï¼šé’ç¾½åç«¯å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-10-25  
**ç‰ˆæœ¬**ï¼šv1.0

