# é’ç¾½å†™ä½œå¹³å° - é¡¹ç›®å®Œå–„è§„åˆ’

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç‰ˆæœ¬ | v1.2 |
| åˆ›å»ºæ—¥æœŸ | 2026-01-02 |
| æ›´æ–°æ—¥æœŸ | 2026-01-06 |
| ç¼–å†™è€… | Claude Code |
| é¡¹ç›®åç§° | é’ç¾½å†™ä½œå¹³å°åç«¯ |

---

## ğŸ“¢ P0çº§åˆ«æŠ€æœ¯å€ºåŠ¡è§£å†³è¿›å±•ï¼ˆ2026-01-02ï¼‰

### å·²å®Œæˆ âœ…

æ‰€æœ‰8é¡¹P0çº§åˆ«æŠ€æœ¯å€ºåŠ¡å·²å®Œæˆå®æ–½ï¼š

| # | é—®é¢˜ | çŠ¶æ€ | å®æ–½å†…å®¹ | æ–‡ä»¶ä½ç½® |
|---|------|------|----------|----------|
| 1 | ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ | âœ… å®Œæˆ | å®ç°é”™è¯¯ç å®šä¹‰ã€é”™è¯¯ç±»å‹ã€ä¸­é—´ä»¶ | `pkg/errors/`<br>`pkg/middleware/error_handler.go` |
| 2 | ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ | âœ… å®Œæˆ | é›†æˆzapæ—¥å¿—åº“ã€æ—¥å¿—ä¸­é—´ä»¶ | `pkg/logger/`<br>`pkg/middleware/logger.go` |
| 3 | APIé™æµç­–ç•¥ | âœ… å®Œæˆ | ä»¤ç‰Œæ¡¶ç®—æ³•ã€IPé™æµã€ç”¨æˆ·é™æµ | `pkg/middleware/rate_limit.go` |
| 4 | æ•æ„Ÿä¿¡æ¯è„±æ• | âœ… å®Œæˆ | é‚®ç®±ã€æ‰‹æœºã€èº«ä»½è¯ã€é“¶è¡Œå¡è„±æ• | `pkg/utils/sanitizer.go` |
| 5 | ç›‘æ§å’Œå¥åº·æ£€æŸ¥ | âœ… å®Œæˆ | PrometheusæŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ç«¯ç‚¹ | `pkg/metrics/prometheus.go`<br>`api/v1/system/health_api.go` |
| 6 | æ•°æ®åº“å¤‡ä»½ç­–ç•¥ | âœ… å®Œæˆ | MongoDB/Rediså¤‡ä»½è„šæœ¬ | `scripts/backup.sh`<br>`scripts/backup.ps1` |
| 7 | ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ | âœ… å®Œæˆ | Prometheusé›†æˆã€å¥åº·æ£€æŸ¥ | å·²ä¸#5åˆå¹¶ |
| 8 | é…é¢åˆ†å¸ƒå¼é” | âœ… å®Œæˆ | Redisåˆ†å¸ƒå¼é”ã€çº¢é”ç®—æ³• | `pkg/lock/distributed_lock.go`<br>`pkg/lock/quota_lock.go` |

### å®æ–½è¯¦æƒ…

#### 1. ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ âœ…
```go
// ä½¿ç”¨ç¤ºä¾‹
err := errors.New(errors.InvalidParams, "å‚æ•°æ— æ•ˆ")
c.JSON(400, err.Info)

// ä¾¿æ·å‡½æ•°
errors.InvalidParam("email")      // å‚æ•°æ— æ•ˆ
errors.Unauthorized("æœªç™»å½•")     // æœªæˆæƒ
errors.NotFound("ç”¨æˆ·")           // èµ„æºä¸å­˜åœ¨
errors.InsufficientBalance()      // ä½™é¢ä¸è¶³
```

#### 2. ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ âœ…
```go
// åˆå§‹åŒ–æ—¥å¿—
logger.Init(&logger.Config{
    Level:  "info",
    Format: "json",
    Output: "stdout",
})

// ä½¿ç”¨æ—¥å¿—
log := logger.WithRequest(requestID, method, path, ip)
log.Info("å¤„ç†è¯·æ±‚", zap.String("user_id", userID))
```

#### 3. APIé™æµç­–ç•¥ âœ…
```go
// åº”ç”¨é™æµä¸­é—´ä»¶
router.Use(middleware.RateLimitMiddleware(&middleware.RateLimiterConfig{
    Rate:  10,  // æ¯ç§’10ä¸ªè¯·æ±‚
    Burst: 100, // æ¡¶å®¹é‡100
}))

// é«˜çº§é™æµï¼ˆIP + ç”¨æˆ·ï¼‰
router.Use(middleware.AdvancedRateLimitMiddleware(config))
```

#### 4. æ•æ„Ÿä¿¡æ¯è„±æ• âœ…
```go
// è„±æ•å‡½æ•°
utils.MaskEmail("test@example.com")     // te***@example.com
utils.MaskPhone("13812345678")          // 138****5678
utils.MaskIDCard("110101199001011234")  // 110***********1234
utils.MaskBankCard("6222021234567890123") // 6222************0123

// æ‰¹é‡è„±æ•
sanitizer := &UserSanitizer{Email: "...", Phone: "..."}
sanitizer.Sanitize()
```

#### 5. ç›‘æ§å’Œå¥åº·æ£€æŸ¥ âœ…
```go
// æ·»åŠ ç›‘æ§ä¸­é—´ä»¶
router.Use(metrics.PrometheusMiddleware())

// å¥åº·æ£€æŸ¥ç«¯ç‚¹
GET /health          // ç³»ç»Ÿå¥åº·çŠ¶æ€
GET /health/live     // å­˜æ´»æ£€æŸ¥ï¼ˆK8sï¼‰
GET /health/ready    // å°±ç»ªæ£€æŸ¥ï¼ˆK8sï¼‰
GET /metrics         // PrometheusæŒ‡æ ‡
```

#### 6. æ•°æ®åº“å¤‡ä»½ç­–ç•¥ âœ…
```bash
# æ‰§è¡Œå¤‡ä»½
./scripts/backup.sh

# å¤‡ä»½å†…å®¹
- MongoDBæ•°æ®åº“ï¼ˆmongodump + å‹ç¼©ï¼‰
- Redisæ•°æ®ï¼ˆBGSAVE + RDBæ–‡ä»¶ï¼‰
- è‡ªåŠ¨ä¸Šä¼ åˆ°S3ï¼ˆå¯é€‰ï¼‰
- è‡ªåŠ¨æ¸…ç†30å¤©å‰çš„å¤‡ä»½
```

#### 7. é…é¢åˆ†å¸ƒå¼é” âœ…
```go
// ä½¿ç”¨åˆ†å¸ƒå¼é”æ¶ˆè´¹é…é¢
quotaLock := lock.NewQuotaLock(redisClient)
quotaLock.ConsumeQuotaWithLock(ctx, userID, quotaType, amount,
    func(ctx context.Context, userID, quotaType string, amount int64) error {
        // å®‰å…¨çš„æ¶ˆè´¹é€»è¾‘
        return consumeQuota(ctx, userID, quotaType, amount)
    })
```

### é›†æˆåˆ°ç°æœ‰é¡¹ç›®

#### åœ¨main.goä¸­é›†æˆä¸­é—´ä»¶

```go
package main

import (
    "qingyu/pkg/logger"
    "qingyu/pkg/middleware"
    "qingyu/pkg/metrics"
)

func main() {
    // 1. åˆå§‹åŒ–æ—¥å¿—
    logger.Init(&logger.Config{
        Level:  "info",
        Format: "json",
        Output: "stdout",
    })

    // 2. åˆ›å»ºè·¯ç”±
    router := gin.Default()

    // 3. åº”ç”¨ä¸­é—´ä»¶ï¼ˆé¡ºåºå¾ˆé‡è¦ï¼‰
    router.Use(
        middleware.RequestIDMiddleware(),           // è¯·æ±‚ID
        middleware.RecoveryMiddleware(),            // å¼‚å¸¸æ¢å¤
        middleware.LoggerMiddleware(),              // æ—¥å¿—è®°å½•
        metrics.PrometheusMiddleware(),            // Prometheusç›‘æ§
        middleware.RateLimitMiddleware(nil),       // é™æµ
        middleware.ErrorHandler(),                 // é”™è¯¯å¤„ç†
    )

    // 4. æ³¨å†Œå¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹
    healthAPI := system.NewHealthAPI(db, redis)
    router.GET("/health", healthAPI.GetHealth)
    router.GET("/health/live", healthAPI.Liveness)
    router.GET("/health/ready", healthAPI.Readiness)
    router.GET("/metrics", metrics.MetricsHandler())

    // 5. å¯åŠ¨æœåŠ¡
    router.Run(":8080")
}
```

### åç»­å»ºè®®

è™½ç„¶P0çº§åˆ«çš„æŠ€æœ¯å€ºåŠ¡å·²å…¨éƒ¨å®Œæˆï¼Œä½†è¿˜éœ€è¦ï¼š

1. ~~**åœ¨ç°æœ‰APIä¸­åº”ç”¨é”™è¯¯å¤„ç†**~~ âœ… å·²å®Œæˆï¼ˆ2026-01-06ï¼‰
   - å°†ç°æœ‰çš„é”™è¯¯è¿”å›ç»Ÿä¸€è½¬æ¢ä¸º`shared`åŒ…çš„å“åº”å‡½æ•°

2. **æ·»åŠ æ›´å¤šç›‘æ§æŒ‡æ ‡**
   - æ•°æ®åº“è¿æ¥æ± ç›‘æ§
   - ä¸šåŠ¡æŒ‡æ ‡ï¼ˆç”¨æˆ·æ³¨å†Œã€ä¹¦ç±å‘å¸ƒç­‰ï¼‰

3. **é…ç½®å®šæ—¶å¤‡ä»½ä»»åŠ¡**
   - ä½¿ç”¨cronå®šæœŸæ‰§è¡Œå¤‡ä»½è„šæœ¬
   - é…ç½®å¤‡ä»½å¤±è´¥é€šçŸ¥

4. **å®Œå–„å•å…ƒæµ‹è¯•**
   - ä¸ºæ–°å¢ä»£ç ç¼–å†™æµ‹è¯•
   - é€æ­¥æå‡æµ‹è¯•è¦†ç›–ç‡åˆ°60%

---

## ğŸ“¢ æœ€æ–°è¿›å±•ï¼ˆ2026-01-06ï¼‰

### 1. P0ä¸­é—´ä»¶é›†æˆåˆ°æ ¸å¿ƒæœåŠ¡å™¨ âœ…

**å®æ–½å†…å®¹ï¼š**
- å°†æ‰€æœ‰6ä¸ªP0ä¸­é—´ä»¶é›†æˆåˆ° `core/server.go` çš„ `InitServer()` å‡½æ•°
- é…ç½®æ­£ç¡®çš„ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº
- æ·»åŠ å¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹

**ä¸­é—´ä»¶é¡ºåºï¼ˆå…³é”®ï¼‰ï¼š**
```
RequestID â†’ Recovery â†’ Logger â†’ Metrics â†’ RateLimit â†’ ErrorHandler â†’ CORS
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `core/server.go` - é›†æˆæ‰€æœ‰ä¸­é—´ä»¶å’Œç«¯ç‚¹

**æ–°å¢ç«¯ç‚¹ï¼š**
```
GET /health           - ç³»ç»Ÿå¥åº·çŠ¶æ€
GET /health/live      - å­˜æ´»æ£€æŸ¥ï¼ˆK8sï¼‰
GET /health/ready     - å°±ç»ªæ£€æŸ¥ï¼ˆK8sï¼‰
GET /metrics          - PrometheusæŒ‡æ ‡
```

### 2. APIé”™è¯¯å¤„ç†æ‰¹é‡é‡æ„ âœ…

**é‡æ„èŒƒå›´ï¼š**
æˆåŠŸé‡æ„äº†9ä¸ªAPIæ–‡ä»¶ï¼Œç»Ÿä¸€ä½¿ç”¨ `shared` åŒ…çš„å“åº”å‡½æ•°ï¼š

| æ¨¡å— | æ–‡ä»¶ | é‡æ„å†…å®¹ |
|------|------|----------|
| bookstore | `bookstore_api.go` | 44å¤„é”™è¯¯å¤„ç†æ›¿æ¢ |
| bookstore | `book_detail_api.go` | å®Œæ•´é‡æ„ï¼ˆ698è¡Œï¼‰ |
| bookstore | `book_rating_api.go` | æ‰¹é‡é‡æ„ |
| bookstore | `book_statistics_api.go` | æ‰¹é‡é‡æ„ |
| bookstore | `chapter_api.go` | æ‰¹é‡é‡æ„ |
| bookstore | `chapter_catalog_api.go` | æ‰¹é‡é‡æ„ |
| finance | `wallet_api.go` | æ‰¹é‡é‡æ„ |
| shared | `auth_api.go` | æ‰¹é‡é‡æ„ |
| shared | `wallet_api.go` | æ‰¹é‡é‡æ„ |

**é‡æ„æ¨¡å¼ï¼š**

| åŸæ¨¡å¼ | æ–°æ¨¡å¼ |
|--------|--------|
| `c.JSON(http.StatusBadRequest, APIResponse{...})` | `shared.BadRequest(c, "å‚æ•°é”™è¯¯", "...")` |
| `c.JSON(http.StatusInternalServerError, APIResponse{...})` | `shared.InternalError(c, "...", err)` |
| `c.JSON(http.StatusOK, APIResponse{...})` | `shared.Success(c, http.StatusOK, "...", data)` |
| `c.JSON(http.StatusOK, PaginatedResponse{...})` | `shared.Paginated(c, data, total, page, size, "...")` |
| `c.JSON(http.StatusNotFound, APIResponse{...})` | `shared.NotFound(c, "...")` |

**å·¥å…·åˆ›å»ºï¼š**
- `scripts/refactor_api.py` - Pythonæ‰¹é‡é‡æ„è„šæœ¬
- `scripts/add_shared_import.ps1` - PowerShellå¯¼å…¥æ·»åŠ è„šæœ¬

### 3. å…¶ä»–æ¨¡å—çŠ¶æ€

**å·²ä½¿ç”¨sharedå‡½æ•°çš„æ¨¡å—ï¼š**
- `api/v1/writer/` - å·²ä½¿ç”¨shared.Error()å’Œshared.Success()
- `api/v1/reader/` - å·²ä½¿ç”¨shared.Error()å’Œshared.Success()
- `api/v1/social/` - å·²ä½¿ç”¨shared.Error()å’Œshared.Success()
- `api/v1/admin/` - å·²ä½¿ç”¨shared.Error()å’Œshared.Success()

è¿™äº›æ¨¡å—åœ¨å¼€å‘æ—¶å·²ç»é‡‡ç”¨äº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼ã€‚

---

## ä¸€ã€é¡¹ç›®ç°çŠ¶åˆ†æ

### 1.1 å·²å®Œæˆæ¨¡å—

ç»è¿‡å…¨é¢åˆ†æï¼Œé¡¹ç›®ç›®å‰å·²å®ç°9å¤§æ ¸å¿ƒæ¨¡å—ï¼š

| æ¨¡å— | å®Œæˆåº¦ | è¯„åˆ† | è¯´æ˜ |
|------|--------|------|------|
| è®¤è¯æˆæƒæ¨¡å— | 90% | â­â­â­â­ | åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œç¼ºå°‘OAuthç­‰ç¬¬ä¸‰æ–¹ç™»å½• |
| å†™ä½œåˆ›ä½œæ¨¡å— | 85% | â­â­â­â­ | æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼ŒAIé›†æˆè‰¯å¥½ |
| é˜…è¯»å™¨æ¨¡å— | 80% | â­â­â­â­ | åŸºç¡€åŠŸèƒ½å®Œæ•´ï¼Œç¼ºå°‘æœ—è¯»åŠŸèƒ½ |
| ç¤¾äº¤äº’åŠ¨æ¨¡å— | 75% | â­â­â­ | è¯„è®ºç‚¹èµå®Œæ•´ï¼Œç¼ºå°‘å…³æ³¨ç³»ç»Ÿ |
| é€šä¿¡æ¶ˆæ¯æ¨¡å— | 70% | â­â­â­ | åŸºç¡€æ¶ˆæ¯åŠŸèƒ½ï¼ŒWebSocketéœ€ä¼˜åŒ– |
| ä¹¦åŸæ¨¡å— | 85% | â­â­â­â­ | æœç´¢æ¨èå®Œæ•´ï¼Œéœ€è¦æ€§èƒ½ä¼˜åŒ– |
| ç®¡ç†æ¨¡å— | 80% | â­â­â­â­ | åå°ç®¡ç†å®Œæ•´ï¼Œæƒé™ç³»ç»Ÿéœ€åŠ å¼º |
| è´¢åŠ¡æ¨¡å— | 75% | â­â­â­ | é’±åŒ…æ”¯ä»˜å®Œæ•´ï¼Œç¼ºå°‘å¯¹è´¦ç³»ç»Ÿ |
| AIæ¨¡å— | 80% | â­â­â­â­ | èŠå¤©åˆ›ä½œå®Œæ•´ï¼Œéœ€è¦ç¨³å®šæ€§æå‡ |

**æ•´ä½“å®Œæˆåº¦ï¼šçº¦80%**

### 1.2 æ¶æ„ä¼˜åŠ¿

1. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**
   - APIå±‚ â†’ Serviceå±‚ â†’ Repositoryå±‚ â†’ Modelå±‚
   - èŒè´£åˆ†ç¦»æ˜ç¡®ï¼Œæ˜“äºç»´æŠ¤

2. **è‰¯å¥½çš„æ¨¡å—åŒ–è®¾è®¡**
   - å„æ¨¡å—ç‹¬ç«‹æ€§å¼º
   - æ¥å£å®šä¹‰è§„èŒƒ
   - ä¾èµ–æ³¨å…¥å®ç°

3. **æŠ€æœ¯æ ˆç°ä»£åŒ–**
   - Go 1.18+ + Ginæ¡†æ¶
   - MongoDB + Redis
   - gRPCç”¨äºå¾®æœåŠ¡é€šä¿¡
   - LangChainç”¨äºAIåŠŸèƒ½

### 1.3 ä¸»è¦ä¸è¶³

1. **å·¥ç¨‹åŒ–å»ºè®¾ä¸è¶³**
   - ç¼ºå°‘ç»Ÿä¸€é”™è¯¯å¤„ç†
   - ç¼ºå°‘å®Œæ•´æµ‹è¯•è¦†ç›–
   - ç¼ºå°‘æ—¥å¿—ç³»ç»Ÿ
   - ç¼ºå°‘ç›‘æ§å‘Šè­¦

2. **æ–‡æ¡£å»ºè®¾ä¸å®Œæ•´**
   - APIæ–‡æ¡£ä¸å®Œæ•´
   - éƒ¨ç½²æ–‡æ¡£ç¼ºå¤±
   - å¼€å‘è§„èŒƒç¼ºå¤±

3. **æ€§èƒ½ä¼˜åŒ–ç©ºé—´**
   - ç¼“å­˜ç­–ç•¥ä¸ç»Ÿä¸€
   - æ•°æ®åº“ç´¢å¼•æœªä¼˜åŒ–
   - æŸ¥è¯¢æ€§èƒ½æœªæµ‹è¯•

4. **å®‰å…¨åŠ å›ºéœ€æ±‚**
   - æ•æ„Ÿä¿¡æ¯è„±æ•ä¸å®Œæ•´
   - APIé™æµç­–ç•¥éœ€å®Œå–„
   - å®‰å…¨å®¡è®¡ç¼ºå¤±

---

## äºŒã€æŠ€æœ¯å€ºåŠ¡æ¸…å•

### 2.1 é«˜ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡

| åºå· | é—®é¢˜ | å½±å“ | æ¨¡å— | å»ºè®®ä¼˜å…ˆçº§ |
|------|------|------|------|-----------|
| 1 | ç¼ºå°‘ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ | é«˜ | å…¨å±€ | P0 |
| 2 | æµ‹è¯•è¦†ç›–ç‡ä½äº30% | é«˜ | å…¨å±€ | P0 |
| 3 | ç¼ºå°‘ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ | é«˜ | å…¨å±€ | P0 |
| 4 | æ•æ„Ÿä¿¡æ¯æœªå®Œå…¨è„±æ• | é«˜ | è®¤è¯/è´¢åŠ¡ | P0 |
| 5 | ç¼ºå°‘APIé™æµç­–ç•¥ | é«˜ | å…¨å±€ | P0 |
| 6 | ç¼ºå°‘æ•°æ®åº“å¤‡ä»½ç­–ç•¥ | é«˜ | è¿ç»´ | P0 |
| 7 | ç¼ºå°‘ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ | é«˜ | è¿ç»´ | P0 |
| 8 | é…é¢ç®¡ç†ç¼ºå°‘åˆ†å¸ƒå¼é” | ä¸­ | AI/è´¢åŠ¡ | P0 |

### 2.2 ä¸­ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡

| åºå· | é—®é¢˜ | å½±å“ | æ¨¡å— | å»ºè®®ä¼˜å…ˆçº§ |
|------|------|------|------|-----------|
| 9 | APIæ–‡æ¡£ä¸å®Œæ•´ | ä¸­ | å…¨å±€ | P1 |
| 10 | ç¼ºå°‘æ•°æ®è¿ç§»å·¥å…· | ä¸­ | è¿ç»´ | P1 |
| 11 | ç¼ºå°‘æ€§èƒ½åŸºå‡†æµ‹è¯• | ä¸­ | å…¨å±€ | P1 |
| 12 | ç¼ºå°‘ä»£ç è´¨é‡æ£€æŸ¥å·¥å…· | ä¸­ | å·¥ç¨‹åŒ– | P1 |
| 13 | WebSocketè¿æ¥ç®¡ç†éœ€ä¼˜åŒ– | ä¸­ | é€šä¿¡ | P1 |
| 14 | æœç´¢åŠŸèƒ½éœ€è¦Elasticsearch | ä¸­ | ä¹¦åŸ | P1 |
| 15 | ç¼ºå°‘å®Œæ•´çš„å•å…ƒæµ‹è¯• | ä¸­ | å…¨å±€ | P1 |

### 2.3 ä½ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡

| åºå· | é—®é¢˜ | å½±å“ | æ¨¡å— | å»ºè®®ä¼˜å…ˆçº§ |
|------|------|------|------|-----------|
| 16 | ç¼ºå°‘ç¬¬ä¸‰æ–¹ç™»å½•æ”¯æŒ | ä½ | è®¤è¯ | P2 |
| 17 | ç¼ºå°‘æœ—è¯»åŠŸèƒ½ | ä½ | é˜…è¯»å™¨ | P2 |
| 18 | ç¼ºå°‘ç”¨æˆ·å…³æ³¨ç³»ç»Ÿ | ä½ | ç¤¾äº¤ | P2 |
| 19 | ç¼ºå°‘æ¨èç®—æ³•ä¼˜åŒ– | ä½ | ä¹¦åŸ | P2 |
| 20 | ç¼ºå°‘å›½é™…åŒ–æ”¯æŒ | ä½ | å…¨å±€ | P2 |

---

## ä¸‰ã€çŸ­æœŸæ”¹è¿›è®¡åˆ’ï¼ˆ1-3ä¸ªæœˆï¼‰

### 3.1 ç¬¬1ä¸ªæœˆï¼šåŸºç¡€è®¾æ–½å»ºè®¾

#### Week 1-2: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ

**ç›®æ ‡**ï¼šå»ºç«‹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—æœºåˆ¶

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç°ç»Ÿä¸€é”™è¯¯ç å®šä¹‰
  ```go
  // pkg/errors/codes.go
  type ErrorCode int

  const (
      Success         ErrorCode = 0
      InvalidParams   ErrorCode = 1001
      Unauthorized    ErrorCode = 1002
      NotFound        ErrorCode = 1003
      InternalError   ErrorCode = 5000
      // ...
  )
  ```

- [ ] å®ç°ç»Ÿä¸€é”™è¯¯å“åº”ä¸­é—´ä»¶
  ```go
  // pkg/middleware/error_handler.go
  func ErrorHandler() gin.HandlerFunc {
      return func(c *gin.Context) {
          c.Next()

          if len(c.Errors) > 0 {
              err := c.Errors.Last()
              // ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
              c.JSON(http.StatusOK, ErrorResponse{
                  Code:    GetErrorCode(err.Err),
                  Message: err.Error(),
                  Details: GetErrorDetails(err.Err),
              })
          }
      }
  }
  ```

- [ ] é›†æˆç»“æ„åŒ–æ—¥å¿—åº“ï¼ˆzap/logrusï¼‰
  ```go
  // pkg/logger/logger.go
  type Logger struct {
      *zap.Logger
  }

  func (l *Logger) WithRequest(req *http.Request) *Logger {
      return &Logger{l.Logger.With(
          zap.String("request_id", GetRequestID(req)),
          zap.String("method", req.Method),
          zap.String("path", req.URL.Path),
          zap.String("ip", GetClientIP(req)),
      )}
  }
  ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ‰€æœ‰APIè¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼
- æ‰€æœ‰å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•
- æ—¥å¿—åŒ…å«è¯·æ±‚IDã€ç”¨æˆ·IDç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯

#### Week 3-4: ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

**ç›®æ ‡**ï¼šå»ºç«‹åŸºç¡€ç›‘æ§èƒ½åŠ›

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] é›†æˆPrometheusç›‘æ§
  ```go
  // pkg/metrics/prometheus.go
  var (
      httpRequestsTotal = prometheus.NewCounterVec(
          prometheus.CounterOpts{
              Name: "http_requests_total",
              Help: "Total number of HTTP requests",
          },
          []string{"method", "endpoint", "status"},
      )

      httpRequestDuration = prometheus.NewHistogramVec(
          prometheus.HistogramOpts{
              Name:    "http_request_duration_seconds",
              Help:    "HTTP request duration in seconds",
              Buckets: prometheus.DefBuckets,
          },
          []string{"method", "endpoint"},
      )
  )
  ```

- [ ] å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹
  ```go
  // api/v1/system/health_api.go
  type HealthAPI struct {
      db    *mongo.Client
      redis *redis.Client
  }

  func (api *HealthAPI) GetHealth(c *gin.Context) {
      checks := map[string]string{
          "database": api.checkDatabase(),
          "redis":    api.checkRedis(),
          "disk":     api.checkDisk(),
      }

      c.JSON(http.StatusOK, checks)
  }
  ```

- [ ] é…ç½®Grafanaä»ªè¡¨ç›˜

**éªŒæ”¶æ ‡å‡†**ï¼š
- å¯ä»¥æŸ¥çœ‹APIè¯·æ±‚é‡ã€å»¶è¿Ÿã€é”™è¯¯ç‡
- å¯ä»¥æŸ¥çœ‹æ•°æ®åº“ã€Redisè¿æ¥çŠ¶æ€
- å…³é”®æŒ‡æ ‡å¼‚å¸¸æ—¶å‘é€å‘Šè­¦

### 3.2 ç¬¬2ä¸ªæœˆï¼šæµ‹è¯•å’Œæ–‡æ¡£

#### Week 5-6: å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

**ç›®æ ‡**ï¼šæå‡æµ‹è¯•è¦†ç›–ç‡åˆ°60%

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ç¼–å†™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å•å…ƒæµ‹è¯•
  ```go
  // service/auth/auth_service_test.go
  func TestAuthService_Login(t *testing.T) {
      tests := []struct {
          name    string
          request *LoginRequest
          wantErr bool
          errMsg  string
      }{
          {
              name: "æ­£å¸¸ç™»å½•",
              request: &LoginRequest{
                  Email:    "test@example.com",
                  Password: "password123",
              },
              wantErr: false,
          },
          // æ›´å¤šæµ‹è¯•ç”¨ä¾‹
      }

      for _, tt := range tests {
          t.Run(tt.name, func(t *testing.T) {
              got, err := service.Login(ctx, tt.request)
              if (err != nil) != tt.wantErr {
                  t.Errorf("Login() error = %v, wantErr %v", err, tt.wantErr)
              }
          })
      }
  }
  ```

- [ ] ç¼–å†™APIé›†æˆæµ‹è¯•
  ```go
  // tests/integration/api_test.go
  func TestBookAPI_GetBook(t *testing.T) {
      router := setupTestRouter()
      req := httptest.NewRequest("GET", "/api/v1/bookstore/books/123", nil)
      w := httptest.NewRecorder()

      router.ServeHTTP(w, req)

      assert.Equal(t, 200, w.Code)
      // æ›´å¤šæ–­è¨€
  }
  ```

- [ ] é…ç½®CI/CDè‡ªåŠ¨æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ ¸å¿ƒServiceå±‚æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°70%
- APIå±‚æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°50%
- CI/CDè‡ªåŠ¨è¿è¡Œæµ‹è¯•

#### Week 7-8: APIæ–‡æ¡£å’Œéƒ¨ç½²æ–‡æ¡£

**ç›®æ ‡**ï¼šå®Œå–„é¡¹ç›®æ–‡æ¡£

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ä½¿ç”¨Swaggerç”ŸæˆAPIæ–‡æ¡£
  ```go
  // @title é’ç¾½å†™ä½œå¹³å° API
  // @version 1.0
  // @description é’ç¾½å†™ä½œå¹³å°åç«¯APIæ–‡æ¡£
  // @host localhost:8080
  // @BasePath /api/v1
  func main() {
      // ...
  }
  ```

- [ ] ç¼–å†™éƒ¨ç½²æ–‡æ¡£
  ```markdown
  # éƒ¨ç½²æŒ‡å—

  ## ç¯å¢ƒè¦æ±‚
  - Go 1.18+
  - MongoDB 4.4+
  - Redis 6.0+

  ## éƒ¨ç½²æ­¥éª¤
  1. é…ç½®ç¯å¢ƒå˜é‡
  2. åˆå§‹åŒ–æ•°æ®åº“
  3. å¯åŠ¨æœåŠ¡
  4. é…ç½®Nginxåå‘ä»£ç†
  ```

- [ ] ç¼–å†™å¼€å‘è§„èŒƒæ–‡æ¡£
  ```markdown
  # å¼€å‘è§„èŒƒ

  ## ä»£ç é£æ ¼
  - ä½¿ç”¨gofmtæ ¼å¼åŒ–ä»£ç 
  - éµå¾ªGoç¤¾åŒºæœ€ä½³å®è·µ

  ## Gitæäº¤è§„èŒƒ
  - feat: æ–°åŠŸèƒ½
  - fix: ä¿®å¤bug
  - docs: æ–‡æ¡£æ›´æ–°
  ...
  ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- Swagger UIå¯è®¿é—®
- éƒ¨ç½²æ–‡æ¡£å¯æŒ‡å¯¼æ–°ç¯å¢ƒéƒ¨ç½²
- å¼€å‘è§„èŒƒè¢«å›¢é˜Ÿéµå¾ª

### 3.3 ç¬¬3ä¸ªæœˆï¼šæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›º

#### Week 9-10: æ€§èƒ½ä¼˜åŒ–

**ç›®æ ‡**ï¼šä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
  ```javascript
  // MongoDBç´¢å¼•ä¼˜åŒ–
  db.books.createIndex({status: 1, created_at: -1})
  db.books.createIndex({title: "text", introduction: "text"})
  db.books.createIndex({category_ids: 1, rating: -1})
  db.transactions.createIndex({user_id: 1, created_at: -1})
  ```

- [ ] Redisç¼“å­˜ç­–ç•¥ä¼˜åŒ–
  ```go
  // pkg/cache/strategy.go
  type CacheStrategy struct {
      HotData     CachePolicy // çƒ­ç‚¹æ•°æ®ï¼š1å°æ—¶
      NormalData  CachePolicy // æ™®é€šæ•°æ®ï¼š5åˆ†é’Ÿ
      UserData    CachePolicy // ç”¨æˆ·æ•°æ®ï¼š30åˆ†é’Ÿ
  }

  func (s *CacheStrategy) GetPolicy(key string) CachePolicy {
      // æ ¹æ®æ•°æ®ç±»å‹è¿”å›ç¼“å­˜ç­–ç•¥
  }
  ```

- [ ] APIå“åº”æ—¶é—´ä¼˜åŒ–
  - ä½¿ç”¨è¿æ¥æ± 
  - æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
  - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**ï¼š
- APIå¹³å‡å“åº”æ—¶é—´ < 200ms
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ç‡æå‡50%
- ç¼“å­˜å‘½ä¸­ç‡ > 80%

#### Week 11-12: å®‰å…¨åŠ å›º

**ç›®æ ‡**ï¼šæå‡ç³»ç»Ÿå®‰å…¨æ€§

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç°APIé™æµç­–ç•¥
  ```go
  // pkg/middleware/rate_limit.go
  func RateLimitMiddleware() gin.HandlerFunc {
      limiter := rate.NewLimiter(10, 100) // æ¯ç§’10ä¸ªè¯·æ±‚ï¼Œæ¡¶å®¹é‡100

      return func(c *gin.Context) {
          if !limiter.Allow() {
              c.JSON(429, gin.H{"error": "è¯·æ±‚è¿‡äºé¢‘ç¹"})
              c.Abort()
              return
          }
          c.Next()
      }
  }
  ```

- [ ] æ•æ„Ÿä¿¡æ¯è„±æ•
  ```go
  // pkg/utils/sanitizer.go
  func SanitizeUser(user *User) *User {
      return &User{
          ID:       user.ID,
          Username: user.Username,
          Email:    maskEmail(user.Email),
          Phone:    maskPhone(user.Phone),
          // ä¸è¿”å›å¯†ç ã€tokenç­‰æ•æ„Ÿä¿¡æ¯
      }
  }
  ```

- [ ] å®‰å…¨å®¡è®¡æ—¥å¿—
  ```go
  // pkg/audit/logger.go
  type AuditLogger struct {
      logger *zap.Logger
  }

  func (a *AuditLogger) LogSensitiveAction(ctx context.Context, action string, details map[string]interface{}) {
      a.logger.Info("sensitive_action",
          zap.String("action", action),
          zap.String("user_id", GetUserID(ctx)),
          zap.String("ip", GetClientIP(ctx)),
          zap.Any("details", details),
      )
  }
  ```

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯éƒ½å·²è„±æ•
- APIé™æµç­–ç•¥ç”Ÿæ•ˆ
- å…³é”®æ“ä½œéƒ½æœ‰å®¡è®¡æ—¥å¿—

---

## å››ã€ä¸­æœŸä¼˜åŒ–è®¡åˆ’ï¼ˆ3-6ä¸ªæœˆï¼‰

### 4.1 åŠŸèƒ½å®Œå–„

#### ç¤¾äº¤æ¨¡å—å¢å¼º

**ç”¨æˆ·å…³ç³»ç³»ç»Ÿ**
```go
// models/social/user_relation.go
type UserRelation struct {
    ID          primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    FollowerID  primitive.ObjectID `bson:"follower_id" json:"followerId"`   // å…³æ³¨è€…
    FolloweeID  primitive.ObjectID `bson:"followee_id" json:"followeeId"`   // è¢«å…³æ³¨è€…
    RelationType RelationType      `bson:"relation_type" json:"relationType"` // follow/friend/block
    CreatedAt   time.Time          `bson:"created_at" json:"createdAt"`
}

type RelationType string

const (
    RelationTypeFollow RelationType = "follow" // å…³æ³¨
    RelationTypeFriend RelationType = "friend" // å¥½å‹
    RelationTypeBlock  RelationType = "block"  // æ‹‰é»‘
)
```

**åŠ¨æ€ä¿¡æ¯æµ**
```go
// models/social/feed.go
type FeedItem struct {
    ID         primitive.ObjectID `bson:"_id,omitempty" json:"id"`
    UserID     primitive.ObjectID `bson:"user_id" json:"userId"`
    ActionType ActionType         `bson:"action_type" json:"actionType"` // publish/review/like/share
    TargetType string             `bson:"target_type" json:"targetType"`
    TargetID   primitive.ObjectID `bson:"target_id" json:"targetId"`
    Content    string             `bson:"content,omitempty" json:"content,omitempty"`
    CreatedAt  time.Time          `bson:"created_at" json:"createdAt"`
}
```

#### é˜…è¯»å™¨æ¨¡å—å¢å¼º

**æœ—è¯»åŠŸèƒ½**
```go
// service/reader/tts_service.go
type TTSService interface {
    TextToSpeech(ctx, text, voice string) ([]byte, error)
    GetAvailableVoices() []Voice
    GetSpeechProgress(userID string) (*SpeechProgress, error)
}

type Voice struct {
    ID       string `json:"id"`
    Name     string `json:"name"`
    Language string `json:"language"`
    Gender   string `json:"gender"` // male/female
}
```

**é˜…è¯»ç»Ÿè®¡å¢å¼º**
```go
type AdvancedReadingStats struct {
    // æ—¶é—´ç»Ÿè®¡
    ReadingStreak     int       `json:"readingStreak"`      // è¿ç»­é˜…è¯»å¤©æ•°
    LongestStreak     int       `json:"longestStreak"`      // æœ€é•¿è¿ç»­å¤©æ•°
    TotalReadingDays  int       `json:"totalReadingDays"`   // æ€»é˜…è¯»å¤©æ•°

    // ä¹ æƒ¯åˆ†æ
    PeakReadingTime   string    `json:"peakReadingTime"`    // æœ€ä½³é˜…è¯»æ—¶æ®µ
    AverageSpeed      float64   `json:"averageSpeed"`       // å¹³å‡é˜…è¯»é€Ÿåº¦ï¼ˆå­—/åˆ†é’Ÿï¼‰
    CompletionRate    float64   `json:"completionRate"`     // å®Œç»“ç‡

    // åå¥½åˆ†æ
    FavoriteGenres    []string  `json:"favoriteGenres"`     // å–œçˆ±çš„ç±»å‹
    FavoriteAuthors   []string  `json:"favoriteAuthors"`    // å–œçˆ±çš„ä½œè€…
    ReadingPattern    string    `json:"readingPattern"`     // é˜…è¯»æ¨¡å¼
}
```

#### è®¤è¯æ¨¡å—å¢å¼º

**ç¬¬ä¸‰æ–¹ç™»å½•**
```go
// service/auth/oauth_service.go
type OAuthProvider string

const (
    OAuthGoogle   OAuthProvider = "google"
    OAuthGitHub   OAuthProvider = "github"
    OAuthWeChat   OAuthProvider = "wechat"
    OAuthQQ       OAuthProvider = "qq"
)

type OAuthService interface {
    GetAuthURL(provider OAuthProvider, state string) (string, error)
    ExchangeToken(provider OAuthProvider, code string) (*OAuthToken, error)
    GetUserInfo(provider OAuthProvider, token string) (*OAuthUserInfo, error)
    LinkAccount(userID string, provider OAuthProvider, oauthID string) error
}
```

### 4.2 æŠ€æœ¯å‡çº§

#### æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ

**ä½¿ç”¨RabbitMQ/Kafkaå¤„ç†å¼‚æ­¥ä»»åŠ¡**
```go
// pkg/queue/publisher.go
type MessageQueue interface {
    Publish(ctx, topic string, message interface{}) error
    Subscribe(topic string, handler func([]byte) error) error
}

// ä½¿ç”¨åœºæ™¯
// 1. å‘é€é‚®ä»¶é€šçŸ¥
queue.Publish("email.notification", EmailMessage{
    To:      user.Email,
    Subject: "æ¬¢è¿æ³¨å†Œé’ç¾½å†™ä½œå¹³å°",
    Body:    "...",
})

// 2. å¤„ç†æç°è¯·æ±‚
queue.Publish("withdraw.request", WithdrawMessage{
    UserID: userID,
    Amount: amount,
})

// 3. ç”Ÿæˆæ¨èç»“æœ
queue.Publish("recommendation.update", RecommendationMessage{
    UserID: userID,
})
```

#### å…¨æ–‡æœç´¢å‡çº§

**é›†æˆElasticsearch**
```go
// service/search/elasticsearch_service.go
type SearchService interface {
    IndexBook(ctx, book *Book) error
    SearchBooks(ctx, query string, filters SearchFilter) (*SearchResult, error)
    SuggestBooks(ctx, prefix string) ([]string, error)
}

type SearchFilter struct {
    Categories []string
    Tags       []string
    Status     string
    MinRating  float64
    MaxPrice   float64
}
```

### 4.3 è¿ç»´å¢å¼º

#### æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤

**è‡ªåŠ¨åŒ–å¤‡ä»½ç­–ç•¥**
```bash
#!/bin/bash
# scripts/backup.sh

# MongoDBå¤‡ä»½
mongodump --uri="mongodb://localhost:27017/qingyu" --out=/backup/mongodb/$(date +%Y%m%d)

# Rediså¤‡ä»½
redis-cli --rdb /backup/redis/$(date +%Y%m%d).rdb

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨
aws s3 sync /backup/ s3://qingyu-backup/$(date +%Y%m%d)/

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find /backup/ -mtime +30 -delete
```

#### å®¹å™¨åŒ–éƒ¨ç½²

**Dockerå’ŒDocker Compose**
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - MONGODB_URI=mongodb://mongo:27017/qingyu
      - REDIS_ADDR=redis:6379
    depends_on:
      - mongo
      - redis

  mongo:
    image: mongo:4.4
    volumes:
      - mongo_data:/data/db

  redis:
    image: redis:6.2
    volumes:
      - redis_data:/data

volumes:
  mongo_data:
  redis_data:
```

---

## äº”ã€é•¿æœŸå‘å±•è§„åˆ’ï¼ˆ6-12ä¸ªæœˆï¼‰

### 5.1 å¾®æœåŠ¡åŒ–æ”¹é€ 

**æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ**

```
ç°æœ‰å•ä½“åº”ç”¨
    â†“
æ‹†åˆ†ä¸ºä»¥ä¸‹å¾®æœåŠ¡ï¼š

1. ç”¨æˆ·æœåŠ¡ (user-service)
   - ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
   - æƒé™ç®¡ç†

2. å†…å®¹æœåŠ¡ (content-service)
   - ä¹¦ç±/ç« èŠ‚ç®¡ç†
   - é¡¹ç›®ç®¡ç†
   - æ–‡æ¡£ç¼–è¾‘

3. ç¤¾äº¤æœåŠ¡ (social-service)
   - è¯„è®º/ç‚¹èµ/æ”¶è—
   - ç”¨æˆ·å…³ç³»
   - åŠ¨æ€ä¿¡æ¯æµ

4. æ¶ˆæ¯æœåŠ¡ (message-service)
   - ç§ä¿¡å¯¹è¯
   - ç³»ç»Ÿé€šçŸ¥
   - WebSocketè¿æ¥

5. æ”¯ä»˜æœåŠ¡ (payment-service)
   - é’±åŒ…ç®¡ç†
   - å……å€¼/æç°
   - æ”¶å…¥ç»“ç®—

6. AIæœåŠ¡ (ai-service)
   - AIèŠå¤©
   - åˆ›æ„å†™ä½œ
   - é…é¢ç®¡ç†

7. æœç´¢æœåŠ¡ (search-service)
   - å…¨æ–‡æœç´¢
   - æ¨èç®—æ³•
   - æ•°æ®åˆ†æ

8. ç½‘å…³æœåŠ¡ (gateway-service)
   - APIè·¯ç”±
   - è´Ÿè½½å‡è¡¡
   - é™æµç†”æ–­
```

**å¾®æœåŠ¡é€šä¿¡**
```go
// ä½¿ç”¨gRPCè¿›è¡ŒæœåŠ¡é—´é€šä¿¡
// proto/user.proto
syntax = "proto3";

package user;

service UserService {
    rpc GetUser(GetUserRequest) returns (UserResponse);
    rpc UpdateUser(UpdateUserRequest) returns (UserResponse);
    rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
}

message GetUserRequest {
    string user_id = 1;
}

message UserResponse {
    string user_id = 1;
    string username = 2;
    string email = 3;
    // ...
}
```

### 5.2 å¤§æ•°æ®å’Œåˆ†æ

**æ•°æ®åˆ†æå¹³å°**
```go
// service/analytics/analytics_service.go
type AnalyticsService interface {
    // ç”¨æˆ·åˆ†æ
    GetUserBehavior(userID string) (*UserBehavior, error)
    GetUserRetention(dateRange DateRange) (*RetentionData, error)

    // å†…å®¹åˆ†æ
    GetPopularContent(dateRange DateRange) (*PopularContent, error)
    GetContentTrends(contentID string) (*TrendData, error)

    // æ”¶å…¥åˆ†æ
    GetRevenue(dateRange DateRange) (*RevenueData, error)
    GetRevenueByCategory(dateRange DateRange) (*CategoryRevenue, error)
}

type UserBehavior struct {
    LoginFrequency    int                `json:"loginFrequency"`
    ReadingTime       int64              `json:"readingTime"`
    WritingTime       int64              `json:"writingTime"`
    PreferredGenres   []string           `json:"preferredGenres"`
    ActiveHours       []int              `json:"activeHours"` // æ´»è·ƒæ—¶æ®µ
    DeviceTypes       map[string]int64   `json:"deviceTypes"`
}
```

**å®æ—¶æ•°æ®æµå¤„ç†**
```go
// ä½¿ç”¨Apache Flinkæˆ–Kafka Streams
// å®æ—¶ç»Ÿè®¡çƒ­é—¨ä¹¦ç±ã€ç”¨æˆ·æ´»è·ƒåº¦ç­‰æŒ‡æ ‡
type RealTimeProcessor interface {
    ProcessReadEvent(event ReadEvent)
    ProcessLikeEvent(event LikeEvent)
    ProcessCommentEvent(event CommentEvent)
    GetRealTimeRanking() (*RankingData, error)
}
```

### 5.3 å›½é™…åŒ–æ”¯æŒ

**å¤šè¯­è¨€æ”¯æŒ**
```go
// pkg/i18n/translator.go
type Translator interface {
    Translate(key string, lang string) string
    TranslateWithParams(key string, lang string, params map[string]interface{}) string
    SupportedLanguages() []string
}

// ä½¿ç”¨ç¤ºä¾‹
msg := translator.Translate("welcome", "zh-CN")
// æ¬¢è¿

msg = translator.Translate("welcome", "en-US")
// Welcome
```

**å¤šæ—¶åŒºæ”¯æŒ**
```go
// pkg/timezone/timezone.go
type TimezoneManager interface {
    ConvertToUserTime(t time.Time, timezone string) time.Time
    GetUserTimezone(userID string) (string, error)
    SetUserTimezone(userID, timezone string) error
}
```

### 5.4 ç§»åŠ¨ç«¯ä¼˜åŒ–

**ç§»åŠ¨ç«¯APIä¼˜åŒ–**
```go
// ç§»åŠ¨ç«¯ä¸“ç”¨API
// api/v1/mobile/book_api.go
type MobileBookAPI struct {
    optimizedService *MobileOptimizedService
}

// è¿”å›æ›´å°‘çš„æ•°æ®ï¼Œä¼˜åŒ–æµé‡
func (api *MobileBookAPI) GetMobileBookList(c *gin.Context) {
    books := api.optimizedService.GetCompactBooks() // åªè¿”å›å¿…è¦å­—æ®µ
    c.JSON(200, books)
}
```

**ç¦»çº¿æ”¯æŒ**
```go
// æä¾›ç¦»çº¿é˜…è¯»çš„æ•°æ®åŒ…
func (api *BookAPI) GetOfflinePack(c *gin.Context) {
    bookID := c.Param("bookId")

    pack := &OfflinePack{
        BookInfo:     book.GetBasicInfo(),
        Chapters:     book.GetChapters(),
        Resources:    book.GetResources(), // å›¾ç‰‡ã€å­—ä½“ç­‰
        LastModified: time.Now(),
    }

    c.Header("Content-Type", "application/octet-stream")
    c.Header("Content-Disposition", "attachment; filename=book.zip")
    c.Data(200, "application/zip", pack.ToZip())
}
```

### 5.5 AIèƒ½åŠ›å¢å¼º

**å¤šæ¨¡å‹æ”¯æŒ**
```go
// service/ai/model_manager.go
type ModelManager interface {
    GetAvailableModels() []Model
    SelectModel(task TaskType) (Model, error)
    EstimateCost(model Model, tokens int) (float64, error)
}

type Model struct {
    ID          string  `json:"id"`
    Name        string  `json:"name"`
    Provider    string  `json:"provider"` // openai/anthropic/google
    TaskTypes   []TaskType `json:"taskTypes"`
    CostPer1K   float64 `json:"costPer1K"`
    MaxTokens   int     `json:"maxTokens"`
}

type TaskType string

const (
    TaskTypeChat       TaskType = "chat"
    TaskTypeWriting    TaskType = "writing"
    TaskTypeTranslate  TaskType = "translate"
    TaskTypeSummarize  TaskType = "summarize"
)
```

**ä¸ªæ€§åŒ–AIåŠ©æ‰‹**
```go
// åŸºäºç”¨æˆ·å†å²æ•°æ®è®­ç»ƒä¸ªæ€§åŒ–æ¨¡å‹
type PersonalizedAI struct {
    BaseModel    string  `json:"baseModel"`
    UserID       string  `json:"userId"`
    TrainingData []TrainingSample `json:"trainingData"`
    LastTrained  time.Time `json:"lastTrained"`
}

func (p *PersonalizedAI) Generate(content string) (string, error) {
    // ä½¿ç”¨ä¸ªæ€§åŒ–æ¨¡å‹ç”Ÿæˆå†…å®¹
}
```

---

## å…­ã€å®æ–½å»ºè®®

### 6.1 ä¼˜å…ˆçº§çŸ©é˜µ

æ ¹æ®**å½±å“**å’Œ**ç´§æ€¥ç¨‹åº¦**å¯¹ä»»åŠ¡è¿›è¡Œåˆ†ç±»ï¼š

| | é«˜å½±å“ | ä¸­å½±å“ | ä½å½±å“ |
|---|--------|--------|--------|
| **ç´§æ€¥** | é”™è¯¯å¤„ç†ã€æ—¥å¿—ã€ç›‘æ§ã€å®‰å…¨åŠ å›º | APIé™æµã€æ•°æ®å¤‡ä»½ | æ–‡æ¡£å®Œå–„ |
| **ä¸ç´§æ€¥** | æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•è¦†ç›– | åŠŸèƒ½å¢å¼ºã€æœç´¢å‡çº§ | å›½é™…åŒ–ã€ç§»åŠ¨ç«¯ä¼˜åŒ– |

### 6.2 èµ„æºéœ€æ±‚

**äººåŠ›èµ„æº**
- åç«¯å¼€å‘ï¼š2-3äºº
- å‰ç«¯å¼€å‘ï¼š1-2äºº
- è¿ç»´å·¥ç¨‹å¸ˆï¼š1äºº
- æµ‹è¯•å·¥ç¨‹å¸ˆï¼š1äººï¼ˆå¯å…¼èŒï¼‰

**æŠ€æœ¯æ ˆ**
- å¼€å‘ï¼šGo 1.18+, MongoDB, Redis, Python 3.9+
- å·¥å…·ï¼šDocker, Git, CI/CD
- ç›‘æ§ï¼šPrometheus, Grafana
- æµ‹è¯•ï¼šGo test, Postman

### 6.3 é£é™©æ§åˆ¶

**æŠ€æœ¯é£é™©**
- å¾®æœåŠ¡åŒ–æ”¹é€ å¯èƒ½å¸¦æ¥ç³»ç»Ÿä¸ç¨³å®š
  - **ç¼“è§£æªæ–½**ï¼šæ¸è¿›å¼æ”¹é€ ï¼Œä¿ç•™å›é€€æ–¹æ¡ˆ

- æ–°æŠ€æœ¯å¼•å…¥å¯èƒ½å¢åŠ å­¦ä¹ æˆæœ¬
  - **ç¼“è§£æªæ–½**ï¼šæŠ€æœ¯é¢„ç ”ã€å›¢é˜ŸåŸ¹è®­

**ä¸šåŠ¡é£é™©**
- åŠŸèƒ½æ›´æ–°å¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒ
  - **ç¼“è§£æªæ–½**ï¼šç°åº¦å‘å¸ƒã€ç”¨æˆ·åé¦ˆæ”¶é›†

### 6.4 æˆåŠŸæŒ‡æ ‡

**æŠ€æœ¯æŒ‡æ ‡**
- æµ‹è¯•è¦†ç›–ç‡ï¼š30% â†’ 60% â†’ 80%
- APIå“åº”æ—¶é—´ï¼š< 500ms â†’ < 200ms â†’ < 100ms
- ç³»ç»Ÿå¯ç”¨æ€§ï¼š99% â†’ 99.5% â†’ 99.9%

**ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·æ´»è·ƒåº¦æå‡20%
- å†…å®¹å‘å¸ƒé‡æå‡30%
- ç”¨æˆ·ç•™å­˜ç‡æå‡15%

---

## ä¸ƒã€æ€»ç»“

é’ç¾½å†™ä½œå¹³å°åç«¯é¡¹ç›®å·²ç»å…·å¤‡äº†è‰¯å¥½çš„åŸºç¡€æ¶æ„å’Œæ ¸å¿ƒåŠŸèƒ½ï¼Œä½†åœ¨å·¥ç¨‹åŒ–å»ºè®¾ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨åŠ å›ºç­‰æ–¹é¢è¿˜æœ‰æå‡ç©ºé—´ã€‚

é€šè¿‡æœ¬è§„åˆ’æ–‡æ¡£çš„å®æ–½ï¼Œé¢„è®¡åœ¨12ä¸ªæœˆå†…ï¼š

1. **çŸ­æœŸï¼ˆ1-3ä¸ªæœˆï¼‰**ï¼šå®ŒæˆåŸºç¡€è®¾æ–½å»ºè®¾ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§
2. **ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰**ï¼šå®Œå–„åŠŸèƒ½æ¨¡å—ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
3. **é•¿æœŸï¼ˆ6-12ä¸ªæœˆï¼‰**ï¼šå®ç°å¾®æœåŠ¡åŒ–ï¼Œæ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·å’Œé«˜å¹¶å‘è®¿é—®

å»ºè®®æŒ‰ç…§ä¼˜å…ˆçº§çŸ©é˜µé€æ­¥å®æ–½ï¼Œå…ˆè§£å†³é«˜ä¼˜å…ˆçº§æŠ€æœ¯å€ºåŠ¡ï¼Œå†è¿›è¡ŒåŠŸèƒ½å¢å¼ºå’ŒæŠ€æœ¯å‡çº§ã€‚

---

## é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [Goæœ€ä½³å®è·µ](https://go.dev/doc/effective_go)
- [MongoDBæ€§èƒ½ä¼˜åŒ–](https://www.mongodb.com/docs/manual/administration/analyzing-mongodb-performance/)
- [å¾®æœåŠ¡æ¶æ„æ¨¡å¼](https://microservices.io/patterns/microservices.html)
- [LangChainæ–‡æ¡£](https://python.langchain.com/docs/)

### B. è”ç³»æ–¹å¼

å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

### C. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| v1.0 | 2026-01-02 | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2026-01-02 | å®Œæˆæ‰€æœ‰P0çº§åˆ«æŠ€æœ¯å€ºåŠ¡ï¼›æ·»åŠ å®æ–½è¿›å±•ç« èŠ‚ |
| v1.2 | 2026-01-06 | å®ŒæˆP0ä¸­é—´ä»¶é›†æˆå’ŒAPIé”™è¯¯å¤„ç†æ‰¹é‡é‡æ„ï¼›æ·»åŠ æœ€æ–°è¿›å±•ç« èŠ‚ |
