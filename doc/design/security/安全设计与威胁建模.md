# 安全设计与威胁建模

定义系统在身份认证、访问控制、输入校验、数据保护、运维安全与供应链安全等方面的策略，并以威胁模型指导落地与验证。

## 1. 目标与范围

- 保护用户与项目数据的机密性、完整性与可用性
- 降低被恶意滥用、越权访问、数据泄露与供应链风险
- 覆盖 API、服务端、数据库与外部 AI 提供商调用

## 2. 威胁建模方法

- 方法：STRIDE（伪造、篡改、抵赖、信息泄露、拒绝服务、权限提升）
- 资产：账号凭据、JWT 秘钥、用户/项目/文档数据、AI 调用配额与密钥
- 信任边界：客户端 ↔ 网关/路由 ↔ API ↔ Service ↔ DB/外部服务
- 攻击面：认证与会话、输入参数、批量接口、AI 外部调用、日志与备份

## 3. 身份认证与会话安全

- JWT：HS/RS 签名；短期 Access Token + 刷新机制；秘钥轮换与吊销策略
- 传输：Authorization: `Bearer <token>`；HTTPS 强制；服务端不落盘敏感 token
- 刷新与吊销：刷新令牌一次性/轮换；服务端维护黑名单/版本号（可选）
- 最小化声明：JWT 仅包含必要声明（sub/user_id、exp、iat、scope）

## 4. 访问控制

- 授权模型：RBAC/项目级 ACL（owner、member、viewer 预留）
- 资源校验：以 project_id/node_id 为边界做服务层授权校验
- 多租户隔离：按 owner_id/项目维度建立查询与索引，避免越权枚举

## 5. 输入校验与抗刷

- 输入验证：类型/范围/长度/格式；拒绝危险运算符（如 MongoDB 注入）
- 速率限制：IP 与用户双维度限流；认证接口叠加验证码/失败退避
- 幂等与重放：对写操作使用幂等键/版本号；时间戳+签名（可选）

## 6. 数据与日志安全

- 数据加密：敏感字段加盐哈希/加密存储（如密码、密钥）；最小字段暴露
- 日志脱敏：对 email/token/phone 等做掩码；错误日志不含敏感明文
- 备份安全：备份介质加密，访问审计与轮换；恢复演练

## 7. 配置与密钥管理

- 秘钥来源：环境变量/密钥管理服务（不进入代码仓库）
- 轮换策略：JWT 秘钥、AI Provider Key 定期轮换；灰度发布与回滚
- 最小权限：数据库账号按最小权限授权，区分读写/只读（如有）

## 8. 供应链与依赖安全

- 依赖审计：启用 SCA/漏洞扫描；最小化依赖；及时升级补丁
- 构建可信：锁定 go.mod/go.sum；CI 校验依赖签名与哈希

## 9. 可观测与审计

- 审计日志：登录、权限变更、敏感操作留痕并聚合存储
- 监控与告警：结合《日志与监控》中的指标阈值，异常行为告警

## 10. 安全测试

- 覆盖：鉴权/越权、注入、暴力破解、敏感信息泄露、限流绕过
- 方法：单测+集成测试+扫描器（SAST/DAST）+模糊测试

## 11. 关联文档

- 软件需求规格说明书(SRS) ./软件需求规格说明书(SRS).md
- 架构设计说明书 ./架构设计说明书.md
- 数据库设计说明书 ./数据库设计说明书.md
- API 接口总览 ./API接口总览.md
- 测试计划与用例 ./测试计划与用例.md
- 部署与运维指南 ./部署与运维指南.md
- 日志与监控 ./日志与监控.md
- 需求追踪矩阵 ./需求追踪矩阵.md
- JWT 身份认证设计 ./功能设计/JWT身份认证设计.md
- 管理后台设计 ./功能设计/管理后台设计.md
