# 关注系统详细设计

> **模块**: 04 - 社交互动
> **功能**: 关注系统
> **完成度**: 🟢 85%

## 📋 概述

关注系统允许用户关注感兴趣的作者，查看关注列表和粉丝列表，接收关注对象的动态通知。

## 🎯 核心功能

### 1. 基础关注功能

- **关注用户**: 关注其他用户（作者）
- **取消关注**: 取消关注
- **相互关注**: 显示相互关注状态

### 2. 关注列表

- **关注列表**: 查看我的关注列表
- **粉丝列表**: 查看我的粉丝列表
- **好友列表**: 相互关注的用户列表

### 3. 关注推荐

- **推荐作者**: 推荐可能感兴趣的作者
- **好友推荐**: 推荐可能认识的人

### 4. 关注通知

- **新粉丝通知**: 有人关注时通知
- **关注动态**: 关注对象的动态通知

## 📊 数据模型

### Follow (关注关系)

```go
type Follow struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    FollowerID      primitive.ObjectID   `bson:"follower_id" json:"followerId"`     // 关注者
    FollowingID     primitive.ObjectID   `bson:"following_id" json:"followingId"`   // 被关注者
    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`

    // 联合唯一索引：followerID + followingID
}
```

### FollowerStats (关注统计)

```go
type FollowerStats struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    UserID          primitive.ObjectID   `bson:"user_id" json:"userId"`
    FollowerCount   int                  `bson:"follower_count" json:"followerCount"`   // 粉丝数
    FollowingCount  int                  `bson:"following_count" json:"followingCount"` // 关注数
    UpdatedAt       time.Time            `bson:"updated_at" json:"updatedAt"`

    // 唯一索引：userID
}
```

## 🌐 API端点

### 关注操作

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| POST | /api/v1/social/follow/:userId | 关注用户 | 是 |
| DELETE | /api/v1/social/follow/:userId | 取消关注 | 是 |

### 关注列表

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/social/following/:userId | 获取关注列表 | 否 |
| GET | /api/v1/social/followers/:userId | 获取粉丝列表 | 否 |
| GET | /api/v1/social/friends/:userId | 获取好友列表（相互关注） | 否 |

### 关注状态

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/social/follow/status/:userId | 查询关注状态 | 是 |
| POST | /api/v1/social/follow/status/batch | 批量查询关注状态 | 是 |

### 关注推荐

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| GET | /api/v1/social/follow/recommendations | 获取推荐关注 | 是 |

## 🔄 核心流程

### 关注流程

```
1. 用户点击关注按钮
   ↓
2. 前端调用API
   ↓
3. 后端检查是否已关注
   ↓
4. 如果未关注，创建关注记录
   ↓
5. 更新关注统计
   ↓
6. 发送通知（给被关注用户）
   ↓
7. 返回结果
```

### 取消关注流程

```
1. 用户点击取消关注
   ↓
2. 前端调用API
   ↓
3. 后端删除关注记录
   ↓
4. 更新关注统计
   ↓
5. 返回结果
```

## 🔧 业务规则

### 关注规则

- 不能关注自己
- 不能重复关注同一用户
- 关注后可以取消关注

### 关注推荐规则

- 推荐热门作者
- 推荐相似兴趣的作者
- 推荐可能认识的人（基于共同关注）

## 📈 性能优化

### 缓存策略

- Redis缓存关注状态
- Redis缓存关注统计
- 缓存热门作者列表

### 数据库优化

- 关注表联合唯一索引：followerID + followingID
- 统计表唯一索引：userID
- 分页查询优化

## 📊 监控指标

- 关注总量（日/周/月）
- 人均关注数
- 关注转化率
- 关注取消率

---

**文档维护**: 青羽后端架构团队
**最后更新**: 2025-01-06
