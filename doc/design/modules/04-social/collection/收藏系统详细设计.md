# æ”¶è—ç³»ç»Ÿè¯¦ç»†è®¾è®¡

> **æ¨¡å—**: 04 - ç¤¾äº¤äº’åŠ¨
> **åŠŸèƒ½**: æ”¶è—ç³»ç»Ÿ
> **å®Œæˆåº¦**: ğŸŸ¢ 85%

## ğŸ“‹ æ¦‚è¿°

æ”¶è—ç³»ç»Ÿå…è®¸ç”¨æˆ·æ”¶è—ä¹¦ç±ã€ç« èŠ‚ç­‰å†…å®¹ï¼Œæ”¯æŒæ”¶è—å¤¹ç®¡ç†ã€æ”¶è—åˆ†ç±»ã€æ”¶è—åˆ†äº«ç­‰åŠŸèƒ½ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. åŸºç¡€æ”¶è—åŠŸèƒ½

- **æ”¶è—å†…å®¹**: æ”¶è—ä¹¦ç±ã€ç« èŠ‚ç­‰
- **å–æ¶ˆæ”¶è—**: å–æ¶ˆå·²æ”¶è—çš„å†…å®¹
- **æ”¶è—çŠ¶æ€**: æŸ¥è¯¢æ”¶è—çŠ¶æ€

### 2. æ”¶è—å¤¹ç®¡ç†

- **åˆ›å»ºæ”¶è—å¤¹**: åˆ›å»ºè‡ªå®šä¹‰æ”¶è—å¤¹
- **ç¼–è¾‘æ”¶è—å¤¹**: ä¿®æ”¹æ”¶è—å¤¹åç§°ã€æè¿°
- **åˆ é™¤æ”¶è—å¤¹**: åˆ é™¤æ”¶è—å¤¹ï¼ˆå†…å®¹ä¸åˆ é™¤ï¼‰
- **é»˜è®¤æ”¶è—å¤¹**: æ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ªé»˜è®¤æ”¶è—å¤¹

### 3. æ”¶è—åˆ†ç±»

- **æ ‡ç­¾åˆ†ç±»**: ä¸ºæ”¶è—æ·»åŠ æ ‡ç­¾
- **æŒ‰æ ‡ç­¾ç­›é€‰**: æŒ‰æ ‡ç­¾ç­›é€‰æ”¶è—

### 4. æ”¶è—åˆ†äº«

- **å…¬å¼€æ”¶è—**: è®¾ç½®æ”¶è—ä¸ºå…¬å¼€
- **åˆ†äº«æ”¶è—**: ç”Ÿæˆåˆ†äº«é“¾æ¥
- **æŸ¥çœ‹å…¬å¼€æ”¶è—**: æŸ¥çœ‹ä»–äººçš„å…¬å¼€æ”¶è—

## ğŸ“Š æ•°æ®æ¨¡å‹

### Collection (æ”¶è—è®°å½•)

```go
type Collection struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    UserID          primitive.ObjectID   `bson:"user_id" json:"userId"`
    TargetType      TargetType          `bson:"target_type" json:"targetType"`
    TargetID        primitive.ObjectID   `bson:"target_id" json:"targetId"`
    FolderID        *primitive.ObjectID  `bson:"folder_id,omitempty" json:"folderId,omitempty"` // æ”¶è—å¤¹IDï¼ˆå¯é€‰ï¼‰
    Tags            []string             `bson:"tags,omitempty" json:"tags,omitempty"`             // æ ‡ç­¾
    Note            string               `bson:"note,omitempty" json:"note,omitempty"`             // å¤‡æ³¨
    IsPublic        bool                 `bson:"is_public" json:"isPublic"`                       // æ˜¯å¦å…¬å¼€
    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`

    // è”åˆå”¯ä¸€ç´¢å¼•ï¼šuserID + targetType + targetID
}

type TargetType string
const (
    TargetTypeBook      TargetType = "book"
    TargetTypeChapter   TargetType = "chapter"
    TargetTypeReview    TargetType = "review"
)
```

### CollectionFolder (æ”¶è—å¤¹)

```go
type CollectionFolder struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    UserID          primitive.ObjectID   `bson:"user_id" json:"userId"`
    Name            string               `bson:"name" json:"name"`
    Description     string               `bson:"description,omitempty" json:"description,omitempty"`
    Icon            string               `bson:"icon,omitempty" json:"icon,omitempty"`
    IsDefault       bool                 `bson:"is_default" json:"isDefault"`     // æ˜¯å¦é»˜è®¤æ”¶è—å¤¹
    SortOrder       int                  `bson:"sort_order" json:"sortOrder"`      // æ’åº
    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`
    UpdatedAt       time.Time            `bson:"updated_at" json:"updatedAt"`
}
```

## ğŸŒ APIç«¯ç‚¹

### æ”¶è—æ“ä½œ

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | /api/v1/social/collections | æ”¶è—å†…å®¹ | æ˜¯ |
| DELETE | /api/v1/social/collections/:targetType/:targetId | å–æ¶ˆæ”¶è— | æ˜¯ |
| GET | /api/v1/social/collections | è·å–æ”¶è—åˆ—è¡¨ | æ˜¯ |
| GET | /api/v1/social/collections/status | æŸ¥è¯¢æ”¶è—çŠ¶æ€ | æ˜¯ |

### æ”¶è—å¤¹ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/social/collection-folders | è·å–æ”¶è—å¤¹åˆ—è¡¨ | æ˜¯ |
| POST | /api/v1/social/collection-folders | åˆ›å»ºæ”¶è—å¤¹ | æ˜¯ |
| PUT | /api/v1/social/collection-folders/:id | æ›´æ–°æ”¶è—å¤¹ | æ˜¯ |
| DELETE | /api/v1/social/collection-folders/:id | åˆ é™¤æ”¶è—å¤¹ | æ˜¯ |

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### æ”¶è—æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æ”¶è—æŒ‰é’®
   â†“
2. å‰ç«¯é€‰æ‹©æ”¶è—å¤¹ï¼ˆå¯é€‰ï¼‰
   â†“
3. è°ƒç”¨API
   â†“
4. åç«¯æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
   â†“
5. å¦‚æœæœªæ”¶è—ï¼Œåˆ›å»ºæ”¶è—è®°å½•
   â†“
6. æ›´æ–°æ”¶è—æ•°ç»Ÿè®¡
   â†“
7. è¿”å›ç»“æœ
```

### åˆ›å»ºæ”¶è—å¤¹æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»åˆ›å»ºæ”¶è—å¤¹
   â†“
2. è¾“å…¥æ”¶è—å¤¹åç§°ã€æè¿°
   â†“
3. é€‰æ‹©å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
   â†“
4. è°ƒç”¨API
   â†“
5. åç«¯éªŒè¯å¹¶åˆ›å»ºæ”¶è—å¤¹
   â†“
6. è¿”å›æ”¶è—å¤¹ä¿¡æ¯
```

## ğŸ”§ ä¸šåŠ¡è§„åˆ™

### æ”¶è—è§„åˆ™

- åŒä¸€ç”¨æˆ·å¯¹åŒä¸€å†…å®¹åªèƒ½æ”¶è—ä¸€æ¬¡
- å–æ¶ˆæ”¶è—åå¯ä»¥é‡æ–°æ”¶è—
- åˆ é™¤æ”¶è—å¤¹ä¸å½±å“æ”¶è—è®°å½•ï¼ˆåªæ˜¯ç§»é™¤å…³è”ï¼‰

### æ”¶è—å¤¹è§„åˆ™

- æ¯ä¸ªç”¨æˆ·æœ€å¤šåˆ›å»º50ä¸ªæ”¶è—å¤¹
- æ¯ä¸ªç”¨æˆ·å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤æ”¶è—å¤¹
- é»˜è®¤æ”¶è—å¤¹ä¸èƒ½åˆ é™¤

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

- Redisç¼“å­˜æ”¶è—çŠ¶æ€
- Redisç¼“å­˜æ”¶è—æ•°ç»Ÿè®¡

### æ•°æ®åº“ä¼˜åŒ–

- æ”¶è—è¡¨è”åˆå”¯ä¸€ç´¢å¼•ï¼šuserID + targetType + targetID
- æ”¶è—å¤¹è¡¨ç´¢å¼•ï¼šuserID + sortOrder

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

- æ”¶è—æ€»é‡ï¼ˆæ—¥/å‘¨/æœˆï¼‰
- äººå‡æ”¶è—æ•°
- æ”¶è—å¤¹ä½¿ç”¨ç‡
- æ”¶è—å–æ¶ˆç‡

---

**æ–‡æ¡£ç»´æŠ¤**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-01-06
