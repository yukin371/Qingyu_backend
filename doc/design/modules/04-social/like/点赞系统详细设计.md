# ç‚¹èµç³»ç»Ÿè¯¦ç»†è®¾è®¡

> **æ¨¡å—**: 04 - ç¤¾äº¤äº’åŠ¨
> **åŠŸèƒ½**: ç‚¹èµç³»ç»Ÿ
> **å®Œæˆåº¦**: ğŸŸ¢ 90%

## ğŸ“‹ æ¦‚è¿°

ç‚¹èµç³»ç»Ÿå…è®¸ç”¨æˆ·å¯¹ä¹¦ç±ã€ç« èŠ‚ã€è¯„è®ºç­‰å†…å®¹è¿›è¡Œç‚¹èµ/è¸©è¯„ä»·ï¼Œæ”¯æŒæŸ¥è¯¢ç‚¹èµçŠ¶æ€å’Œç»Ÿè®¡ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. åŸºç¡€ç‚¹èµåŠŸèƒ½

- **ç‚¹èµ**: å¯¹å†…å®¹è¿›è¡Œç‚¹èµ
- **å–æ¶ˆç‚¹èµ**: å–æ¶ˆå·²ç‚¹èµçš„å†…å®¹
- **è¸©**: å¯¹å†…å®¹è¿›è¡Œè´Ÿé¢è¯„ä»·ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

### 2. ç‚¹èµçŠ¶æ€

- **æŸ¥è¯¢çŠ¶æ€**: æŸ¥è¯¢ç”¨æˆ·å¯¹å†…å®¹çš„ç‚¹èµçŠ¶æ€
- **æ‰¹é‡æŸ¥è¯¢**: æ‰¹é‡æŸ¥è¯¢å¤šä¸ªå†…å®¹çš„ç‚¹èµçŠ¶æ€

### 3. ç‚¹èµç»Ÿè®¡

- **ç‚¹èµæ•°**: å†…å®¹çš„ç‚¹èµæ€»æ•°
- **è¸©æ•°**: å†…å®¹çš„è¸©æ€»æ•°ï¼ˆå¯é€‰ï¼‰
- **å‡€èµæ•°**: ç‚¹èµæ•° - è¸©æ•°

### 4. ç‚¹èµæ’è¡Œ

- **çƒ­é—¨å†…å®¹**: æŒ‰ç‚¹èµæ•°æ’åº
- **ç”¨æˆ·æ’è¡Œ**: ç”¨æˆ·è·èµæ’è¡Œ

## ğŸ“Š æ•°æ®æ¨¡å‹

### Like (ç‚¹èµè®°å½•)

```go
type Like struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    UserID          primitive.ObjectID   `bson:"user_id" json:"userId"`
    TargetType      TargetType          `bson:"target_type" json:"targetType"`
    TargetID        primitive.ObjectID   `bson:"target_id" json:"targetId"`
    Type            LikeType             `bson:"type" json:"type"`             // like/dislike
    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`

    // è”åˆç´¢å¼•ï¼šuserID + targetType + targetID (å”¯ä¸€)
}

type TargetType string
const (
    TargetTypeBook      TargetType = "book"
    TargetTypeChapter   TargetType = "chapter"
    TargetTypeComment   TargetType = "comment"
    TargetTypeReview    TargetType = "review"
)

type LikeType string
const (
    LikeTypeLike       LikeType = "like"
    LikeTypeDislike    LikeType = "dislike"
)
```

### LikeStats (ç‚¹èµç»Ÿè®¡)

```go
type LikeStats struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    TargetType      TargetType          `bson:"target_type" json:"targetType"`
    TargetID        primitive.ObjectID   `bson:"target_id" json:"targetId"`
    LikeCount       int64                `bson:"like_count" json:"likeCount"`
    DislikeCount    int64                `bson:"dislike_count" json:"dislikeCount"`
    NetCount        int64                `bson:"net_count" json:"netCount"`     // å‡€èµæ•°
    UpdatedAt       time.Time            `bson:"updated_at" json:"updatedAt"`

    // è”åˆç´¢å¼•ï¼štargetType + targetID (å”¯ä¸€)
}
```

## ğŸŒ APIç«¯ç‚¹

### ç‚¹èµæ“ä½œ

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | /api/v1/social/likes | ç‚¹èµ/è¸© | æ˜¯ |
| DELETE | /api/v1/social/likes/:targetType/:targetId | å–æ¶ˆç‚¹èµ | æ˜¯ |
| PUT | /api/v1/social/likes/:targetType/:targetId | åˆ‡æ¢ç‚¹èµçŠ¶æ€ | æ˜¯ |

### ç‚¹èµæŸ¥è¯¢

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/social/likes/status | æŸ¥è¯¢ç‚¹èµçŠ¶æ€ | æ˜¯ |
| POST | /api/v1/social/likes/status/batch | æ‰¹é‡æŸ¥è¯¢ç‚¹èµçŠ¶æ€ | æ˜¯ |
| GET | /api/v1/social/likes/:targetType/:targetId/stats | è·å–ç‚¹èµç»Ÿè®¡ | å¦ |

### ç‚¹èµæ’è¡Œ

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/social/likes/hot/:targetType | çƒ­é—¨å†…å®¹æ’è¡Œ | å¦ |

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### ç‚¹èµæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»ç‚¹èµæŒ‰é’®
   â†“
2. å‰ç«¯æ£€æŸ¥å½“å‰çŠ¶æ€
   â†“
3. å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµï¼›å¦åˆ™ï¼Œç‚¹èµ
   â†“
4. è°ƒç”¨API
   â†“
5. åç«¯æ£€æŸ¥æ˜¯å¦å·²ç‚¹èµ
   â†“
6. å¦‚æœæœªç‚¹èµï¼Œåˆ›å»ºç‚¹èµè®°å½•
   â†“
7. æ›´æ–°ç‚¹èµç»Ÿè®¡
   â†“
8. è¿”å›ç»“æœ
```

### ç‚¹èµçŠ¶æ€æŸ¥è¯¢æµç¨‹

```
1. å‰ç«¯è¯·æ±‚å†…å®¹åˆ—è¡¨
   â†“
2. åç«¯è¿”å›å†…å®¹åˆ—è¡¨
   â†“
3. å‰ç«¯æ‰¹é‡è¯·æ±‚ç‚¹èµçŠ¶æ€
   â†“
4. åç«¯æ‰¹é‡æŸ¥è¯¢
   â†“
5. è¿”å›ç‚¹èµçŠ¶æ€æ˜ å°„
   â†“
6. å‰ç«¯æ›´æ–°UIçŠ¶æ€
```

## ğŸ”§ ä¸šåŠ¡è§„åˆ™

### ç‚¹èµè§„åˆ™

- åŒä¸€ç”¨æˆ·å¯¹åŒä¸€å†…å®¹åªèƒ½ç‚¹èµä¸€æ¬¡
- ç‚¹èµåå¯ä»¥å–æ¶ˆç‚¹èµ
- ç‚¹èµå’Œè¸©äº’æ–¥ï¼ˆç‚¹èµåä¸èƒ½è¸©ï¼Œè¸©åä¸èƒ½ç‚¹èµï¼‰

### ç‚¹èµç»Ÿè®¡æ›´æ–°

- ç‚¹èµæ—¶ï¼šlikeCount++, netCount++
- å–æ¶ˆç‚¹èµï¼šlikeCount--, netCount--
- è¸©æ—¶ï¼šdislikeCount++, netCount--
- å–æ¶ˆè¸©ï¼šdislikeCount--, netCount++

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

- Redisç¼“å­˜ç‚¹èµçŠ¶æ€ï¼ˆç”¨æˆ·ç»´åº¦ï¼‰
- Redisç¼“å­˜ç‚¹èµç»Ÿè®¡ï¼ˆå†…å®¹ç»´åº¦ï¼‰
- ç¼“å­˜çƒ­ç‚¹å†…å®¹ï¼ˆçƒ­é—¨å†…å®¹ï¼‰

### å¼‚æ­¥æ›´æ–°

- ç‚¹èµç»Ÿè®¡å¼‚æ­¥æ›´æ–°ï¼ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- å®šæ—¶åŒæ­¥Redisåˆ°æ•°æ®åº“

### æ•°æ®åº“ä¼˜åŒ–

- ç‚¹èµè¡¨è”åˆå”¯ä¸€ç´¢å¼•ï¼šuserID + targetType + targetID
- ç»Ÿè®¡è¡¨è”åˆå”¯ä¸€ç´¢å¼•ï¼štargetType + targetID
- ä½¿ç”¨è®¡æ•°å™¨æ¨¡å¼å‡å°‘é”ç«äº‰

## ğŸ” å®‰å…¨è€ƒè™‘

### é˜²åˆ·æœºåˆ¶

- IPçº§åˆ«é¢‘ç‡é™åˆ¶
- ç”¨æˆ·çº§åˆ«é¢‘ç‡é™åˆ¶
- å¼‚å¸¸ç‚¹èµæ£€æµ‹ï¼ˆçŸ­æ—¶é—´å†…å¤§é‡ç‚¹èµï¼‰

### æ•°æ®ä¸€è‡´æ€§

- åˆ†å¸ƒå¼é”é˜²æ­¢é‡å¤ç‚¹èµ
- æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¼‚æ­¥æ›´æ–°ç»Ÿè®¡ï¼‰

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

- ç‚¹èµæ€»é‡ï¼ˆæ—¥/å‘¨/æœˆï¼‰
- äººå‡ç‚¹èµæ•°
- ç‚¹èµå–æ¶ˆç‡
- çƒ­é—¨å†…å®¹æ’è¡Œ

---

**æ–‡æ¡£ç»´æŠ¤**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-01-06
