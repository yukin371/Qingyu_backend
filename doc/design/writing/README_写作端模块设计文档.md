# 写作端模块设计文档

## 概述

写作端模块是青羽轻量级阅读写作平台的创作核心，为作者提供完整的写作工具链和创作辅助功能。本模块包含编辑器、设定百科、AI辅助、数据统计等功能。

## 模块架构

```plaintext
writing/
 editor/             # 编辑器模块
 encyclopedia/       # 设定百科
 ai_assistant/       # AI辅助功能
 content_review/     # 内容审核
 statistics/         # 数据统计
 monetization/       # 稿费结算
```

## 核心功能模块

### 1. 编辑器模块 (editor)
- **双模式编辑**: Markdown + 富文本双Tab切换
- **自动保存**: 30秒间隔自动保存
- **版本管理**: 文档历史版本记录
- **协作编辑**: 多人实时协作（后期功能）

### 2. 设定百科 (encyclopedia)
- **三级分类**: 角色/地图/功法分类管理
- **关系图谱**: 角色关系、地理位置可视化
- **模板系统**: 预设角色卡、世界观模板
- **引用管理**: 文档中快速引用设定内容

### 3. AI辅助功能 (ai_assistant)
- **智能续写**: 选中段落一键续写200字
- **模型切换**: 支持多种AI模型选择
- **创意建议**: 情节发展、角色塑造建议
- **文风分析**: 写作风格分析和改进建议

### 4. 内容审核 (content_review)
- **敏感词检测**: 实时检测并高亮提示
- **AI审核**: 调用ai-service进行内容审核
- **人工复审**: 疑似内容标记人工审核
- **合规建议**: 提供内容修改建议

### 5. 数据统计 (statistics)
- **阅读数据**: 每章完读率、跳章率分析
- **读者画像**: 读者年龄、性别、地域分布
- **收入统计**: 订阅、打赏、广告收入统计
- **趋势分析**: 数据趋势图表展示

### 6. 稿费结算 (monetization)
- **多元收入**: 订阅+打赏+广告三分账模式
- **实时结算**: 收入实时统计和分成计算
- **提现管理**: 支持支付宝提现
- **税务处理**: 自动计算税费和开票

## 技术架构

### 数据层
- **MongoDB**: 存储作品内容、设定百科、统计数据
- **Redis**: 缓存编辑状态、实时协作数据
- **OSS**: 存储图片、附件等静态资源
- **Elasticsearch**: 全文搜索和内容检索

### 服务层
- **编辑服务**: 文档编辑、保存、版本管理
- **百科服务**: 设定管理、关系图谱生成
- **AI服务**: 智能续写、内容分析
- **审核服务**: 敏感词检测、合规审查
- **统计服务**: 数据分析、报表生成
- **支付服务**: 收入结算、提现处理

### 接口层
- **RESTful API**: 标准HTTP接口
- **WebSocket**: 实时编辑同步
- **gRPC**: 内部服务通信
- **消息队列**: 异步任务处理

## 相关文档

- [编辑器系统设计](./editor_design.md)
- [设定百科设计](./encyclopedia_design.md)
- [AI辅助功能设计](./ai_assistant_design.md)
- [内容审核设计](./content_review_design.md)
- [数据统计设计](./statistics_design.md)
- [稿费结算设计](./monetization_design.md)

## 开发优先级

### MVP阶段
1. 基础编辑器功能（Markdown + 富文本）
2. 自动保存机制
3. 简单的设定百科
4. 基础敏感词检测
5. AI续写功能

### 后续迭代
1. 高级编辑功能（协作编辑）
2. 完整的关系图谱系统
3. 深度数据分析
4. 完整的稿费结算系统
5. 高级AI辅助功能

## 集成接口

### 与阅读端集成
- 作品发布到书城
- 章节内容同步
- 读者反馈收集

### 与底层服务集成
- 用户认证和权限管理
- 钱包系统对接
- 推荐算法数据提供

### 外部服务集成
- 第三方AI模型API
- 支付宝提现接口
- 敏感词检测服务
