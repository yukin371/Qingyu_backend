# å†™ä½œç«¯å†…å®¹å®¡æ ¸ç³»ç»Ÿè®¾è®¡

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-17  
> **æœ€åæ›´æ–°**: 2025-10-17  
> **ç»´æŠ¤è€…**: é’ç¾½å†™ä½œå›¢é˜Ÿ  
> **ä¼˜å…ˆçº§**: ğŸ”¥ MVPé«˜ä¼˜å…ˆçº§

## 1. éœ€æ±‚æ¦‚è¿°

### 1.1 åŠŸèƒ½æè¿°

å†…å®¹å®¡æ ¸ç³»ç»Ÿæ˜¯é’ç¾½å†™ä½œå¹³å°çš„æ ¸å¿ƒå®‰å…¨æ¨¡å—ï¼Œæ—¨åœ¨å®æ—¶æ£€æµ‹å’Œè¯†åˆ«ç”¨æˆ·åˆ›ä½œå†…å®¹ä¸­çš„æ•æ„Ÿè¯æ±‡ã€è¿è§„è¡¨è¾¾å’Œä¸å½“å†…å®¹ï¼Œä¿éšœå¹³å°å†…å®¹å¥åº·ã€åˆè§„ï¼Œé¿å…æ³•å¾‹é£é™©ã€‚ç³»ç»Ÿæ”¯æŒå®æ—¶æ£€æµ‹ã€æ‰¹é‡å®¡æ ¸ã€äººå·¥å¤æ ¸ç­‰å¤šç§å®¡æ ¸æ¨¡å¼ã€‚

### 1.2 ä¸šåŠ¡ä»·å€¼

- **åˆè§„ä¿éšœ**ï¼šç¡®ä¿å¹³å°å†…å®¹ç¬¦åˆå›½å®¶æ³•å¾‹æ³•è§„ï¼Œé¿å…æ³•å¾‹é£é™©
- **å†…å®¹è´¨é‡**ï¼šæå‡å¹³å°å†…å®¹è´¨é‡ï¼Œç»´æŠ¤è‰¯å¥½çš„ç¤¾åŒºæ°›å›´
- **é£é™©é¢„è­¦**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†è¿è§„å†…å®¹ï¼Œé™ä½å¹³å°è¿è¥é£é™©
- **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›å®æ—¶åé¦ˆï¼Œå¸®åŠ©ä½œè€…åŠæ—¶ä¿®æ­£å†…å®¹é—®é¢˜

### 1.3 ç”¨æˆ·åœºæ™¯

**ä½œè€…ç«¯åœºæ™¯**ï¼š
1. **å®æ—¶å†™ä½œæ£€æµ‹**ï¼šä½œè€…åœ¨ç¼–è¾‘å™¨ä¸­å†™ä½œæ—¶ï¼Œç³»ç»Ÿå®æ—¶æ£€æµ‹æ•æ„Ÿè¯å¹¶é«˜äº®æç¤º
2. **å‘å¸ƒå‰å®¡æ ¸**ï¼šä½œè€…æäº¤å‘å¸ƒæ—¶ï¼Œç³»ç»Ÿè¿›è¡Œå…¨æ–‡å®¡æ ¸ï¼Œç»™å‡ºå®¡æ ¸ç»“æœå’Œä¿®æ”¹å»ºè®®
3. **å†å²å†…å®¹å¤æŸ¥**ï¼šç³»ç»Ÿå®šæœŸå¯¹å·²å‘å¸ƒå†…å®¹è¿›è¡Œå¤æŸ¥ï¼Œè¯†åˆ«æ–°å¢æ•æ„Ÿè¯
4. **ç”³è¯‰å¤„ç†**ï¼šä½œè€…å¯¹å®¡æ ¸ç»“æœæœ‰å¼‚è®®æ—¶ï¼Œå¯æäº¤ç”³è¯‰å¹¶ç­‰å¾…äººå·¥å¤æ ¸

**ç®¡ç†å‘˜åœºæ™¯**ï¼š
1. **æ•æ„Ÿè¯åº“ç®¡ç†**ï¼šç®¡ç†å‘˜ç»´æŠ¤å’Œæ›´æ–°æ•æ„Ÿè¯åº“
2. **äººå·¥å¤æ ¸**ï¼šå¯¹ç³»ç»Ÿæ ‡è®°çš„ç–‘ä¼¼è¿è§„å†…å®¹è¿›è¡Œäººå·¥å®¡æ ¸
3. **å®¡æ ¸è§„åˆ™é…ç½®**ï¼šé…ç½®ä¸åŒç±»å‹å†…å®¹çš„å®¡æ ¸ç­–ç•¥å’Œä¸¥æ ¼ç¨‹åº¦
4. **å®¡æ ¸æŠ¥è¡¨ç»Ÿè®¡**ï¼šæŸ¥çœ‹å®¡æ ¸æ•°æ®ç»Ÿè®¡å’Œè¿è§„è¶‹åŠ¿åˆ†æ

### 1.4 åŠŸèƒ½è¾¹ç•Œ

**åŒ…å«åŠŸèƒ½**ï¼š
- âœ… æ•æ„Ÿè¯å®æ—¶æ£€æµ‹ï¼ˆå‰ç«¯é«˜äº®æç¤ºï¼‰
- âœ… å…¨æ–‡å†…å®¹å®¡æ ¸ï¼ˆå‘å¸ƒå‰å®¡æ ¸ï¼‰
- âœ… æ•æ„Ÿè¯åº“ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ã€å¯¼å…¥å¯¼å‡ºï¼‰
- âœ… è¿è§„å†…å®¹è¯†åˆ«ï¼ˆæ”¿æ²»ã€è‰²æƒ…ã€æš´åŠ›ã€å¹¿å‘Šç­‰ï¼‰
- âœ… å®¡æ ¸è®°å½•ç®¡ç†ï¼ˆå®¡æ ¸å†å²ã€è¿è§„è®°å½•ï¼‰
- âœ… äººå·¥å¤æ ¸æµç¨‹ï¼ˆç”³è¯‰ã€å¤å®¡ã€å¤„ç†ï¼‰
- âœ… å®¡æ ¸è§„åˆ™é…ç½®ï¼ˆå®¡æ ¸ç­–ç•¥ã€ä¸¥æ ¼ç¨‹åº¦ï¼‰
- âœ… å®¡æ ¸æ•°æ®ç»Ÿè®¡ï¼ˆè¿è§„ç‡ã€å®¡æ ¸é‡ã€å¤„ç†æ—¶æ•ˆï¼‰

**ä¸åŒ…å«åŠŸèƒ½**ï¼š
- âŒ å›¾ç‰‡å†…å®¹å®¡æ ¸ï¼ˆåæœŸç‰ˆæœ¬ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼‰
- âŒ è§†é¢‘å†…å®¹å®¡æ ¸ï¼ˆåæœŸç‰ˆæœ¬ï¼‰
- âŒ AIè‡ªåŠ¨ä¿®æ­£ï¼ˆåæœŸç‰ˆæœ¬ï¼ŒAIæ”¹å†™å»ºè®®ï¼‰
- âŒ å®æ—¶åä½œå®¡æ ¸ï¼ˆåæœŸç‰ˆæœ¬ï¼‰

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ç¼–è¾‘å™¨ (Vue)                            â”‚
â”‚              å®æ—¶æ£€æµ‹ + é«˜äº®æ˜¾ç¤º + è¿è§„æç¤º                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 Router Layer (è·¯ç”±å±‚)                         â”‚
â”‚              /api/v1/content-audit/*                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  API Layer (æ¥å£å±‚)                           â”‚
â”‚        ContentAuditApi / SensitiveWordApi / AppealApi        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Service Layer (ä¸šåŠ¡é€»è¾‘å±‚)                       â”‚
â”‚  ContentAuditService / SensitiveWordService / AppealService  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Strategy Layer (å®¡æ ¸ç­–ç•¥å±‚) - ç®—æ³•å’Œè§„åˆ™å¼•æ“                â”‚
â”‚   DFAMatcher / RegexMatcher / RuleEngine / AIDetector       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Repository Layer (æ•°æ®è®¿é—®å±‚)                       â”‚
â”‚  AuditRecordRepo / SensitiveWordRepo / AppealRepo           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Model Layer (æ•°æ®æ¨¡å‹å±‚)                          â”‚
â”‚  AuditRecord / SensitiveWord / Appeal / AuditResult         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              MongoDB + Redis (å­˜å‚¨å±‚)                         â”‚
â”‚        MongoDB: å®¡æ ¸è®°å½•ã€æ•æ„Ÿè¯åº“ã€ç”³è¯‰è®°å½•                    â”‚
â”‚        Redis: æ•æ„Ÿè¯ç¼“å­˜ã€å®¡æ ¸ç»“æœç¼“å­˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—åˆ’åˆ†

**æ ¸å¿ƒæ¨¡å—**ï¼š
- **ContentAuditService**ï¼šå†…å®¹å®¡æ ¸æ ¸å¿ƒæœåŠ¡ï¼Œåè°ƒå„æ£€æµ‹å™¨å®Œæˆå®¡æ ¸
- **SensitiveWordService**ï¼šæ•æ„Ÿè¯åº“ç®¡ç†æœåŠ¡
- **AppealService**ï¼šç”³è¯‰å’Œäººå·¥å¤æ ¸æœåŠ¡
- **DFAMatcher**ï¼šDFAï¼ˆç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰æ•æ„Ÿè¯åŒ¹é…å™¨
- **RegexMatcher**ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å™¨ï¼ˆå¤æ‚æ¨¡å¼æ£€æµ‹ï¼‰
- **RuleEngine**ï¼šè§„åˆ™å¼•æ“ï¼ˆåŸºäºè§„åˆ™çš„è¿è§„æ£€æµ‹ï¼‰
- **AIDetector**ï¼šAIæ£€æµ‹å™¨ï¼ˆè°ƒç”¨AIæœåŠ¡è¿›è¡Œè¯­ä¹‰åˆ†æï¼‰

**è¾…åŠ©æ¨¡å—**ï¼š
- **AuditStatisticsService**ï¼šå®¡æ ¸æ•°æ®ç»Ÿè®¡æœåŠ¡
- **AuditNotificationService**ï¼šå®¡æ ¸ç»“æœé€šçŸ¥æœåŠ¡
- **SensitiveWordCacheManager**ï¼šæ•æ„Ÿè¯ç¼“å­˜ç®¡ç†

### 2.3 æ•°æ®æµè®¾è®¡

#### å®æ—¶æ£€æµ‹æµç¨‹
```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯é˜²æŠ–(500ms) â†’ APIè¯·æ±‚ â†’ Redisç¼“å­˜æŸ¥è¯¢ 
â†’ DFAå¿«é€ŸåŒ¹é… â†’ è¿”å›åŒ¹é…ç»“æœ â†’ å‰ç«¯é«˜äº®æ˜¾ç¤º
```

#### å‘å¸ƒå®¡æ ¸æµç¨‹
```
æäº¤å‘å¸ƒ â†’ å…¨æ–‡å®¡æ ¸è¯·æ±‚ â†’ æ•æ„Ÿè¯æ£€æµ‹ â†’ æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹ 
â†’ è§„åˆ™å¼•æ“æ£€æµ‹ â†’ AIè¯­ä¹‰åˆ†æ â†’ æ±‡æ€»å®¡æ ¸ç»“æœ 
â†’ è®°å½•å®¡æ ¸æ—¥å¿— â†’ è¿”å›å®¡æ ¸ç»“æœ â†’ å‘å¸ƒ/æ‹’ç»
```

#### äººå·¥å¤æ ¸æµç¨‹
```
ç”¨æˆ·ç”³è¯‰ â†’ åˆ›å»ºç”³è¯‰è®°å½• â†’ é€šçŸ¥å®¡æ ¸å‘˜ â†’ äººå·¥å®¡æ ¸ 
â†’ å®¡æ ¸å†³ç­– â†’ æ›´æ–°å®¡æ ¸è®°å½• â†’ é€šçŸ¥ç”¨æˆ· â†’ å®Œæˆ
```

---

## 3. è¯¦ç»†è®¾è®¡

### 3.1 Routerå±‚è®¾è®¡

**è·¯ç”±åˆ†ç»„**ï¼š`/api/v1/content-audit`

**è·¯ç”±å®šä¹‰**ï¼š
```go
// å†…å®¹å®¡æ ¸è·¯ç”±
auditGroup := v1.Group("/content-audit")
auditGroup.Use(middleware.JWTAuth())
{
    // å®æ—¶æ£€æµ‹ï¼ˆä½œè€…ä½¿ç”¨ï¼‰
    auditGroup.POST("/check-realtime", contentAuditApi.CheckRealtime)
    
    // å…¨æ–‡å®¡æ ¸ï¼ˆå‘å¸ƒå‰å®¡æ ¸ï¼‰
    auditGroup.POST("/check-full", contentAuditApi.CheckFull)
    
    // æ‰¹é‡å®¡æ ¸ï¼ˆå®šæœŸå¤æŸ¥ï¼‰
    auditGroup.POST("/check-batch", contentAuditApi.CheckBatch)
    
    // å®¡æ ¸è®°å½•
    auditGroup.GET("/records", contentAuditApi.GetAuditRecords)
    auditGroup.GET("/records/:id", contentAuditApi.GetAuditRecord)
    
    // ç”³è¯‰ç®¡ç†ï¼ˆä½œè€…ä½¿ç”¨ï¼‰
    auditGroup.POST("/appeals", appealApi.CreateAppeal)
    auditGroup.GET("/appeals", appealApi.GetMyAppeals)
    auditGroup.GET("/appeals/:id", appealApi.GetAppeal)
}

// æ•æ„Ÿè¯åº“ç®¡ç†è·¯ç”±ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
adminAuditGroup := admin.Group("/audit")
adminAuditGroup.Use(middleware.AdminPermission())
{
    // æ•æ„Ÿè¯CRUD
    adminAuditGroup.GET("/sensitive-words", sensitiveWordApi.List)
    adminAuditGroup.POST("/sensitive-words", sensitiveWordApi.Create)
    adminAuditGroup.PUT("/sensitive-words/:id", sensitiveWordApi.Update)
    adminAuditGroup.DELETE("/sensitive-words/:id", sensitiveWordApi.Delete)
    adminAuditGroup.POST("/sensitive-words/import", sensitiveWordApi.Import)
    adminAuditGroup.GET("/sensitive-words/export", sensitiveWordApi.Export)
    
    // å®¡æ ¸è§„åˆ™é…ç½®
    adminAuditGroup.GET("/rules", auditRuleApi.GetRules)
    adminAuditGroup.PUT("/rules", auditRuleApi.UpdateRules)
    
    // äººå·¥å¤æ ¸
    adminAuditGroup.GET("/appeals/pending", appealApi.GetPendingAppeals)
    adminAuditGroup.PUT("/appeals/:id/review", appealApi.ReviewAppeal)
    
    // å®¡æ ¸ç»Ÿè®¡
    adminAuditGroup.GET("/statistics", auditStatisticsApi.GetStatistics)
}
```

### 3.2 APIå±‚è®¾è®¡

#### 3.2.1 å®æ—¶æ£€æµ‹æ¥å£

**è¯·æ±‚**ï¼š
```json
POST /api/v1/content-audit/check-realtime
{
  "content": "è¦æ£€æµ‹çš„æ–‡æœ¬å†…å®¹",
  "checkType": "sensitive_word" // sensitive_word, regex, full
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æ£€æµ‹å®Œæˆ",
  "data": {
    "isSafe": false,
    "matches": [
      {
        "word": "æ£€æµ‹åˆ°çš„æ•æ„Ÿè¯",
        "position": [10, 14], // èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®
        "level": "high", // high, medium, low
        "category": "political", // political, porn, violence, advertising, etc.
        "suggestion": "å»ºè®®ä¿®æ”¹ä¸ºï¼š***"
      }
    ],
    "checkTime": "2025-10-17T10:30:00Z"
  }
}
```

#### 3.2.2 å…¨æ–‡å®¡æ ¸æ¥å£

**è¯·æ±‚**ï¼š
```json
POST /api/v1/content-audit/check-full
{
  "documentId": "æ–‡æ¡£ID",
  "content": "å…¨æ–‡å†…å®¹",
  "checkOptions": {
    "enableDFA": true,
    "enableRegex": true,
    "enableRuleEngine": true,
    "enableAI": false // AIæ£€æµ‹å¯é€‰ï¼Œæ¶ˆè€—è¾ƒé«˜
  }
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "å®¡æ ¸å®Œæˆ",
  "data": {
    "auditId": "å®¡æ ¸è®°å½•ID",
    "result": "pass", // pass, warning, reject
    "isSafe": true,
    "riskLevel": "low", // low, medium, high
    "issues": [
      {
        "type": "sensitive_word",
        "level": "medium",
        "category": "political",
        "content": "è¿è§„å†…å®¹ç‰‡æ®µ",
        "position": [100, 110],
        "suggestion": "ä¿®æ”¹å»ºè®®"
      }
    ],
    "statistics": {
      "totalWords": 5000,
      "sensitiveWords": 2,
      "violationWords": 0,
      "checkDuration": "150ms"
    },
    "nextAction": "è¯·ä¿®æ”¹æ ‡è®°çš„å†…å®¹åé‡æ–°æäº¤" // ç»™ç”¨æˆ·çš„å»ºè®®
  }
}
```

#### 3.2.3 åˆ›å»ºç”³è¯‰æ¥å£

**è¯·æ±‚**ï¼š
```json
POST /api/v1/content-audit/appeals
{
  "auditId": "å®¡æ ¸è®°å½•ID",
  "documentId": "æ–‡æ¡£ID",
  "reason": "ç”³è¯‰åŸå› è¯´æ˜",
  "evidence": "è¯æ®ææ–™ï¼ˆå¯é€‰ï¼‰",
  "contactInfo": "è”ç³»æ–¹å¼"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ç”³è¯‰å·²æäº¤",
  "data": {
    "appealId": "ç”³è¯‰ID",
    "status": "pending", // pending, reviewing, approved, rejected
    "submittedAt": "2025-10-17T10:30:00Z",
    "estimatedReviewTime": "24å°æ—¶å†…"
  }
}
```

### 3.3 Serviceå±‚è®¾è®¡

#### ContentAuditService æ ¸å¿ƒæ–¹æ³•

```go
type ContentAuditService struct {
    auditRecordRepo     repository.AuditRecordRepository
    sensitiveWordRepo   repository.SensitiveWordRepository
    dfaMatcher          *DFAMatcher
    regexMatcher        *RegexMatcher
    ruleEngine          *RuleEngine
    aiDetector          *AIDetector
    cacheManager        *SensitiveWordCacheManager
    eventBus            base.EventBus
}

// CheckRealtime å®æ—¶æ£€æµ‹ï¼ˆå¿«é€Ÿæ¨¡å¼ï¼Œä»…DFAï¼‰
func (s *ContentAuditService) CheckRealtime(ctx context.Context, req *CheckRealtimeRequest) (*CheckRealtimeResponse, error) {
    // 1. å‚æ•°éªŒè¯
    if req.Content == "" || len(req.Content) > 10000 {
        return nil, errors.NewValidationError("å†…å®¹ä¸ºç©ºæˆ–è¶…é•¿")
    }
    
    // 2. ä»ç¼“å­˜è·å–æ•æ„Ÿè¯åº“
    words, err := s.cacheManager.GetSensitiveWords(ctx)
    if err != nil {
        return nil, errors.NewInternalError("è·å–æ•æ„Ÿè¯åº“å¤±è´¥").WithCause(err)
    }
    
    // 3. DFAå¿«é€ŸåŒ¹é…
    matches := s.dfaMatcher.Match(req.Content, words)
    
    // 4. æ„å»ºå“åº”
    return &CheckRealtimeResponse{
        IsSafe:    len(matches) == 0,
        Matches:   matches,
        CheckTime: time.Now(),
    }, nil
}

// CheckFull å…¨æ–‡å®¡æ ¸ï¼ˆå®Œæ•´æ¨¡å¼ï¼Œå¤šç§æ£€æµ‹å™¨ï¼‰
func (s *ContentAuditService) CheckFull(ctx context.Context, req *CheckFullRequest) (*CheckFullResponse, error) {
    startTime := time.Now()
    
    // 1. å‚æ•°éªŒè¯
    if err := s.validateCheckFullRequest(req); err != nil {
        return nil, err
    }
    
    // 2. åˆ›å»ºå®¡æ ¸è®°å½•
    auditRecord := &models.AuditRecord{
        DocumentID: req.DocumentId,
        Content:    req.Content,
        Status:     "checking",
        CreatedAt:  time.Now(),
    }
    if err := s.auditRecordRepo.Create(ctx, auditRecord); err != nil {
        return nil, errors.NewInternalError("åˆ›å»ºå®¡æ ¸è®°å½•å¤±è´¥").WithCause(err)
    }
    
    // 3. å¤šç§æ£€æµ‹å™¨å¹¶è¡Œæ£€æµ‹
    var (
        dfaIssues   []AuditIssue
        regexIssues []AuditIssue
        ruleIssues  []AuditIssue
        aiIssues    []AuditIssue
        wg          sync.WaitGroup
        mu          sync.Mutex
    )
    
    // 3.1 DFAæ£€æµ‹ï¼ˆå¿…é€‰ï¼‰
    if req.CheckOptions.EnableDFA {
        wg.Add(1)
        go func() {
            defer wg.Done()
            issues := s.dfaMatcher.Detect(req.Content)
            mu.Lock()
            dfaIssues = issues
            mu.Unlock()
        }()
    }
    
    // 3.2 æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹ï¼ˆå¯é€‰ï¼‰
    if req.CheckOptions.EnableRegex {
        wg.Add(1)
        go func() {
            defer wg.Done()
            issues := s.regexMatcher.Detect(req.Content)
            mu.Lock()
            regexIssues = issues
            mu.Unlock()
        }()
    }
    
    // 3.3 è§„åˆ™å¼•æ“æ£€æµ‹ï¼ˆå¯é€‰ï¼‰
    if req.CheckOptions.EnableRuleEngine {
        wg.Add(1)
        go func() {
            defer wg.Done()
            issues := s.ruleEngine.Detect(req.Content)
            mu.Lock()
            ruleIssues = issues
            mu.Unlock()
        }()
    }
    
    // 3.4 AIæ£€æµ‹ï¼ˆå¯é€‰ï¼Œè¾ƒæ…¢ï¼‰
    if req.CheckOptions.EnableAI {
        wg.Add(1)
        go func() {
            defer wg.Done()
            issues, _ := s.aiDetector.Detect(ctx, req.Content)
            mu.Lock()
            aiIssues = issues
            mu.Unlock()
        }()
    }
    
    wg.Wait()
    
    // 4. åˆå¹¶æ£€æµ‹ç»“æœ
    allIssues := s.mergeIssues(dfaIssues, regexIssues, ruleIssues, aiIssues)
    
    // 5. é£é™©è¯„çº§
    riskLevel, result := s.evaluateRisk(allIssues)
    
    // 6. æ›´æ–°å®¡æ ¸è®°å½•
    auditRecord.Status = "completed"
    auditRecord.Result = result
    auditRecord.RiskLevel = riskLevel
    auditRecord.Issues = allIssues
    auditRecord.CheckDuration = time.Since(startTime).Milliseconds()
    if err := s.auditRecordRepo.Update(ctx, auditRecord.ID, auditRecord); err != nil {
        log.Error("æ›´æ–°å®¡æ ¸è®°å½•å¤±è´¥", "error", err)
    }
    
    // 7. å‘å¸ƒå®¡æ ¸äº‹ä»¶
    s.publishAuditEvent(ctx, auditRecord)
    
    // 8. æ„å»ºå“åº”
    return &CheckFullResponse{
        AuditId:    auditRecord.ID,
        Result:     result,
        IsSafe:     len(allIssues) == 0,
        RiskLevel:  riskLevel,
        Issues:     allIssues,
        Statistics: s.buildStatistics(req.Content, allIssues, startTime),
        NextAction: s.getNextActionSuggestion(result),
    }, nil
}

// evaluateRisk é£é™©è¯„çº§
func (s *ContentAuditService) evaluateRisk(issues []AuditIssue) (riskLevel string, result string) {
    if len(issues) == 0 {
        return "low", "pass"
    }
    
    highCount := 0
    mediumCount := 0
    
    for _, issue := range issues {
        switch issue.Level {
        case "high":
            highCount++
        case "medium":
            mediumCount++
        }
    }
    
    // é£é™©è¯„çº§è§„åˆ™
    if highCount > 0 {
        return "high", "reject" // æœ‰é«˜é£é™©é—®é¢˜ï¼Œæ‹’ç»å‘å¸ƒ
    } else if mediumCount >= 3 {
        return "medium", "reject" // ä¸­é£é™©é—®é¢˜è¿‡å¤šï¼Œæ‹’ç»å‘å¸ƒ
    } else if mediumCount > 0 {
        return "medium", "warning" // æœ‰ä¸­é£é™©é—®é¢˜ï¼Œè­¦å‘Šä½†å…è®¸å‘å¸ƒ
    }
    
    return "low", "pass"
}
```

### 3.4 Repositoryå±‚è®¾è®¡

#### AuditRecordRepository æ¥å£å®šä¹‰

```go
type AuditRecordRepository interface {
    // åŸºç¡€CRUD
    Create(ctx context.Context, record *models.AuditRecord) error
    GetByID(ctx context.Context, id string) (*models.AuditRecord, error)
    Update(ctx context.Context, id string, record *models.AuditRecord) error
    Delete(ctx context.Context, id string) error
    
    // ä¸šåŠ¡æŸ¥è¯¢
    GetByDocumentID(ctx context.Context, documentId string, limit int) ([]*models.AuditRecord, error)
    GetByUserID(ctx context.Context, userId string, filter infrastructure.Filter) ([]*models.AuditRecord, error)
    GetPendingAppeals(ctx context.Context, limit int) ([]*models.AuditRecord, error)
    
    // ç»Ÿè®¡æŸ¥è¯¢
    CountByResult(ctx context.Context, startDate, endDate time.Time) (map[string]int64, error)
    CountByCategory(ctx context.Context, startDate, endDate time.Time) (map[string]int64, error)
    GetViolationRate(ctx context.Context, startDate, endDate time.Time) (float64, error)
}
```

#### SensitiveWordRepository æ¥å£å®šä¹‰

```go
type SensitiveWordRepository interface {
    // åŸºç¡€CRUD
    Create(ctx context.Context, word *models.SensitiveWord) error
    BatchCreate(ctx context.Context, words []*models.SensitiveWord) error
    GetByID(ctx context.Context, id string) (*models.SensitiveWord, error)
    Update(ctx context.Context, id string, word *models.SensitiveWord) error
    Delete(ctx context.Context, id string) error
    BatchDelete(ctx context.Context, ids []string) error
    
    // ä¸šåŠ¡æŸ¥è¯¢
    GetAll(ctx context.Context) ([]*models.SensitiveWord, error)
    GetByCategory(ctx context.Context, category string) ([]*models.SensitiveWord, error)
    GetByLevel(ctx context.Context, level string) ([]*models.SensitiveWord, error)
    Search(ctx context.Context, keyword string, limit int) ([]*models.SensitiveWord, error)
    
    // ç¼“å­˜ç®¡ç†
    RefreshCache(ctx context.Context) error
}
```

### 3.5 Modelå±‚è®¾è®¡

#### AuditRecord å®¡æ ¸è®°å½•æ¨¡å‹

```go
type AuditRecord struct {
    ID            string       `bson:"_id,omitempty" json:"id"`
    DocumentID    string       `bson:"document_id" json:"documentId"`
    UserID        string       `bson:"user_id" json:"userId"`
    Content       string       `bson:"content" json:"-"` // ä¸è¿”å›åˆ°å‰ç«¯
    ContentHash   string       `bson:"content_hash" json:"contentHash"` // MD5å“ˆå¸Œ
    Status        string       `bson:"status" json:"status"` // checking, completed
    Result        string       `bson:"result" json:"result"` // pass, warning, reject
    RiskLevel     string       `bson:"risk_level" json:"riskLevel"` // low, medium, high
    Issues        []AuditIssue `bson:"issues" json:"issues"`
    CheckDuration int64        `bson:"check_duration" json:"checkDuration"` // æ¯«ç§’
    CheckOptions  CheckOptions `bson:"check_options" json:"checkOptions"`
    CreatedAt     time.Time    `bson:"created_at" json:"createdAt"`
    UpdatedAt     time.Time    `bson:"updated_at" json:"updatedAt"`
}

type AuditIssue struct {
    Type       string   `bson:"type" json:"type"` // sensitive_word, regex, rule, ai
    Level      string   `bson:"level" json:"level"` // high, medium, low
    Category   string   `bson:"category" json:"category"` // political, porn, violence, advertising
    Content    string   `bson:"content" json:"content"` // è¿è§„å†…å®¹
    Position   []int    `bson:"position" json:"position"` // [start, end]
    Suggestion string   `bson:"suggestion" json:"suggestion"` // ä¿®æ”¹å»ºè®®
}

type CheckOptions struct {
    EnableDFA        bool `bson:"enable_dfa" json:"enableDfa"`
    EnableRegex      bool `bson:"enable_regex" json:"enableRegex"`
    EnableRuleEngine bool `bson:"enable_rule_engine" json:"enableRuleEngine"`
    EnableAI         bool `bson:"enable_ai" json:"enableAi"`
}
```

#### SensitiveWord æ•æ„Ÿè¯æ¨¡å‹

```go
type SensitiveWord struct {
    ID          string    `bson:"_id,omitempty" json:"id"`
    Word        string    `bson:"word" json:"word" validate:"required"`
    Level       string    `bson:"level" json:"level"` // high, medium, low
    Category    string    `bson:"category" json:"category"` // political, porn, violence, advertising
    Replacement string    `bson:"replacement" json:"replacement"` // å»ºè®®æ›¿æ¢è¯
    IsRegex     bool      `bson:"is_regex" json:"isRegex"` // æ˜¯å¦ä¸ºæ­£åˆ™è¡¨è¾¾å¼
    IsEnabled   bool      `bson:"is_enabled" json:"isEnabled"` // æ˜¯å¦å¯ç”¨
    Source      string    `bson:"source" json:"source"` // æ¥æºï¼ˆå®˜æ–¹ã€ç”¨æˆ·æ·»åŠ ç­‰ï¼‰
    CreatedBy   string    `bson:"created_by" json:"createdBy"`
    CreatedAt   time.Time `bson:"created_at" json:"createdAt"`
    UpdatedAt   time.Time `bson:"updated_at" json:"updatedAt"`
}
```

#### Appeal ç”³è¯‰è®°å½•æ¨¡å‹

```go
type Appeal struct {
    ID            string    `bson:"_id,omitempty" json:"id"`
    AuditID       string    `bson:"audit_id" json:"auditId"`
    DocumentID    string    `bson:"document_id" json:"documentId"`
    UserID        string    `bson:"user_id" json:"userId"`
    Reason        string    `bson:"reason" json:"reason" validate:"required"`
    Evidence      string    `bson:"evidence" json:"evidence"`
    ContactInfo   string    `bson:"contact_info" json:"contactInfo"`
    Status        string    `bson:"status" json:"status"` // pending, reviewing, approved, rejected
    ReviewerID    string    `bson:"reviewer_id" json:"reviewerId"`
    ReviewResult  string    `bson:"review_result" json:"reviewResult"`
    ReviewComment string    `bson:"review_comment" json:"reviewComment"`
    ReviewedAt    time.Time `bson:"reviewed_at" json:"reviewedAt"`
    CreatedAt     time.Time `bson:"created_at" json:"createdAt"`
    UpdatedAt     time.Time `bson:"updated_at" json:"updatedAt"`
}
```

---

## 4. ç®—æ³•è®¾è®¡

### 4.1 DFAï¼ˆç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰ç®—æ³•

**ç®—æ³•åŸç†**ï¼š
DFAæ˜¯ä¸€ç§é«˜æ•ˆçš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå°†æ•æ„Ÿè¯åº“æ„å»ºæˆæ ‘å½¢ç»“æ„ï¼ˆå‰ç¼€æ ‘/Trieæ ‘ï¼‰ï¼Œå®ç°O(n)æ—¶é—´å¤æ‚åº¦çš„å¤šæ¨¡å¼åŒ¹é…ã€‚

**å®ç°æ­¥éª¤**ï¼š
1. **æ„å»ºDFAæ ‘**ï¼šå°†æ‰€æœ‰æ•æ„Ÿè¯æ’å…¥åˆ°Trieæ ‘ä¸­
2. **åŒ¹é…æ£€æµ‹**ï¼šéå†æ–‡æœ¬ï¼Œåœ¨Trieæ ‘ä¸­æŸ¥æ‰¾åŒ¹é…è·¯å¾„
3. **è®°å½•ç»“æœ**ï¼šè®°å½•åŒ¹é…çš„æ•æ„Ÿè¯ä½ç½®å’Œå†…å®¹

**ä»£ç å®ç°**ï¼š
```go
type DFANode struct {
    Children map[rune]*DFANode
    IsEnd    bool
    Word     string
    Level    string
    Category string
}

type DFAMatcher struct {
    root *DFANode
    mu   sync.RWMutex
}

// BuildTree æ„å»ºDFAæ ‘
func (m *DFAMatcher) BuildTree(words []*models.SensitiveWord) {
    m.mu.Lock()
    defer m.mu.Unlock()
    
    m.root = &DFANode{Children: make(map[rune]*DFANode)}
    
    for _, word := range words {
        if !word.IsEnabled || word.IsRegex {
            continue // è·³è¿‡æœªå¯ç”¨å’Œæ­£åˆ™è¡¨è¾¾å¼è¯
        }
        
        node := m.root
        runes := []rune(word.Word)
        
        for _, r := range runes {
            if _, ok := node.Children[r]; !ok {
                node.Children[r] = &DFANode{Children: make(map[rune]*DFANode)}
            }
            node = node.Children[r]
        }
        
        node.IsEnd = true
        node.Word = word.Word
        node.Level = word.Level
        node.Category = word.Category
    }
}

// Match åŒ¹é…æ•æ„Ÿè¯
func (m *DFAMatcher) Match(content string, words []*models.SensitiveWord) []AuditIssue {
    m.mu.RLock()
    defer m.mu.RUnlock()
    
    // å¦‚æœæ ‘ä¸ºç©ºï¼Œå…ˆæ„å»º
    if m.root == nil {
        m.mu.RUnlock()
        m.BuildTree(words)
        m.mu.RLock()
    }
    
    var issues []AuditIssue
    runes := []rune(content)
    
    for i := 0; i < len(runes); i++ {
        node := m.root
        j := i
        
        for j < len(runes) {
            r := runes[j]
            if child, ok := node.Children[r]; ok {
                node = child
                j++
                
                if node.IsEnd {
                    // æ‰¾åˆ°æ•æ„Ÿè¯
                    issues = append(issues, AuditIssue{
                        Type:     "sensitive_word",
                        Level:    node.Level,
                        Category: node.Category,
                        Content:  node.Word,
                        Position: []int{i, j},
                        Suggestion: "å»ºè®®åˆ é™¤æˆ–æ›¿æ¢",
                    })
                    break
                }
            } else {
                break
            }
        }
    }
    
    return issues
}
```

### 4.2 æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

ç”¨äºæ£€æµ‹å¤æ‚æ¨¡å¼çš„è¿è§„å†…å®¹ï¼Œä¾‹å¦‚ï¼š
- å˜ä½“æ•æ„Ÿè¯ï¼ˆå¦‚ï¼šå¹¿å‘Š â†’ å¹¿-å‘Šã€å¹¿*å‘Šï¼‰
- è”ç³»æ–¹å¼ï¼ˆæ‰‹æœºå·ã€QQå·ã€å¾®ä¿¡å·ï¼‰
- ç½‘å€é“¾æ¥
- ç‰¹æ®Šç¬¦å·ç»„åˆ

**ç¤ºä¾‹è§„åˆ™**ï¼š
```go
var regexPatterns = []struct {
    Pattern  string
    Category string
    Level    string
}{
    {`1[3-9]\d{9}`, "contact", "medium"}, // æ‰‹æœºå·
    {`[qQ]{2}[:ï¼š]?\d{5,}`, "contact", "medium"}, // QQå·
    {`https?://[^\s]+`, "link", "low"}, // ç½‘å€
    {`[å¹¿å‘Š]{2}`, "advertising", "high"}, // å¹¿å‘Šå˜ä½“
}
```

### 4.3 è§„åˆ™å¼•æ“

åŸºäºä¸šåŠ¡è§„åˆ™çš„è¿è§„æ£€æµ‹ï¼Œä¾‹å¦‚ï¼š
- **é¢‘ç¹é‡å¤**ï¼šåŒä¸€è¯è¯­è¿ç»­å‡ºç°5æ¬¡ä»¥ä¸Š
- **ç‰¹æ®Šç¬¦å·æ¯”ä¾‹**ï¼šç‰¹æ®Šç¬¦å·å æ¯”è¶…è¿‡20%
- **æ•æ„Ÿè¯é¢˜ç»„åˆ**ï¼šå¤šä¸ªæ•æ„Ÿè¯é¢˜åŒæ—¶å‡ºç°
- **è¯­ä¹‰å¼‚å¸¸**ï¼šä¸Šä¸‹æ–‡è¯­ä¹‰ä¸è¿è´¯ï¼ˆéœ€ç»“åˆAIï¼‰

### 4.4 AIè¯­ä¹‰æ£€æµ‹

è°ƒç”¨AIæœåŠ¡è¿›è¡Œæ·±åº¦è¯­ä¹‰åˆ†æï¼Œæ£€æµ‹ï¼š
- **éšæ™¦è¡¨è¾¾**ï¼šç”¨æš—è¯­è¡¨è¾¾è¿è§„å†…å®¹
- **ä¸Šä¸‹æ–‡è¿è§„**ï¼šå•ç‹¬çœ‹åˆè§„ï¼Œä½†ç»„åˆèµ·æ¥è¿è§„
- **æƒ…æ„Ÿå€¾å‘**ï¼šè´Ÿé¢æƒ…ç»ªã€æš´åŠ›å€¾å‘
- **ä»·å€¼è§‚å¯¼å‘**ï¼šä¸‰è§‚ä¸æ­£ã€è¯¯å¯¼æ€§å†…å®¹

---

## 5. æ•°æ®è®¾è®¡

### 5.1 æ•°æ®æ¨¡å‹

è§ç¬¬3.5èŠ‚Modelå±‚è®¾è®¡ã€‚

### 5.2 æ•°æ®å…³ç³»

```
User (ç”¨æˆ·)
  â†“ 1:N
Document (æ–‡æ¡£)
  â†“ 1:N
AuditRecord (å®¡æ ¸è®°å½•)
  â†“ 0:N
Appeal (ç”³è¯‰è®°å½•)

SensitiveWord (æ•æ„Ÿè¯åº“) - ç‹¬ç«‹ç®¡ç†
```

### 5.3 ç´¢å¼•ç­–ç•¥

| é›†åˆåç§° | ç´¢å¼•å­—æ®µ | ç´¢å¼•ç±»å‹ | è¯´æ˜ |
|---------|---------|---------|------|
| audit_records | document_id | normal | æŸ¥è¯¢æ–‡æ¡£çš„å®¡æ ¸è®°å½• |
| audit_records | user_id + created_at | compound | æŸ¥è¯¢ç”¨æˆ·çš„å®¡æ ¸å†å² |
| audit_records | result + created_at | compound | ç»Ÿè®¡å®¡æ ¸ç»“æœ |
| audit_records | content_hash | normal | é˜²é‡å¤å®¡æ ¸ |
| sensitive_words | word | unique | æ•æ„Ÿè¯å”¯ä¸€ç´¢å¼• |
| sensitive_words | category + level | compound | æŒ‰åˆ†ç±»å’Œç­‰çº§æŸ¥è¯¢ |
| sensitive_words | is_enabled | normal | æŸ¥è¯¢å¯ç”¨çš„æ•æ„Ÿè¯ |
| appeals | audit_id | normal | å…³è”å®¡æ ¸è®°å½• |
| appeals | status + created_at | compound | æŸ¥è¯¢å¾…å¤„ç†ç”³è¯‰ |

### 5.4 ç¼“å­˜ç­–ç•¥

**Redisç¼“å­˜**ï¼š
- **Key**: `audit:sensitive_words:all`
- **Value**: æ‰€æœ‰å¯ç”¨çš„æ•æ„Ÿè¯åˆ—è¡¨ï¼ˆJSONï¼‰
- **TTL**: 1å°æ—¶
- **æ›´æ–°ç­–ç•¥**: æ•æ„Ÿè¯åº“å˜æ›´æ—¶ä¸»åŠ¨åˆ·æ–°

---

## 6. å®‰å…¨è®¾è®¡

### 6.1 æƒé™æ§åˆ¶

- **ä½œè€…æƒé™**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±æ–‡æ¡£çš„å®¡æ ¸è®°å½•å’Œç”³è¯‰
- **ç®¡ç†å‘˜æƒé™**ï¼šå¯ä»¥ç®¡ç†æ•æ„Ÿè¯åº“ã€å¤„ç†ç”³è¯‰ã€æŸ¥çœ‹æ‰€æœ‰å®¡æ ¸è®°å½•
- **å®¡æ ¸å‘˜æƒé™**ï¼šå¯ä»¥å¤„ç†ç”³è¯‰ï¼Œä½†ä¸èƒ½ä¿®æ”¹æ•æ„Ÿè¯åº“

### 6.2 æ•°æ®å®‰å…¨

- **æ•æ„Ÿè¯åº“åŠ å¯†**ï¼šæ•æ„Ÿè¯åº“å­˜å‚¨æ—¶åŠ å¯†ï¼Œé˜²æ­¢æ³„éœ²
- **å®¡æ ¸å†…å®¹è„±æ•**ï¼šå®¡æ ¸è®°å½•ä¸­çš„å†…å®¹ä»…ä¿ç•™å“ˆå¸Œå€¼ï¼Œä¸ä¿ç•™åŸæ–‡
- **æ—¥å¿—è„±æ•**ï¼šæ—¥å¿—ä¸­ä¸è®°å½•å®Œæ•´å†…å®¹ï¼Œä»…è®°å½•å…³é”®ä¿¡æ¯

### 6.3 è¾“å…¥éªŒè¯

- **å†…å®¹é•¿åº¦é™åˆ¶**ï¼šå®æ—¶æ£€æµ‹æœ€å¤š10,000å­—ï¼Œå…¨æ–‡å®¡æ ¸æœ€å¤š50,000å­—
- **é¢‘ç‡é™åˆ¶**ï¼šåŒä¸€ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š50æ¬¡å®æ—¶æ£€æµ‹è¯·æ±‚
- **é˜²åˆ·æœºåˆ¶**ï¼šç›¸åŒå†…å®¹1å°æ—¶å†…ä¸é‡å¤å®¡æ ¸

### 6.4 å®¡è®¡æ—¥å¿—

è®°å½•æ‰€æœ‰å®¡æ ¸æ“ä½œï¼š
- å®¡æ ¸è¯·æ±‚ï¼ˆç”¨æˆ·ã€æ–‡æ¡£ã€æ—¶é—´ï¼‰
- å®¡æ ¸ç»“æœï¼ˆé€šè¿‡ã€è­¦å‘Šã€æ‹’ç»ï¼‰
- æ•æ„Ÿè¯å‘½ä¸­æƒ…å†µ
- ç”³è¯‰å’Œå¤æ ¸æ“ä½œ

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 ç¼“å­˜ä¼˜åŒ–

- **æ•æ„Ÿè¯åº“ç¼“å­˜**ï¼šRedisç¼“å­˜ï¼Œ1å°æ—¶TTL
- **DFAæ ‘ç¼“å­˜**ï¼šå†…å­˜ç¼“å­˜ï¼Œæ•æ„Ÿè¯åº“å˜æ›´æ—¶é‡å»º
- **å®¡æ ¸ç»“æœç¼“å­˜**ï¼šç›¸åŒå†…å®¹çš„å®¡æ ¸ç»“æœç¼“å­˜1å°æ—¶

### 7.2 å¹¶å‘ä¼˜åŒ–

- **æ£€æµ‹å™¨å¹¶è¡Œ**ï¼šDFAã€æ­£åˆ™ã€è§„åˆ™å¼•æ“å¹¶è¡Œæ£€æµ‹
- **æ‰¹é‡å®¡æ ¸**ï¼šæ”¯æŒæ‰¹é‡æäº¤ï¼Œåå°å¼‚æ­¥å¤„ç†
- **è¿æ¥æ± **ï¼šMongoDBã€Redisè¿æ¥æ± å¤ç”¨

### 7.3 æ€§èƒ½æŒ‡æ ‡

- **å®æ—¶æ£€æµ‹å»¶è¿Ÿ**ï¼š< 200ms (99th percentile)
- **å…¨æ–‡å®¡æ ¸å»¶è¿Ÿ**ï¼š< 1s (99th percentileï¼Œä¸å«AIï¼‰
- **å¹¶å‘å¤„ç†èƒ½åŠ›**ï¼š500 QPS
- **æ•æ„Ÿè¯åº“å®¹é‡**ï¼šæ”¯æŒ10ä¸‡+æ•æ„Ÿè¯

---

## 8. æµ‹è¯•è®¾è®¡

### 8.1 å•å…ƒæµ‹è¯•

**DFAMatcheræµ‹è¯•**ï¼š
```go
func TestDFAMatcher_Match(t *testing.T) {
    words := []*models.SensitiveWord{
        {Word: "æ•æ„Ÿè¯1", Level: "high", Category: "political"},
        {Word: "æ•æ„Ÿè¯2", Level: "medium", Category: "porn"},
    }
    
    matcher := NewDFAMatcher()
    matcher.BuildTree(words)
    
    content := "è¿™æ˜¯ä¸€æ®µåŒ…å«æ•æ„Ÿè¯1çš„å†…å®¹"
    issues := matcher.Match(content, words)
    
    assert.Equal(t, 1, len(issues))
    assert.Equal(t, "æ•æ„Ÿè¯1", issues[0].Content)
}
```

### 8.2 é›†æˆæµ‹è¯•

**å…¨æ–‡å®¡æ ¸æµç¨‹æµ‹è¯•**ï¼š
```go
func TestContentAuditService_CheckFull(t *testing.T) {
    service := setupAuditService(t)
    
    req := &CheckFullRequest{
        DocumentId: "test-doc-1",
        Content: "æµ‹è¯•å†…å®¹...",
        CheckOptions: CheckOptions{
            EnableDFA:   true,
            EnableRegex: true,
        },
    }
    
    resp, err := service.CheckFull(context.Background(), req)
    
    assert.NoError(t, err)
    assert.NotEmpty(t, resp.AuditId)
    assert.Equal(t, "pass", resp.Result)
}
```

### 8.3 æ€§èƒ½æµ‹è¯•

**å‹åŠ›æµ‹è¯•**ï¼š
- å¹¶å‘ç”¨æˆ·ï¼š100
- æµ‹è¯•æ—¶é•¿ï¼š5åˆ†é’Ÿ
- å†…å®¹é•¿åº¦ï¼š1000-5000å­—
- é¢„æœŸQPSï¼š> 500

---

## 9. ç›‘æ§å’Œè¿ç»´

### 9.1 ç›‘æ§æŒ‡æ ‡

**ä¸šåŠ¡æŒ‡æ ‡**ï¼š
- å®¡æ ¸è¯·æ±‚é‡ï¼ˆæŒ‰æ—¶é—´ã€ç±»å‹ç»Ÿè®¡ï¼‰
- å®¡æ ¸é€šè¿‡ç‡ã€æ‹’ç»ç‡ã€è­¦å‘Šç‡
- è¿è§„å†…å®¹åˆ†å¸ƒï¼ˆæŒ‰åˆ†ç±»ç»Ÿè®¡ï¼‰
- ç”³è¯‰é‡å’Œå¤„ç†æ—¶æ•ˆ

**æŠ€æœ¯æŒ‡æ ‡**ï¼š
- APIå“åº”æ—¶é—´ï¼ˆP50ã€P95ã€P99ï¼‰
- é”™è¯¯ç‡ï¼ˆæŒ‰é”™è¯¯ç±»å‹ç»Ÿè®¡ï¼‰
- ç¼“å­˜å‘½ä¸­ç‡
- æ£€æµ‹å™¨æ€§èƒ½ï¼ˆDFAã€æ­£åˆ™ã€AIï¼‰

### 9.2 å‘Šè­¦è§„åˆ™

- å®¡æ ¸æ‹’ç»ç‡ > 10%ï¼ˆå¯èƒ½æ•æ„Ÿè¯åº“é…ç½®è¿‡ä¸¥ï¼‰
- APIé”™è¯¯ç‡ > 1%
- å®¡æ ¸å»¶è¿Ÿ > 2sï¼ˆP99ï¼‰
- å¾…å¤„ç†ç”³è¯‰ > 100

### 9.3 æ—¥å¿—ç­–ç•¥

**ç»“æ„åŒ–æ—¥å¿—**ï¼š
```json
{
  "level": "info",
  "service": "ContentAuditService",
  "operation": "CheckFull",
  "user_id": "user123",
  "document_id": "doc456",
  "result": "reject",
  "risk_level": "high",
  "issues_count": 3,
  "duration_ms": 150,
  "timestamp": "2025-10-17T10:30:00Z"
}
```

---

## 10. å®æ–½è®¡åˆ’

### 10.1 å¼€å‘é˜¶æ®µ

**Phase 1: åŸºç¡€åŠŸèƒ½ (3å¤©)**
- [ ] æ•°æ®æ¨¡å‹è®¾è®¡å’Œå®ç°
- [ ] Repositoryå±‚å®ç°
- [ ] DFAåŒ¹é…ç®—æ³•å®ç°
- [ ] å®æ—¶æ£€æµ‹APIå®ç°

**Phase 2: å®Œæ•´å®¡æ ¸ (3å¤©)**
- [ ] æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å™¨å®ç°
- [ ] è§„åˆ™å¼•æ“å®ç°
- [ ] å…¨æ–‡å®¡æ ¸APIå®ç°
- [ ] å®¡æ ¸è®°å½•ç®¡ç†

**Phase 3: ç®¡ç†åŠŸèƒ½ (2å¤©)**
- [ ] æ•æ„Ÿè¯åº“ç®¡ç†API
- [ ] ç”³è¯‰æµç¨‹å®ç°
- [ ] ç®¡ç†åå°é›†æˆ

**Phase 4: ä¼˜åŒ–å’Œæµ‹è¯• (2å¤©)**
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¹¶å‘ï¼‰
- [ ] å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•å’Œè°ƒä¼˜

**æ€»è®¡**: 10ä¸ªå·¥ä½œæ—¥

### 10.2 æµ‹è¯•é˜¶æ®µ

- **å•å…ƒæµ‹è¯•**ï¼šæ¯ä¸ªç»„ä»¶ç‹¬ç«‹æµ‹è¯•
- **é›†æˆæµ‹è¯•**ï¼šå®¡æ ¸æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**ï¼šå‹åŠ›æµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜
- **å®‰å…¨æµ‹è¯•**ï¼šæ•æ„Ÿè¯åº“æ³„éœ²é˜²æŠ¤æµ‹è¯•

### 10.3 ä¸Šçº¿è®¡åˆ’

- **ç°åº¦å‘å¸ƒ**ï¼šå…ˆå¯¹éƒ¨åˆ†ç”¨æˆ·å¼€å¯å®¡æ ¸åŠŸèƒ½
- **ç›‘æ§è§‚å¯Ÿ**ï¼šè§‚å¯Ÿå®¡æ ¸æ•ˆæœå’Œæ€§èƒ½è¡¨ç°
- **å…¨é‡å‘å¸ƒ**ï¼šé€æ­¥å¼€å¯å…¨éƒ¨ç”¨æˆ·çš„å®¡æ ¸åŠŸèƒ½
- **å›æ»šæ–¹æ¡ˆ**ï¼šå‡†å¤‡å®¡æ ¸åŠŸèƒ½é™çº§å¼€å…³

---

## 11. é£é™©è¯„ä¼°

### 11.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|-----|-----|-----|---------|
| DFAæ ‘æ„å»ºè€—æ—¶è¿‡é•¿ | é«˜ | ä¸­ | å¼‚æ­¥æ„å»ºï¼Œä½¿ç”¨æ—§æ ‘ç»§ç»­æœåŠ¡ |
| æ•æ„Ÿè¯åº“è¿‡å¤§å½±å“æ€§èƒ½ | é«˜ | ä¸­ | åˆ†çº§åŠ è½½ï¼Œé«˜ä¼˜å…ˆçº§è¯ä¼˜å…ˆæ£€æµ‹ |
| AIæ£€æµ‹æœåŠ¡ä¸ç¨³å®š | ä¸­ | é«˜ | AIæ£€æµ‹å¯é€‰ï¼Œå¤±è´¥ä¸å½±å“ä¸»æµç¨‹ |
| ç¼“å­˜å¤±æ•ˆå¯¼è‡´æ€§èƒ½ä¸‹é™ | ä¸­ | ä½ | å¤šçº§ç¼“å­˜ï¼Œé™çº§ç­–ç•¥ |

### 11.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|-----|-----|-----|---------|
| è¯¯æ€æ­£å¸¸å†…å®¹ | é«˜ | ä¸­ | æä¾›ç”³è¯‰æµç¨‹ï¼Œäººå·¥å¤æ ¸ |
| æ•æ„Ÿè¯åº“é…ç½®ä¸å½“ | é«˜ | ä¸­ | åˆ†çº§ç®¡ç†ï¼Œå®šæœŸreview |
| æ¼æ£€è¿è§„å†…å®¹ | é«˜ | ä¸­ | å¤šæ£€æµ‹å™¨ç»„åˆï¼ŒAIå…œåº• |
| ç”¨æˆ·ä½“éªŒä¸‹é™ | ä¸­ | ä½ | å®æ—¶æç¤ºï¼Œä¿®æ”¹å»ºè®® |

### 11.3 åˆè§„é£é™©

- **æ³•å¾‹é£é™©**ï¼šè¿è§„å†…å®¹æœªåŠæ—¶å¤„ç†
  - **åº”å¯¹**ï¼šå»ºç«‹7x24å°æ—¶äººå·¥å®¡æ ¸å›¢é˜Ÿ
- **éšç§é£é™©**ï¼šå®¡æ ¸å†…å®¹æ³„éœ²
  - **åº”å¯¹**ï¼šå†…å®¹è„±æ•ï¼Œæ•æ„Ÿè¯åº“åŠ å¯†
- **æ•°æ®å®‰å…¨**ï¼šæ•æ„Ÿè¯åº“è¢«çªƒå–
  - **åº”å¯¹**ï¼šè®¿é—®æ§åˆ¶ï¼Œæ“ä½œå®¡è®¡

---

## 12. åç»­è¿­ä»£

### 12.1 çŸ­æœŸä¼˜åŒ– (1-3ä¸ªæœˆ)

- [ ] AIå›¾ç‰‡å†…å®¹å®¡æ ¸ï¼ˆè°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼‰
- [ ] æ•æ„Ÿè¯å˜ä½“è‡ªåŠ¨è¯†åˆ«
- [ ] å®¡æ ¸è§„åˆ™æ™ºèƒ½æ¨è
- [ ] å®¡æ ¸æ•°æ®å¯è§†åŒ–æŠ¥è¡¨

### 12.2 ä¸­æœŸè§„åˆ’ (3-6ä¸ªæœˆ)

- [ ] AIè‡ªåŠ¨ä¿®æ­£å»ºè®®
- [ ] å®æ—¶åä½œå®¡æ ¸ï¼ˆå¤šäººåŒæ—¶å®¡æ ¸ï¼‰
- [ ] å®¡æ ¸æ¨¡å‹è®­ç»ƒå’Œä¼˜åŒ–
- [ ] è·¨å¹³å°å®¡æ ¸èƒ½åŠ›

### 12.3 é•¿æœŸæ„¿æ™¯ (6-12ä¸ªæœˆ)

- [ ] è‡ªç ”AIå®¡æ ¸æ¨¡å‹
- [ ] å¤šè¯­è¨€å®¡æ ¸æ”¯æŒ
- [ ] è§†é¢‘/éŸ³é¢‘å†…å®¹å®¡æ ¸
- [ ] æ™ºèƒ½å®¡æ ¸åŠ©æ‰‹

---

## 13. å‚è€ƒæ–‡æ¡£

- [å†™ä½œç«¯æ¨¡å—è®¾è®¡](./README_å†™ä½œç«¯æ¨¡å—è®¾è®¡æ–‡æ¡£æ€»è§ˆ.md)
- [ç¼–è¾‘å™¨ç³»ç»Ÿè®¾è®¡](./ç¼–è¾‘å™¨ç³»ç»Ÿè®¾è®¡.md)
- [AIæœåŠ¡æ¶æ„è®¾è®¡](../ai/01.AIæœåŠ¡æ¶æ„è®¾è®¡.md)
- [å®‰å…¨è®¾è®¡ä¸å¨èƒå»ºæ¨¡](../security/å®‰å…¨è®¾è®¡ä¸å¨èƒå»ºæ¨¡.md)
- [MongoDBåº”ç”¨å±‚ä¼˜åŒ–è®¾è®¡](../database/MongoDBåº”ç”¨å±‚ä¼˜åŒ–è®¾è®¡.md)

---

## é™„å½•

### A. æ•æ„Ÿè¯åˆ†ç±»ä½“ç³»

| ä¸€çº§åˆ†ç±» | äºŒçº§åˆ†ç±» | ç¤ºä¾‹ |
|---------|---------|-----|
| æ”¿æ²»æ•æ„Ÿ | å›½å®¶é¢†å¯¼äºº | ... |
| æ”¿æ²»æ•æ„Ÿ | æ”¿æ²»äº‹ä»¶ | ... |
| è‰²æƒ…ä½ä¿— | éœ²éª¨æå†™ | ... |
| è‰²æƒ…ä½ä¿— | æ€§æš—ç¤º | ... |
| æš´åŠ›è¡€è…¥ | æš´åŠ›è¡Œä¸º | ... |
| æš´åŠ›è¡€è…¥ | è¡€è…¥æå†™ | ... |
| è¿æ³•çŠ¯ç½ª | æ¯’å“èµŒåš | ... |
| è¿æ³•çŠ¯ç½ª | è¯ˆéª—ä¼ é”€ | ... |
| å¹¿å‘Šè¥é”€ | è”ç³»æ–¹å¼ | ... |
| å¹¿å‘Šè¥é”€ | å¤–éƒ¨é“¾æ¥ | ... |

### B. å®¡æ ¸è§„åˆ™é…ç½®ç¤ºä¾‹

```yaml
audit_rules:
  # æ•æ„Ÿè¯æ£€æµ‹
  sensitive_word:
    enabled: true
    strictness: medium # low, medium, high
    categories:
      - political
      - porn
      - violence
  
  # æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹
  regex:
    enabled: true
    patterns:
      - pattern: '1[3-9]\d{9}'
        category: contact
        level: medium
  
  # è§„åˆ™å¼•æ“
  rule_engine:
    enabled: true
    rules:
      - name: frequent_repeat
        condition: word_repeat_count > 5
        level: low
      - name: special_char_ratio
        condition: special_char_ratio > 0.2
        level: medium
  
  # AIæ£€æµ‹
  ai_detector:
    enabled: false # é»˜è®¤å…³é—­ï¼ŒæŒ‰éœ€å¼€å¯
    model: "content-moderation-v1"
    threshold: 0.7
```

---

**æ–‡æ¡£çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-10-17  
**ä¸‹ä¸€æ­¥**: è¿›å…¥å¼€å‘é˜¶æ®µ

