# 快捷键系统设计

> **版本**: v1.0  
> **创建日期**: 2025-10-21  
> **状态**: ✅ 已实现，补充设计文档

---

## 1. 设计概述

### 1.1 业务价值

- 提升写作效率（减少鼠标操作）
- 个性化定制体验
- 支持多平台快捷键适配

### 1.2 实现情况

**已实现**：
- 完整的快捷键配置模型
- 预定义快捷键模板
- 用户自定义快捷键

**文件位置**：`models/document/shortcut.go`

---

## 2. 核心数据模型

### 2.1 ShortcutConfig（快捷键配置）

```go
type ShortcutConfig struct {
    ID        string              `bson:"_id,omitempty" json:"id"`
    UserID    string              `bson:"userId" json:"userId"`
    Shortcuts map[string]Shortcut `bson:"shortcuts" json:"shortcuts"` // key: action
    CreatedAt time.Time           `bson:"createdAt" json:"createdAt"`
    UpdatedAt time.Time           `bson:"updatedAt" json:"updatedAt"`
}

type Shortcut struct {
    Action      string `json:"action"`      // 操作名称
    Key         string `json:"key"`         // 按键组合 (e.g., "Ctrl+S")
    Description string `json:"description"` // 描述
    Category    string `json:"category"`    // 分类
    IsCustom    bool   `json:"isCustom"`    // 是否自定义
}
```

**字段说明**：
- `Shortcuts`: 使用map结构，key为action，便于快速查找
- `IsCustom`: 区分默认快捷键和用户自定义

---

## 3. 独特设计亮点

### 3.1 预定义快捷键模板

```go
var DefaultShortcuts = map[string]Shortcut{
    "save":           {Action: "save", Key: "Ctrl+S", Category: "文档操作"},
    "bold":           {Action: "bold", Key: "Ctrl+B", Category: "文本格式"},
    "italic":         {Action: "italic", Key: "Ctrl+I", Category: "文本格式"},
    "undo":           {Action: "undo", Key: "Ctrl+Z", Category: "编辑"},
    "redo":           {Action: "redo", Key: "Ctrl+Y", Category: "编辑"},
    "ai_continue":    {Action: "ai_continue", Key: "Ctrl+J", Category: "AI辅助"},
    "fullscreen":     {Action: "fullscreen", Key: "F11", Category: "视图"},
    "search":         {Action: "search", Key: "Ctrl+F", Category: "导航"},
}
```

### 3.2 快捷键分类管理

```go
// GetShortcutsByCategory 按分类获取快捷键
func GetShortcutsByCategory(shortcuts map[string]Shortcut) map[string][]Shortcut {
    categorized := make(map[string][]Shortcut)
    for _, sc := range shortcuts {
        categorized[sc.Category] = append(categorized[sc.Category], sc)
    }
    return categorized
}
```

**优势**：
- 分类展示，便于用户查找
- 支持按类别导出/导入

### 3.3 冲突检测

```go
// ValidateShortcut 验证快捷键是否冲突
func ValidateShortcut(config *ShortcutConfig, action string, key string) error {
    for existingAction, shortcut := range config.Shortcuts {
        if existingAction != action && shortcut.Key == key {
            return fmt.Errorf("快捷键 %s 已被 %s 占用", key, existingAction)
        }
    }
    return nil
}
```

---

## 4. Service层设计

### 4.1 核心方法

```go
type ShortcutService interface {
    // GetUserShortcuts 获取用户快捷键配置
    GetUserShortcuts(ctx context.Context, userID string) (*ShortcutConfig, error)
    
    // UpdateShortcut 更新单个快捷键
    UpdateShortcut(ctx context.Context, userID string, action string, key string) error
    
    // ResetToDefault 重置为默认快捷键
    ResetToDefault(ctx context.Context, userID string) error
    
    // ExportShortcuts 导出快捷键配置
    ExportShortcuts(ctx context.Context, userID string) (map[string]Shortcut, error)
    
    // ImportShortcuts 导入快捷键配置
    ImportShortcuts(ctx context.Context, userID string, shortcuts map[string]Shortcut) error
}
```

---

## 5. API设计

```
GET    /api/v1/shortcuts           - 获取快捷键配置
PUT    /api/v1/shortcuts/:action   - 更新快捷键
POST   /api/v1/shortcuts/reset     - 重置为默认
POST   /api/v1/shortcuts/export    - 导出配置
POST   /api/v1/shortcuts/import    - 导入配置
```

---

## 6. 与v2.1架构的关系

```
Writing Module
  └─ Document Module
      └─ ShortcutConfig (个性化配置)
```

**集成点**：
- 编辑器初始化时加载用户快捷键
- 支持跨设备同步（存储在MongoDB）

---

## 7. 实现参考

**代码文件**：
- `models/document/shortcut.go` - 数据模型
- `service/document/shortcut_service.go`（待创建） - 业务逻辑
- `api/v1/writer/shortcut_api.go`（待创建） - API接口

**索引策略**：
```javascript
db.shortcut_configs.createIndex({ "userId": 1 }, { unique: true })
```

---

**文档状态**: ✅ 已完成  
**优先级**: P0

