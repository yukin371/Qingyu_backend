# 阅读端模块设计文档

> **架构版本**: v2.1  
> **最后更新**: 2025-10-21  
> **模块定位**: 青羽平台阅读端核心功能

## 📋 概述

阅读端模块为用户提供完整的在线阅读体验，包括书城浏览、书籍阅读、社交互动、阅读任务等功能。本模块遵循v2.1架构设计，采用事件驱动和清晰的模块边界。

## 🏗️ 模块架构（v2.1更新）

```
reading/
├── bookstore/          # 1.1 书城系统（6份文档）
├── reader/             # 1.2 阅读器（6份文档）
├── social/             # 1.3 社交系统（1份文档）
├── reading_task/       # 1.4 阅读任务（1份文档，v2.1重新设计）
├── _archived/          # 已过时文档（2份）
├── README_阅读端模块设计文档.md  # 本文档
└── 推荐系统设计.md      # 推荐系统（考虑移动到独立模块）
```

**v2.1架构更新**（2025-10-21）：
- ✅ 采用二级子目录结构，提升文档可维护性
- ✅ 单目录文档数量从18份降至≤6份
- ✅ 清晰的模块职责划分
- ✅ 过时文档归档到_archived/目录

## 📚 设计文档索引

### 1.1 书城系统 (Bookstore)

#### [书城系统设计](./书城系统设计.md)
**功能范围**：
- 书城首页（轮播Banner、榜单展示）
- 书籍分类和浏览
- 搜索和筛选
- Banner和运营活动

**核心数据**：
- Book（书籍信息）
- Category（分类）
- Banner（轮播图）
- BookStatistics（统计数据）

**状态**：✅ 已完成

#### [书籍详情页开发设计](./书籍详情页开发设计.md)
**功能范围**：
- 书籍详情展示
- 章节目录
- 评分和评论
- 加入书架功能

**状态**：✅ 已完成

#### [书城仓储层实现检测报告](./书城仓储层实现检测报告.md)
**文档类型**：技术验证报告  
**内容**：Repository层实现的检测和验证  
**状态**：✅ 已完成

### 1.2 阅读器 (Reader)

#### [阅读器设计](./阅读器设计.md)
**功能范围**：
- 章节内容展示
- 阅读设置（字体、主题、翻页模式）
- 阅读进度同步
- 书签和笔记功能

**核心数据**：
- ReadingProgress（阅读进度）
- Bookmark（书签）
- Note（笔记）
- ReadingSettings（阅读设置）

**状态**：✅ 已完成

### 1.3 推荐系统 (Recommendation)

#### [推荐系统设计](./推荐系统设计.md)
**功能范围**：
- 个性化推荐算法（协同过滤、内容推荐）
- 用户画像构建
- 推荐效果评估
- 冷启动处理

**技术特性**：
- 协同过滤算法
- 标签权重计算
- A/B测试支持

**状态**：✅ 已完成

### 1.4 社交系统 (Social)

#### [社交功能设计](./社交功能设计.md)
**功能范围**：
- 评论系统（段评、章评、书评）
- 互动功能（点赞、收藏、分享、打赏）
- 用户关系（关注、粉丝、好友）
- 书圈功能

**核心数据**：
- Comment（评论）
- Like（点赞）
- Follow（关注关系）
- BookCircle（书圈）

**状态**：✅ 已完成

### 1.5 阅读任务 (Reading Task) - v2.1重新设计

#### [阅读任务系统设计v2](./阅读任务系统设计v2.md) ⭐
**功能范围**：
- 任务定义和配置
- 任务进度追踪
- 任务完成判定
- **触发奖励事件**（不直接修改余额和经验值）

**v2.1架构特性**：
- ✅ 职责明确：只负责任务流程管理
- ✅ 事件驱动：通过`TaskCompletedEvent`触发奖励
- ✅ 与User Level和Wallet Service解耦

**核心流程**：
```
Reading Task完成 
  → 发布TaskCompletedEvent{经验值, 代币数}
    ├→ User Level订阅 → 增加经验值 → 检查升级
    └→ Wallet Service订阅 → 增加代币 → 记录交易
```

**状态**：✅ v2版本已完成

**替代**：旧版 `阅读任务设计.md` 已过时，请使用v2版本

### 搁置功能

#### [生词本设计(搁置)](./生词本设计(搁置).md)
**功能范围**：划词查询、生词收集、复习提醒  
**状态**：⏸️ 已搁置

## 🔄 过时文档说明

### [阅读任务设计.md](./阅读任务设计.md) - ⚠️ 已过时
> 本文档基于v2.0架构设计，职责边界不清晰。  
> **替代文档**：[阅读任务系统设计v2](./阅读任务系统设计v2.md)  
> **过时原因**：
> - 未明确与User Level、Wallet Service的边界
> - 直接修改用户余额和经验值
> - 缺少事件发布机制

## 🎯 v2.1架构要点

### 模块边界优化

根据 [模块边界优化方案](../重构规划/模块边界优化方案.md)：

| 模块 | 职责 | 数据源 |
|------|------|--------|
| **Reading Task** | 任务流程、触发奖励事件 | 任务状态 |
| **User Level** | 等级计算、成就解锁 | 经验值（唯一） |
| **Wallet Service** | 代币余额管理 | 代币余额（唯一） |

### 事件驱动架构

Reading Task发布的核心事件：
- `task.completed` - 任务完成事件
- `task.progress_updated` - 任务进度更新事件

订阅者：
- User Level Service → 增加经验值
- Wallet Service → 增加代币奖励
- Notification Service → 发送完成通知

## 🔗 相关文档

### 架构总览
- [青羽平台模块化架构设计v2.1](../青羽平台模块化架构设计v2.1.md) - 第一章：阅读端模块

### 相关模块
- [用户等级成就系统](../platform/用户等级成就系统设计.md) - 经验值管理和等级计算
- [钱包系统](../shared/钱包系统设计.md) - 代币余额管理
- [事件驱动架构](../core/事件驱动架构设计.md) - 事件发布和订阅机制

### 测试文档
- [书城系统测试设计](../testing/书城系统测试设计.md) - 书城系统的测试用例

## 🚀 开发优先级

### P0 - 核心功能 (MVP)
1. ✅ 书城系统（首页、详情、分类）
2. ✅ 基础阅读器（章节展示、阅读设置）
3. ✅ 简单推荐（基于标签）
4. ✅ 阅读任务v2（事件驱动）

### P1 - 完善功能
1. 书签笔记功能
2. 社交功能完善
3. 高级推荐算法
4. 阅读数据分析

### P2 - 扩展功能
1. 生词本（待启动）
2. 阅读助手AI
3. 个性化书单

## 📞 联系方式

**文档维护者**：青羽阅读端架构组  
**最后更新**：2025-10-21  
**架构版本**：v2.1
