# 搜索索引系统设计文档

## 1. 概述

### 1.1 项目背景
高效的搜索功能是提升用户在青羽写作平台查找和管理内容效率的关键。本系统旨在为文档、大纲、角色卡等核心内容提供快速、准确的全文搜索能力。

### 1.2 设计目标
- **快速响应**：保证搜索请求的低延迟
- **高相关性**：提供与查询意图高度相关的搜索结果
- **全文索引**：支持对所有核心内容的全文索引
- **实时更新**：保证索引数据与主数据源的实时同步
- **易于扩展**：支持未来新增内容类型的索引

## 2. 技术架构

### 2.1 整体架构
```
┌─────────────────┐
│   Frontend      │ ← 搜索界面
├─────────────────┤
│   Router        │ ← 路由层：/api/v1/search
├─────────────────┤
│   API Layer     │ ← 搜索接口
├─────────────────┤
│   Search Service│ ← 搜索服务
├─────────────────┤
│   Elasticsearch │ ← 搜索引擎
├─────────────────┤
│   Data Sync     │ ← 数据同步模块
└─────────────────┘
```

### 2.2 模块划分
- **Search API**：提供统一的搜索接口
- **Search Service**：封装Elasticsearch查询逻辑，处理搜索请求
- **Elasticsearch Cluster**：负责存储索引数据和执行搜索
- **Data Sync Service**：负责将主数据库的数据同步到Elasticsearch

## 3. 功能设计

### 3.1 索引管理
- **索引创建**：为不同类型的内容（文档、大纲等）创建独立的索引
- **索引更新**：通过Data Sync Service实时更新索引
- **索引重建**：支持手动或自动重建索引

### 3.2 搜索功能
- **关键词搜索**：支持多关键词、短语搜索
- **高级搜索**：支持按作者、标签、时间范围等条件过滤
- **结果高亮**：在搜索结果中高亮显示匹配的关键词

## 4. 数据模型

### 4.1 文档索引模型 (Elasticsearch)
```json
{
  "mappings": {
    "properties": {
      "id": { "type": "keyword" },
      "title": { "type": "text" },
      "content": { "type": "text" },
      "authorId": { "type": "keyword" },
      "tags": { "type": "keyword" },
      "createdAt": { "type": "date" }
    }
  }
}
```

## 5. 接口设计

### 5.1 GET /api/v1/search
- **功能**：执行搜索
- **请求参数**：`q` (查询字符串), `type` (内容类型), `author` (作者), `tags` (标签)
- **响应**：`{ "results": [ ... ], "total": ... }`