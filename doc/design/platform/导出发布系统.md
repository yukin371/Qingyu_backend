# 导出发布系统设计文档

## 1. 概述

### 1.1 项目背景
导出与发布是创作者完成作品后的最后一公里。青羽写作平台提供强大的导出和发布功能，帮助用户将作品以多种格式交付，或直接发布到主流内容平台。

### 1.2 设计目标
- **多格式支持**：支持导出为PDF, Word, Markdown, ePub等多种格式
- **高质量排版**：保证导出文件的排版质量和阅读体验
- **平台集成**：支持一键发布到博客、社交媒体等平台
- **异步处理**：对于大型文档的导出，采用异步任务处理，避免阻塞用户界面
- **模板化**：支持用户自定义导出模板

## 2. 技术架构

### 2.1 整体架构

```plaintext
┌─────────────────┐
│   Frontend      │ ← 导出选项界面
├─────────────────┤
│   Router        │ ← 路由层：/api/v1/export/*
├─────────────────┤
│   API Layer     │ ← 导出任务接口
├─────────────────┤
│   Task Queue    │ ← 异步任务队列 (e.g., RabbitMQ)
├─────────────────┤
│   Export Worker │ ← 导出任务处理器
├─────────────────┤
│   File Storage  │ ← 导出文件存储 (e.g., S3)
└─────────────────┘
```

### 2.2 模块划分
- **Export API**：接收导出请求，创建导出任务
- **Task Queue**：管理导出任务队列，实现异步处理
- **Export Worker**：执行具体的导出操作，如格式转换、排版等
- **Template Engine**：管理和应用导出模板
- **Publisher**：负责将内容发布到第三方平台

## 3. 功能设计

### 3.1 导出功能
- **格式选择**：提供多种导出格式选项
- **模板选择**：允许用户选择或自定义导出模板
- **任务管理**：用户可以查看导出任务的状态和历史记录

### 3.2 发布功能
- **平台绑定**：用户可以绑定自己的博客、社交媒体等平台的账号
- **一键发布**：将内容直接发布到已绑定的平台
- **发布记录**：记录发布历史和状态

## 4. 数据模型

### 4.1 导出任务模型
```go
type ExportTask struct {
    ID         string    `bson:"_id,omitempty" json:"id"`
    UserID     string    `bson:"user_id" json:"userId"`
    DocumentID string    `bson:"document_id" json:"documentId"`
    Format     string    `bson:"format" json:"format"`
    Status     string    `bson:"status" json:"status"`
    FileURL    string    `bson:"file_url" json:"fileUrl"`
    CreatedAt  time.Time `bson:"created_at" json:"createdAt"`
}
```

## 5. 接口设计

### 5.1 POST /api/v1/export
- **功能**：创建导出任务
- **请求**：`{ "documentId": "...", "format": "pdf" }`
- **响应**：`{ "taskId": "..." }`

### 5.2 GET /api/v1/export/:taskId
- **功能**：查询导出任务状态
- **请求**：`{}`
- **响应**：`{ "status": "...", "fileUrl": "..." }`