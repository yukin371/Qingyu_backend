# APIè¿ç§»æ£€æŸ¥æ¸…å•

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¥æœŸ**: 2026-01-29
> **ç”¨é€”**: ç¡®ä¿APIè¿ç§»çš„å®Œæ•´æ€§å’Œè´¨é‡

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

æœ¬æ£€æŸ¥æ¸…å•ç”¨äºéªŒè¯ä»`shared`åŒ…åˆ°`response`åŒ…çš„APIè¿ç§»æ˜¯å¦å®Œæ•´ä¸”æ­£ç¡®ã€‚

**æ‰“å°å‹å¥½ç‰ˆæœ¬**: å¯ä»¥ä½¿ç”¨`[ ]`å¤é€‰æ¡†æ‰“å°åæ‰‹åŠ¨å‹¾é€‰

---

## é˜¶æ®µ0ï¼šè¿ç§»å‰å‡†å¤‡

### ç¯å¢ƒæ£€æŸ¥

- [ ] å·²åˆ›å»ºfeatureåˆ†æ”¯ï¼ˆå¦‚`feature/block8-writer-migration`ï¼‰
- [ ] å·²å¤‡ä»½å½“å‰ä»£ç çŠ¶æ€
- [ ] å·²è¿è¡ŒåŸºçº¿æµ‹è¯•å¹¶è®°å½•ç»“æœ
- [ ] å·²é˜…è¯»APIè¿ç§»æŒ‡å—
- [ ] å·²äº†è§£responseåŒ…çš„APIå’Œç”¨æ³•

### å·¥å…·æ£€æŸ¥

- [ ] Goç‰ˆæœ¬æ­£ç¡®ï¼ˆ1.21+ï¼‰
- [ ] ç¼–è¾‘å™¨/IDEé…ç½®æ­£ç¡®
- [ ] Gité…ç½®æ­£ç¡®
- [ ] å¯ä»¥è®¿é—®è¿œç¨‹ä»“åº“

---

## é˜¶æ®µ1ï¼šæ–‡ä»¶çº§è¿ç§»æ£€æŸ¥

### 1.1 ä»£ç è¿ç§»

#### shared.Erroræ›¿æ¢

- [ ] æ‰€æœ‰`shared.Error(c, http.StatusBadRequest, ...)` â†’ `response.BadRequest(c, ...)`
- [ ] æ‰€æœ‰`shared.Error(c, http.StatusUnauthorized, ...)` â†’ `response.Unauthorized(c, ...)`
- [ ] æ‰€æœ‰`shared.Error(c, http.StatusForbidden, ...)` â†’ `response.Forbidden(c, ...)`
- [ ] æ‰€æœ‰`shared.Error(c, http.StatusNotFound, ...)` â†’ `response.NotFound(c, ...)`
- [ ] æ‰€æœ‰`shared.Error(c, http.StatusConflict, ...)` â†’ `response.Conflict(c, ...)`
- [ ] æ‰€æœ‰`shared.Error(c, http.StatusInternalServerError, ...)` â†’ `response.InternalError(c, ...)`

#### shared.Successæ›¿æ¢

- [ ] æ‰€æœ‰`shared.Success(c, http.StatusOK, ...)` â†’ `response.Success(c, ...)`
- [ ] æ‰€æœ‰`shared.Success(c, http.StatusCreated, ...)` â†’ `response.Created(c, ...)`
- [ ] æ‰€æœ‰`shared.Success(c, http.StatusNoContent, ...)` â†’ `response.NoContent(c)`

#### shared.ValidationErroræ›¿æ¢

- [ ] æ‰€æœ‰`shared.ValidationError(c, err)` â†’ `response.BadRequest(c, "å‚æ•°é”™è¯¯", err.Error())`

#### å‚æ•°æ¸…ç†

- [ ] ç§»é™¤æ‰€æœ‰HTTPçŠ¶æ€ç å‚æ•°ï¼ˆå¦‚`http.StatusOK`ï¼‰
- [ ] ç®€åŒ–æ¶ˆæ¯å‚æ•°ï¼ˆåˆå¹¶åˆ°responseåŒ…å†…éƒ¨å¤„ç†ï¼‰

### 1.2 å¯¼å…¥æ¸…ç†

- [ ] ç§»é™¤`"Qingyu_backend/api/v1/shared"`å¯¼å…¥
- [ ] ç§»é™¤`"net/http"`å¯¼å…¥ï¼ˆé™¤éä½¿ç”¨WebSocketï¼‰
- [ ] æ·»åŠ `"Qingyu_backend/pkg/response"`å¯¼å…¥
- [ ] æ¸…ç†æœªä½¿ç”¨çš„å…¶ä»–å¯¼å…¥

### 1.3 ç‰¹æ®Šåœºæ™¯å¤„ç†

- [ ] WebSocketï¼šä¿ç•™`net/http`å¯¼å…¥
- [ ] æ–‡ä»¶ä¸‹è½½ï¼šä¿æŒ`c.FileAttachment`ä¸å˜
- [ ] æ‰¹é‡æ“ä½œï¼šå¼‚æ­¥æ‰§è¡Œé€»è¾‘æ­£ç¡®
- [ ] ç‰ˆæœ¬å†²çªï¼šä½¿ç”¨`response.Conflict`å¤„ç†

### 1.4 Swaggeræ–‡æ¡£æ›´æ–°

- [ ] æ‰€æœ‰`shared.APIResponse` â†’ `response.APIResponse`
- [ ] Successå“åº”æ³¨é‡Šæ›´æ–°
- [ ] Failureå“åº”æ³¨é‡Šæ›´æ–°
- [ ] ç¤ºä¾‹å“åº”æ›´æ–°

---

## é˜¶æ®µ2ï¼šéªŒè¯æ£€æŸ¥

### 2.1 ç¼–è¯‘éªŒè¯

```bash
# æ‰§è¡Œç¼–è¯‘æ£€æŸ¥
go build ./api/v1/writer/xxx_api.go
```

- [ ] æ–‡ä»¶ç¼–è¯‘é€šè¿‡
- [ ] æ— ç±»å‹é”™è¯¯
- [ ] æ— å¯¼å…¥é”™è¯¯
- [ ] æ— æœªå®šä¹‰å˜é‡

### 2.2 æµ‹è¯•éªŒè¯

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
go test -v ./api/v1/writer/xxx_api_test.go

# è¿è¡Œå®Œæ•´æ¨¡å—æµ‹è¯•
go test -v ./api/v1/writer/
```

- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] æ— æµ‹è¯•å¤±è´¥
- [ ] æ— æµ‹è¯•è·³è¿‡ï¼ˆé™¤éæœ‰æ„ä¸ºä¹‹ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

### 2.3 ä»£ç è´¨é‡æ£€æŸ¥

```bash
# è¿è¡Œä»£ç æ£€æŸ¥
go vet ./api/v1/writer/xxx_api.go

# è¿è¡Œlinterï¼ˆå¦‚æœæœ‰ï¼‰
golangci-lint run api/v1/writer/xxx_api.go
```

- [ ] `go vet`æ£€æŸ¥é€šè¿‡
- [ ] æ— linterè­¦å‘Šï¼ˆæˆ–å·²å¤„ç†ï¼‰
- [ ] ä»£ç æ ¼å¼æ­£ç¡®ï¼ˆ`go fmt`ï¼‰

### 2.4 æ‰‹åŠ¨éªŒè¯

- [ ] æ£€æŸ¥å“åº”æ ¼å¼ç¬¦åˆè§„èŒƒ
- [ ] æ£€æŸ¥é”™è¯¯ç ä½¿ç”¨æ­£ç¡®ï¼ˆ4ä½ï¼‰
- [ ] æ£€æŸ¥æ—¶é—´æˆ³ä¸ºæ¯«ç§’çº§
- [ ] æ£€æŸ¥RequestIDæ­£ç¡®ä¼ é€’

---

## é˜¶æ®µ3ï¼šGitæäº¤æ£€æŸ¥

### 3.1 æäº¤å†…å®¹

- [ ] å·²æ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶
- [ ] å·²æ·»åŠ æµ‹è¯•æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] æœªæ·»åŠ æ— å…³æ–‡ä»¶
- [ ] æäº¤ä¿¡æ¯æ ¼å¼æ­£ç¡®

### 3.2 æäº¤ä¿¡æ¯æ¨¡æ¿

```bash
feat(api): migrate xxx_api to new response package

- Replace all shared.Error calls with response functions
- Replace all shared.Success calls with response functions
- Replace all shared.ValidationError calls
- Remove HTTP status code parameters
- Update Swagger annotations
- Clean up imports (remove shared, net/http)

Test: All unit tests passing
```

- [ ] æäº¤ä¿¡æ¯åŒ…å«åŠŸèƒ½æè¿°
- [ ] æäº¤ä¿¡æ¯åŒ…å«ä¸»è¦å˜æ›´
- [ ] æäº¤ä¿¡æ¯åŒ…å«æµ‹è¯•çŠ¶æ€

---

## é˜¶æ®µ4ï¼šæ•´ä½“éªŒæ”¶æ£€æŸ¥

### 4.1 å®Œæ•´æ€§æ£€æŸ¥

```bash
# æœç´¢æ®‹ç•™çš„sharedè°ƒç”¨
grep -r "shared\.(Error|Success|ValidationError)" api/v1/writer
```

- [ ] æ— shared.Erroræ®‹ç•™
- [ ] æ— shared.Successæ®‹ç•™
- [ ] æ— shared.ValidationErroræ®‹ç•™
- [ ] æ— sharedåŒ…å¯¼å…¥æ®‹ç•™

### 4.2 ä¸€è‡´æ€§æ£€æŸ¥

- [ ] æ‰€æœ‰APIä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼
- [ ] æ‰€æœ‰é”™è¯¯ä½¿ç”¨4ä½é”™è¯¯ç 
- [ ] æ‰€æœ‰æ—¶é—´æˆ³ä¸ºæ¯«ç§’çº§
- [ ] æ‰€æœ‰Swaggeræ³¨é‡Šå·²æ›´æ–°

### 4.3 æµ‹è¯•è¦†ç›–

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
go test -v ./api/v1/writer/...

# æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
go test -cover ./api/v1/writer/...
```

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡ç¬¦åˆè¦æ±‚
- [ ] æ— æ–°å¢æµ‹è¯•å¤±è´¥

### 4.4 æ–‡æ¡£å®Œæ•´æ€§

- [ ] Swaggeræ–‡æ¡£å·²ç”Ÿæˆ/æ›´æ–°
- [ ] APIæ–‡æ¡£ä¸ä»£ç ä¸€è‡´
- [ ] å˜æ›´æ—¥å¿—å·²æ›´æ–°
- [ ] è¿ç§»è®°å½•å·²æ›´æ–°

---

## é˜¶æ®µ5ï¼šPRåˆ›å»ºæ£€æŸ¥

### 5.1 å‡†å¤‡å·¥ä½œ

- [ ] æ‰€æœ‰æ›´æ”¹å·²æäº¤åˆ°æœ¬åœ°åˆ†æ”¯
- [ ] åˆ†æ”¯å·²æ¨é€åˆ°è¿œç¨‹
- [ ] PRæè¿°å·²å‡†å¤‡å®Œæ•´
- [ ] ç›¸å…³Issueå·²å…³è”

### 5.2 PRæè¿°æ¨¡æ¿

```markdown
## æ¦‚è¿°
æœ¬PRå®Œæˆäº†xxxæ¨¡å—çš„APIè§„èŒƒåŒ–è¿ç§»ï¼Œä»sharedåŒ…è¿ç§»åˆ°responseåŒ…ã€‚

## å˜æ›´å†…å®¹
- è¿ç§»æ–‡ä»¶ï¼šxxx_api.go
- å“åº”è°ƒç”¨ï¼šNNæ¬¡
- æµ‹è¯•çŠ¶æ€ï¼šå…¨éƒ¨é€šè¿‡

## æµ‹è¯•ç»“æœ
- å•å…ƒæµ‹è¯•ï¼šNN/NNé€šè¿‡
- é›†æˆæµ‹è¯•ï¼šNN/NNé€šè¿‡
- ç¼–è¯‘çŠ¶æ€ï¼šâœ… é€šè¿‡

## ç›¸å…³æ–‡æ¡£
- APIè¿ç§»æŒ‡å—ï¼š[é“¾æ¥]
- åˆ†ææŠ¥å‘Šï¼š[é“¾æ¥]
```

- [ ] PRæè¿°åŒ…å«æ¦‚è¿°
- [ ] PRæè¿°åŒ…å«å˜æ›´å†…å®¹
- [ ] PRæè¿°åŒ…å«æµ‹è¯•ç»“æœ
- [ ] PRæè¿°åŒ…å«ç›¸å…³æ–‡æ¡£é“¾æ¥

### 5.3 å®¡æŸ¥æ£€æŸ¥

- [ ] å·²æ·»åŠ å®¡æŸ¥è€…
- [ ] å·²è®¾ç½®æ ‡ç­¾ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] å·²å…³è”é¡¹ç›®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] CIæ£€æŸ¥é€šè¿‡

---

## å¿«é€Ÿå‚è€ƒï¼šå¸¸è§é—æ¼ç‚¹

### âš ï¸ ç»å¸¸é—æ¼çš„é¡¹ç›®

1. **Swaggeræ³¨é‡Šæœªæ›´æ–°**
   - æ£€æŸ¥ï¼š`grep "shared.APIResponse" api/v1/writer/`

2. **net/httpå¯¼å…¥æœªæ¸…ç†**
   - æ£€æŸ¥ï¼š`grep "\"net/http\"" api/v1/writer/xxx_api.go`
   - ä¾‹å¤–ï¼šWebSocketç›¸å…³æ–‡ä»¶

3. **é”™è¯¯ç æœªæ›´æ–°**
   - æ£€æŸ¥ï¼šä»£ç ä¸­æ˜¯å¦è¿˜æœ‰4ä½é”™è¯¯ç 

4. **æœªæå–helperå‡½æ•°**
   - æ£€æŸ¥ï¼šæ˜¯å¦æœ‰é‡å¤çš„getUserIDã€å‚æ•°éªŒè¯ä»£ç 

5. **æµ‹è¯•æœªæ›´æ–°**
   - æ£€æŸ¥ï¼šæµ‹è¯•ä¸­çš„æ–­è¨€æ˜¯å¦åŒ¹é…æ–°å“åº”æ ¼å¼

### ğŸ” éªŒè¯å‘½ä»¤é€ŸæŸ¥

```bash
# æ£€æŸ¥sharedæ®‹ç•™
grep -r "shared\.(Error|Success|ValidationError)" api/v1/writer

# æ£€æŸ¥Swaggeræ³¨é‡Š
grep "shared.APIResponse" api/v1/writer

# æ£€æŸ¥net/httpå¯¼å…¥
grep "\"net/http\"" api/v1/writer/*.go | grep -v "websocket"

# è¿è¡Œæµ‹è¯•
go test -v ./api/v1/writer/...

# æ£€æŸ¥ç¼–è¯‘
go build ./api/v1/writer/...
```

---

## ç­¾å­—ç¡®è®¤

| è§’è‰² | å§“å | æ—¥æœŸ | ç­¾å­— |
|------|------|------|------|
| å¼€å‘è€… | | | |
| å®¡æŸ¥è€… | | | |
| æµ‹è¯•è€… | | | |

---

**æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-29
**ä¸‹æ¬¡å®¡æ ¸**: å®ŒæˆWriteræ¨¡å—è¿ç§»å
