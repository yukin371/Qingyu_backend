# MVP审查待办事项清单

> **创建日期**: 2025-10-20  
> **来源**: MVP阶段设计文档与代码审查报告  
> **优先级划分**: 🔥 高优先级 | ⭐ 中优先级 | 💡 低优先级

---

## 🔥 高优先级任务（本周完成）

### 1. 更新设计进度管理文档 🚨

**问题**: 设计进度文档状态与实际代码严重不一致

**任务清单**:
- [ ] 更新`doc/design/设计进度管理.md`第89行
  - 内容审核从"🔴 未开始 0%"更新为"✅ 已完成 95%"
- [ ] 更新第90行
  - 数据统计从"🔴 未开始 0%"更新为"✅ 已完成 85%"  
- [ ] 移除`router/enter.go:36-41`的过时警告信息
- [ ] 更新MVP核心功能最终确认文档的实施状态

**预计工时**: 1小时  
**负责人**: 项目文档管理员  
**截止日期**: 2025-10-22

---

### 2. 实现RankingRepository

**问题**: 榜单Repository未实现，导致榜单功能无法正常工作

**文件位置**: 
- ❌ 当前: `router/enter.go:58` 传入nil
- ✅ 需要: 创建`repository/mongodb/bookstore/ranking_repository_mongo.go`

**任务清单**:
- [ ] 创建`RankingRepository`接口的MongoDB实现
- [ ] 实现榜单数据的CRUD操作
- [ ] 实现榜单计算方法：
  - `CalculateRealtimeRanking()`
  - `CalculateWeeklyRanking()`
  - `CalculateMonthlyRanking()`
  - `CalculateNewbieRanking()`
- [ ] 创建榜单相关的MongoDB索引
- [ ] 在`router/enter.go`中正确注入Repository
- [ ] 编写单元测试

**参考文件**:
- 接口定义: `repository/interfaces/bookstore/RankingRepository_interface.go`
- 使用示例: `service/bookstore/bookstore_service.go:551-595`
- 调度器: `service/bookstore/ranking_scheduler.go`

**预计工时**: 4小时  
**负责人**: 后端开发  
**截止日期**: 2025-10-23

---

### 3. 补充核心模块单元测试

**问题**: Service层核心业务逻辑缺少单元测试，风险较高

**任务清单**:
- [ ] BookstoreService测试
  - `TestGetHomepageData()`
  - `TestSearchBooksWithFilter()`
  - `TestGetRankingByType()`
- [ ] ProjectService测试
  - `TestCreateProject()`
  - `TestGetProject()`
  - `TestListMyProjects()`
- [ ] WalletService测试
  - `TestRecharge()`
  - `TestConsume()`
  - `TestWithdraw()`
- [ ] AuthService测试
  - `TestLogin()`
  - `TestGenerateToken()`
  - `TestValidateToken()`
- [ ] ContentAuditService测试
  - `TestCheckContent()`
  - `TestAuditDocument()`

**目标覆盖率**: 70%以上

**预计工时**: 12小时  
**负责人**: QA + 开发  
**截止日期**: 2025-10-25

---

### 4. 完善API Swagger文档

**问题**: 部分API缺少Swagger注释，影响API文档生成

**任务清单**:
- [ ] 补充推荐API的Swagger注释 (`api/v1/recommendation/`)
- [ ] 补充文档API的Swagger注释 (`api/v1/writer/document_api.go`)
- [ ] 补充统计API的Swagger注释 (`api/v1/writer/stats_api.go`)
- [ ] 统一响应格式（确保所有API使用相同的Response结构）
- [ ] 统一4位错误码体系
- [ ] 生成完整的Swagger JSON文档
- [ ] 配置Swagger UI

**参考文件**:
- 良好示例: `api/v1/reading/bookstore_api.go`

**预计工时**: 6小时  
**负责人**: 后端开发  
**截止日期**: 2025-10-24

---

## ⭐ 中优先级任务（两周内完成）

### 5. 完善编辑器自动保存的版本冲突检测

**问题**: 当前版本冲突检测为简化实现

**文件位置**: `service/document/document_service.go:641-648`

**任务清单**:
- [ ] 实现完整的版本号比对逻辑
- [ ] 添加版本冲突时的用户提示
- [ ] 实现冲突解决策略：
  - 保留本地版本（覆盖服务器）
  - 保留服务器版本（丢弃本地）
  - 手动合并（需前端支持）
- [ ] 添加版本冲突的单元测试
- [ ] 在前端实现冲突提示UI

**预计工时**: 4小时  
**负责人**: 后端 + 前端开发  
**截止日期**: 2025-10-28

---

### 6. 实现三分账稿费结算机制

**问题**: 设计文档提到的三分账机制在代码中未明确体现

**设计文档**: `doc/design/shared/钱包系统设计.md`

**任务清单**:
- [ ] 定义分成规则数据模型
  - 作者分成比例
  - 平台分成比例
  - 渠道分成比例（如有）
- [ ] 在WalletService中实现分账逻辑
- [ ] 创建`RevenueShareService`处理收益分配
- [ ] 实现自动结算定时任务
- [ ] 添加分账记录和查询
- [ ] 创建分账报表API
- [ ] 编写单元测试

**预计工时**: 8小时  
**负责人**: 后端开发  
**截止日期**: 2025-10-30

---

### 7. 优化路由初始化，使用RepositoryFactory

**问题**: 路由层直接创建Repository实例，违反依赖注入原则

**文件位置**: `router/enter.go:48-62`

**当前代码**:
```go
// ⚠️ 直接创建Repository实例
bookRepo := mongoBookstore.NewMongoBookRepository(global.MongoClient, dbName)
```

**目标代码**:
```go
// ✅ 使用Factory创建
factory := mongodb.NewMongoRepositoryFactory(config)
bookRepo := factory.CreateBookRepository()
```

**任务清单**:
- [ ] 在`router/enter.go`中引入`RepositoryFactory`
- [ ] 使用Factory统一创建所有Repository
- [ ] 移除直接实例化Repository的代码
- [ ] 测试路由功能正常

**预计工时**: 2小时  
**负责人**: 后端开发  
**截止日期**: 2025-10-29

---

### 8. 补充数据库索引创建逻辑

**问题**: 代码中没有明确的索引创建逻辑，影响查询性能

**任务清单**:
- [ ] 在`migration/examples/`创建索引迁移脚本
  - `003_create_bookstore_indexes.go`
  - `004_create_user_indexes.go`
  - `005_create_document_indexes.go`
- [ ] 为高频查询字段创建索引：
  - books.category_ids
  - books.status
  - books.author_id
  - books.is_recommended
  - documents.project_id
  - documents.status
  - users.email
  - users.username
- [ ] 创建复合索引（根据常用查询组合）
- [ ] 在README中添加索引创建说明
- [ ] 执行迁移并验证性能提升

**预计工时**: 4小时  
**负责人**: 后端开发 + DBA  
**截止日期**: 2025-10-31

---

### 9. 完善DocumentContent保存逻辑

**问题**: 自动保存时DocumentContent的保存被标记为TODO

**文件位置**: `service/document/document_service.go:667-669`

**任务清单**:
- [ ] 实现DocumentContent的自动保存
- [ ] 确保内容与Document元数据同步
- [ ] 处理大文档的GridFS存储
- [ ] 添加内容校验逻辑
- [ ] 编写保存逻辑的单元测试

**预计工时**: 3小时  
**负责人**: 后端开发  
**截止日期**: 2025-10-30

---

### 10. 统一API响应格式和错误码

**问题**: 不同API使用不同的响应结构，错误码不一致

**任务清单**:
- [ ] 定义统一的`StandardResponse`结构
- [ ] 创建错误码枚举文件 `pkg/errors/error_codes.go`
- [ ] 定义完整的错误码体系：
  - 1000-1999: 通用错误
  - 2000-2999: 业务错误
  - 3000-3999: 权限错误
  - 4000-4999: 数据错误
  - 5000-5999: 系统错误
- [ ] 更新所有API使用统一响应格式
- [ ] 创建错误码文档
- [ ] 在前端统一处理错误码

**预计工时**: 6小时  
**负责人**: 后端 + 前端开发  
**截止日期**: 2025-11-01

---

## 💡 低优先级任务（迭代二或按需）

### 11. 实现Kafka+Flink实时数据计算（可选）

**说明**: 当前使用简化方案，数据量小时无需引入

**触发条件**: 
- 日活用户 > 10,000
- 每日行为数据 > 100万条
- 实时统计延迟 > 5分钟

**任务清单**:
- [ ] 搭建Kafka集群
- [ ] 搭建Flink集群
- [ ] 实现数据埋点采集
- [ ] 编写Flink实时计算任务
- [ ] 优化统计查询性能
- [ ] 迁移现有统计数据

**预计工时**: 40小时  
**负责人**: 大数据团队  
**截止日期**: 按需评估

---

### 12. 完善AI图片生成功能

**说明**: 接口已定义但实现不完整

**文件位置**: 
- 接口: `service/ai/adapter/adapter_interface.go:27`
- Service: `service/ai/image_service.go`

**任务清单**:
- [ ] 集成DALL-E或Stable Diffusion API
- [ ] 实现图片生成参数配置
- [ ] 实现生成结果的存储
- [ ] 添加图片审核（调用第三方API）
- [ ] 创建图片管理API
- [ ] 实现前端图片生成UI
- [ ] 添加成本控制

**预计工时**: 12小时  
**负责人**: AI团队  
**截止日期**: 迭代二

---

### 13. 实现OSS文件存储

**说明**: 生产环境建议使用云存储

**文件位置**: `service/shared/storage/storage_service.go`

**任务清单**:
- [ ] 选择OSS服务商（阿里云/腾讯云/AWS S3）
- [ ] 实现OSS Backend
- [ ] 配置OSS访问凭证
- [ ] 实现文件上传、下载、删除
- [ ] 实现私有文件的临时访问链接
- [ ] 配置CDN加速
- [ ] 迁移现有本地文件到OSS
- [ ] 添加文件存储监控

**预计工时**: 10小时  
**负责人**: 运维 + 后端开发  
**截止日期**: 生产上线前

---

### 14. 启用AI路由并完善功能

**说明**: AI功能已实现但路由被禁用

**文件位置**: `router/enter.go:75-78`

**任务清单**:
- [ ] 确认AI服务各项功能完整
- [ ] 移除路由注释，启用AI路由
- [ ] 配置AI服务的环境变量
- [ ] 测试AI聊天功能
- [ ] 测试AI文本生成
- [ ] 测试流式响应
- [ ] 创建AI功能的前端界面
- [ ] 添加AI使用说明文档

**预计工时**: 4小时  
**负责人**: 后端 + 前端开发  
**截止日期**: MVP上线后

---

### 15. 实现离线推荐计算任务

**说明**: 当前推荐为实时计算，大数据量时需要离线计算

**触发条件**: 
- 书籍数量 > 10,000
- 用户数量 > 100,000
- 推荐接口RT > 500ms

**任务清单**:
- [ ] 设计离线推荐任务调度
- [ ] 实现用户画像批量计算
- [ ] 实现协同过滤批量计算
- [ ] 实现推荐结果预计算和缓存
- [ ] 创建推荐效果评估指标
- [ ] 实现A/B测试框架
- [ ] 优化推荐算法参数

**预计工时**: 30小时  
**负责人**: 算法团队  
**截止日期**: 按需评估

---

### 16. 实现安全审计系统

**说明**: 设计文档已完成但未实施

**设计文档**: `doc/design/shared/安全审计设计.md`

**任务清单**:
- [ ] 创建审计日志数据模型
- [ ] 实现操作日志记录
- [ ] 实现用户行为追踪
- [ ] 实现异常检测规则
- [ ] 创建审计日志查询API
- [ ] 实现日志归档和清理
- [ ] 创建安全报表
- [ ] 集成到Admin管理后台

**预计工时**: 16小时  
**负责人**: 安全团队  
**截止日期**: 迭代三

---

### 17. 优化版本对比算法

**说题**: 当前使用简单的行差异算法，效果一般

**文件位置**: `service/project/version_service.go:819-890`

**当前实现**: 简单的逐行比对

**目标实现**: 使用Myers Diff算法或类似算法

**任务清单**:
- [ ] 引入diff库（如`github.com/sergi/go-diff`）
- [ ] 重构`CompareVersions()`方法
- [ ] 支持单词级别的diff
- [ ] 支持语义化的diff展示
- [ ] 优化大文件diff性能
- [ ] 添加diff结果的高亮渲染
- [ ] 编写性能测试

**预计工时**: 6小时  
**负责人**: 后端开发  
**截止日期**: 迭代二

---

### 18. 添加代码质量检查工具

**任务清单**:
- [ ] 配置golangci-lint
- [ ] 配置pre-commit钩子
- [ ] 添加代码覆盖率检查
- [ ] 配置CI/CD代码质量门禁
- [ ] 修复现有的linter warnings
- [ ] 创建代码规范文档

**预计工时**: 4小时  
**负责人**: DevOps  
**截止日期**: 本月底

---

## 📊 任务统计

### 按优先级统计

| 优先级 | 任务数 | 预计总工时 |
|-------|-------|-----------|
| 🔥 高优先级 | 4 | 23小时 |
| ⭐ 中优先级 | 6 | 33小时 |
| 💡 低优先级 | 8 | 122小时 |
| **总计** | **18** | **178小时** |

### 按类型统计

| 类型 | 任务数 | 占比 |
|-----|-------|------|
| 文档更新 | 1 | 6% |
| 功能实现 | 8 | 44% |
| 测试补充 | 2 | 11% |
| 代码优化 | 4 | 22% |
| 架构改进 | 3 | 17% |

### 按模块统计

| 模块 | 任务数 |
|-----|-------|
| 文档 | 1 |
| 书城 | 1 |
| 编辑器 | 2 |
| 钱包 | 1 |
| 路由 | 1 |
| 数据库 | 1 |
| API | 2 |
| 测试 | 1 |
| AI | 2 |
| 推荐 | 1 |
| 存储 | 1 |
| 审计 | 1 |
| 版本控制 | 1 |
| DevOps | 1 |

---

## 📅 时间规划

### Week 1 (2025-10-21 ~ 2025-10-27)

**目标**: 完成所有高优先级任务

- Mon: 任务1 - 更新文档 (1h)
- Tue-Wed: 任务2 - 实现RankingRepository (4h)
- Thu: 任务4 - 完善API文档 (6h)
- Fri-Sun: 任务3 - 补充单元测试 (12h)

### Week 2 (2025-10-28 ~ 2025-11-03)

**目标**: 完成中优先级任务

- Mon: 任务5 - 版本冲突检测 (4h)
- Tue: 任务7 - 优化路由初始化 (2h)
- Wed: 任务9 - DocumentContent保存 (3h)
- Thu: 任务8 - 数据库索引 (4h)
- Fri-Sun: 任务6 - 三分账结算 (8h) + 任务10 - 统一响应格式 (6h)

### Week 3+ (2025-11-04+)

**目标**: 根据需要处理低优先级任务

---

## ✅ 完成标准

每个任务完成时需要满足：

1. **代码实现**
   - 功能完整，符合需求
   - 代码规范，通过linter检查
   - 无明显bug

2. **测试验证**
   - 单元测试通过
   - 集成测试通过（如适用）
   - 手动测试验证

3. **文档更新**
   - 更新相关设计文档
   - 更新API文档
   - 添加代码注释

4. **Code Review**
   - 至少1人Review
   - 解决所有Review意见
   - 获得Approve

5. **部署验证**
   - 在测试环境验证
   - 确认无回归问题

---

## 📝 备注

1. **时间估算**: 所有工时为理想情况下的估算，实际可能有20-30%的偏差
2. **优先级调整**: 根据业务需求和用户反馈，优先级可能动态调整
3. **资源分配**: 需要根据团队实际情况合理分配任务
4. **并行处理**: 部分任务可以并行处理，加快整体进度
5. **持续更新**: 本文档会根据任务完成情况持续更新

---

**文档创建**: 2025-10-20  
**最后更新**: 2025-10-20  
**下次更新**: 每周五


