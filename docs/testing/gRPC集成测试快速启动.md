# gRPCé›†æˆæµ‹è¯• - å¿«é€Ÿå¯åŠ¨æŒ‡å—

> **å¿«é€Ÿä¸Šæ‰‹** | **10åˆ†é’Ÿå®Œæˆæµ‹è¯•** | **é›¶é…ç½®çƒ¦æ¼**

---

## ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆæœ€ç®€å•ï¼‰

### Windows

```bash
# 1. è®¾ç½® API Keyï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰
set GOOGLE_API_KEY=your_api_key_here

# 2. è¿è¡Œé›†æˆæµ‹è¯•
scripts\testing\test_grpc_integration.bat
```

### Linux/Mac

```bash
# 1. è®¾ç½® API Keyï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰
export GOOGLE_API_KEY=your_api_key_here

# 2. è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦å…ˆåˆ›å»ºå¯¹åº”çš„ .sh è„šæœ¬ï¼‰
# æˆ–æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤
```

**å®Œæˆï¼** è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ä¾èµ–
- âœ… å¯åŠ¨ Python AI æœåŠ¡
- âœ… è¿è¡Œ Python æµ‹è¯•
- âœ… è¿è¡Œ Go æµ‹è¯•
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

---

## ğŸ“ æ‰‹åŠ¨æµ‹è¯•ï¼ˆåˆ†æ­¥éª¤ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ç¯å¢ƒ

#### 1. å®‰è£…ä¾èµ–

```bash
# Go ä¾èµ–
go mod download

# Python ä¾èµ–
cd python_ai_service
pip install -r requirements.txt
cd ..
```

#### 2. è®¾ç½® API Key

```bash
# Windows
set GOOGLE_API_KEY=your_google_api_key

# Linux/Mac
export GOOGLE_API_KEY=your_google_api_key
```

#### 3. éªŒè¯ç¯å¢ƒ

```bash
# æ£€æŸ¥ Go
go version

# æ£€æŸ¥ Python
python --version

# æ£€æŸ¥ API Key
echo %GOOGLE_API_KEY%  # Windows
echo $GOOGLE_API_KEY    # Linux/Mac
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ Python AI æœåŠ¡

æ‰“å¼€ä¸€ä¸ª**æ–°çš„ç»ˆç«¯çª—å£**ï¼š

```bash
cd python_ai_service
python run_grpc_server.py
```

**çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸ**ï¼š

```
========================================
Phase3 gRPC Server Startup
========================================

API Key: AIzaSyB1234567890...

[1/2] Checking dependencies...
Dependencies: OK

[2/2] Starting gRPC server...

========================================
Server will listen on 0.0.0.0:50051
Press Ctrl+C to stop
========================================

ğŸš€ gRPCæœåŠ¡å™¨å¯åŠ¨ - ç›‘å¬åœ°å€: 0.0.0.0:50051
ğŸ“‹ å¯ç”¨æœåŠ¡:
  - ExecuteCreativeWorkflow: å®Œæ•´åˆ›ä½œå·¥ä½œæµ
  - GenerateOutline: å¤§çº²ç”Ÿæˆ
  - GenerateCharacters: è§’è‰²ç”Ÿæˆ
  - GeneratePlot: æƒ…èŠ‚ç”Ÿæˆ
  - HealthCheck: å¥åº·æ£€æŸ¥
âœ… gRPCæœåŠ¡å™¨å°±ç»ªï¼Œç­‰å¾…è¯·æ±‚...
```

**ä¿æŒæ­¤çª—å£è¿è¡Œï¼**

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯• Python å®¢æˆ·ç«¯

æ‰“å¼€**å¦ä¸€ä¸ªæ–°ç»ˆç«¯çª—å£**ï¼š

```bash
cd python_ai_service
python tests\test_grpc_phase3.py
```

**é¢„æœŸè¾“å‡º**ï¼š

```
========================================
ğŸš€ Phase3 gRPCæœåŠ¡æµ‹è¯•
========================================

========================================
ğŸ¥ æµ‹è¯•å¥åº·æ£€æŸ¥
========================================
âœ… å¥åº·çŠ¶æ€: healthy
ğŸ“‹ æ£€æŸ¥ç»“æœ:
  - agents: ok
  - llm: ok

========================================
ğŸ“– æµ‹è¯•å¤§çº²ç”Ÿæˆ
========================================
ğŸ“ ä»»åŠ¡: åˆ›ä½œä¿®ä»™å°è¯´å¤§çº²...

âœ… å¤§çº²ç”ŸæˆæˆåŠŸ!
ğŸ“– æ ‡é¢˜: é€†å¤©ä¿®ä»™è·¯
ğŸ­ ç±»å‹: ä¿®ä»™
ğŸ“š ç« èŠ‚æ•°: 5
â±ï¸  è€—æ—¶: 9.83ç§’

... (æ›´å¤šè¾“å‡º)

========================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
========================================
```

### ç¬¬å››æ­¥ï¼šæµ‹è¯• Go å®¢æˆ·ç«¯

æ‰“å¼€**ç¬¬ä¸‰ä¸ªç»ˆç«¯çª—å£**ï¼ˆæˆ–å…³é—­ Python æµ‹è¯•çª—å£åä½¿ç”¨ï¼‰ï¼š

#### æ–¹å¼ Aï¼šè¿è¡Œå•ä¸ªå‘½ä»¤è¡Œå·¥å…·

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
go run cmd\test_phase3_grpc\main.go --addr localhost:50051
```

#### æ–¹å¼ Bï¼šè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
go test -v -timeout 300s ./test/integration -run TestGRPC
```

**é¢„æœŸè¾“å‡º**ï¼š

```
========================================
Phase3 gRPCå®¢æˆ·ç«¯æµ‹è¯•
========================================

è¿æ¥åˆ°gRPCæœåŠ¡å™¨: localhost:50051
âœ… è¿æ¥æˆåŠŸ

1ï¸âƒ£  å¥åº·æ£€æŸ¥...
   çŠ¶æ€: healthy
   ç»„ä»¶çŠ¶æ€:
     - agents: ok
     - llm: ok

2ï¸âƒ£  ç”Ÿæˆå¤§çº²...
   ä»»åŠ¡: åˆ›ä½œä¸€ä¸ªä¿®ä»™å°è¯´å¤§çº²ï¼Œä¸»è§’æ˜¯å¤©æ‰å°‘å¹´
   âœ… æˆåŠŸ! è€—æ—¶: 9.78ç§’
   ğŸ“– æ ‡é¢˜: å¤©æ‰å°‘å¹´ä¿®ä»™å½•
   ğŸ­ ç±»å‹: ä¿®ä»™
   ğŸ“š ç« èŠ‚æ•°: 5

... (æ›´å¤šè¾“å‡º)

========================================
âœ… æµ‹è¯•å®Œæˆ
========================================
```

---

## ğŸ” éªŒè¯æµ‹è¯•ç»“æœ

### æˆåŠŸæ ‡å¿—

æ‰€æœ‰æµ‹è¯•åº”è¯¥çœ‹åˆ°ï¼š

- âœ… Python æœåŠ¡å¯åŠ¨æˆåŠŸ
- âœ… Python å®¢æˆ·ç«¯æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… Go å®¢æˆ·ç«¯æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ— æŠ¥é”™å’Œå¼‚å¸¸

### æµ‹è¯•è¦†ç›–

| æµ‹è¯•é¡¹ | Python å®¢æˆ·ç«¯ | Go å®¢æˆ·ç«¯ |
|-------|-------------|----------|
| å¥åº·æ£€æŸ¥ | âœ… | âœ… |
| å¤§çº²ç”Ÿæˆ | âœ… | âœ… |
| è§’è‰²ç”Ÿæˆ | âœ… | âœ… |
| æƒ…èŠ‚ç”Ÿæˆ | âœ… | âœ… |
| å®Œæ•´å·¥ä½œæµ | âœ… | âœ… |

---

## ğŸ¯ åªæƒ³å¿«é€ŸéªŒè¯è¿æ¥ï¼Ÿ

æœ€ç®€å•çš„æµ‹è¯• - ä»…éªŒè¯ gRPC è¿æ¥ï¼š

```bash
# 1. å¯åŠ¨ Python æœåŠ¡ï¼ˆç»ˆç«¯1ï¼‰
cd python_ai_service
python run_grpc_server.py

# 2. æµ‹è¯•è¿æ¥ï¼ˆç»ˆç«¯2ï¼‰
cd python_ai_service
python -c "
import grpc
from grpc_service import ai_service_pb2, ai_service_pb2_grpc
import asyncio

async def test():
    async with grpc.aio.insecure_channel('localhost:50051') as channel:
        stub = ai_service_pb2_grpc.AIServiceStub(channel)
        resp = await stub.HealthCheck(ai_service_pb2.HealthCheckRequest())
        print(f'Status: {resp.status}')

asyncio.run(test())
"
```

---

## âŒ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: "GOOGLE_API_KEY æœªè®¾ç½®"

```
ERROR: GOOGLE_API_KEY environment variable is not set
```

**è§£å†³**ï¼š
```bash
set GOOGLE_API_KEY=your_actual_api_key
```

### é—®é¢˜ 2: "è¿æ¥è¢«æ‹’ç»"

```
grpc._channel._InactiveRpcError: failed to connect to all addresses
```

**åŸå› **: Python AI æœåŠ¡æœªå¯åŠ¨

**è§£å†³**: å…ˆå¯åŠ¨ Python æœåŠ¡
```bash
cd python_ai_service
python run_grpc_server.py
```

### é—®é¢˜ 3: "ç«¯å£å·²è¢«å ç”¨"

```
OSError: [WinError 10048] é€šå¸¸æ¯ä¸ªå¥—æ¥å­—åœ°å€(åè®®/ç½‘ç»œåœ°å€/ç«¯å£)åªå…è®¸ä½¿ç”¨ä¸€æ¬¡
```

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :50051

# ç»“æŸè¿›ç¨‹ï¼ˆè®°ä¸‹ PIDï¼‰
taskkill /PID <PID> /F

# é‡æ–°å¯åŠ¨æœåŠ¡
```

### é—®é¢˜ 4: "Python ä¾èµ–ç¼ºå¤±"

```
ModuleNotFoundError: No module named 'grpc'
```

**è§£å†³**:
```bash
cd python_ai_service
pip install -r requirements.txt
```

### é—®é¢˜ 5: "Go ç¼–è¯‘é”™è¯¯"

```
cannot find package "google.golang.org/grpc"
```

**è§£å†³**:
```bash
go mod download
go mod tidy
```

---

## ğŸ“Š æ€§èƒ½é¢„æœŸ

| æ“ä½œ | é¢„æœŸæ—¶é—´ | è¯´æ˜ |
|-----|---------|------|
| æœåŠ¡å¯åŠ¨ | 5-10ç§’ | Python AI æœåŠ¡åˆå§‹åŒ– |
| å¥åº·æ£€æŸ¥ | < 0.1ç§’ | è¿æ¥éªŒè¯ |
| å¤§çº²ç”Ÿæˆ | 8-15ç§’ | è°ƒç”¨ LLM API |
| è§’è‰²ç”Ÿæˆ | 10-18ç§’ | è°ƒç”¨ LLM API |
| æƒ…èŠ‚ç”Ÿæˆ | 12-20ç§’ | è°ƒç”¨ LLM API |
| å®Œæ•´å·¥ä½œæµ | 30-60ç§’ | å®Œæ•´æµç¨‹ |

---

## ğŸ“– ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œæ‚¨å¯ä»¥ï¼š

1. **é›†æˆåˆ° Go æœåŠ¡** - åœ¨ Service å±‚é›†æˆ Phase3Client
2. **æ·»åŠ ä¸šåŠ¡é€»è¾‘** - å®ç°å…·ä½“çš„ä¸šåŠ¡åœºæ™¯
3. **æ€§èƒ½ä¼˜åŒ–** - æ·»åŠ ç¼“å­˜å’Œå¹¶å‘æ§åˆ¶
4. **ç”Ÿäº§éƒ¨ç½²** - ä½¿ç”¨ Docker å’Œ K8s éƒ¨ç½²

è¯¦ç»†æ–‡æ¡£ï¼š
- [gRPC é›†æˆæµ‹è¯•æŒ‡å—](./gRPCé›†æˆæµ‹è¯•æŒ‡å—.md)
- [Phase3 gRPC README](../../python_ai_service/PHASE3_GRPC_README.md)

---

## ğŸ¤ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’æŸ¥æŒ‡å—](./gRPCé›†æˆæµ‹è¯•æŒ‡å—.md#æ•…éšœæ’æŸ¥)
2. æ£€æŸ¥ Python æœåŠ¡æ—¥å¿—
3. æŸ¥çœ‹ [å®Œæ•´æµ‹è¯•æŒ‡å—](./gRPCé›†æˆæµ‹è¯•æŒ‡å—.md)

---

**æœ€åæ›´æ–°**: 2025-10-31  
**ç»´æŠ¤è€…**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ

