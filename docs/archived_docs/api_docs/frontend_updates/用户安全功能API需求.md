# ç”¨æˆ·å®‰å…¨åŠŸèƒ½APIéœ€æ±‚æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-29  
**çŠ¶æ€**: å¾…å®ç°  
**ä¼˜å…ˆçº§**: P1

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [APIåˆ—è¡¨](#apiåˆ—è¡¨)
3. [è¯¦ç»†è®¾è®¡](#è¯¦ç»†è®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [é”™è¯¯ç å®šä¹‰](#é”™è¯¯ç å®šä¹‰)
6. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## æ¦‚è¿°

### åŠŸèƒ½æè¿°

ç”¨æˆ·å®‰å…¨åŠŸèƒ½ä¸ºç”¨æˆ·æä¾›è´¦æˆ·å®‰å…¨ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ‰‹æœºå·/é‚®ç®±ç»‘å®šã€å¯†ç ç®¡ç†ã€è®¾å¤‡ç®¡ç†å’Œè´¦å·æ³¨é”€ç­‰æ ¸å¿ƒå®‰å…¨åŠŸèƒ½ã€‚

### ä¸šåŠ¡ä»·å€¼

- æå‡è´¦æˆ·å®‰å…¨æ€§ï¼Œé™ä½è´¦æˆ·è¢«ç›—é£é™©
- å®Œå–„ç”¨æˆ·èº«ä»½éªŒè¯ä½“ç³»
- æ»¡è¶³ç›‘ç®¡è¦æ±‚ï¼ˆå®ååˆ¶ã€æ•°æ®å®‰å…¨æ³•ç­‰ï¼‰
- æå‡ç”¨æˆ·ä¿¡ä»»åº¦å’Œå¹³å°å¯ä¿¡åº¦

### æŠ€æœ¯ç›®æ ‡

- çŸ­ä¿¡/é‚®ä»¶éªŒè¯ç å‘é€é¢‘ç‡é™åˆ¶ï¼ˆé˜²åˆ·ï¼‰
- éªŒè¯ç æœ‰æ•ˆæœŸç®¡ç†ï¼ˆ5-10åˆ†é’Ÿï¼‰
- æ•æ„Ÿæ“ä½œäºŒæ¬¡éªŒè¯
- è®¾å¤‡æŒ‡çº¹è¯†åˆ«
- å®‰å…¨å®¡è®¡æ—¥å¿—

---

## APIåˆ—è¡¨

### 2.1 éªŒè¯ç ç›¸å…³

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 1 | `/api/v1/user/security/send-sms-code` | POST | å‘é€æ‰‹æœºéªŒè¯ç  | P0 |
| 2 | `/api/v1/user/security/send-email-code` | POST | å‘é€é‚®ç®±éªŒè¯ç  | P0 |
| 3 | `/api/v1/user/security/verify-code` | POST | éªŒè¯éªŒè¯ç ï¼ˆé€šç”¨ï¼‰ | P1 |

### 2.2 æ‰‹æœºå·ç®¡ç†

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 4 | `/api/v1/user/security/bind-phone` | POST | ç»‘å®šæ‰‹æœºå· | P0 |
| 5 | `/api/v1/user/security/unbind-phone` | POST | è§£ç»‘æ‰‹æœºå· | P1 |
| 6 | `/api/v1/user/security/change-phone` | POST | æ›´æ¢æ‰‹æœºå· | P1 |

### 2.3 é‚®ç®±ç®¡ç†

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 7 | `/api/v1/user/security/bind-email` | POST | ç»‘å®šé‚®ç®± | P0 |
| 8 | `/api/v1/user/security/unbind-email` | POST | è§£ç»‘é‚®ç®± | P1 |
| 9 | `/api/v1/user/security/change-email` | POST | æ›´æ¢é‚®ç®± | P1 |

### 2.4 å¯†ç ç®¡ç†

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 10 | `/api/v1/user/security/change-password` | POST | ä¿®æ”¹å¯†ç  | P0 |
| 11 | `/api/v1/user/security/reset-password` | POST | é‡ç½®å¯†ç  | P0 |
| 12 | `/api/v1/user/security/verify-password` | POST | éªŒè¯å½“å‰å¯†ç  | P1 |

### 2.5 è®¾å¤‡ç®¡ç†

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 13 | `/api/v1/user/security/devices` | GET | è·å–ç™»å½•è®¾å¤‡åˆ—è¡¨ | P1 |
| 14 | `/api/v1/user/security/devices/:id` | DELETE | ç§»é™¤ç™»å½•è®¾å¤‡ | P1 |
| 15 | `/api/v1/user/security/devices/current` | GET | è·å–å½“å‰è®¾å¤‡ä¿¡æ¯ | P2 |

### 2.6 è´¦å·ç®¡ç†

| åºå· | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ | ä¼˜å…ˆçº§ |
|-----|---------|------|------|--------|
| 16 | `/api/v1/user/security/deactivate` | POST | ç”³è¯·æ³¨é”€è´¦å· | P1 |
| 17 | `/api/v1/user/security/cancel-deactivation` | POST | å–æ¶ˆæ³¨é”€ç”³è¯· | P2 |
| 18 | `/api/v1/user/security/check-status` | GET | æ£€æŸ¥è´¦å·çŠ¶æ€ | P2 |

---

## è¯¦ç»†è®¾è®¡

### 3.1 å‘é€æ‰‹æœºéªŒè¯ç 

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/send-sms-code`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¯é€‰ï¼ˆå·²ç™»å½•ç”¨æˆ·ä½¿ç”¨å½“å‰æ‰‹æœºå·ï¼Œæœªç™»å½•ç”¨æˆ·æŒ‡å®šæ‰‹æœºå·ï¼‰
- **é™æµ**: 60ç§’/æ¬¡ï¼Œæ¯å¤©10æ¬¡/æ‰‹æœºå·

#### è¯·æ±‚å‚æ•°

```json
{
  "phone": "13800138000",
  "scene": "bind_phone",  // åœºæ™¯ï¼šbind_phone, change_phone, login, reset_password
  "captcha_token": "xxx"  // å›¾å½¢éªŒè¯ç tokenï¼ˆé˜²åˆ·ï¼‰
}
```

**å‚æ•°è¯´æ˜**:
- `phone`: æ‰‹æœºå·ï¼ˆå¿…å¡«ï¼‰
- `scene`: ä½¿ç”¨åœºæ™¯ï¼ˆå¿…å¡«ï¼‰
- `captcha_token`: å›¾å½¢éªŒè¯ç tokenï¼ˆå¯é€‰ï¼Œé«˜é¢‘è°ƒç”¨æ—¶éœ€è¦ï¼‰

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "éªŒè¯ç å·²å‘é€",
  "data": {
    "expires_in": 300,  // æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
    "can_resend_after": 60  // å¯é‡å‘æ—¶é—´ï¼ˆç§’ï¼‰
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **é¢‘ç‡é™åˆ¶**:
   - åŒä¸€æ‰‹æœºå·ï¼š60ç§’å†…åªèƒ½å‘é€1æ¬¡
   - åŒä¸€IPï¼š1åˆ†é’Ÿå†…æœ€å¤š3æ¬¡ï¼Œ1å°æ—¶å†…æœ€å¤š20æ¬¡
   - åŒä¸€æ‰‹æœºå·ï¼š24å°æ—¶å†…æœ€å¤š10æ¬¡

2. **éªŒè¯ç è§„åˆ™**:
   - 6ä½æ•°å­—éªŒè¯ç 
   - æœ‰æ•ˆæœŸ5åˆ†é’Ÿ
   - åŒä¸€æ‰‹æœºå·åŒä¸€åœºæ™¯åªä¿ç•™æœ€æ–°çš„éªŒè¯ç 

3. **é˜²åˆ·æœºåˆ¶**:
   - çŸ­æ—¶é—´å†…å¤šæ¬¡å¤±è´¥éœ€è¦å›¾å½¢éªŒè¯ç 
   - å¼‚å¸¸IPè‡ªåŠ¨å°ç¦

4. **é€šçŸ¥å†…å®¹**:
   ```
   ã€é’ç¾½å†™ä½œã€‘æ‚¨çš„éªŒè¯ç æ˜¯ï¼š123456ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆã€‚è¯·å‹¿æ³„éœ²ç»™ä»–äººã€‚
   ```

---

### 3.2 å‘é€é‚®ç®±éªŒè¯ç 

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/send-email-code`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¯é€‰
- **é™æµ**: 60ç§’/æ¬¡ï¼Œæ¯å¤©10æ¬¡/é‚®ç®±

#### è¯·æ±‚å‚æ•°

```json
{
  "email": "user@example.com",
  "scene": "bind_email",  // åœºæ™¯ï¼šbind_email, change_email, login, reset_password
  "captcha_token": "xxx"
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "éªŒè¯ç å·²å‘é€è‡³é‚®ç®±",
  "data": {
    "expires_in": 600,  // æœ‰æ•ˆæœŸ10åˆ†é’Ÿ
    "can_resend_after": 60
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

- é¢‘ç‡é™åˆ¶åŒæ‰‹æœºéªŒè¯ç 
- éªŒè¯ç ï¼š6ä½æ•°å­—æˆ–å­—æ¯ç»„åˆ
- æœ‰æ•ˆæœŸï¼š10åˆ†é’Ÿ
- é‚®ä»¶ä¸»é¢˜ï¼šã€é’ç¾½å†™ä½œã€‘é‚®ç®±éªŒè¯ç 

---

### 3.3 ç»‘å®šæ‰‹æœºå·

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/bind-phone`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```json
{
  "phone": "13800138000",
  "code": "123456",  // éªŒè¯ç 
  "password": "***"  // å½“å‰å¯†ç ï¼ˆäºŒæ¬¡éªŒè¯ï¼‰
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ‰‹æœºå·ç»‘å®šæˆåŠŸ",
  "data": {
    "phone": "138****8000",  // è„±æ•æ˜¾ç¤º
    "verified": true,
    "bound_at": "2025-10-29T10:30:00Z"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **éªŒè¯æ­¥éª¤**:
   - éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
   - éªŒè¯å½“å‰å¯†ç 
   - éªŒè¯æ‰‹æœºéªŒè¯ç 
   - æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²è¢«å…¶ä»–è´¦å·ç»‘å®š

2. **é™åˆ¶æ¡ä»¶**:
   - ä¸€ä¸ªæ‰‹æœºå·åªèƒ½ç»‘å®šä¸€ä¸ªè´¦å·
   - å·²ç»‘å®šæ‰‹æœºå·çš„è´¦å·ä¸èƒ½é‡å¤ç»‘å®š
   - å¿…é¡»å…ˆè§£ç»‘æ‰èƒ½ç»‘å®šæ–°å·ç 

3. **å®‰å…¨å®¡è®¡**:
   - è®°å½•ç»‘å®šæ“ä½œæ—¥å¿—
   - å‘é€ç»‘å®šæˆåŠŸé€šçŸ¥

---

### 3.4 ç»‘å®šé‚®ç®±

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/bind-email`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```json
{
  "email": "user@example.com",
  "code": "123456",
  "password": "***"
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "é‚®ç®±ç»‘å®šæˆåŠŸ",
  "data": {
    "email": "u***@example.com",
    "verified": true,
    "bound_at": "2025-10-29T10:30:00Z"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

- ä¸æ‰‹æœºå·ç»‘å®šç±»ä¼¼
- ä¸€ä¸ªé‚®ç®±åªèƒ½ç»‘å®šä¸€ä¸ªè´¦å·
- ç»‘å®šåå‘é€ç¡®è®¤é‚®ä»¶

---

### 3.5 ä¿®æ”¹å¯†ç 

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/change-password`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```json
{
  "old_password": "***",  // å½“å‰å¯†ç 
  "new_password": "***",  // æ–°å¯†ç 
  "confirm_password": "***",  // ç¡®è®¤æ–°å¯†ç 
  "verification_code": "123456"  // æ‰‹æœºæˆ–é‚®ç®±éªŒè¯ç ï¼ˆå¯é€‰ï¼Œå¢å¼ºå®‰å…¨ï¼‰
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•",
  "data": {
    "require_relogin": true
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **å¯†ç å¼ºåº¦è¦æ±‚**:
   - é•¿åº¦8-32ä½
   - å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—
   - å»ºè®®åŒ…å«ç‰¹æ®Šå­—ç¬¦
   - ä¸èƒ½ä¸ç”¨æˆ·åç›¸åŒ
   - ä¸èƒ½æ˜¯å¸¸è§å¼±å¯†ç 

2. **éªŒè¯æ­¥éª¤**:
   - éªŒè¯å½“å‰å¯†ç 
   - éªŒè¯æ–°å¯†ç æ ¼å¼
   - éªŒè¯ä¸¤æ¬¡è¾“å…¥ä¸€è‡´æ€§
   - ï¼ˆå¯é€‰ï¼‰éªŒè¯éªŒè¯ç 

3. **åç»­æ“ä½œ**:
   - ä¿®æ”¹æˆåŠŸåä½¿æ‰€æœ‰tokenå¤±æ•ˆ
   - è¦æ±‚ç”¨æˆ·é‡æ–°ç™»å½•
   - å‘é€å¯†ç ä¿®æ”¹é€šçŸ¥ï¼ˆé‚®ä»¶/çŸ­ä¿¡ï¼‰
   - è®°å½•ä¿®æ”¹æ—¥å¿—

---

### 3.6 é‡ç½®å¯†ç 

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/reset-password`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: ä¸éœ€è¦
- **åœºæ™¯**: å¿˜è®°å¯†ç 

#### è¯·æ±‚å‚æ•°

```json
{
  "identifier": "13800138000 æˆ– user@example.com",  // æ‰‹æœºå·æˆ–é‚®ç®±
  "code": "123456",  // éªŒè¯ç 
  "new_password": "***",
  "confirm_password": "***"
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "å¯†ç é‡ç½®æˆåŠŸï¼Œè¯·ç™»å½•",
  "data": {
    "require_login": true
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **é‡ç½®æµç¨‹**:
   - ç”¨æˆ·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±
   - å‘é€éªŒè¯ç 
   - éªŒè¯éªŒè¯ç 
   - è®¾ç½®æ–°å¯†ç 
   - å®Œæˆé‡ç½®

2. **å®‰å…¨æªæ–½**:
   - éªŒè¯ç æœ‰æ•ˆæœŸ5åˆ†é’Ÿ
   - æ¯æ¬¡é‡ç½®ä½¿æ‰€æœ‰tokenå¤±æ•ˆ
   - å‘é€é‡ç½®æˆåŠŸé€šçŸ¥
   - è®°å½•é‡ç½®æ—¥å¿—ï¼ˆå«IPå’Œè®¾å¤‡ä¿¡æ¯ï¼‰

---

### 3.7 è·å–ç™»å½•è®¾å¤‡åˆ—è¡¨

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/devices`
- **æ–¹æ³•**: `GET`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```
Queryå‚æ•°:
- page: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- page_size: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- status: è®¾å¤‡çŠ¶æ€ï¼ˆactive, expiredï¼‰
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "device_id": "xxx",
      "device_name": "iPhone 14 Pro",
      "device_type": "mobile",  // mobile, desktop, tablet
      "os": "iOS 17.0",
      "browser": "Safari 17.0",
      "ip": "123.456.789.0",
      "location": "åŒ—äº¬å¸‚æœé˜³åŒº",
      "last_active": "2025-10-29T10:30:00Z",
      "login_at": "2025-10-28T08:00:00Z",
      "is_current": true,
      "status": "active"
    }
  ],
  "total": 5,
  "page": 1,
  "page_size": 20
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **è®¾å¤‡è¯†åˆ«**:
   - åŸºäºUser-Agentè§£æè®¾å¤‡ä¿¡æ¯
   - ä½¿ç”¨è®¾å¤‡æŒ‡çº¹æŠ€æœ¯
   - IPåœ°å€å®šä½

2. **çŠ¶æ€ç®¡ç†**:
   - active: æ´»è·ƒè®¾å¤‡ï¼ˆ30å¤©å†…æœ‰æ´»åŠ¨ï¼‰
   - expired: è¿‡æœŸè®¾å¤‡ï¼ˆè¶…è¿‡30å¤©æ— æ´»åŠ¨ï¼‰

3. **å®‰å…¨æç¤º**:
   - æ ‡è¯†å½“å‰ç™»å½•è®¾å¤‡
   - æ˜¾ç¤ºæœ€åæ´»è·ƒæ—¶é—´
   - å¼‚å¸¸è®¾å¤‡é¢„è­¦

---

### 3.8 ç§»é™¤ç™»å½•è®¾å¤‡

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/devices/:device_id`
- **æ–¹æ³•**: `DELETE`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```
Pathå‚æ•°:
- device_id: è®¾å¤‡ID

Bodyå‚æ•°:
{
  "password": "***"  // å½“å‰å¯†ç ï¼ˆäºŒæ¬¡éªŒè¯ï¼‰
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "è®¾å¤‡å·²ç§»é™¤",
  "data": {
    "device_id": "xxx",
    "removed_at": "2025-10-29T10:30:00Z"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **éªŒè¯æ­¥éª¤**:
   - éªŒè¯ç”¨æˆ·å¯†ç 
   - éªŒè¯è®¾å¤‡å½’å±
   - ä¸èƒ½ç§»é™¤å½“å‰è®¾å¤‡

2. **æ‰§è¡Œæ“ä½œ**:
   - ä½¿è¯¥è®¾å¤‡çš„tokenå¤±æ•ˆ
   - è®°å½•ç§»é™¤æ—¥å¿—
   - å‘é€è®¾å¤‡ç§»é™¤é€šçŸ¥

---

### 3.9 ç”³è¯·æ³¨é”€è´¦å·

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**: `/api/v1/user/security/deactivate`
- **æ–¹æ³•**: `POST`
- **è®¤è¯**: å¿…é¡»
- **æƒé™**: ç”¨æˆ·æœ¬äºº

#### è¯·æ±‚å‚æ•°

```json
{
  "password": "***",  // å½“å‰å¯†ç 
  "verification_code": "123456",  // æ‰‹æœºæˆ–é‚®ç®±éªŒè¯ç 
  "reason": "ä¸å†ä½¿ç”¨",  // æ³¨é”€åŸå› ï¼ˆå¯é€‰ï¼‰
  "feedback": "å»ºè®®å†…å®¹"  // åé¦ˆæ„è§ï¼ˆå¯é€‰ï¼‰
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ³¨é”€ç”³è¯·å·²æäº¤ï¼Œå°†åœ¨7å¤©åç”Ÿæ•ˆ",
  "data": {
    "deactivation_id": "xxx",
    "effective_date": "2025-11-05T10:30:00Z",
    "can_cancel_before": "2025-11-05T10:30:00Z"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™

1. **æ³¨é”€æ¡ä»¶æ£€æŸ¥**:
   - è´¦æˆ·æ— æœªå®Œæˆè®¢å•
   - é’±åŒ…ä½™é¢ä¸ºé›¶æˆ–å·²æç°
   - æ— è¿è§„å¤„ç½šæœŸ
   - æ— æœªç»“æ¸…å€ºåŠ¡

2. **å†·é™æœŸæœºåˆ¶**:
   - æäº¤ç”³è¯·åè¿›å…¥7å¤©å†·é™æœŸ
   - å†·é™æœŸå†…å¯ä»¥å–æ¶ˆæ³¨é”€
   - å†·é™æœŸç»“æŸåè‡ªåŠ¨æ‰§è¡Œæ³¨é”€

3. **æ³¨é”€æµç¨‹**:
   - éªŒè¯å¯†ç å’ŒéªŒè¯ç 
   - æ£€æŸ¥æ³¨é”€æ¡ä»¶
   - åˆ›å»ºæ³¨é”€ç”³è¯·
   - å‘é€ç¡®è®¤é€šçŸ¥
   - 7å¤©åæ‰§è¡Œæ³¨é”€

4. **æ•°æ®å¤„ç†**:
   - åŒ¿ååŒ–ç”¨æˆ·ä¿¡æ¯
   - åˆ é™¤ä¸ªäººéšç§æ•°æ®
   - ä¿ç•™å¿…è¦çš„äº¤æ˜“è®°å½•ï¼ˆæ³•å¾‹è¦æ±‚ï¼‰
   - å‘å¸ƒå†…å®¹æ ‡è®°ä¸º"å·²æ³¨é”€ç”¨æˆ·"

5. **ä¸å¯æ¢å¤æç¤º**:
   - æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ³¨é”€åä¸å¯æ¢å¤
   - æç¤ºå¤‡ä»½é‡è¦æ•°æ®
   - ç¡®è®¤ç†è§£åæ‰èƒ½æäº¤

---

## æ•°æ®æ¨¡å‹

### 4.1 éªŒè¯ç è®°å½•

```go
type VerificationCode struct {
    ID          string    `bson:"_id"`
    Type        string    `bson:"type"`         // sms, email
    Recipient   string    `bson:"recipient"`    // æ‰‹æœºå·æˆ–é‚®ç®±
    Code        string    `bson:"code"`         // éªŒè¯ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    Scene       string    `bson:"scene"`        // ä½¿ç”¨åœºæ™¯
    ExpiresAt   time.Time `bson:"expires_at"`   // è¿‡æœŸæ—¶é—´
    UsedAt      *time.Time `bson:"used_at"`     // ä½¿ç”¨æ—¶é—´
    IP          string    `bson:"ip"`           // è¯·æ±‚IP
    UserAgent   string    `bson:"user_agent"`   // ç”¨æˆ·ä»£ç†
    Status      string    `bson:"status"`       // pending, used, expired
    CreatedAt   time.Time `bson:"created_at"`
}
```

### 4.2 ç™»å½•è®¾å¤‡

```go
type LoginDevice struct {
    ID          string    `bson:"_id"`
    UserID      string    `bson:"user_id"`
    DeviceID    string    `bson:"device_id"`    // è®¾å¤‡å”¯ä¸€æ ‡è¯†
    DeviceName  string    `bson:"device_name"`  // è®¾å¤‡åç§°
    DeviceType  string    `bson:"device_type"`  // mobile, desktop, tablet
    OS          string    `bson:"os"`           // æ“ä½œç³»ç»Ÿ
    Browser     string    `bson:"browser"`      // æµè§ˆå™¨
    IP          string    `bson:"ip"`           // IPåœ°å€
    Location    string    `bson:"location"`     // åœ°ç†ä½ç½®
    LastActive  time.Time `bson:"last_active"`  // æœ€åæ´»è·ƒæ—¶é—´
    LoginAt     time.Time `bson:"login_at"`     // ç™»å½•æ—¶é—´
    Status      string    `bson:"status"`       // active, expired, removed
    CreatedAt   time.Time `bson:"created_at"`
    UpdatedAt   time.Time `bson:"updated_at"`
}
```

### 4.3 æ³¨é”€ç”³è¯·

```go
type DeactivationRequest struct {
    ID            string     `bson:"_id"`
    UserID        string     `bson:"user_id"`
    Reason        string     `bson:"reason"`         // æ³¨é”€åŸå› 
    Feedback      string     `bson:"feedback"`       // ç”¨æˆ·åé¦ˆ
    EffectiveDate time.Time  `bson:"effective_date"` // ç”Ÿæ•ˆæ—¥æœŸ
    CancelledAt   *time.Time `bson:"cancelled_at"`   // å–æ¶ˆæ—¶é—´
    ExecutedAt    *time.Time `bson:"executed_at"`    // æ‰§è¡Œæ—¶é—´
    Status        string     `bson:"status"`         // pending, cancelled, executed
    CreatedAt     time.Time  `bson:"created_at"`
    UpdatedAt     time.Time  `bson:"updated_at"`
}
```

### 4.4 å®‰å…¨æ—¥å¿—

```go
type SecurityLog struct {
    ID          string    `bson:"_id"`
    UserID      string    `bson:"user_id"`
    Action      string    `bson:"action"`       // æ“ä½œç±»å‹
    Resource    string    `bson:"resource"`     // æ“ä½œèµ„æº
    Result      string    `bson:"result"`       // success, failure
    IP          string    `bson:"ip"`
    UserAgent   string    `bson:"user_agent"`
    Details     map[string]interface{} `bson:"details"`  // è¯¦ç»†ä¿¡æ¯
    CreatedAt   time.Time `bson:"created_at"`
}
```

---

## é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  |
|-------|------|-----------|
| 40001 | éªŒè¯ç å‘é€é¢‘ç‡è¿‡å¿« | 429 |
| 40002 | éªŒè¯ç å·²è¿‡æœŸ | 400 |
| 40003 | éªŒè¯ç é”™è¯¯ | 400 |
| 40004 | æ‰‹æœºå·å·²è¢«ç»‘å®š | 409 |
| 40005 | é‚®ç®±å·²è¢«ç»‘å®š | 409 |
| 40006 | å½“å‰å¯†ç é”™è¯¯ | 401 |
| 40007 | æ–°å¯†ç æ ¼å¼ä¸ç¬¦åˆè¦æ±‚ | 400 |
| 40008 | è®¾å¤‡ä¸å­˜åœ¨æˆ–å·²è¢«ç§»é™¤ | 404 |
| 40009 | ä¸èƒ½ç§»é™¤å½“å‰è®¾å¤‡ | 400 |
| 40010 | æ³¨é”€æ¡ä»¶ä¸æ»¡è¶³ | 400 |
| 40011 | è´¦å·å·²åœ¨æ³¨é”€æµç¨‹ä¸­ | 400 |
| 40012 | éœ€è¦å›¾å½¢éªŒè¯ç  | 400 |

---

## å®æ–½è®¡åˆ’

### 6.1 Phase 1 - æ ¸å¿ƒåŠŸèƒ½ (ä¼˜å…ˆçº§P0)

**é¢„è®¡å·¥æ—¶**: 5-7å¤©

**ä»»åŠ¡åˆ—è¡¨**:
1. éªŒè¯ç å‘é€æœåŠ¡ï¼ˆæ‰‹æœº+é‚®ç®±ï¼‰ - 2å¤©
2. æ‰‹æœºå·ç»‘å®šåŠŸèƒ½ - 1å¤©
3. é‚®ç®±ç»‘å®šåŠŸèƒ½ - 1å¤©
4. å¯†ç ä¿®æ”¹åŠŸèƒ½ - 1å¤©
5. å¯†ç é‡ç½®åŠŸèƒ½ - 1å¤©
6. æµ‹è¯•å’Œæ–‡æ¡£ - 1å¤©

### 6.2 Phase 2 - è®¾å¤‡ç®¡ç† (ä¼˜å…ˆçº§P1)

**é¢„è®¡å·¥æ—¶**: 3-4å¤©

**ä»»åŠ¡åˆ—è¡¨**:
1. è®¾å¤‡è¯†åˆ«å’Œè®°å½• - 1.5å¤©
2. è®¾å¤‡åˆ—è¡¨æŸ¥è¯¢ - 0.5å¤©
3. è®¾å¤‡ç§»é™¤åŠŸèƒ½ - 1å¤©
4. æµ‹è¯•å’Œä¼˜åŒ– - 1å¤©

### 6.3 Phase 3 - è´¦å·æ³¨é”€ (ä¼˜å…ˆçº§P1)

**é¢„è®¡å·¥æ—¶**: 3-4å¤©

**ä»»åŠ¡åˆ—è¡¨**:
1. æ³¨é”€æ¡ä»¶æ£€æŸ¥ - 1å¤©
2. æ³¨é”€ç”³è¯·æµç¨‹ - 1å¤©
3. å®šæ—¶ä»»åŠ¡æ‰§è¡Œ - 1å¤©
4. æµ‹è¯•å’Œæ–‡æ¡£ - 1å¤©

### 6.4 Phase 4 - æ‰©å±•åŠŸèƒ½ (ä¼˜å…ˆçº§P2)

**é¢„è®¡å·¥æ—¶**: 2-3å¤©

**ä»»åŠ¡åˆ—è¡¨**:
1. æ‰‹æœºå·/é‚®ç®±æ›´æ¢ - 1å¤©
2. è§£ç»‘åŠŸèƒ½ - 0.5å¤©
3. å®‰å…¨å®¡è®¡å¢å¼º - 1å¤©
4. ç›‘æ§å’Œå‘Šè­¦ - 0.5å¤©

---

## é™„å½•

### A. ç¬¬ä¸‰æ–¹æœåŠ¡

#### çŸ­ä¿¡æœåŠ¡æä¾›å•†
- é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
- è…¾è®¯äº‘çŸ­ä¿¡æœåŠ¡
- å¤‡ç”¨ï¼šäº‘ç‰‡ç½‘ç»œ

#### é‚®ä»¶æœåŠ¡æä¾›å•†
- SendGrid
- é˜¿é‡Œäº‘é‚®ä»¶æ¨é€
- å¤‡ç”¨ï¼šSMTPè‡ªå»º

### B. å‚è€ƒæ–‡æ¡£

- [RFC 6238 - TOTPç®—æ³•](https://tools.ietf.org/html/rfc6238)
- [OWASPå¯†ç å­˜å‚¨æŒ‡å—](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
- [ã€Šä¸ªäººä¿¡æ¯å®‰å…¨è§„èŒƒã€‹](https://www.gb688.cn/bzgk/gb/newGbInfo?hcno=4FFAA51D63BA21B9EE40C51DD3CC40BE)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-10-29

