# 第3阶段：Part 2-4 实施计划 - 路由清理、测试验证、文档更新

> **创建日期**: 2026-02-27
> **状态**: 待执行
> **预计总时长**: 8小时

---

## 任务概述

完成阶段3通信模块重构的剩余任务：
- Part 2: 路由配置清理
- Part 3: 测试验证
- Part 4: 文档更新

---

## Part 2: 路由配置清理 (2小时)

### Task 2.1: 检查并清理废弃模块路由

**目标**: 移除已废弃模块的路由引用

**具体要求**:
1. 检查 `internal/router/` 下的路由文件
2. 移除 `shared/notification_api.go` 的路由引用（如果存在）
3. 确认 `api/v1/messages/message_api.go` 旧版路由需要保留（Messaging整合是P2任务）
4. 验证所有现役API的路由正确注册

**检查点**:
- [ ] 无废弃模块的路由引用
- [ ] 所有现役API路由正确
- [ ] 路由注册顺序合理

**预计时间**: 1小时

---

### Task 2.2: 更新路由文档

**目标**: 同步更新路由相关文档

**具体要求**:
1. 更新 `internal/router/README.md`
2. 记录废弃的路由变更
3. 更新路由列表

**检查点**:
- [ ] 路由文档与代码一致
- [ ] 废弃变更已记录

**预计时间**: 30分钟

---

### Task 2.3: 验证路由注册

**目标**: 确保所有路由正确注册

**具体要求**:
1. 启动服务，检查路由注册情况
2. 使用健康检查接口验证
3. 检查路由冲突

**检查点**:
- [ ] 服务正常启动
- [ ] 路由无冲突
- [ ] 健康检查通过

**预计时间**: 30分钟

---

## Part 3: 测试验证 (4小时)

### Task 3.1: 运行通信模块单元测试

**目标**: 确保通信模块测试通过

**具体要求**:
1. 运行 announcements 测试: `go test ./api/v1/announcements/... -v`
2. 运行 notifications 测试: `go test ./api/v1/notifications/... -v`
3. 运行 messaging 测试: `go test ./api/v1/social/... -v -run Message`
4. 修复发现的问题

**检查点**:
- [ ] 所有 announcements 测试通过
- [ ] 所有 notifications 测试通过
- [ ] 所有 messaging 测试通过
- [ ] 无新增警告

**预计时间**: 1.5小时

---

### Task 3.2: 运行集成测试

**目标**: 验证模块间集成正常

**具体要求**:
1. 运行通信模块集成测试
2. 检查依赖服务连接
3. 验证消息流转

**检查点**:
- [ ] 集成测试通过
- [ ] 无集成问题

**预计时间**: 1小时

---

### Task 3.3: 运行回归测试

**目标**: 确保重构未破坏现有功能

**具体要求**:
1. 运行完整测试套件
2. 检查测试覆盖率
3. 分析测试结果

**检查点**:
- [ ] 核心功能测试通过
- [ ] 测试覆盖率未下降
- [ ] 无回归问题

**预计时间**: 1.5小时

---

## Part 4: 文档更新 (2小时)

### Task 4.1: 更新API文档

**目标**: 同步API文档与代码变更

**具体要求**:
1. 更新 `api/v1/announcements/README.md`
2. 更新 `api/v1/notifications/README.md`
3. 更新 `api/v1/social/README.md` (messaging部分)
4. 记录废弃的API端点

**检查点**:
- [ ] API文档准确完整
- [ ] 废弃端点已标注

**预计时间**: 1小时

---

### Task 4.2: 更新架构文档

**目标**: 反映模块架构变更

**具体要求**:
1. 更新 `architecture/api_architecture.md`
2. 更新模块依赖图
3. 记录废弃模块

**检查点**:
- [ ] 架构文档同步更新
- [ ] 依赖关系清晰

**预计时间**: 30分钟

---

### Task 4.3: 更新任务状态

**目标**: 完成阶段3任务记录

**具体要求**:
1. 更新 `phase3_todo.md`
2. 标记所有任务为已完成
3. 创建完成报告

**检查点**:
- [ ] TODO文档更新完成
- [ ] 完成报告创建

**预计时间**: 30分钟

---

## 执行顺序

```
Part 2: 路由配置清理 (2h)
  ├─ Task 2.1: 检查并清理废弃模块路由 (1h)
  ├─ Task 2.2: 更新路由文档 (30min)
  └─ Task 2.3: 验证路由注册 (30min)
  ↓
Part 3: 测试验证 (4h)
  ├─ Task 3.1: 运行通信模块单元测试 (1.5h)
  ├─ Task 3.2: 运行集成测试 (1h)
  └─ Task 3.3: 运行回归测试 (1.5h)
  ↓
Part 4: 文档更新 (2h)
  ├─ Task 4.1: 更新API文档 (1h)
  ├─ Task 4.2: 更新架构文档 (30min)
  └─ Task 4.3: 更新任务状态 (30min)
```

---

## 完成标准

### Part 2 完成标准
- [ ] 废弃模块路由已移除
- [ ] 路由文档已更新
- [ ] 路由注册验证通过

### Part 3 完成标准
- [ ] 所有单元测试通过
- [ ] 集成测试通过
- [ ] 无回归问题

### Part 4 完成标准
- [ ] API文档更新完成
- [ ] 架构文档更新完成
- [ ] 任务状态已更新

---

## 参考资料

- [API重构总计划](./api_refactor_plan.md)
- [阶段3 TODO](./phase3_todo.md)
- [API设计规范](../standards/api_standard.md)
- [路由配置指南](../../internal/router/README.md)

---

## 延期任务说明

以下任务延期至后续阶段处理：

- **Messaging 模块整合**: P2优先级，需要8-12小时
  - 涉及@提醒功能迁移
  - 需要与产品设计确认
  - 不影响当前阶段完成

---

**文档状态**: ✅ 计划完成
**下一步**: 派遣女仆执行任务
