# ç”¨æˆ·ç­‰çº§æˆå°±ç³»ç»Ÿè®¾è®¡

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¶é—´**: 2025-10-21

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è®¾è®¡ç”¨æˆ·ç­‰çº§å’Œæˆå°±ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç­‰çº§ä½“ç³»ã€ç»éªŒå€¼ç®¡ç†ã€æˆå°±è§£é”å’Œç‰¹æƒç³»ç»Ÿã€‚

---

## ä¸€ã€ç­‰çº§ä½“ç³»è®¾è®¡

### 1.1 ç­‰çº§é…ç½®

| ç­‰çº§ | æ‰€éœ€ç»éªŒå€¼ | ç‰¹æƒ |
|------|-----------|------|
| 1 | 0 | åŸºç¡€åŠŸèƒ½ |
| 2 | 100 | æ¯æ—¥ä»»åŠ¡+2 |
| 3 | 300 | AIå¯¹è¯+50æ¬¡/æ—¥ |
| 5 | 1000 | è‡ªå®šä¹‰å¤´åƒ |
| 10 | 5000 | ä¼˜å…ˆå®¢æœ |
| 20 | 20000 | é«˜çº§æ¨¡æ¿ |

### 1.2 æ•°æ®æ¨¡å‹

```go
type UserLevel struct {
    ID           string `bson:"_id" json:"id"`
    UserID       string `bson:"user_id" json:"userId"`
    Level        int    `bson:"level" json:"level"`
    Experience   int    `bson:"experience" json:"experience"` // å½“å‰ç»éªŒå€¼
    NextLevelExp int    `bson:"next_level_exp" json:"nextLevelExp"`
    Achievements []string `bson:"achievements" json:"achievements"`
}

type Achievement struct {
    ID          string `bson:"_id" json:"id"`
    Title       string `bson:"title" json:"title"`
    Description string `bson:"description" json:"description"`
    Icon        string `bson:"icon" json:"icon"`
    Type        string `bson:"type" json:"type"` // reading, writing, social
    Condition   string `bson:"condition" json:"condition"` // JSONæ¡ä»¶
    RewardExp   int    `bson:"reward_exp" json:"rewardExp"`
}
```

---

## äºŒã€Serviceæ¥å£

```go
type UserLevelService interface {
    // ç»éªŒå€¼ç®¡ç†ï¼ˆå”¯ä¸€æ•°æ®æºï¼‰
    AddExperience(ctx context.Context, userID string, exp int, reason string) error
    GetExperience(ctx context.Context, userID string) (int, error)
    
    // å‡çº§æ£€æŸ¥
    CheckLevelUp(ctx context.Context, userID string) (bool, *UserLevel, error)
    
    // æˆå°±ç®¡ç†
    UnlockAchievement(ctx context.Context, userID, achievementID string) error
    CheckAchievements(ctx context.Context, userID string) error
    
    // äº‹ä»¶å¤„ç†
    OnTaskCompleted(ctx context.Context, event *TaskCompletedEvent) error
}
```

---

## ä¸‰ã€äº‹ä»¶å¤„ç†

```go
func (s *UserLevelServiceImpl) OnTaskCompleted(ctx context.Context, event *TaskCompletedEvent) error {
    // å¢åŠ ç»éªŒå€¼
    if err := s.AddExperience(ctx, event.UserID, event.RewardExp, fmt.Sprintf("task_%s", event.TaskID)); err != nil {
        return err
    }
    
    // æ£€æŸ¥å‡çº§
    levelUp, newLevel, _ := s.CheckLevelUp(ctx, event.UserID)
    
    if levelUp {
        s.eventBus.PublishAsync(ctx, &UserLevelUpEvent{
            UserID:   event.UserID,
            NewLevel: newLevel.Level,
        })
    }
    
    return nil
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-10-21

