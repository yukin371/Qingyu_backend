# 青羽写作平台集成系统设计文档

## 1. 概述

### 1.1 项目背景
青羽写作平台需要集成用户管理、作品管理等核心功能，为用户提供完整的写作创作和分享平台。本文档描述了平台集成系统的整体架构和功能设计。

### 1.2 设计目标
- **用户体系**：完整的用户注册、登录、权限管理系统
- **作品管理**：支持作品上传、查看、分类、搜索等功能
- **多用户隔离**：确保不同用户的作品数据安全隔离
- **扩展性**：支持未来功能模块的快速集成
- **高性能**：支持大量用户并发访问

## 2. 技术架构

### 2.1 整体架构
```
┌─────────────────┐
│   Frontend      │ ← Vue3 + TypeScript 前端界面
├─────────────────┤
│   API Gateway   │ ← 统一API网关，路由分发
├─────────────────┤
│   Auth Service  │ ← 用户认证服务 (JWT)
├─────────────────┤
│   User Service  │ ← 用户管理服务
├─────────────────┤
│   Work Service  │ ← 作品管理服务
├─────────────────┤
│   File Service  │ ← 文件存储服务
├─────────────────┤
│   Database      │ ← MySQL/PostgreSQL 数据库
└─────────────────┘
```

### 2.2 模块划分
- **用户模块 (User)**：用户注册、登录、个人信息管理
- **认证模块 (Auth)**：JWT令牌管理、权限验证
- **作品模块 (Work)**：作品CRUD操作、分类管理
- **文件模块 (File)**：文件上传、下载、存储管理
- **搜索模块 (Search)**：作品搜索、标签检索

## 3. 数据库设计

### 3.1 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    nickname VARCHAR(100),
    avatar_url VARCHAR(255),
    bio TEXT,
    status TINYINT DEFAULT 1, -- 1:正常 0:禁用
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 3.2 作品表 (works)
```sql
CREATE TABLE works (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    content LONGTEXT,
    category_id BIGINT,
    tags JSON,
    cover_url VARCHAR(255),
    status TINYINT DEFAULT 1, -- 1:草稿 2:已发布 3:已删除
    visibility TINYINT DEFAULT 1, -- 1:公开 2:私有 3:仅好友
    view_count INT DEFAULT 0,
    like_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);
```

### 3.3 分类表 (categories)
```sql
CREATE TABLE categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    description TEXT,
    parent_id BIGINT DEFAULT 0,
    sort_order INT DEFAULT 0,
    status TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 4. API 接口设计

### 4.1 用户相关接口
- `POST /api/v1/auth/register` - 用户注册
- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/logout` - 用户登出
- `GET /api/v1/user/profile` - 获取用户信息
- `PUT /api/v1/user/profile` - 更新用户信息

### 4.2 作品相关接口
- `GET /api/v1/works` - 获取作品列表
- `POST /api/v1/works` - 创建作品
- `GET /api/v1/works/:id` - 获取作品详情
- `PUT /api/v1/works/:id` - 更新作品
- `DELETE /api/v1/works/:id` - 删除作品
- `GET /api/v1/works/search` - 搜索作品

### 4.3 文件相关接口
- `POST /api/v1/files/upload` - 文件上传
- `GET /api/v1/files/:id` - 文件下载
- `DELETE /api/v1/files/:id` - 删除文件

## 5. 安全设计

### 5.1 认证机制
- 使用JWT令牌进行用户认证
- 令牌过期时间设置为24小时
- 支持刷新令牌机制

### 5.2 权限控制
- 基于角色的访问控制 (RBAC)
- 用户只能访问自己的作品
- 管理员可以管理所有用户和作品

### 5.3 数据安全
- 密码使用bcrypt加密存储
- 敏感数据传输使用HTTPS
- SQL注入防护
- XSS攻击防护

## 6. 性能优化

### 6.1 缓存策略
- Redis缓存用户会话信息
- 缓存热门作品数据
- 缓存分类和标签信息

### 6.2 数据库优化
- 合理设计索引
- 分页查询优化
- 读写分离

### 6.3 文件存储
- 支持本地存储和云存储
- 图片压缩和格式转换
- CDN加速

## 7. 部署方案

### 7.1 开发环境
- Docker容器化部署
- 本地MySQL数据库
- 本地Redis缓存

### 7.2 生产环境
- Kubernetes集群部署
- 云数据库服务
- 云存储服务
- 负载均衡

## 8. 监控和日志

### 8.1 监控指标
- API响应时间
- 数据库连接数
- 内存使用率
- 错误率统计

### 8.2 日志管理
- 结构化日志输出
- 日志分级管理
- 日志聚合和分析