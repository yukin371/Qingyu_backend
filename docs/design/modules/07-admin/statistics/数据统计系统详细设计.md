# æ•°æ®ç»Ÿè®¡ç³»ç»Ÿè¯¦ç»†è®¾è®¡

> **æ¨¡å—**: 07 - ç®¡ç†
> **åŠŸèƒ½**: æ•°æ®ç»Ÿè®¡ç³»ç»Ÿ
> **å®Œæˆåº¦**: ğŸŸ¢ 75%

## ğŸ“‹ æ¦‚è¿°

æ•°æ®ç»Ÿè®¡ç³»ç»Ÿä¸ºç®¡ç†å‘˜æä¾›å¹³å°æ•°æ®ç»Ÿè®¡åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç»Ÿè®¡ã€ä½œå“ç»Ÿè®¡ã€æ”¶å…¥ç»Ÿè®¡ç­‰ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å¹³å°æ¦‚è§ˆ

- **æ ¸å¿ƒæŒ‡æ ‡**: ç”¨æˆ·æ•°ã€ä½œå“æ•°ã€é˜…è¯»é‡ç­‰æ ¸å¿ƒæŒ‡æ ‡
- **å®æ—¶æ•°æ®**: å®æ—¶è®¿é—®é‡ã€åœ¨çº¿äººæ•°ç­‰
- **è¶‹åŠ¿å›¾è¡¨**: æ•°æ®è¶‹åŠ¿å¯è§†åŒ–

### 2. ç”¨æˆ·ç»Ÿè®¡

- **æ–°å¢ç”¨æˆ·**: æ—¥/å‘¨/æœˆæ–°å¢ç”¨æˆ·
- **æ´»è·ƒç”¨æˆ·**: DAUã€MAU
- **ç”¨æˆ·ç•™å­˜**: æ¬¡æ—¥ç•™å­˜ã€7æ—¥ç•™å­˜ã€30æ—¥ç•™å­˜
- **ç”¨æˆ·ç”»åƒ**: å¹´é¾„ã€æ€§åˆ«ã€åœ°åŸŸåˆ†å¸ƒ

### 3. ä½œå“ç»Ÿè®¡

- **ä½œå“æ•°é‡**: æ€»ä½œå“æ•°ã€æ–°å¢ä½œå“æ•°
- **ä½œå“è´¨é‡**: å®Œæœ¬ç‡ã€å¹³å‡å­—æ•°
- **ä½œå“æ’è¡Œ**: å„ç±»æ’è¡Œæ¦œ

### 4. æ”¶å…¥ç»Ÿè®¡

- **å……å€¼ç»Ÿè®¡**: å……å€¼æ€»é¢ã€å……å€¼äººæ•°
- **æ¶ˆè´¹ç»Ÿè®¡**: æ¶ˆè´¹æ€»é¢ã€æ¶ˆè´¹äººæ•°
- **ä½œè€…æ”¶å…¥**: ä½œè€…åˆ†æˆç»Ÿè®¡

## ğŸ“Š æ•°æ®æ¨¡å‹

### PlatformStatistics (å¹³å°ç»Ÿè®¡)

```go
type PlatformStatistics struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    Date            time.Time            `bson:"date" json:"date"`                     // ç»Ÿè®¡æ—¥æœŸ

    // ç”¨æˆ·ç»Ÿè®¡
    TotalUsers      int64                `bson:"total_users" json:"totalUsers"`         // æ€»ç”¨æˆ·æ•°
    NewUsers        int64                `bson:"new_users" json:"newUsers"`             // æ–°å¢ç”¨æˆ·æ•°
    ActiveUsers     int64                `bson:"active_users" json:"activeUsers"`       // æ´»è·ƒç”¨æˆ·æ•°
    OnlineUsers     int64                `bson:"online_users" json:"onlineUsers"`       // åœ¨çº¿ç”¨æˆ·æ•°

    // ä½œå“ç»Ÿè®¡
    TotalBooks      int64                `bson:"total_books" json:"totalBooks"`         // æ€»ä½œå“æ•°
    NewBooks        int64                `bson:"new_books" json:"newBooks"`             // æ–°å¢ä½œå“æ•°
    TotalChapters   int64                `bson:"total_chapters" json:"totalChapters"`   // æ€»ç« èŠ‚æ•°
    TotalWords      int64                `bson:"total_words" json:"totalWords"`         // æ€»å­—æ•°

    // é˜…è¯»ç»Ÿè®¡
    TotalReads      int64                `bson:"total_reads" json:"totalReads"`         // æ€»é˜…è¯»é‡
    TotalReadTime   int64                `bson:"total_read_time" json:"totalReadTime"`  // æ€»é˜…è¯»æ—¶é•¿ï¼ˆç§’ï¼‰

    // æ”¶å…¥ç»Ÿè®¡
    TotalRevenue    int64                `bson:"total_revenue" json:"totalRevenue"`     // æ€»æ”¶å…¥ï¼ˆåˆ†ï¼‰
    RechargeAmount  int64                `bson:"recharge_amount" json:"rechargeAmount"` // å……å€¼é‡‘é¢
    ConsumeAmount   int64                `bson:"consume_amount" json:"consumeAmount"`   // æ¶ˆè´¹é‡‘é¢

    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`
    UpdatedAt       time.Time            `bson:"updated_at" json:"updatedAt"`

    // å”¯ä¸€ç´¢å¼•ï¼šdate
}
```

### UserRetention (ç”¨æˆ·ç•™å­˜)

```go
type UserRetention struct {
    ID              primitive.ObjectID   `bson:"_id,omitempty" json:"id"`
    Date            time.Time            `bson:"date" json:"date"`                     // æ³¨å†Œæ—¥æœŸ
    Day1Retention   float64              `bson:"day1_retention" json:"day1Retention"`   // æ¬¡æ—¥ç•™å­˜ç‡
    Day7Retention   float64              `bson:"day7_retention" json:"day7Retention"`   // 7æ—¥ç•™å­˜ç‡
    Day30Retention  float64              `bson:"day30_retention" json:"day30Retention"` // 30æ—¥ç•™å­˜ç‡

    CreatedAt       time.Time            `bson:"created_at" json:"createdAt"`

    // å”¯ä¸€ç´¢å¼•ï¼šdate
}
```

## ğŸŒ APIç«¯ç‚¹

### å¹³å°æ¦‚è§ˆ

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/admin/statistics/overview | è·å–å¹³å°æ¦‚è§ˆ | æ˜¯(ç®¡ç†å‘˜) |
| GET | /api/v1/admin/statistics/trend | è·å–æ•°æ®è¶‹åŠ¿ | æ˜¯(ç®¡ç†å‘˜) |

### ç”¨æˆ·ç»Ÿè®¡

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/admin/statistics/users | è·å–ç”¨æˆ·ç»Ÿè®¡ | æ˜¯(ç®¡ç†å‘˜) |
| GET | /api/v1/admin/statistics/users/retention | è·å–ç”¨æˆ·ç•™å­˜ | æ˜¯(ç®¡ç†å‘˜) |
| GET | /api/v1/admin/statistics/users/profile | è·å–ç”¨æˆ·ç”»åƒ | æ˜¯(ç®¡ç†å‘˜) |

### ä½œå“ç»Ÿè®¡

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/admin/statistics/works | è·å–ä½œå“ç»Ÿè®¡ | æ˜¯(ç®¡ç†å‘˜) |
| GET | /api/v1/admin/statistics/works/ranking | è·å–ä½œå“æ’è¡Œ | æ˜¯(ç®¡ç†å‘˜) |

### æ”¶å…¥ç»Ÿè®¡

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | /api/v1/admin/statistics/revenue | è·å–æ”¶å…¥ç»Ÿè®¡ | æ˜¯(ç®¡ç†å‘˜) |
| GET | /api/v1/admin/statistics/revenue/author | è·å–ä½œè€…æ”¶å…¥ç»Ÿè®¡ | æ˜¯(ç®¡ç†å‘˜) |

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### ç»Ÿè®¡æ•°æ®ç”Ÿæˆæµç¨‹

```
1. å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆæ¯å°æ—¶ï¼‰
   â†“
2. æŸ¥è¯¢åŸå§‹æ•°æ®
   â†“
3. è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
   â†“
4. ä¿å­˜ç»Ÿè®¡æ•°æ®
   â†“
5. æ›´æ–°ç¼“å­˜
```

### å®æ—¶æ•°æ®æ›´æ–°æµç¨‹

```
1. ç”¨æˆ·è¡Œä¸ºå‘ç”Ÿ
   â†“
2. å®æ—¶æ›´æ–°è®¡æ•°å™¨ï¼ˆRedisï¼‰
   â†“
3. å®šæ—¶åŒæ­¥åˆ°æ•°æ®åº“
   â†“
4. èšåˆè®¡ç®—ç»Ÿè®¡æ•°æ®
```

## ğŸ“ˆ ç»Ÿè®¡æŒ‡æ ‡å®šä¹‰

### ç”¨æˆ·æŒ‡æ ‡

- **æ€»ç”¨æˆ·æ•°**: ç´¯è®¡æ³¨å†Œç”¨æˆ·æ•°
- **æ–°å¢ç”¨æˆ·æ•°**: æ–°æ³¨å†Œç”¨æˆ·æ•°
- **æ´»è·ƒç”¨æˆ·æ•°**: æœ‰ç™»å½•è¡Œä¸ºçš„ç”¨æˆ·æ•°
- **åœ¨çº¿ç”¨æˆ·æ•°**: å½“å‰åœ¨çº¿ç”¨æˆ·æ•°

### ç•™å­˜ç‡è®¡ç®—

```
æ¬¡æ—¥ç•™å­˜ç‡ = (å½“æ—¥æ³¨å†Œç”¨æˆ·ä¸­ï¼Œæ¬¡æ—¥ç™»å½•çš„ç”¨æˆ·æ•° / å½“æ—¥æ³¨å†Œç”¨æˆ·æ•°) Ã— 100%
7æ—¥ç•™å­˜ç‡ = (å½“æ—¥æ³¨å†Œç”¨æˆ·ä¸­ï¼Œç¬¬7æ—¥ç™»å½•çš„ç”¨æˆ·æ•° / å½“æ—¥æ³¨å†Œç”¨æˆ·æ•°) Ã— 100%
30æ—¥ç•™å­˜ç‡ = (å½“æ—¥æ³¨å†Œç”¨æˆ·ä¸­ï¼Œç¬¬30æ—¥ç™»å½•çš„ç”¨æˆ·æ•° / å½“æ—¥æ³¨å†Œç”¨æˆ·æ•°) Ã— 100%
```

### ä½œå“æŒ‡æ ‡

- **æ€»ä½œå“æ•°**: ç´¯è®¡å‘å¸ƒä½œå“æ•°
- **æ–°å¢ä½œå“æ•°**: æ–°å‘å¸ƒä½œå“æ•°
- **å®Œæœ¬ç‡**: å·²å®Œç»“ä½œå“æ•° / æ€»ä½œå“æ•°
- **å¹³å‡å­—æ•°**: æ€»å­—æ•° / æ€»ä½œå“æ•°

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

- Redisç¼“å­˜çƒ­ç‚¹ç»Ÿè®¡æ•°æ®
- ç¼“å­˜æœ‰æ•ˆæœŸï¼š5åˆ†é’Ÿ

### å¼‚æ­¥å¤„ç†

- ç»Ÿè®¡æ•°æ®å¼‚æ­¥ç”Ÿæˆ
- ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦

### æ•°æ®é¢„èšåˆ

- æŒ‰å°æ—¶ã€å¤©ã€å‘¨ã€æœˆé¢„èšåˆ
- ç‰©åŒ–è§†å›¾åŠ é€ŸæŸ¥è¯¢

## ğŸ“Š ç›‘æ§å‘Šè­¦

### å¼‚å¸¸å‘Šè­¦

- æ–°å¢ç”¨æˆ·æ•°å¼‚å¸¸ä¸‹é™
- æ”¶å…¥å¼‚å¸¸æ³¢åŠ¨
- ç³»ç»Ÿè´Ÿè½½å¼‚å¸¸

---

**æ–‡æ¡£ç»´æŠ¤**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-01-06
