# 青羽写作平台 - 测试规范体系

## 📚 文档导航

### 快速开始
- [新手指引](#快速开始) - 5分钟了解测试体系
- [第一个测试](#快速开始) - 快速编写第一个测试
- [常见问题](06_快速参考/故障排查指南.md) - 遇到问题？看这里

### 按层级查找规范
| 层级 | 规范文档 | 关键要点 | 优先级 |
|------|---------|---------|--------|
| Repository层 | [规范](01_测试层级规范/repository_层测试规范.md) | 真实MongoDB、CRUD完整覆盖 | P0 |
| Service层 | [规范](01_测试层级规范/service_层测试规范.md) | Mock Repository、业务逻辑 | P0 |
| API层 | [规范](01_测试层级规范/api_层测试规范.md) | HTTP集成、TestHelper | P1 |
| E2E层 | [规范](01_测试层级规范/e2e_测试规范.md) | 完整业务流程 | P1 |

### 按类型查找规范
- [单元测试](02_测试类型规范/单元测试详细规范.md) - 单一函数/方法测试
- [集成测试](02_测试类型规范/集成测试详细规范.md) - 多组件协作测试
- [性能测试](02_测试类型规范/性能测试详细规范.md) - 基准测试和响应时间
- [安全测试](02_测试类型规范/安全测试规范.md) - 权限和注入防护
- [边缘测试](02_测试类型规范/边缘案例测试规范.md) - 边界条件和异常

### 测试工具指南
- [testify使用](03_测试工具指南/testify使用指南.md) - assert/mock完整手册
- [MongoDB测试配置](03_测试工具指南/mongodb_测试配置指南.md) - 测试数据库setup
- [覆盖率工具](03_测试工具指南/覆盖率工具使用指南.md) - 覆盖率分析和报告
- [Mock最佳实践](03_测试工具指南/mock框架使用指南.md) - Mock使用规范
- [测试辅助工具](03_测试工具指南/测试辅助工具使用指南.md) - TestHelper/Fixtures

### 真实数据测试 ⚠️ 重要
- [真实数据库测试](04_真实数据测试规范/真实数据库测试规范.md) - **禁止使用Mock的场景**
- [测试数据准备](04_真实数据测试规范/测试数据准备规范.md) - Factory模式使用
- [数据隔离策略](04_真实数据测试规范/数据隔离策略.md) - 避免数据污染
- [禁止Hack规范](04_真实数据测试规范/禁止hack规范.md) - 明确禁止的做法

### 最佳实践
- [测试命名规范](05_最佳实践/测试命名规范.md) - 清晰的测试命名
- [测试组织结构](05_最佳实践/测试组织结构规范.md) - 文件和代码组织
- [测试维护规范](05_最佳实践/测试维护规范.md) - 保持测试质量
- [常见反模式](05_最佳实践/常见反模式及避免.md) - 避免这些陷阱

### 快速参考
- [测试模板集](06_快速参考/测试模板集.md) - 复制即用的代码模板
- [断言速查表](06_快速参考/断言速查表.md) - assert方法一览
- [测试场景清单](06_快速参考/常见测试场景清单.md) - 测试覆盖checklist
- [故障排查指南](06_快速参考/故障排查指南.md) - 问题诊断

## 🎯 测试金字塔原则

```
         E2E (10%)        - 关键业务流程
      ┌─────────────┐
      集成测试 (30%)    - 跨层交互
   ┌─────────────────┐
   单元测试 (60%)        - 快速、隔离
└────────────────────┘
```

## 🔍 当前测试覆盖情况

| 层级 | 覆盖率目标 | 当前状态 | 文档 |
|------|-----------|---------|------|
| Repository | ≥80% | ✅ 良好 | [查看](01_测试层级规范/repository_层测试规范.md) |
| Service | ≥80% | ✅ 良好 | [查看](01_测试层级规范/service_层测试规范.md) |
| API | ≥60% | 🔄 进行中 | [查看](01_测试层级规范/api_层测试规范.md) |
| E2E | 核心流程 | 🔄 进行中 | [查看](01_测试层级规范/e2e_测试规范.md) |

## 🚀 快速命令

```bash
# 运行所有测试
go test ./...

# 运行特定层级测试
go test ./repository/...   # Repository层
go test ./service/...      # Service层
go test ./test/api/...     # API层

# 生成覆盖率报告
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html

# 运行性能测试
go test -bench=. -benchmem ./test/performance/...

# 跳过慢速测试
go test -short ./...
```

## 📖 推荐阅读顺序

### 新手入门
1. [测试层级规范 - README](01_测试层级规范/README.md)
2. [单元测试详细规范](02_测试类型规范/单元测试详细规范.md)
3. [testify使用指南](03_测试工具指南/testify使用指南.md)
4. [测试模板集](06_快速参考/测试模板集.md)

### 进阶提升
1. [集成测试详细规范](02_测试类型规范/集成测试详细规范.md)
2. [真实数据库测试规范](04_真实数据测试规范/真实数据库测试规范.md)
3. [Mock框架使用指南](03_测试工具指南/mock框架使用指南.md)
4. [测试组织结构规范](05_最佳实践/测试组织结构规范.md)

### 高级专题
1. [性能测试详细规范](02_测试类型规范/性能测试详细规范.md)
2. [数据隔离策略](04_真实数据测试规范/数据隔离策略.md)
3. [常见反模式及避免](05_最佳实践/常见反模式及避免.md)
4. [故障排查指南](06_快速参考/故障排查指南.md)

## ⚠️ 重要原则

### 真实数据测试（禁止Hack）
- ✅ Repository层必须使用真实MongoDB
- ✅ 集成测试必须使用真实数据库
- ✅ 测试数据使用Factory模式创建
- ❌ 禁止使用内存数据库Mock
- ❌ 禁止使用假数据绕过验证
- ❌ 禁止临时修改代码适配测试

详见：[真实数据测试规范](04_真实数据测试规范/README.md)

### 测试分层原则
| 层级 | 测试方式 | 数据源 | 执行速度 |
|------|---------|--------|---------|
| Repository | 真实DB操作 | 真实MongoDB | 慢 (秒级) |
| Service | Mock Repository | 测试数据 | 快 (毫秒级) |
| API | HTTP请求 | 真实DB | 中 (百毫秒级) |
| E2E | 完整流程 | 真实DB | 慢 (秒级) |

## 📝 更新日志

- **v3.0** (2026-01-09) - 重构为分层分类体系，强调真实数据测试
- **v2.0** (2026-01-08) - 增加集成测试和E2E测试规范
- **v1.0** (2025-12-01) - 初始版本
