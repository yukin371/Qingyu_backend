# å…±äº«åº•å±‚æœåŠ¡æ¨¡å—

> é’ç¾½åç«¯ - æ¨¡å—åŒ–å•ä½“æ¶æ„çš„å…±äº«æœåŠ¡å±‚
>
> **åˆ›å»ºæ—¶é—´**: 2025-09-30
> **æœ€åæ›´æ–°**: 2026-01-12 (æ¸…ç†é‡å¤æ¨¡å—)

---

## ğŸ“‹ æ¦‚è¿°

å…±äº«åº•å±‚æœåŠ¡æ˜¯é’ç¾½åç«¯çš„åŸºç¡€è®¾æ–½å±‚ï¼Œä¸ºé˜…è¯»ç«¯å’Œå†™ä½œç«¯æä¾›ç»Ÿä¸€çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

**æ¶æ„æ¨¡å¼**: æ¨¡å—åŒ–å•ä½“ï¼ˆModular Monolithï¼‰

**æ³¨æ„**: ä»¥ä¸‹æ¨¡å—å·²ç§»è‡³ä¸šåŠ¡ç›®å½•ï¼Œä¸å†åœ¨æ­¤ç›®å½•ç»´æŠ¤ï¼š
- **Wallet** â†’ `service/finance/wallet/`
- **Recommendation** â†’ `service/recommendation/`
- **Admin** â†’ `service/admin/`

---

## ğŸ—ï¸ æ¨¡å—ç»“æ„

### å½“å‰æ¨¡å—

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ | ä¸»è¦æ–‡ä»¶ |
|------|------|------|---------|
| **Auth** | ğŸ“¦ å·²è¿ç§» | è®¤è¯ä¸æƒé™ç®¡ç† | å·²è¿ç§»è‡³ [service/auth/](../auth/) |
| **Messaging** | ğŸ“¦ å·²è¿ç§» | æ¶ˆæ¯é˜Ÿåˆ—ä¸é€šçŸ¥ | å·²è¿ç§»è‡³ [service/channels/](../channels/) |
| **Storage** | âœ… æ¥å£ | æ–‡ä»¶å­˜å‚¨æ¥å£ | [interfaces.go](./storage/interfaces.go) |
| **Cache** | âœ… å®ç° | Redis ç¼“å­˜æœåŠ¡ | [redis_cache_service.go](./cache/redis_cache_service.go) |
| **Search** | âœ… å®ç° | æœç´¢æœåŠ¡ | [search_service.go](./search/search_service.go) |
| **Metrics** | âœ… å®ç° | æœåŠ¡æŒ‡æ ‡æ”¶é›† | [service_metrics.go](./metrics/service_metrics.go) |
| **Stats** | âœ… å®ç° | å¹³å°ç»Ÿè®¡æœåŠ¡ | [stats_service.go](./stats/stats_service.go) |

---

## ğŸ“¦ ç›®å½•ç»“æ„

```
service/shared/
â”œâ”€â”€ storage/                   # æ–‡ä»¶å­˜å‚¨æ¨¡å—
â”‚   â””â”€â”€ interfaces.go          # å­˜å‚¨æœåŠ¡æ¥å£
â”‚
â”œâ”€â”€ cache/                     # ç¼“å­˜æ¨¡å—
â”‚   â””â”€â”€ redis_cache_service.go # Redis ç¼“å­˜å®ç°
â”‚
â”œâ”€â”€ search/                    # æœç´¢æ¨¡å—
â”‚   â””â”€â”€ search_service.go      # æœç´¢æœåŠ¡å®ç°
â”‚
â”œâ”€â”€ metrics/                   # æŒ‡æ ‡æ¨¡å—
â”‚   â””â”€â”€ service_metrics.go     # æœåŠ¡æŒ‡æ ‡æ”¶é›†
â”‚
â”œâ”€â”€ stats/                     # ç»Ÿè®¡æ¨¡å—
â”‚   â””â”€â”€ stats_service.go       # å¹³å°ç»Ÿè®¡æœåŠ¡
â”‚
â”œâ”€â”€ config_service.go          # åŠ¨æ€é…ç½®ç®¡ç†æœåŠ¡
â”œâ”€â”€ permission_service.go      # æƒé™æœåŠ¡ï¼ˆå®Œæ•´ RBACï¼‰
â”œâ”€â”€ messaging_compat.go        # æ¶ˆæ¯æ¨¡å—å…¼å®¹å±‚
â”‚
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

**å·²è¿ç§»æ¨¡å—**:
- **auth/** â†’ å·²è¿ç§»è‡³ [`service/auth/`](../auth/)
- **messaging/** â†’ å·²è¿ç§»è‡³ [`service/channels/`](../channels/)

---

## ğŸ¯ å„æ¨¡å—åŠŸèƒ½

### å·²è¿ç§»æ¨¡å—

#### 1. Auth æ¨¡å— (å·²è¿ç§»è‡³ `service/auth/`)

**æ ¸å¿ƒåŠŸèƒ½**:
- JWT Token ç”Ÿæˆä¸éªŒè¯
- ç”¨æˆ·æ³¨å†Œä¸ç™»å½•
- åŸºäº RBAC çš„æƒé™ç³»ç»Ÿ
- ä¼šè¯ç®¡ç†ï¼ˆRedisï¼‰
- è§’è‰²ä¸æƒé™ç®¡ç†

**æ–°ä½ç½®**: [`service/auth/`](../auth/)

#### 2. Messaging æ¨¡å— (å·²è¿ç§»è‡³ `service/channels/`)

**æ ¸å¿ƒåŠŸèƒ½**:
- æ¶ˆæ¯å‘å¸ƒè®¢é˜…ï¼ˆåŸºäº Redis Streamsï¼‰
- é‚®ä»¶å‘é€æœåŠ¡
- é€šçŸ¥å‘é€æœåŠ¡
- å»¶è¿Ÿæ¶ˆæ¯æ”¯æŒ

**æ–°ä½ç½®**: [`service/channels/`](../channels/)

**å…¼å®¹å±‚**: æœ¬ç›®å½•çš„ `messaging_compat.go` æä¾›äº†å‘åå…¼å®¹çš„åˆ«åå’Œç±»å‹

---

### 1. Storage æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
- æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ¥å£å®šä¹‰
- æ–‡ä»¶æƒé™æ§åˆ¶
- æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†
- ä¸´æ—¶è®¿é—® URL ç”Ÿæˆ

**ä¸»è¦æ–‡ä»¶**:
- `storage/interfaces.go` - å­˜å‚¨æœåŠ¡æ¥å£å®šä¹‰

---

### 2. Cache æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
- é€šç”¨ Redis ç¼“å­˜æœåŠ¡
- åŸºç¡€ç¼“å­˜æ“ä½œï¼ˆGET/SET/DELETEï¼‰
- æ‰¹é‡æ“ä½œæ”¯æŒ
- å“ˆå¸Œã€é›†åˆã€æœ‰åºé›†åˆæ“ä½œ

**ä¸»è¦æ–‡ä»¶**:
- `cache/redis_cache_service.go` - Redis ç¼“å­˜å®ç°

---

### 3. Search æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
- æœç´¢æœåŠ¡æ¥å£å®šä¹‰

**ä¸»è¦æ–‡ä»¶**:
- `search/search_service.go` - æœç´¢æœåŠ¡å®ç°

---

### 4. Metrics æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
- æœåŠ¡æŒ‡æ ‡æ”¶é›†ä¸ä¸ŠæŠ¥

**ä¸»è¦æ–‡ä»¶**:
- `metrics/service_metrics.go` - æœåŠ¡æŒ‡æ ‡æ”¶é›†

---

### 5. Stats æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
- å¹³å°ç»Ÿè®¡æ•°æ®æœåŠ¡

**ä¸»è¦æ–‡ä»¶**:
- `stats/stats_service.go` - å¹³å°ç»Ÿè®¡æœåŠ¡

---

### 6. Config æœåŠ¡

**æ ¸å¿ƒåŠŸèƒ½**:
- åŠ¨æ€é…ç½®ç®¡ç†
- é…ç½®çƒ­æ›´æ–°
- é…ç½®å¤‡ä»½ä¸æ¢å¤

**ä¸»è¦æ–‡ä»¶**:
- `config_service.go` - é…ç½®ç®¡ç†æœåŠ¡

---

### 7. Permission æœåŠ¡

**æ ¸å¿ƒåŠŸèƒ½**:
- å®Œæ•´ RBAC æƒé™å®ç°
- æƒé™æ£€æŸ¥æ¥å£
- è§’è‰²ç®¡ç†æ¥å£

**ä¸»è¦æ–‡ä»¶**:
- `permission_service.go` - æƒé™æœåŠ¡å®ç°

---

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### å¯¼å…¥æœåŠ¡æ¥å£

```go
import (
    authService "Qingyu_backend/service/auth"           // è®¤è¯æœåŠ¡
    cacheService "Qingyu_backend/service/shared/cache"  // ç¼“å­˜æœåŠ¡
    channelsService "Qingyu_backend/service/channels"   // æ¶ˆæ¯é€šçŸ¥æœåŠ¡
    storageService "Qingyu_backend/service/shared/storage" // å­˜å‚¨æœåŠ¡
)
```

**æ³¨æ„**:
- Authæ¨¡å—å·²è¿ç§»è‡³ `service/auth`
- Messagingæ¨¡å—å·²è¿ç§»è‡³ `service/channels`
- æ—§çš„importè·¯å¾„ `service/shared/auth` å’Œ `service/shared/messaging` ä¸å†å¯ç”¨
- å¯ä½¿ç”¨ `service/shared` çš„å…¼å®¹å±‚ä½œä¸ºè¿‡æ¸¡ï¼ˆ`messaging_compat.go`ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å—ç‹¬ç«‹æ€§**: å„æ¨¡å—é€šè¿‡æ¥å£äº¤äº’ï¼Œç¦æ­¢è·¨æ¨¡å—ç›´æ¥è°ƒç”¨å†…éƒ¨å®ç°
2. **æ¥å£ç¨³å®šæ€§**: æ¥å£ä¸€æ—¦å®šä¹‰åº”ä¿æŒç¨³å®šï¼Œå˜æ›´éœ€è°¨æ…
3. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨é¡¹ç›®é”™è¯¯å¤„ç†è§„èŒƒ
4. **æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œå¿…é¡»è®°å½•æ—¥å¿—
5. **æµ‹è¯•è¦†ç›–**: æ ¸å¿ƒåŠŸèƒ½å¿…é¡»æœ‰å•å…ƒæµ‹è¯•

---

## ğŸ“ Commit è§„èŒƒ

```
feat(shared/auth): å®ç°JWTæœåŠ¡
fix(shared/cache): ä¿®å¤ç¼“å­˜å¤±æ•ˆé—®é¢˜
test(shared/messaging): æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—æµ‹è¯•
docs(shared): æ›´æ–°ä½¿ç”¨è¯´æ˜
refactor(shared): æ¸…ç†é‡å¤æ¨¡å—
```

---

*æœ€åæ›´æ–°: 2026-01-12 - æ¸…ç†é‡å¤æ¨¡å—*
