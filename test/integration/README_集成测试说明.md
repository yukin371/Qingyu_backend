# é’ç¾½åç«¯é›†æˆæµ‹è¯•å¥—ä»¶

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«é’ç¾½åç«¯çš„å®Œæ•´é›†æˆæµ‹è¯•å¥—ä»¶ï¼Œæ¶µç›–ä»æ•°æ®å‡†å¤‡åˆ°ä¸šåŠ¡æµç¨‹çš„æ‰€æœ‰æµ‹è¯•åœºæ™¯ã€‚

## ğŸ—‚ï¸ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
test/integration/
â”œâ”€â”€ scenario_bookstore_test.go      # ä¹¦åŸé¦–é¡µå’Œæ¦œå•æµ‹è¯•
â”œâ”€â”€ scenario_search_test.go         # ä¹¦ç±æœç´¢åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ scenario_reading_test.go        # é˜…è¯»æµç¨‹æµ‹è¯•
â”œâ”€â”€ scenario_ai_generation_test.go  # AIæ–‡æœ¬ç”Ÿæˆæµ‹è¯•
â”œâ”€â”€ scenario_auth_test.go           # ç”¨æˆ·è®¤è¯å’Œæƒé™æµ‹è¯•
â”œâ”€â”€ scenario_writing_test.go        # å†™ä½œæµç¨‹æµ‹è¯•
â”œâ”€â”€ scenario_interaction_test.go    # äº’åŠ¨åŠŸèƒ½æµ‹è¯•
â””â”€â”€ README_é›†æˆæµ‹è¯•è¯´æ˜.md         # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®æ‰§è¡Œï¼ˆæ¨èï¼‰

```batch
scripts\testing\run_integration_tests.bat
```

æŒ‰æç¤ºæ“ä½œï¼š
1. é€‰æ‹©æ˜¯å¦å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆé¦–æ¬¡è¿è¡Œé€‰yesï¼‰
2. é€‰æ‹©è¦æ‰§è¡Œçš„æµ‹è¯•åœºæ™¯ï¼ˆ1-8ï¼‰

### æ‰‹åŠ¨æ‰§è¡Œ

#### 1. å‡†å¤‡ç¯å¢ƒ

```batch
# æ¸…ç†æ—§æ•°æ®
scripts\testing\cleanup_test_data.bat

# å¯¼å…¥æµ‹è¯•ç”¨æˆ·
go run scripts\testing\import_test_users.go

# å¯¼å…¥å°è¯´æ•°æ®
scripts\testing\import_novels.bat
```

#### 2. å¯åŠ¨æœåŠ¡å™¨

```batch
go run cmd/server/main.go
```

#### 3. è¿è¡Œæµ‹è¯•

```batch
# å•ä¸ªæµ‹è¯•
go test -v ./test/integration/scenario_bookstore_test.go

# å…¨éƒ¨æµ‹è¯•
go test -v ./test/integration/scenario_*.go
```

## ğŸ“¦ æµ‹è¯•åœºæ™¯è¯¦æƒ…

### 1. ä¹¦åŸæµç¨‹æµ‹è¯• âœ…

**æ–‡ä»¶**: `scenario_bookstore_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ è·å–ä¹¦åŸé¦–é¡µæ•°æ®
- âœ“ è·å–åˆ†ç±»æ ‘
- âœ“ è·å–æ¨èä¹¦ç±
- âœ“ è·å–ç²¾é€‰ä¹¦ç±
- âœ“ è·å–æ´»åŠ¨Banner
- âœ“ è·å–å®æ—¶æ¦œ/å‘¨æ¦œ/æœˆæ¦œ/æ–°äººæ¦œ
- âœ“ æ•°æ®åº“ç»Ÿè®¡éªŒè¯

### 2. æœç´¢åŠŸèƒ½æµ‹è¯• ğŸ”

**æ–‡ä»¶**: `scenario_search_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ æŒ‰æ ‡é¢˜å…³é”®è¯æœç´¢
- âœ“ æŒ‰ä½œè€…æœç´¢
- âœ“ ç»„åˆæœç´¢
- âœ“ æ’åºåŠŸèƒ½ï¼ˆæœ€æ–°ã€æœ€çƒ­ã€å­—æ•°ï¼‰
- âœ“ åˆ†é¡µåŠŸèƒ½
- âœ“ æ— ç»“æœåœºæ™¯å¤„ç†

### 3. é˜…è¯»æµç¨‹æµ‹è¯• ğŸ“–

**æ–‡ä»¶**: `scenario_reading_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ è·å–ä¹¦ç±è¯¦æƒ…
- âœ“ è·å–ç« èŠ‚åˆ—è¡¨
- âœ“ é˜…è¯»ç« èŠ‚å†…å®¹
- âœ“ ä¿å­˜é˜…è¯»è¿›åº¦
- âœ“ æ·»åŠ ä¹¦ç­¾
- âœ“ æ·»åŠ ç¬”è®°
- âœ“ ç®¡ç†ä¸ªäººä¹¦æ¶

**éœ€è¦**: ç™»å½•æµ‹è¯•ç”¨æˆ·

### 4. AIç”Ÿæˆæµ‹è¯• ğŸ¤–

**æ–‡ä»¶**: `scenario_ai_generation_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ æ–‡æœ¬ç»­å†™
- âœ“ æ–‡æœ¬æ”¹å†™
- âœ“ æ–‡æœ¬æ‰©å†™
- âœ“ æ–‡æœ¬æ¶¦è‰²
- âœ“ Tokenä½¿ç”¨ç»Ÿè®¡
- âœ“ é”™è¯¯å¤„ç†

**éœ€è¦**: 
- é…ç½®Gemini API Key
- ç½‘ç»œè¿æ¥

**APIé…ç½®**: 
```yaml
# config/config.yaml
external_api:
  default_provider: "gemini"
  providers:
    gemini:
      api_key: "YOUR_API_KEY"
      base_url: "https://generativelanguage.googleapis.com"
      enabled: true
```

### 5. è®¤è¯æµç¨‹æµ‹è¯• ğŸ”

**æ–‡ä»¶**: `scenario_auth_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ æ™®é€šç”¨æˆ·ç™»å½•
- âœ“ VIPç”¨æˆ·ç™»å½•
- âœ“ ç®¡ç†å‘˜ç™»å½•
- âœ“ TokenéªŒè¯
- âœ“ æƒé™æ§åˆ¶
- âœ“ ç”¨æˆ·æ³¨å†Œ
- âœ“ é”™è¯¯å¤„ç†ï¼ˆé”™è¯¯å¯†ç ã€ä¸å­˜åœ¨ç”¨æˆ·ï¼‰

### 6. å†™ä½œæµç¨‹æµ‹è¯• âœï¸

**æ–‡ä»¶**: `scenario_writing_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ åˆ›å»ºå†™ä½œé¡¹ç›®
- âœ“ è·å–é¡¹ç›®åˆ—è¡¨
- âœ“ åˆ›å»ºæ–‡æ¡£
- âœ“ ä¿å­˜è‰ç¨¿
- âœ“ ç‰ˆæœ¬ç®¡ç†
- âœ“ å‘å¸ƒæ–‡æ¡£

**éœ€è¦**: ç™»å½•æµ‹è¯•ç”¨æˆ·

### 7. äº’åŠ¨åŠŸèƒ½æµ‹è¯• ğŸ’¬

**æ–‡ä»¶**: `scenario_interaction_test.go`

**æµ‹è¯•å†…å®¹**:
- âœ“ æ”¶è—ä¹¦ç±
- âœ“ å‘è¡¨è¯„è®º
- âœ“ ç‚¹èµ/å–æ¶ˆç‚¹èµ
- âœ“ é˜…è¯»å†å²
- âœ“ ä¸ªäººä¹¦æ¶
- âœ“ äº’åŠ¨æ•°æ®ç»Ÿè®¡

**éœ€è¦**: ç™»å½•æµ‹è¯•ç”¨æˆ·

## ğŸ‘¥ æµ‹è¯•è´¦å·

| è§’è‰² | é‚®ç®± | å¯†ç  | ç”¨é€” |
|-----|------|------|-----|
| ç®¡ç†å‘˜ | admin@qingyu.com | Admin@123456 | ç®¡ç†å‘˜æµ‹è¯• |
| VIPç”¨æˆ· | vip01@qingyu.com | Vip@123456 | VIPåŠŸèƒ½æµ‹è¯• |
| VIPç”¨æˆ· | vip02@qingyu.com | Vip@123456 | VIPåŠŸèƒ½æµ‹è¯• |
| æ™®é€šç”¨æˆ· | test01@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ·æµ‹è¯• |
| æ™®é€šç”¨æˆ· | test02@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ·æµ‹è¯• |
| æ™®é€šç”¨æˆ· | test03@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ·æµ‹è¯• |
| æ™®é€šç”¨æˆ· | test04@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ·æµ‹è¯• |
| æ™®é€šç”¨æˆ· | test05@qingyu.com | Test@123456 | æ™®é€šç”¨æˆ·æµ‹è¯• |

## ğŸ“Š æµ‹è¯•æ•°æ®

### å°è¯´æ•°æ®
- **æ¥æº**: CNNovel125Kæ•°æ®é›†
- **æ•°é‡**: 100æœ¬å°è¯´ï¼ˆçº¦3000ç« ï¼‰
- **æ–‡ä»¶**: `data/novels_100.json`

### æ•°æ®å‡†å¤‡è„šæœ¬

```batch
# Windows
scripts\testing\cleanup_test_data.bat      # æ¸…ç†æ•°æ®
scripts\testing\import_test_users.go       # å¯¼å…¥ç”¨æˆ·
scripts\testing\import_novels.bat          # å¯¼å…¥å°è¯´
scripts\testing\run_integration_tests.bat  # ä¸€é”®æµ‹è¯•
```

## âš™ï¸ é…ç½®è¯´æ˜

### æµ‹è¯•ç¯å¢ƒé…ç½®

æµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼š`config/config.test.yaml`

å…³é”®é…ç½®ï¼š
```yaml
mongodb:
  database: "qingyu_test"  # ä½¿ç”¨æµ‹è¯•æ•°æ®åº“

redis:
  db: 1  # ä½¿ç”¨ç‹¬ç«‹çš„Redis DB

external_api:
  providers:
    gemini:
      api_key: "YOUR_API_KEY"  # Gemini API Key
```

## ğŸ› å¸¸è§é—®é¢˜

### æœåŠ¡å™¨è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æµ‹è¯•æç¤º"æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"

**è§£å†³**:
```batch
# 1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/api/v1/system/health

# 2. å¯åŠ¨æœåŠ¡å™¨
go run cmd/server/main.go
```

### æ•°æ®åº“æ— æ•°æ®

**ç—‡çŠ¶**: æµ‹è¯•æç¤º"æ•°æ®åº“ä¸­æ²¡æœ‰ä¹¦ç±"

**è§£å†³**:
```batch
# é‡æ–°å¯¼å…¥æ•°æ®
scripts\testing\import_novels.bat
```

### AIæµ‹è¯•å¤±è´¥

**ç—‡çŠ¶**: AIæµ‹è¯•è¿”å›é”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥API Keyé…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç¡®è®¤APIé…é¢

### ç™»å½•å¤±è´¥

**ç—‡çŠ¶**: æµ‹è¯•æç¤º"ç”¨æˆ·ä¸å­˜åœ¨"

**è§£å†³**:
```batch
# é‡æ–°å¯¼å…¥æµ‹è¯•ç”¨æˆ·
go run scripts\testing\import_test_users.go
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼š

```batch
# è¿è¡Œæµ‹è¯•å¹¶ä¿å­˜æŠ¥å‘Š
go test -v ./test/integration/scenario_*.go > test_report.txt 2>&1

# æŸ¥çœ‹æŠ¥å‘Š
type test_report.txt
```

## ğŸ”„ æŒç»­é›†æˆ

æµ‹è¯•å¯é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼š

```yaml
# .github/workflows/integration-test.yml
name: Integration Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      mongodb:
        image: mongo:4.4
        ports:
          - 27017:27017
    
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-go@v2
      
      - name: Prepare test data
        run: |
          go run scripts/testing/import_test_users.go
          bash scripts/testing/import_novels.sh
      
      - name: Run tests
        run: go test -v ./test/integration/...
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é›†æˆæµ‹è¯•ä½¿ç”¨æŒ‡å—](../../doc/testing/é›†æˆæµ‹è¯•ä½¿ç”¨æŒ‡å—.md)
- [é¡¹ç›®æ¶æ„æ–‡æ¡£](../../doc/architecture/)
- [APIæ–‡æ¡£](../../doc/api/)

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

è¿è¡Œæµ‹è¯•å‰ç¡®è®¤ï¼š

- [ ] MongoDB æ­£åœ¨è¿è¡Œ
- [ ] æµ‹è¯•æ•°æ®å·²å¯¼å…¥
- [ ] æµ‹è¯•ç”¨æˆ·å·²åˆ›å»º
- [ ] æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- [ ] Gemini API Keyå·²é…ç½®ï¼ˆAIæµ‹è¯•éœ€è¦ï¼‰
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸

## ğŸ¯ æµ‹è¯•ç›®æ ‡

- âœ… éªŒè¯æ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- âœ… ç¡®ä¿APIæ¥å£æ­£å¸¸å·¥ä½œ
- âœ… éªŒè¯ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- âœ… æµ‹è¯•AIé›†æˆåŠŸèƒ½
- âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§

---

**æœ€åæ›´æ–°**: 2025-10-24  
**ç»´æŠ¤è€…**: é’ç¾½åç«¯æµ‹è¯•å›¢é˜Ÿ


