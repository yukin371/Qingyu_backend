# Scripts 使用说明

## 📁 目录结构

```
scripts/
├── init/           # 初始化和环境设置
├── testing/        # 测试相关脚本
├── deployment/     # 部署相关脚本
├── data/           # 数据处理脚本
├── utils/          # 工具脚本
├── docs/           # 文档
├── README.md       # 详细文档
└── QUICKSTART.md   # 快速开始指南
```

---

## 🚀 快速开始

### 1. 初始化本地测试环境

```bash
# 推荐：使用 Python 脚本（跨平台）
python scripts/init/setup_local_test_data.py

# Windows
scripts\init\setup_local_test_data.bat

# Linux/Mac
./scripts/init/setup_local_test_data.sh
```

### 2. 运行测试

```bash
# 快速验证
python scripts/testing/quick_verify.py

# 完整测试套件
python scripts/testing/run_tests.py

# 集成测试准备
python scripts/testing/setup_integration_tests.py
```

### 3. 数据导入

```bash
# 导入测试用户
go run scripts/testing/import_test_users.go

# 导入小说数据
python scripts/data/import_novels.py --file data/novels_100.json
```

---

## 📂 目录详细说明

### init/ - 初始化脚本

| 脚本 | 说明 | 平台 |
|------|------|------|
| `setup_local_test_data.py` | 一键初始化测试数据 | 跨平台 |
| `setup_local_test_data.bat` | Windows 批处理版本 | Windows |
| `setup_local_test_data.sh` | Shell 脚本版本 | Linux/Mac |

**使用示例**：
```bash
# 完整初始化
python scripts/init/setup_local_test_data.py

# 仅导入小说，跳过用户
python scripts/init/setup_local_test_data.py --skip-users

# 自定义数据文件
python scripts/init/setup_local_test_data.py --novels-file data/novels_500.json
```

---

### testing/ - 测试脚本

#### 快速验证

| 脚本 | 说明 |
|------|------|
| `quick_verify.py` | 快速验证项目状态 |
| `quick_verify.bat/sh` | 平台特定版本 |

#### 集成测试

| 脚本 | 说明 |
|------|------|
| `setup_integration_tests.py` | 准备集成测试环境 |
| `run_tests.py` | 运行集成测试套件 |
| `run_all_scenarios.bat` | 运行所有场景测试 |
| `run_single_scenario.bat` | 运行单个场景测试 |

#### 用户管理

| 脚本 | 说明 |
|------|------|
| `import_test_users.go` | 导入测试用户（Go 版本）|
| `import_users_direct.py` | 直接导入用户（Python 版本）|
| `check_users.py` | 检查用户数据 |

#### 数据库清理

| 脚本 | 说明 |
|------|------|
| `cleanup_database.py` | 清理测试数据 |
| `clean_and_reimport.py` | 清理并重新导入 |

#### 功能测试

| 脚本 | 说明 |
|------|------|
| `test_login_direct.py` | 直接测试登录 API |
| `test_reading_features.py` | 测试阅读功能 |
| `test_bcrypt.py` | 测试密码加密兼容性 |

**使用示例**：
```bash
# 1. 准备测试环境
python scripts/testing/setup_integration_tests.py

# 2. 运行测试
python scripts/testing/run_tests.py

# 3. 测试特定功能
python scripts/testing/test_login_direct.py
```

---

### data/ - 数据处理脚本

| 脚本 | 说明 |
|------|------|
| `import_novels.py` | 导入小说数据 |
| `test_novel_import.py` | 测试小说导入功能 |

**使用示例**：
```bash
# 导入小说
python scripts/data/import_novels.py --file data/novels_100.json

# 试运行（不实际导入）
python scripts/data/import_novels.py --file data/novels_100.json --dry-run
```

---

### deployment/ - 部署脚本

| 脚本 | 说明 |
|------|------|
| `quick_deploy_mvp.sh` | 快速部署 MVP 版本 |
| `deployment_check.sh` | 部署前检查 |

---

## 💡 常见场景

### 场景 1：首次设置开发环境

```bash
# 1. 初始化测试数据
python scripts/init/setup_local_test_data.py

# 2. 启动服务器
go run cmd/server/main.go

# 3. 验证环境
python scripts/testing/quick_verify.py
```

### 场景 2：运行集成测试

```bash
# 1. 确保服务器运行
go run cmd/server/main.go

# 2. 准备测试（如果需要）
python scripts/testing/setup_integration_tests.py

# 3. 运行测试
python scripts/testing/run_tests.py
```

### 场景 3：重置测试数据

```bash
# 1. 清理数据库
python scripts/testing/cleanup_database.py

# 2. 重新导入
python scripts/init/setup_local_test_data.py
```

### 场景 4：测试特定功能

```bash
# 测试登录
python scripts/testing/test_login_direct.py

# 测试阅读功能
python scripts/testing/test_reading_features.py

# 测试密码兼容性
python scripts/testing/test_bcrypt.py
```

---

## 🔧 脚本开发规范

### Python 脚本

- 使用 UTF-8 编码
- 支持命令行参数
- 提供 `--help` 选项
- 包含清晰的输出和错误处理

### 批处理脚本

- Windows：`.bat` 文件
- Linux/Mac：`.sh` 文件，添加执行权限
- 提供与 Python 版本对等的功能

### Go 脚本

- 可以直接用 `go run` 运行
- 提供清晰的输出和错误信息

---

## 📚 相关文档

- **详细文档**：`scripts/README.md`
- **快速开始**：`scripts/QUICKSTART.md`
- **测试指南**：`doc/testing/集成测试使用指南.md`
- **API 文档**：`doc/api/`
- **实施文档**：`doc/implement/`

---

## ⚠️ 注意事项

1. **环境要求**：
   - Python 3.7+
   - Go 1.21+
   - MongoDB 运行中
   - Redis 运行中（如需要）

2. **数据库**：
   - 测试使用 `qingyu_test` 数据库
   - 生产使用 `qingyu` 数据库
   - 不要在生产环境运行测试脚本！

3. **配置文件**：
   - 开发环境：`config/config.yaml`
   - 测试环境：`config/config.test.yaml`

---

## 🆘 故障排查

### 问题：脚本找不到模块

```bash
# 安装依赖
pip install -r requirements.txt
```

### 问题：MongoDB 连接失败

```bash
# 检查 MongoDB 是否运行
mongosh --eval "db.version()"

# Windows 启动 MongoDB
net start MongoDB
```

### 问题：数据导入失败

```bash
# 检查数据文件是否存在
ls data/novels_100.json

# 查看详细错误信息（添加 -v 参数）
python scripts/data/import_novels.py -v
```

---

**最后更新**：2025-10-25  
**维护者**：青羽后端开发团队

