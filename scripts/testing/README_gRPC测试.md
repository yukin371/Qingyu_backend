# gRPC é›†æˆæµ‹è¯•è„šæœ¬

> **Go åç«¯ â†” Python AI å¾®æœåŠ¡é›†æˆæµ‹è¯•**

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æµ‹è¯•è„šæœ¬

| æ–‡ä»¶ | ç”¨é€” | é€‚ç”¨åœºæ™¯ |
|-----|------|---------|
| `test_grpc_integration.bat` | **ä¸€é”®é›†æˆæµ‹è¯•** | å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯• |
| `run_grpc_tests.bat` | **è¿è¡Œ Go æµ‹è¯•** | ä»…æµ‹è¯• Go å®¢æˆ·ç«¯ |

### ä½¿ç”¨è¯´æ˜

#### 1. ä¸€é”®é›†æˆæµ‹è¯•ï¼ˆæ¨èï¼‰

**æœ€ç®€å•çš„æ–¹å¼** - è‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
scripts\testing\test_grpc_integration.bat
```

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨æ£€æŸ¥ä¾èµ–ï¼ˆGo, Pythonï¼‰
- âœ… è‡ªåŠ¨å¯åŠ¨ Python AI æœåŠ¡
- âœ… è‡ªåŠ¨è¿è¡Œ Python å®¢æˆ·ç«¯æµ‹è¯•
- âœ… è‡ªåŠ¨è¿è¡Œ Go å®¢æˆ·ç«¯æµ‹è¯•
- âœ… è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ‘˜è¦

**å‰ææ¡ä»¶**:
```bash
# ä»…éœ€è®¾ç½®ä¸€æ¬¡
set GOOGLE_API_KEY=your_api_key_here
```

#### 2. å•ç‹¬è¿è¡Œ Go æµ‹è¯•

**åœºæ™¯**: Python æœåŠ¡å·²å¯åŠ¨ï¼Œä»…æµ‹è¯• Go å®¢æˆ·ç«¯

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
scripts\testing\run_grpc_tests.bat
```

**å‰ææ¡ä»¶**:
- Python AI æœåŠ¡å¿…é¡»å·²å¯åŠ¨ï¼ˆlocalhost:50051ï¼‰
- GOOGLE_API_KEY ç¯å¢ƒå˜é‡å·²è®¾ç½®

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„æ–¹å¼

```bash
# 1. è®¾ç½® API Keyï¼ˆä»…ä¸€æ¬¡ï¼‰
set GOOGLE_API_KEY=your_google_api_key

# 2. è¿è¡Œæµ‹è¯•
scripts\testing\test_grpc_integration.bat

# 3. ç­‰å¾…æµ‹è¯•å®Œæˆ
# âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### æ‰‹åŠ¨æµ‹è¯•æµç¨‹

å¦‚æœéœ€è¦æ›´å¤šæ§åˆ¶ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Python AI æœåŠ¡
cd python_ai_service
python run_grpc_server.py

# ç»ˆç«¯ 2: æµ‹è¯• Python å®¢æˆ·ç«¯
cd python_ai_service
python tests\test_grpc_phase3.py

# ç»ˆç«¯ 3: æµ‹è¯• Go å®¢æˆ·ç«¯
go run cmd\test_phase3_grpc\main.go --addr localhost:50051

# æˆ–è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
go test -v -timeout 300s ./test/integration -run TestGRPC
```

---

## ğŸ“‹ æµ‹è¯•å†…å®¹

### Python å®¢æˆ·ç«¯æµ‹è¯•

| æµ‹è¯•é¡¹ | è¯´æ˜ | é¢„æœŸè€—æ—¶ |
|-------|------|---------|
| å¥åº·æ£€æŸ¥ | éªŒè¯æœåŠ¡å¯ç”¨æ€§ | < 0.1ç§’ |
| å¤§çº²ç”Ÿæˆ | æµ‹è¯• GenerateOutline | 8-12ç§’ |
| è§’è‰²ç”Ÿæˆ | æµ‹è¯• GenerateCharacters | 10-15ç§’ |
| æƒ…èŠ‚ç”Ÿæˆ | æµ‹è¯• GeneratePlot | 12-18ç§’ |
| å®Œæ•´å·¥ä½œæµ | æµ‹è¯• ExecuteCreativeWorkflow | 30-45ç§’ |

### Go å®¢æˆ·ç«¯æµ‹è¯•

| æµ‹è¯•é¡¹ | è¯´æ˜ | é¢„æœŸè€—æ—¶ |
|-------|------|---------|
| è¿æ¥æµ‹è¯• | éªŒè¯ gRPC è¿æ¥ | < 0.1ç§’ |
| å¤§çº²ç”Ÿæˆ | æµ‹è¯• GenerateOutline | 8-12ç§’ |
| è§’è‰²ç”Ÿæˆ | æµ‹è¯• GenerateCharacters | 10-15ç§’ |
| æƒ…èŠ‚ç”Ÿæˆ | æµ‹è¯• GeneratePlot | 12-18ç§’ |
| å®Œæ•´å·¥ä½œæµ | æµ‹è¯•å®Œæ•´æµç¨‹ | 30-45ç§’ |
| å¹¶å‘æµ‹è¯• | æµ‹è¯•å¹¶å‘å¤„ç† | 15-25ç§’ |
| é”™è¯¯å¤„ç† | æµ‹è¯•å¼‚å¸¸å¤„ç† | < 1ç§’ |

**æ€»æµ‹è¯•æ—¶é—´**: çº¦ 2-3 åˆ†é’Ÿ

---

## âœ… æˆåŠŸæ ‡å¿—

æµ‹è¯•æˆåŠŸåº”è¯¥çœ‹åˆ°ï¼š

### Python æµ‹è¯•è¾“å‡º

```
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
========================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
========================================
```

### Go æµ‹è¯•è¾“å‡º

```
========================================
âœ… æµ‹è¯•å®Œæˆ
========================================
```

### é›†æˆæµ‹è¯•æ‘˜è¦

```
========================================
æµ‹è¯•å®Œæˆæ‘˜è¦
========================================

[âœ“] Python AI å¾®æœåŠ¡å¯åŠ¨æˆåŠŸ
[âœ“] Python å®¢æˆ·ç«¯æµ‹è¯•é€šè¿‡
[âœ“] Go å®¢æˆ·ç«¯æµ‹è¯•é€šè¿‡

========================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
========================================
```

---

## âŒ å¸¸è§é”™è¯¯

### 1. API Key æœªè®¾ç½®

**é”™è¯¯**:
```
ERROR: GOOGLE_API_KEY environment variable is not set
```

**è§£å†³**:
```bash
set GOOGLE_API_KEY=your_api_key_here
```

### 2. è¿æ¥å¤±è´¥

**é”™è¯¯**:
```
failed to connect to all addresses
```

**åŸå› **: Python AI æœåŠ¡æœªå¯åŠ¨

**è§£å†³**:
```bash
cd python_ai_service
python run_grpc_server.py
```

### 3. ç«¯å£å ç”¨

**é”™è¯¯**:
```
Address already in use
```

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
netstat -ano | findstr :50051

# ç»“æŸè¿›ç¨‹
taskkill /PID <PID> /F
```

### 4. ä¾èµ–ç¼ºå¤±

**é”™è¯¯**:
```
ModuleNotFoundError: No module named 'grpc'
```

**è§£å†³**:
```bash
cd python_ai_service
pip install -r requirements.txt
```

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

### æµ‹è¯•æŒ‡å—

- [gRPCé›†æˆæµ‹è¯•æŒ‡å—](../../doc/testing/gRPCé›†æˆæµ‹è¯•æŒ‡å—.md) - å®Œæ•´æµ‹è¯•æ–‡æ¡£
- [gRPCé›†æˆæµ‹è¯•å¿«é€Ÿå¯åŠ¨](../../doc/testing/gRPCé›†æˆæµ‹è¯•å¿«é€Ÿå¯åŠ¨.md) - å¿«é€Ÿä¸Šæ‰‹
- [gRPCæµ‹è¯•ç»“æœç¤ºä¾‹](../../doc/testing/gRPCæµ‹è¯•ç»“æœç¤ºä¾‹.md) - æµ‹è¯•ç»“æœå‚è€ƒ

### æŠ€æœ¯æ–‡æ¡£

- [Phase3 gRPC README](../../python_ai_service/PHASE3_GRPC_README.md) - æœåŠ¡è¯´æ˜
- [gRPC é›†æˆæŒ‡å—](../../python_ai_service/GRPC_INTEGRATION_GUIDE.md) - é›†æˆæ–¹æ³•
- [Proto å®šä¹‰](../../python_ai_service/proto/ai_service.proto) - æ¥å£å®šä¹‰

### ä»£ç å®ç°

- [Go å®¢æˆ·ç«¯](../../service/ai/phase3_client.go) - Go ç«¯å®ç°
- [Python æœåŠ¡ç«¯](../../python_ai_service/src/grpc_service/server.py) - Python ç«¯å®ç°
- [Go é›†æˆæµ‹è¯•](../../test/integration/grpc_ai_service_test.go) - æµ‹è¯•ä»£ç 

---

## ğŸ¯ æµ‹è¯•æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œæµ‹è¯•è„šæœ¬                        â”‚
â”‚  test_grpc_integration.bat          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”œâ”€> [1] æ£€æŸ¥ä¾èµ–
                â”‚    â””â”€> Go, Python, pip
                â”‚
                â”œâ”€> [2] å¯åŠ¨ Python AI æœåŠ¡
                â”‚    â””â”€> localhost:50051
                â”‚
                â”œâ”€> [3] Python å®¢æˆ·ç«¯æµ‹è¯•
                â”‚    â”œâ”€> å¥åº·æ£€æŸ¥
                â”‚    â”œâ”€> å¤§çº²ç”Ÿæˆ
                â”‚    â”œâ”€> è§’è‰²ç”Ÿæˆ
                â”‚    â”œâ”€> æƒ…èŠ‚ç”Ÿæˆ
                â”‚    â””â”€> å®Œæ•´å·¥ä½œæµ
                â”‚
                â”œâ”€> [4] Go å®¢æˆ·ç«¯æµ‹è¯•
                â”‚    â”œâ”€> è¿æ¥æµ‹è¯•
                â”‚    â”œâ”€> å¤§çº²ç”Ÿæˆ
                â”‚    â”œâ”€> è§’è‰²ç”Ÿæˆ
                â”‚    â”œâ”€> æƒ…èŠ‚ç”Ÿæˆ
                â”‚    â”œâ”€> å®Œæ•´å·¥ä½œæµ
                â”‚    â”œâ”€> å¹¶å‘æµ‹è¯•
                â”‚    â””â”€> é”™è¯¯å¤„ç†
                â”‚
                â””â”€> [5] ç”Ÿæˆæµ‹è¯•æ‘˜è¦
                     â””â”€> âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

---

## ğŸ”§ é«˜çº§é€‰é¡¹

### è‡ªå®šä¹‰æµ‹è¯•

#### ä»…æµ‹è¯•è¿æ¥

```bash
go test -v ./test/integration -run TestGRPCConnection
```

#### ä»…æµ‹è¯•å¤§çº²ç”Ÿæˆ

```bash
go test -v ./test/integration -run TestGenerateOutline
```

#### è·³è¿‡é•¿æ—¶é—´æµ‹è¯•

```bash
go test -v -short ./test/integration
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
set GRPC_VERBOSITY=DEBUG
set GRPC_TRACE=all

# è¿è¡Œæµ‹è¯•
go test -v ./test/integration -run TestGRPC
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### æ ‡å‡†é…ç½®

| æµ‹è¯•é¡¹ | æ—¶é—´ | å†…å­˜ | CPU |
|-------|------|------|-----|
| Python æœåŠ¡å¯åŠ¨ | 5-10ç§’ | ~512MB | ~20% |
| å¥åº·æ£€æŸ¥ | < 0.1ç§’ | +10MB | +5% |
| å¤§çº²ç”Ÿæˆ | 8-12ç§’ | +50MB | +30% |
| è§’è‰²ç”Ÿæˆ | 10-15ç§’ | +50MB | +30% |
| æƒ…èŠ‚ç”Ÿæˆ | 12-18ç§’ | +50MB | +30% |
| å®Œæ•´å·¥ä½œæµ | 30-45ç§’ | +100MB | +40% |

### æ¨èé…ç½®

- **CPU**: 4æ ¸å¿ƒ+
- **å†…å­˜**: 8GB+
- **ç½‘ç»œ**: 100Mbps+
- **ç£ç›˜**: SSD

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. **é¦–æ¬¡è¿è¡Œ** - ä½¿ç”¨ä¸€é”®æµ‹è¯•è„šæœ¬
2. **æ—¥å¸¸å¼€å‘** - åªæµ‹è¯•ä¿®æ”¹çš„åŠŸèƒ½
3. **æäº¤å‰** - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

### CI/CD é›†æˆ

```yaml
# .github/workflows/test.yml
- name: Run gRPC Integration Tests
  run: |
    set GOOGLE_API_KEY=${{ secrets.GOOGLE_API_KEY }}
    scripts\testing\test_grpc_integration.bat
```

### ç”Ÿäº§éƒ¨ç½²å‰

1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
2. æ‰§è¡Œæ€§èƒ½æµ‹è¯•
3. æ£€æŸ¥èµ„æºæ¶ˆè€—
4. éªŒè¯é”™è¯¯å¤„ç†

---

## ğŸ†˜ è·å–å¸®åŠ©

### é—®é¢˜æ’æŸ¥

1. æŸ¥çœ‹ [å¸¸è§é”™è¯¯](#-å¸¸è§é”™è¯¯)
2. æ£€æŸ¥ [æ•…éšœæ’æŸ¥æŒ‡å—](../../doc/testing/gRPCé›†æˆæµ‹è¯•æŒ‡å—.md#æ•…éšœæ’æŸ¥)
3. æŸ¥çœ‹ Python æœåŠ¡æ—¥å¿—
4. æŸ¥çœ‹ Go æµ‹è¯•è¾“å‡º

### æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: `doc/testing/` ç›®å½•
- **ç¤ºä¾‹**: `doc/testing/gRPCæµ‹è¯•ç»“æœç¤ºä¾‹.md`
- **ä»£ç **: `test/integration/` ç›®å½•

---

**æœ€åæ›´æ–°**: 2025-10-31  
**ç»´æŠ¤è€…**: é’ç¾½åç«¯æ¶æ„å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v1.0

